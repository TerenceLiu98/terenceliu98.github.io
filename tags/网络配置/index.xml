<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>ç½‘ç»œé…ç½® | ç‰¹å€«è˜‡çš„æ—¥èˆ‡å¤œ</title>
    <link>https://blog.cklau.cc/tags/%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE/</link>
      <atom:link href="https://blog.cklau.cc/tags/%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE/index.xml" rel="self" type="application/rss+xml" />
    <description>ç½‘ç»œé…ç½®</description>
    <generator>Source Themes Academic (https://sourcethemes.com/academic/)</generator><language>en</language><lastBuildDate>Mon, 29 Jan 2024 00:00:00 +0800</lastBuildDate>
    <item>
      <title>ğŸ›œ å¢ƒå†…å¤– CDN åˆ†æµé…ç½®</title>
      <link>https://blog.cklau.cc/post/cdn-divertor.zh/</link>
      <pubDate>Mon, 29 Jan 2024 00:00:00 +0800</pubDate>
      <guid>https://blog.cklau.cc/post/cdn-divertor.zh/</guid>
      <description>&lt;p&gt;æœ¬æ–‡çº¯å±ä¸ªäººè®°å½•ï¼Œä¸ä¿è¯æ˜¯æœ€ä¼˜è§£å†³æ–¹æ¡ˆï¼Œä»…ä¾›å‚è€ƒã€‚ å¯¹äºåšå®¢çš„å¢ƒå†…å¤– CDN åˆ†æµæœ‰å¾ˆå¤šæ›´åŠ ä¼˜é›…çš„æ–¹å¼ï¼Œè€Œæˆ‘é€‰æ‹©äº†æœ€è ¢çš„ã€Œè·³è½¬ã€ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‰ç½®æ¡ä»¶&#34;&gt;å‰ç½®æ¡ä»¶&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;æˆ‘çš„é™æ€åšå®¢æ˜¯æ‰˜ç®¡åœ¨ &lt;a href=&#34;https://pages.github.com&#34;&gt;GitHub Page&lt;/a&gt;ï¼Œå¹¶ä¸”ä½¿ç”¨äº† &lt;a href=&#34;https://www.cloudflare.com&#34;&gt;Cloudflare&lt;/a&gt; çš„ CDN æœåŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;æˆ‘æ‹¥æœ‰ä¸€å°å¢ƒå†…æœåŠ¡å™¨ï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ªå·²å¤‡æ¡ˆåŸŸåï¼Œå¯ä»¥æ»¡è¶³å›½å†… CDN çš„è¦æ±‚ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;å¢ƒå†…å¤–-cdn-åˆ†æµ&#34;&gt;å¢ƒå†…å¤– CDN åˆ†æµ&lt;/h2&gt;
&lt;h3 id=&#34;ç½‘ç«™è¿è¡Œ&#34;&gt;ç½‘ç«™è¿è¡Œ&lt;/h3&gt;
&lt;p&gt;æˆ‘çš„ç½‘ç«™éƒ¨ç½²æµç¨‹æ˜¯è¿™æ ·çš„ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åœ¨æœ¬åœ°ç¼–å†™åšå®¢å†…å®¹ï¼Œä½¿ç”¨ &lt;a href=&#34;https://gohugo.io&#34;&gt;Hugo&lt;/a&gt; ç”Ÿæˆé™æ€ç½‘é¡µè¿›è¡Œå†…å®¹æ¸²æŸ“è¿›è¡Œæ£€æŸ¥ã€‚&lt;/li&gt;
&lt;li&gt;å°† source file æ¨åŠ¨åˆ° &lt;a href=&#34;https://github.com/terenceliu98.github.io.source&#34;&gt;TerenceLiu98.github.io.source&lt;/a&gt; ä»“åº“ï¼Œä½¿ç”¨ GitHub Action è¿›è¡Œè‡ªåŠ¨éƒ¨ç½²ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨ GitHub Action ä¸­ï¼Œä½¿ç”¨ Hugo ç”Ÿæˆé™æ€ç½‘é¡µï¼Œå¹¶å°†ç”Ÿæˆçš„ç½‘é¡µæ¨é€åˆ° &lt;a href=&#34;https://github.com/terenceliu98.github.io&#34;&gt;TerenceLiu98.github.io&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;åœ¨ Cloudflare ä¸­ï¼Œå°† &lt;a href=&#34;https://github.com/terenceliu98.github.io&#34;&gt;TerenceLiu98.github.io&lt;/a&gt; ä»“åº“çš„å†…å®¹è¿›è¡Œ CDN åŠ é€Ÿã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;å…·ä½“é…ç½®&#34;&gt;å…·ä½“é…ç½®&lt;/h3&gt;
&lt;p&gt;ä½ éœ€è¦åœ¨å›½å†…çš„æœåŠ¡å™¨ä¸Šæ­å»ºä¸€ä¸ª HTTP æœåŠ¡ï¼Œç”¨äºåˆ†æµå¢ƒå†…çš„è¯·æ±‚ã€‚è¿™é‡Œæˆ‘ä½¿ç”¨äº† &lt;a href=&#34;https://www.nginx.com&#34;&gt;Nginx&lt;/a&gt; ä½œä¸º HTTP æœåŠ¡ï¼Œå› ä¸ºæˆ‘ä»ä¸€å¼€å§‹å°±åœ¨ä½¿ç”¨ nginx æ‰€ä»¥ç›¸å¯¹ç†Ÿæ‚‰ã€‚ä¸è¿‡ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»– HTTP æœåŠ¡ï¼Œæ¯”å¦‚ &lt;a href=&#34;https://caddyserver.com&#34;&gt;Caddy&lt;/a&gt;ï¼ŒCaddy æœ‰ä¸€ä¸ªå¾ˆå¥½çš„ç‰¹æ€§ï¼Œå°±æ˜¯å¯ä»¥è‡ªåŠ¨ç”³è¯· HTTPS è¯ä¹¦ï¼Œè¿™æ ·ä½ å°±ä¸éœ€è¦è‡ªå·±å»ç”³è¯·è¯ä¹¦äº†ã€‚æˆ‘è¿™é‡Œä½¿ç”¨ ACME è¿›è¡Œè¯ä¹¦ç”³è¯·ï¼Œæ‰€ä»¥å°±ä¸å†ä½¿ç”¨ Caddy äº†ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;server &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       	listen 80;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      	listen &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;::&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;:80;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      	server_name blog.rho.ac.cn;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;301&lt;/span&gt; https://$host$request_uri;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;server &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        listen &lt;span style=&#34;color:#ae81ff&#34;&gt;443&lt;/span&gt; ssl;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        server_name blog.rho.ac.cn;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ssl_certificate /home/ubuntu/acme-script/ssl/rho.ac.cn.pem;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ssl_certificate_key /home/ubuntu/acme-script/ssl/rho.ac.cn.key;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	root /var/www/terenceliu98.github.io;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	index index.php index.html index.htm;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  location / &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  	try_files $uri $uri/ &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;404;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…¶ä¸­ï¼Œ&lt;code&gt;server_name&lt;/code&gt; æ˜¯å‡†å¤‡çš„å¤‡æ¡ˆååŸŸåï¼Œ&lt;code&gt;root&lt;/code&gt; æŒ‡å‘çš„æ˜¯æˆ‘å­˜å‚¨åšå®¢å†…å®¹çš„åœ°æ–¹ï¼Œ&lt;code&gt;index&lt;/code&gt; æŒ‡å®šäº†é»˜è®¤çš„é¦–é¡µã€‚&lt;code&gt;ssl_certificate&lt;/code&gt; å’Œ &lt;code&gt;ssl_certificate_key&lt;/code&gt; æŒ‡å®šäº† HTTPS è¯ä¹¦çš„ä½ç½®ã€‚ä½ ä¹Ÿå¯ä»¥å¯¹ nginx é…ç½®æ–‡ä»¶è¿›è¡Œå®šåˆ¶ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚åœ¨å‡†å¤‡å¥½è¿™äº›ä»¥åï¼Œå¯ä»¥å°è¯•è¿è¡Œç½‘ç«™ï¼Œå¦‚æœæ²¡æœ‰é—®é¢˜ï¼Œé‚£ä¹ˆå°±å¯ä»¥è¿›è¡Œä¸‹ä¸€æ­¥äº†ã€‚&lt;/p&gt;
&lt;p&gt;å½“ç„¶ï¼Œè¿™é‡Œåº”è¯¥ä¼šé‡åˆ°ä¸€ä¸ªåŸŸåé”™è¯¯çš„é—®é¢˜ï¼Œå› ä¸ºåœ¨ Hugo é‡Œæˆ‘ä»¬é…ç½®äº† CNAMEï¼Œæ‰€ä»¥å®ƒåœ¨æ¸²æŸ“çš„æ—¶å€™ä¼šå°†åŸŸåæ›¿æ¢æˆ CNAME ä¸­æŒ‡å®šçš„åŸŸåï¼Œè¿™æ ·å°±ä¼šå‡ºç°åŸŸåä¸åŒ¹é…çš„é—®é¢˜ã€‚è¿™é‡Œæˆ‘ä½¿ç”¨äº†ä¸€ä¸ªå¾ˆè ¢çš„æ–¹å¼è§£å†³ï¼Œå°±æ˜¯åœ¨ Hugo æ¸²æŸ“ä¹‹åï¼Œè¿›è¡ŒåŸŸåæ›¿æ¢ã€‚è¿™é‡Œæˆ‘ä½¿ç”¨äº†ä¸€ä¸ª Bash è„šæœ¬ï¼Œå°†åŸŸåæ›¿æ¢æˆäº†æˆ‘å‡†å¤‡çš„å¤‡æ¡ˆååŸŸåã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git restore . &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; git pull
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; file in &lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;find -iname &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;*.html&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt;; &lt;span style=&#34;color:#66d9ef&#34;&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	sed -i &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;s/blog.cklau.cc/blog.rho.ac.cn/g&amp;#39;&lt;/span&gt; $file
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;done&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨ç½‘ç«™å¯ä»¥æ­£å¸¸è¿è¡Œåï¼Œæˆ‘ä»¬ä»…éœ€è¦åœ¨è…¾è®¯äº‘çš„ CDN æ§åˆ¶å°é‡Œæ·»åŠ è‡ªå·±çš„åŸŸåå³å¯ï¼Œå°†åŸŸåè§£æåˆ°æä¾›çš„ CNAMEï¼Œä¸»æºç«™æŒ‡å‘è‡ªå·±å›½å†…çš„æœåŠ¡å™¨ IPï¼Œé…ç½®å¥½å›æº Host å³å¯&lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;ã€‚å…¶ä»–å¹³å°ä¹Ÿæ˜¯ä¸€æ ·çš„æ–¹æ³•ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚&lt;/p&gt;
&lt;p&gt;Cloudflare çš„é…ç½®ä¹Ÿååˆ†ç®€å•ï¼Œä»…éœ€è¦åœ¨ Rules é‡Œæ·»åŠ ä¸€ä¸ªè§„åˆ™ï¼Œæˆ‘è¿™é‡Œé€‰æ‹©çš„æ˜¯æ ¹æ®å›½å®¶è¿›è¡Œåˆ†æµï¼Œè¿™æ ·è™½ç„¶æ˜¯ä¸€åˆ€åˆ‡ï¼Œä½†æ˜¯ç¡®å®ä¿è¯äº†ç”¨æˆ·çš„ä½¿ç”¨ä½“éªŒï¼ˆä¹Ÿæ˜¯å› ä¸ºæˆ‘ä¹°ä¸èµ· GeoDNSï¼‰ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åç»­&#34;&gt;åç»­&lt;/h3&gt;
&lt;p&gt;å› ä¸ºè…¾è®¯äº‘ CDN çš„ HTTPS éœ€è¦è‡ªå·±æä¾›è¯ä¹¦ï¼ˆä¹Ÿéœ€è¦ä»˜è´¹ï¼‰ï¼Œæ‰€ä»¥æˆ‘å°†åˆšæ‰ç”³è¯·åˆ°çš„ ACME è¯ä¹¦æ·»åŠ åˆ°äº†æŒ‡å®šçš„åœ°æ–¹ï¼Œä¸çŸ¥é“æ˜¯å¦æœ‰å¯ä»¥è‡ªåŠ¨åŒ–çš„æ–¹æ³•ï¼Œä¸ç„¶å°±éœ€è¦ä¸‰ä¸ªæœˆæ›´æ–°ä¸€æ¬¡è¯ä¹¦äº† ğŸ¥¹ ã€‚&lt;/p&gt;
&lt;div class=&#34;footnotes&#34; role=&#34;doc-endnotes&#34;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&#34;fn:1&#34;&gt;
&lt;p&gt;HOST å°±å¡«è‡ªå·±çš„åŸŸåå³å¯ï¼Œä¸éœ€è¦å¡« IPï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»é…ç½®äº† HTTP æœåŠ¡ï¼Œæ‰€ä»¥éœ€è¦åŸŸåè¿›è¡Œåˆ†æµã€‚&amp;#160;&lt;a href=&#34;#fnref:1&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</description>
    </item>
    
  </channel>
</rss>