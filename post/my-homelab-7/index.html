<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="X-Clacks-Overhead" content="GNU Terry Pratchett" />
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="shortcut icon" href="https://blog.cklau.cc/images/logo.svg" />
<title>ğŸ§‘ğŸ¿â€ğŸ’» Homelab: CloudFlare is All you Need | ç‰¹å€«è˜‡çš„æ—¥èˆ‡å¤œ</title>
<meta name="title" content="ğŸ§‘ğŸ¿â€ğŸ’» Homelab: CloudFlare is All you Need" />
<meta name="description" content="å›åˆ°åŸç‚¹ï¼Œåˆå¼€å§‹äº†ä¸€å¹´ä¸€åº¦çš„ Homelab æŠ˜è…¾ã€‚è¿™ä¸€æ¬¡ï¼Œ æ‰“ç®—æ•´ç‚¹ã€Œèµ·å¤œã€çº§æ–¹æ¡ˆ :)" />
<meta name="keywords" content="homelab,networking,hardware,ç½‘ç»œ,å­˜å‚¨,NAS," />


<meta property="og:title" content="ğŸ§‘ğŸ¿â€ğŸ’» Homelab: CloudFlare is All you Need" />
<meta property="og:description" content="å›åˆ°åŸç‚¹ï¼Œåˆå¼€å§‹äº†ä¸€å¹´ä¸€åº¦çš„ Homelab æŠ˜è…¾ã€‚è¿™ä¸€æ¬¡ï¼Œ æ‰“ç®—æ•´ç‚¹ã€Œèµ·å¤œã€çº§æ–¹æ¡ˆ :)" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.cklau.cc/post/my-homelab-7/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2024-08-10T00:11:21+08:00" />
<meta property="article:modified_time" content="2024-08-10T00:11:21+08:00" />




<meta name="twitter:card" content="summary"/><meta name="twitter:title" content="ğŸ§‘ğŸ¿â€ğŸ’» Homelab: CloudFlare is All you Need"/>
<meta name="twitter:description" content="å›åˆ°åŸç‚¹ï¼Œåˆå¼€å§‹äº†ä¸€å¹´ä¸€åº¦çš„ Homelab æŠ˜è…¾ã€‚è¿™ä¸€æ¬¡ï¼Œ æ‰“ç®—æ•´ç‚¹ã€Œèµ·å¤œã€çº§æ–¹æ¡ˆ :)"/>



<meta itemprop="name" content="ğŸ§‘ğŸ¿â€ğŸ’» Homelab: CloudFlare is All you Need">
<meta itemprop="description" content="å›åˆ°åŸç‚¹ï¼Œåˆå¼€å§‹äº†ä¸€å¹´ä¸€åº¦çš„ Homelab æŠ˜è…¾ã€‚è¿™ä¸€æ¬¡ï¼Œ æ‰“ç®—æ•´ç‚¹ã€Œèµ·å¤œã€çº§æ–¹æ¡ˆ :)"><meta itemprop="datePublished" content="2024-08-10T00:11:21+08:00" />
<meta itemprop="dateModified" content="2024-08-10T00:11:21+08:00" />
<meta itemprop="wordCount" content="415">
<meta itemprop="keywords" content="homelab,networking,hardware,ç½‘ç»œ,å­˜å‚¨,NAS," />
<meta name="referrer" content="no-referrer-when-downgrade" />

  <style>
  body {
    font-family: "Noto Serif SC", serif;
    font-weight: 500;
    font-style: normal;
    margin: auto;
    padding: 20px;
    max-width: 980px;
    text-align: left;
    background-color: #fff;
    word-wrap: break-word;
    overflow-wrap: break-word;
    line-height: 1.5;
    color: #444;
  }

  h1,
  h2,
  h3,
  h4,
  h5,
  h6,
  strong,
  b {
    color: #222;
  }

  a {
    color: #444;
    text-decoration: none;
     
  }

  .title {
    text-decoration: none;
    border: 0;
  }

  .title span {
    font-weight: 400;
  }

  nav a {
    margin-right: 10px;
  }

  textarea {
    width: 100%;
    font-size: 16px;
  }

  input {
    font-size: 16px;
  }

  content {
    line-height: 1.6;
  }

  main content p a {
    word-wrap: break-word;
    border: none;
    box-shadow: inset 0 -2px #444;
    transition-property: box-shadow;
    transition-duration: .1s;
  }

  table {
    width: 100%;
  }

  img {
    max-width: 100%;
  }

  code {
    padding: 2px 5px;
    background-color: #f2f2f2;
  }

  pre code {
    color: #222;
    display: block;
    padding: 20px;
    white-space: pre-wrap;
    font-size: 14px;
    overflow-x: auto;
  }

  div.highlight pre {
    background-color: initial;
    color: initial;
  }

  div.highlight code {
    background-color: unset;
    color: unset;
  }

  blockquote {
    border-left: 1px solid #999;
    color: #222;
    padding-left: 20px;
    font-style: italic;
  }

  footer {
    padding: 25px;
    text-align: center;
  }

  .helptext {
    color: #777;
    font-size: small;
  }

  .errorlist {
    color: #eba613;
    font-size: small;
  }

   
  ul.blog-posts {
    list-style-type: none;
    padding: unset;
    line-height: 2;
  }

  ul.blog-posts li {
    display: flex;
  }

  ul.blog-posts li span {
    flex: 0 0 6.5rem;
  }

  ul.blog-posts li time {
    color: #8e8d8d;
  }

  ul.blog-posts li a:visited {
    color: #8b6fcb;
  }


   


  .bg { background-color: #f0f0f0; }
  .chroma { background-color: #f0f0f0; }
  .chroma .x {  }
  .chroma .err {  }
  .chroma .cl {  }
  .chroma .lnlinks { outline: none; text-decoration: none; color: inherit }
  .chroma .lntd { vertical-align: top; padding: 0; margin: 0; border: 0; }
  .chroma .lntable { border-spacing: 0; padding: 0; margin: 0; border: 0; }
  .chroma .hl { background-color: #ffffcc }
  .chroma .lnt { white-space: pre; user-select: none; margin-right: 0.4em; padding: 0 0.4em 0 0.4em;color: #7f7f7f }
  .chroma .ln { white-space: pre; user-select: none; margin-right: 0.4em; padding: 0 0.4em 0 0.4em;color: #7f7f7f }
  .chroma .line { display: flex; }
  .chroma .k { color: #007020; font-weight: bold }
  .chroma .kc { color: #007020; font-weight: bold }
  .chroma .kd { color: #007020; font-weight: bold }
  .chroma .kn { color: #007020; font-weight: bold }
  .chroma .kp { color: #007020 }
  .chroma .kr { color: #007020; font-weight: bold }
  .chroma .kt { color: #902000 }
  .chroma .n {  }
  .chroma .na { color: #4070a0 }
  .chroma .nb { color: #007020 }
  .chroma .bp {  }
  .chroma .nc { color: #0e84b5; font-weight: bold }
  .chroma .no { color: #60add5 }
  .chroma .nd { color: #555555; font-weight: bold }
  .chroma .ni { color: #d55537; font-weight: bold }
  .chroma .ne { color: #007020 }
  .chroma .nf { color: #06287e }
  .chroma .fm {  }
  .chroma .nl { color: #002070; font-weight: bold }
  .chroma .nn { color: #0e84b5; font-weight: bold }
  .chroma .nx {  }
  .chroma .py {  }
  .chroma .nt { color: #062873; font-weight: bold }
  .chroma .nv { color: #bb60d5 }
  .chroma .vc {  }
  .chroma .vg {  }
  .chroma .vi {  }
  .chroma .vm {  }
  .chroma .l {  }
  .chroma .ld {  }
  .chroma .s { color: #4070a0 }
  .chroma .sa { color: #4070a0 }
  .chroma .sb { color: #4070a0 }
  .chroma .sc { color: #4070a0 }
  .chroma .dl { color: #4070a0 }
  .chroma .sd { color: #4070a0; font-style: italic }
  .chroma .s2 { color: #4070a0 }
  .chroma .se { color: #4070a0; font-weight: bold }
  .chroma .sh { color: #4070a0 }
  .chroma .si { color: #70a0d0 }
  .chroma .sx { color: #c65d09 }
  .chroma .sr { color: #235388 }
  .chroma .s1 { color: #4070a0 }
  .chroma .ss { color: #517918 }
  .chroma .m { color: #40a070 }
  .chroma .mb { color: #40a070 }
  .chroma .mf { color: #40a070 }
  .chroma .mh { color: #40a070 }
  .chroma .mi { color: #40a070 }
  .chroma .il { color: #40a070 }
  .chroma .mo { color: #40a070 }
  .chroma .o { color: #666666 }
  .chroma .ow { color: #007020; font-weight: bold }
  .chroma .p {  }
  .chroma .c { color: #60a0b0; font-style: italic }
  .chroma .ch { color: #60a0b0; font-style: italic }
  .chroma .cm { color: #60a0b0; font-style: italic }
  .chroma .c1 { color: #60a0b0; font-style: italic }
  .chroma .cs { color: #60a0b0; background-color: #fff0f0 }
  .chroma .cp { color: #007020 }
  .chroma .cpf { color: #007020 }
  .chroma .g {  }
  .chroma .gd { color: #a00000 }
  .chroma .ge { font-style: italic }
  .chroma .gr { color: #ff0000 }
  .chroma .gh { color: #000080; font-weight: bold }
  .chroma .gi { color: #00a000 }
  .chroma .go { color: #888888 }
  .chroma .gp { color: #c65d09; font-weight: bold }
  .chroma .gs { font-weight: bold }
  .chroma .gu { color: #800080; font-weight: bold }
  .chroma .gt { color: #0044dd }
  .chroma .gl { text-decoration: underline }
  .chroma .w { color: #bbbbbb }


 
.sidenote {
    font-size: 80%;         
    font-weight: normal;
    color: var(--theme-hl1-color);
    position: relative;     
}
 
@media (min-width: 1400px) {
    .sidenote {
        float: right;
        clear: right;            
        text-align: left;

         
            
        top: -3rem;             
        width: 20vw;            
        margin-right: -23vw;     
        margin-top: 1rem;       
    }
}
 
 
@media (max-width: 1400px) {
    .sidenote {
         
        float: right;
        text-align: left;

            
        width: 100%;  
        margin: 1rem 0;
        padding-left: 5%;  
    }
}
 
 
body {
    counter-reset: sidenote-counter;
}
.sidenote-number {
    counter-increment: sidenote-counter;
}
 
.sidenote::before {
    content: "\2020";
    position: relative;
    vertical-align: super;
    font-size: 0.9em;
    font-weight: bold;
}
 
.sidenote-number::after {
    content: "\2020";
    position: relative;
    vertical-align: super;
    font-size: 0.7em;
    font-weight: bold;
    color: var(--theme-body-color);
    display: inline;
    margin-right: 0.2rem;
}
@media (min-width: 1400px) {
     
    .sidenote-number:hover .sidenote {
        background-color: var(--theme-color-light);
    }
}

  
.card-container {
    display: flex;
    flex-direction: column;
    align-items: center;  
    gap: 5px;  
    padding: 5px;
}

.card {
    width: 80%;  
    box-shadow: 0 0px 0px rgba(0,0,0,0.1);  
    display: flex;
    align-items: center;  
    padding: 10px;
    background: white;  
    text-decoration: none;  
    color: inherit;  
}

.card img {
    width: 80px;  
    height: 80px;
    border-radius: 50%;  
    margin-right: 20px;  
}

.card .info h2 {
    margin: 0;
    font-size: 1.2em;  
}

.card .info p {
    margin: 5px 0 0;  
    font-size: 0.9em;
    color: #444;  
}
.card .info span{
    font-size: 0.5em;
    color: #666;
}
</style>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;500&display=swap" rel="stylesheet">
<script defer data-domain="nova.moe" src="https://possible.knat.network/js/script.js"></script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1844674035384472" crossorigin="anonymous"></script>
<link rel="alternate" type="application/rss+xml" href="https://blog.cklau.cc/feed.xml" title="ç‰¹å€«è˜‡çš„æ—¥èˆ‡å¤œ">

</head>

<body>
  <header><a href="/" class="title">
  <h2>ç‰¹å€«è˜‡çš„æ—¥èˆ‡å¤œ</h2>
</a>
<nav><a href="/">Home</a>

<a href="/post">[Blog]</a>

<a href="/post/scientia">[Scientia]</a>

<a href="/links">[Links]</a>

</nav>
</header>
  <main>
<h1>ğŸ§‘ğŸ¿â€ğŸ’» Homelab: CloudFlare is All you Need</h1>
<p>
  <i>
    <time datetime='2024-08-10' pubdate>
      10 Aug, 2024
    </time>
  </i>
</p>

<content>
  <p>å›åˆ°åŸç‚¹ï¼Œåˆå¼€å§‹äº†ä¸€å¹´ä¸€åº¦çš„ Homelab æŠ˜è…¾ã€‚è¿™ä¸€æ¬¡ï¼Œ æ‰“ç®—æ•´ç‚¹ã€Œèµ·å¤œã€çº§æ–¹æ¡ˆ :)</p>
<p>ä½•ä¸ºä¼ä¸šçº§æ–¹æ¡ˆ?</p>
<p>å¤§è‡´æ¥è¯´ï¼Œå°±æ˜¯å¾ˆç¨³ï¼Œéå¸¸ç¨³ï¼Œååˆ†æœ‰åäºŒåˆ†çš„ç¨³ã€‚è‡³å°‘æ˜¯æ­£å‘æ¨ç†çš„æ—¶å€™æ˜¯è¿™æ ·çš„ï¼Œè‡³äºæ„å¤–æƒ…å†µï¼Œä¸åˆ—å…¥è€ƒè™‘èŒƒå›´<span class="sidenote-number">
	<small class="sidenote">
	ä½œä¸ºä¼ä¸šçº§æ–¹æ¡ˆï¼Œè‡ªç„¶éœ€è¦æ˜¯éœ€è¦åº”æ€¥é¢„æ¡ˆï¼Œè‡³äºèƒ½ä¸èƒ½é‡ä¸Šå°±å†è®®
	</small>
</span>ã€‚ é‚£ä¹ˆä½œä¸ºä¸€ä¸ª <code>yaml</code> ç©å®¶ï¼Œè‡ªç„¶è€Œç„¶çš„é€‰æ‹©å°±åªä¼šè½åœ¨ Kubernetes ä¹‹ä¸Šï¼Œè‡³äºå¦‚ä½•é€šè¿‡ <code>kubeadm</code> æ­å»ºé«˜å¯ç”¨çš„ K8s é›†ç¾¤ï¼Œä¸åœ¨æœ¬æ–‡è®¨è®ºèŒƒå›´ä¹‹å†…ï¼Œè¯·å‚è€ƒä»¥å‰çš„æ–‡ç« ã€‚ å½“ç„¶ï¼Œä¸ºäº†<ruby >
    <span>å¢åŠ å¯è®¿é—®æ€§</span>
    <rp>(</rp><rt >
            ç»•è¿‡åŸŸåå¤‡æ¡ˆ</rt><rp>)</rp>
</ruby>ï¼Œæˆ‘çš„ç¬¬ä¸€é€‰æ‹©å½“æ—¶æ˜¯é€‰æ‹©åœ°å¤„é¦™æ¸¯çš„æœåŠ¡å™¨ä½œä¸ºé›†ç¾¤çš„ä¸»æ§èŠ‚ç‚¹ã€‚æ— æ³•å¦è®¤çš„æ˜¯ï¼ŒAWS/Azure/GCP çš„æœåŠ¡å™¨æ˜¯æˆ‘ç­‰ç©·å­¦ç”Ÿæ— æ³•è´Ÿæ‹…å¾—èµ·çš„ï¼Œè€Œå°ä¼—å•†å®¶åˆæœ‰ç€æ¦‚ç‡è·‘è·¯/è¾ƒé«˜æ¦‚ç‡è¢«æ”»å‡»ï¼Œæœ¬ç€ã€Œèµ·å¤œçº§ã€çš„æ€æƒ³ï¼Œæœ€ç»ˆå°†é›†ç¾¤çš„ä¸»æ§èŠ‚ç‚¹å®šåœ¨äº†åƒç°ä¸­çš„è…¾è®¯äº‘å¹¿å·è½»é‡åº”ç”¨æœåŠ¡å™¨ï¼ˆç¨³å®šä¸”ä½å»¶è¿Ÿï¼‰ã€‚</p>
<p>åœ¨ç»è¿‡å¾ˆå¤šå¹´çš„å¤§æµªæ·˜æ²™ä¹‹åï¼Œæ‰‹é‡Œä»…å‰©ä¸‹ä¸¤å°æœºå™¨<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>ï¼Œä¸€å°ä½œä¸ºä¸»å­˜å‚¨èŠ‚ç‚¹ (Riemann)ï¼Œè€Œå¦å¤–ä¸€å°åˆ™æ˜¯è®¡ç®—èŠ‚ç‚¹ (Nexus)ï¼Œæ¯”è¾ƒæœ‰æ„æ€çš„æ˜¯ï¼Œè®¡ç®—èŠ‚ç‚¹ä¸Šå…¶å®ä¹Ÿæ’äº†ä¸€äº›å­˜å‚¨ç”¨çš„ç¡¬ç›˜è€Œå­˜å‚¨èŠ‚ç‚¹ä¸Šä¹Ÿæœ‰ä¸€äº›è®¡ç®—èµ„æºã€‚ä¸ºäº†ä¸æµªè´¹å­˜å‚¨ä¸”å®Œæˆã€Œèµ·å¤œã€çº§çš„ä¸­å¿ƒæ€æƒ³ï¼Œæˆ‘é€‰æ‹©äº† GlusterFS ä½œä¸ºä¸»è¦çš„æ–‡ä»¶ç³»ç»Ÿã€‚è¯šç„¶ï¼Œ Ceph æ‰æ˜¯ä¸»æµï¼ŒGlusterFS è¿™ç§ç‰›å¤«äººæ‰æ˜¯<del>ç¨³å®šå¯é ä¹‹é€‰</del>ã€‚</p>
<p>ä¸€åˆ‡éƒ¨ç½²å®Œæ¯•ä»¥åï¼Œå¦‚ä½•è®©èº«å¤„ UTC çš„æˆ‘å¿«é€Ÿè®¿é—® CST çš„å†…å®¹åˆ™æˆä¸ºäº†ä¸‹ä¸€ä¸ªä¼ä¸šçº§éš¾é¢˜ã€‚å¯¹äºçœŸæ­£çš„ä¼ä¸šæ¥è¯´ï¼Œå½“ç„¶ä¸éš¾ï¼š</p>
<ol>
<li>IPLC/IEPL ç›´æ¥æ‹‰ä¸“çº¿ï¼›ä½†ï¼Œæ¨ªè·¨äºšæ¬§å¤§é™†ï¼Œæˆ‘ç›¸ä¿¡ä¹Ÿä¸æ˜¯å¤šå°‘ä¼ä¸šå¯ä»¥æ‰¿æ‹…å¾—èµ·è¿™æ ·çš„ä¸“çº¿</li>
<li>SD-WAN  ä¾æ‰˜æœåŠ¡å•†æä¾›çš„å…¨çƒä¼ è¾“ç½‘ç»œï¼Œé€šè¿‡ SDN æŠ€æœ¯åˆ°è¾¾ä¸åŒçš„ POP ç‚¹</li>
</ol>
<p>è€ƒè™‘åˆ°å­‘ç„¶ä¸€äººçš„æˆ‘å¹¶æ²¡æœ‰å¤ªå®½è£•çš„ç»è´¹ï¼Œæœ€ç»ˆæ²¡æœ‰é€‰æ‹©ååˆ†å¤æ‚çš„æ–¹æ¡ˆï¼Œè€Œæ˜¯ä¾æ‰˜èµ›åšè©è¨<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>çš„å…¨çƒåŠ é€Ÿç½‘ç»œå®ç° SD-WAN çš„éƒ¨åˆ†åŠŸèƒ½ã€‚å½“ç„¶ï¼Œå¹¶ä¸æ˜¯å…¨ç¨‹ä¼ä¸šçº§ï¼Œè€Œæ˜¯ä¸€åŠä¼ä¸šçº§ã€‚å…ˆæ¥è¯´è¯´è¯´ã€Œèµ·å¤œã€çº§éƒ¨åˆ†ï¼š</p>
<p>è€ƒè™‘åˆ°èµ›åšè©è¨åœ¨ CST åœ°åŒºçš„ä½œç”¨æœ‰é™ï¼Œåœ¨ç­›é€‰äº†è®¸ä¹…åï¼Œæˆ‘é€‰æ‹©äº†å‡ ä¸ªä¸­è½¬ç‚¹ï¼šHKG/AMS/LAXã€‚åœ¨è¿™äº›åœ°æ–¹é€‰æ‹©å»‰ä»·ä¸”å“åº”è¿…é€Ÿçš„æœºå™¨ï¼Œæ¥å…¥åˆ°æˆ‘çš„èŠ‚ç‚¹ä¹‹ä¸­ï¼Œä½œä¸ºå‡ºç«™ç¬¬ä¸€æ­¥ã€‚æ³¨æ„ï¼Œè¿™äº›æœºå™¨å¹¶æ²¡æœ‰æ¥å…¥é›†ç¾¤ä¹‹ä¸­ï¼Œåªæ˜¯ä½œä¸ºä¸­è½¬ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šåšåˆ°äº†éš”ç¦»ï¼Œå› ä¸ºå³ä½¿è¿™äº›æœºå™¨æ²¦é™·/æœåŠ¡å•†è·‘è·¯æˆ‘çš„é›†ç¾¤ä¹Ÿä¸ä¼šæ”¶åˆ°å¤ªå¤§çš„ç‰µè¿<sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup>ã€‚è‡³äºå¦‚ä½•ä¸­è½¬ï¼Œåˆ™æ˜¯ Wireguard+VxLAN ä¸€æŠŠæ¢­å†åŠ ä¸€ç‚¹ç‚¹çš„ TCP ä»¥åº”å¯¹å…¨çƒ ISP å¯¹ UDP çš„åŠ£åŒ–ã€‚å¹¶ä¸”ï¼Œæˆ‘å¹¶æ²¡æœ‰å°†ä¸»æ§èŠ‚ç‚¹ä¸æµ·å¤–æœºå™¨äº’è”ï¼Œè¿™æ ·ä¹Ÿé™ä½äº†ä¸»æ§èŠ‚ç‚¹è¢«æ”»ç ´çš„é£é™©ã€‚è€Œè‡³äºä¸ºä»€ä¹ˆè¿™æ ·å¯ä»¥è®¿é—®ï¼Œå°±å…¨é  K8S çš„ External IP äº†:</p>
<ol>
<li>åœ¨é…ç½® MetalLB çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»º External IP æ± ï¼Œå¸¸è§„è®¾ç½®ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šæŠŠé‚£äº›å…¬ç½‘å¯è¾¾çš„ IP æ”¾è¿›å»ï¼Œæ¯”å¦‚æˆ‘è¿™é‡Œçš„è…¾è®¯äº‘çš„ IPï¼›ä½†åœ¨æˆ‘è¿™å¥—æ–¹æ¡ˆä¸­ï¼Œä»…éœ€è¦æŠŠ worker çš„å†…ç½‘ IP æ”¾å…¥å³å¯ï¼š
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">metallb.io/v1beta1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">IPAddressPool</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">ip-pool</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">metallb-system</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">addresses</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">192.168.101.101-192.168.101.102</span> <span style="color:#75715e"># Riemann å’Œ Nexus çš„å†…ç½‘ IPï¼Œéœ€è¦ä¸»æ§èŠ‚ç‚¹ä¹Ÿå¯ä»¥è®¿é—®çš„ IP</span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">metallb.io/v1beta1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">L2Advertisement</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">public-ip</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">metallb-system</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">ipAddressPools</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">ip-pool</span>
</span></span></code></pre></div></li>
<li>é…ç½® Ingress Controllerï¼Œæˆ‘ç›®å‰é€‰æ‹©çš„æ˜¯å®˜æ–¹çš„ <a href="https://github.com/kubernetes/ingress-nginx">ingress-nginx-controller</a>ï¼›å¦‚æœæƒ³è¦å……åˆ†åˆ©ç”¨ IP æ± ä¸­çš„æ‰€æœ‰ IPï¼Œ æˆ‘ä»¬åˆ™éœ€è¦åˆ†åˆ«åˆ›å»ºä¸¤ä¸ª ingress controllerï¼š
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># æ¯ä¸€ä¸ª ingress controller éƒ½æ˜¯ Load Balancerï¼Œ æ‰€ä»¥ä¸€å…±å¯ä»¥æ‹¿åˆ°ä¸¤ä¸ª IP</span>
</span></span><span style="display:flex;"><span>helm upgrade --install ingress-nginx-a ingress-nginx --repo https://kubernetes.github.io/ingress-nginx --namespace ingress-nginx-a --create-namespace
</span></span><span style="display:flex;"><span>helm upgrade --install ingress-nginx-b ingress-nginx --repo https://kubernetes.github.io/ingress-nginx --namespace ingress-nginx-b --create-namespace
</span></span></code></pre></div></li>
<li><code>IPTABLES</code> ä¸€æŠŠæ¢­ï¼Œè®©å¤–éƒ¨æœåŠ¡å™¨è¿›è¡Œç«¯å£è½¬å‘ï¼Œå½“ç„¶ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©å…¶ä»–å·¥å…·ï¼š
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;net.ipv4.ip_forward = 1&#34;</span> | sudo tee /etc/sysctl.conf
</span></span><span style="display:flex;"><span>sudo iptables -t nat -A PREROUTING -p tcp -m multiport --dport 80,443 -j DNAT --to-destination 192.168.101.101:80
</span></span><span style="display:flex;"><span>sudo iptables -t nat -A POSTROUTING -p tcp -d 192.168.101.101 -m multiport --dport 80,443 -j SNAT --to-source 192.168.101.2
</span></span></code></pre></div></li>
</ol>
<p>ä¸‰æ­¥èµ°ä»¥åï¼Œã€Œèµ·å¤œã€çº§çš„é“¾è·¯å°±æ„é€ å®Œæˆäº†ï¼Œè¿™æ—¶åªéœ€è¦æˆ‘ä»¬å°†åŸŸåè§£æåˆ°å¤–éƒ¨æœåŠ¡å™¨çš„ IP ä¸Šå³å¯è®¿é—®é›†ç¾¤å†…éƒ¨éƒ¨ç½²çš„ web æœåŠ¡ã€‚ä¸è¿‡ï¼Œåªæœ‰ä¸‰ä¸ªèŠ‚ç‚¹æ€ä¹ˆæœåŠ¡å…¨çƒï¼Œè¿˜æ˜¯ä¸å¤Ÿå…¨é¢ã€‚ä¸€ä¸ªä¼ä¸šçº§çš„æ–¹æ¡ˆä¸€å®šè¦åšåˆ°å…¨çƒè¦†ç›–ã€‚é‚£æ­¤æ—¶å°±é‚€è¯·åˆ°èµ›åšè©è¨ç™»åœºäº†ã€‚Cloudflare ç»™æ¯ä¸ªç”¨æˆ·éƒ½æä¾›äº†ä¸€ä¸ªéš§é“æœåŠ¡å«åš <a href="https://www.cloudflare.com/products/tunnel/">ã€ŒCloudflare Tunnelã€</a>:</p>
<blockquote>
<p>Cloudflare Tunnel provides you with a secure way to connect your resources to Cloudflare without a publicly routable IP address. With Tunnel, you do not send traffic to an external IP â€” instead, a lightweight daemon in your infrastructure (cloudflared) creates outbound-only connections to Cloudflareâ€™s global network. Cloudflare Tunnel can connect HTTP web servers, SSH servers, remote desktops, and other protocols safely to Cloudflare. This way, your origins can serve traffic through Cloudflare without being vulnerable to attacks that bypass Cloudflare.
æ‘˜è‡ª <a href="https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/">Cloudflare Tunnel å®˜æ–¹æ–‡æ¡£</a></p>
</blockquote>
<p>è¿™é‡Œæåˆ°ï¼ŒCloudflare å®é™…ä¸Šæ˜¯ä»å†…ç½‘ç›´æ¥åˆ° Cloudflare çš„è¾¹ç¼˜èŠ‚ç‚¹ï¼Œè€Œä¸éœ€è¦æœåŠ¡éƒ¨ç½²åœ¨ä¸€ä¸ªå…¬ç½‘å¯è¾¾çš„æœåŠ¡å™¨ä¸Šï¼Œä½†æ˜¯åœ¨è¿™é‡Œï¼Œæˆ‘åœ¨ç›´å°†ä¸‰ä¸ªå…¬ç½‘å¯è¾¾çš„æœåŠ¡å™¨ä½œä¸ºè¿æ¥è¾¹ç¼˜èŠ‚ç‚¹å’ŒæºæœåŠ¡å™¨çš„ä¸­é—´è·³æ¿ï¼Œè€Œå…¶ä¸­çš„è·³æ¿å°±æ˜¯ CF Tunnelã€‚è¿™æ ·å¸ƒç½®çš„å¥½å¤„æ˜¯ï¼Œæˆ‘ä»¬çš„å›æºè·¯å¾„ä¸éœ€è¦ç»è¿‡çº·ç¹å¤æ‚çš„å…¬ç½‘ç»è¿‡æ— æ•°çš„ pop å’Œæ— å°½çš„ç»•è·¯ï¼Œè¢« BGP è½¬çš„æ™•å¤´è½¬å‘ï¼Œæœ€ç»ˆé—å¤±åœ¨å¤ªå¹³æ´‹ï¼›æµé‡åœ¨è¿›å…¥ CF Tunnel ä¼šå»å¯»æ‰¾ç¦»è‡ªå·±æœ€è¿‘çš„â€œæºâ€ç«™ï¼Œç„¶åä¸‹ä¸€è·³å°±æ˜¯â€æºâ€œç«™ï¼ˆé›†ç¾¤ï¼‰äº†<sup id="fnref:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">4</a></sup>ã€‚ Tunnel ä¼šè‡ªåŠ¨å¯»æ‰¾æœ€è¿‘çš„â€œæºâ€ç«™ä¹Ÿæ˜¯å®˜æ–¹æ–‡æ¡£æåŠçš„ï¼š</p>
<blockquote>
<p>By design, replicas(æ˜¯æŒ‡ cloudflared replicas) do not offer any level of traffic steering (random, hash, or round-robin). Instead, when a request arrives to Cloudflare, <strong>it will be forwarded to the replica that is geographically closest</strong>. If that distance calculation is unsuccessful or the connection fails, we will retry others, but there is no guarantee about which connection is chosen.</p>
</blockquote>
<p>å¯¹äº Cloudflare æ¥è¯´ï¼Œå¯èƒ½ä»˜è´¹ç”¨æˆ·éœ€è¦çš„æ˜¯ traffic steeringï¼Œä½†å®é™…ä¸Šï¼Œæˆ‘éœ€è¦çš„æ˜¯ geo steeringã€‚è‡ªæ­¤ï¼š</p>
<ol>
<li>ç¾æ´²ç”¨æˆ·å¤§æ¦‚ç‡ä¼šè¿›å…¥éš§é“åˆ°è¾¾ LAXï¼Œç„¶åè·¨è¶Šå¤ªå¹³æ´‹å›æºï¼›</li>
<li>æ¬§æ´²å’Œéƒ¨åˆ†äºšç»†äºšç”¨æˆ·ä¼šåˆ° AMSï¼Œç„¶åèµ°äº¬å¾·çº¿è·¯å›æºï¼›</li>
<li>å…¶ä»–äºšç»†äºšå’Œå¤§æ´‹æ´²ç”¨æˆ·ä¼šåˆ°è¾¾ HKGï¼Œç„¶åå›æºï¼›</li>
<li>ç›®å‰ï¼Œæ²¡æœ‰æµ‹è¯•è¿‡éæ´²çš„ä½“éªŒï¼Œæ‰€ä»¥æš‚ä¸”æ²¡æœ‰ç»“æœã€‚</li>
</ol>
<p>ç†è®ºä¸Šä¼¼ä¹ä¼šæœ‰åŠ é€Ÿï¼Œé‚£å®é™…ä¸Šæµ‹è¯•å‘¢ï¼Ÿæˆ‘ç”¨ <a href="https://www.dotcom-tools.com/">dotcom-tools</a> å¯¹ç½‘ç«™æ‰“å¼€é€Ÿåº¦è¿›è¡Œæµ‹è¯•ï¼Œé€‰å–äº†é©¬å¾·é‡Œã€åç››é¡¿å’Œé¦™æ¸¯è¿›è¡Œæµ‹è¯•ï¼Œæ•ˆæœå¦‚ä¸‹å›¾ï¼Œå¯ä»¥çœ‹åˆ°ä¸‰åœ°å¹³å‡è®¿é—®é€Ÿåº¦ç¡®å®æ˜¯æœ‰æ‰€æå‡ï¼Œè€Œå…¶ä¸­åç››é¡¿åœ°åŒºçš„æµ‹è¯•ä¸å‡åé™ï¼Œè¿™ä¸ªå¯èƒ½æ˜¯æœ¬èº«æµ‹è¯•èŠ‚ç‚¹åˆ°â€œæºâ€ç«™çš„è·¯ç”±æ¯” CF çš„å¥½å§ï¼Œä¹Ÿæœ‰å¯èƒ½ CF å¸¦è¿™äº›æµé‡å»äº†æ¬§æ´²ï¼Œè¿™å°±ä¸å¾—è€ŒçŸ¥äº†ã€‚ä¸è¿‡æ€»ä½“è€Œè¨€ï¼Œå®éªŒåº”å½“ç®—ä½œæˆåŠŸã€‚</p>
<table>
    <tr>
        <td><img src="https://32cf906.webp.li/2024/08/media-before-cf.png" /></td>
        <td><img src="https://32cf906.webp.li/2024/08/media-cf-speedup.png"/></td>
    </tr>
    <tr>
        <td><center>Before</center></td>
        <td><center>After</center></td>
    </tr>
</table>
<p>è‡ªæ­¤ï¼Œå…¨çƒåŠ é€Ÿéƒ¨åˆ†åˆ°æ­¤ç»“æŸã€‚å¤§æ¦‚çš„æœ‰ç‚¹æœ‰å¦‚ä¸‹å‡ æ¡ï¼š</p>
<ol>
<li>ä»»æ„æ·»åŠ æ¥å…¥ç‚¹ï¼šæˆ‘ä»¬ä»…éœ€è¦è®©æ–°å¢èŠ‚ç‚¹å’Œé›†ç¾¤å»ºç«‹é€šç•…è¿æ¥ï¼Œå³å¯éšæ—¶å¢ï¼ˆåˆ ï¼‰æ¥å…¥ç‚¹ï¼Œä¸»è¦ç›®çš„æ˜¯ç”¨æ¥åº”å¯¹ä¸åŒç½‘ç»œæ³¢åŠ¨å’Œ VPS æœåŠ¡å•† SLA æƒ…å†µã€‚</li>
<li>éšè—æºç«™å’Œé™ä½è´¹ç”¨ï¼šå¦‚æœä½¿ç”¨ GeoDNS å’Œ CDN è¿›è¡ŒåŠ é€Ÿï¼Œåˆ™éœ€è¦æ”¯ä»˜ DNS åˆ†åŒºè§£æå’Œå¯¹åº” CDN çš„è´¹ç”¨ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼Œèµ›åšè©è¨çš„ DNS æ²¡æœ‰åˆ†åŒºè§£æï¼ŒGeo steering éœ€è¦ä»˜è´¹ã€‚</li>
</ol>
<p>å½“ç„¶ï¼Œå®é™…ä¸Šæ–¹æ¡ˆä¾æ—§å­˜åœ¨ç¼ºé™·ï¼Œä¾‹å¦‚ï¼Œæ¥å…¥ç‚¹å’Œé›†ç¾¤è¿æ¥éœ€è¦æ‰‹åŠ¨é…ç½®ï¼ŒCF è·¯ç”±é»‘ç®±ã€‚å½“ç„¶ï¼Œå‰è€…æ˜¯æˆ‘çš„é—®é¢˜ï¼Œåè€…ä¹Ÿæ˜¯æˆ‘çš„é—®é¢˜ã€‚</p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>å®é™…ä¸Šæœ‰äº›åæ‚”ï¼Œä¸ºä»€ä¹ˆä¸æ˜¯å­˜å‚¨èŠ‚ç‚¹å«åš Nexus è®¡ç®—èŠ‚ç‚¹ Riemannï¼Œè¿™æ ·æ‰ç¬¦åˆäººè®¾ã€‚&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>èµ›åšè©è¨ä¹‹æ‰€ä»¥æ˜¯è©è¨ï¼Œæ˜¯å› ä¸ºå–„ã€‚&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3">
<p>è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘é€‰æ‹©è…¾è®¯äº‘çš„æœåŠ¡å™¨ä½œä¸ºä¸»æ§èŠ‚ç‚¹çš„åŸå› ï¼Œæ¯•ç«Ÿæ˜¯å¤§å‚ã€‚&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:4">
<p>è¿™é‡Œæåˆ°çš„ã€Œä¸‹ä¸€è·³ã€æ˜¯æŒ‡ overlay ç½‘ç»œé‡Œçš„ï¼Œå®é™…ä¸Šè¿˜æ˜¯éœ€è¦ç»è¿‡å¾ˆå¤š popï¼Œåªä¸è¿‡å› ä¸ºéƒ½åœ¨è¿™ä¸ªå¤§å†…ç½‘é‡Œä¸ä¼šè¢«å±•ç¤ºå‡ºæ¥ã€‚&#160;<a href="#fnref:4" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>
</content>

<p>
  
  <a href="https://blog.cklau.cc/tags/homelab/">#homelab</a>
  
  <a href="https://blog.cklau.cc/tags/networking/">#networking</a>
  
  <a href="https://blog.cklau.cc/tags/hardware/">#hardware</a>
  
  <a href="https://blog.cklau.cc/tags/%E7%BD%91%E7%BB%9C/">#ç½‘ç»œ</a>
  
  <a href="https://blog.cklau.cc/tags/%E5%AD%98%E5%82%A8/">#å­˜å‚¨</a>
  
  <a href="https://blog.cklau.cc/tags/nas/">#NAS</a>
  
</p>

  </main>
  <footer>


<p>
    <span><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">ç²¤ICPå¤‡2022102668å·</a></span>

&copy; 2024 <a href="https://blog.cklau.cc">Junjie LIU</a>
    <a href="https://blog.cklau.cc/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a>
    <br>
Hosting and images served by <a href="https://cloud.tencent.com/">Tencent Cloud</a> / <a href="https://cloudflare.com/">Cloudflare</a> / <a href="https://webp.se/">WebP Cloud Services</a>
</p>

</footer>

    
</body>

</html>
