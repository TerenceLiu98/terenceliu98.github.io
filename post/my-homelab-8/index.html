<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="X-Clacks-Overhead" content="GNU Terry Pratchett" />
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="shortcut icon" href="https://blog.cklau.cc/images/logo.svg" />
<title>üßëüèø‚Äçüíª Homelab: Cloudflare is All your Need, or Not | ÁâπÂÄ´ËòáÁöÑÊó•ËàáÂ§ú</title>
<meta name="title" content="üßëüèø‚Äçüíª Homelab: Cloudflare is All your Need, or Not" />
<meta name="description" content="ÂõûÂà∞ÂéüÁÇπÔºåÂèàÂºÄÂßã‰∫Ü‰∏ÄÂπ¥‰∏ÄÂ∫¶ÁöÑ Homelab ÊäòËÖæ„ÄÇËøô‰∏ÄÊ¨°Ôºå ÊâìÁÆóÊï¥ÁÇπ„ÄåËµ∑Â§ú„ÄçÁ∫ßÊñπÊ°à :)
Âú®‰∏ä‰∏ÄÁØáÊñáÁ´†‰∏≠ÊèêÂèä‰∫Ü‰∏Ä‰∫õÁΩëÁªúÁõ∏ÂÖ≥ÁöÑÊñπÊ°àÔºåÊØîÂ¶ÇÂ¶Ç‰Ωï‰ΩøÁî® Cloudflare Tunnel ËøõË°å‚ÄúËá™Âª∫ÊúçÂä°ÂÖ®ÁêÉÂä†ÈÄü‚Äù„ÄÇÂÖ∂‰∏≠Ôºå‰πüÊèêÂèä‰∫ÜÂèØ‰ª•Ëá™Âª∫ GeoDNS ËææÂà∞Á±ª‰ººÁöÑÊïàÊûúÔºåÂú®ËøôÈáåÔºåÊàëÂ∞ÜËØ¶ÁªÜÊèèËø∞ÂêÑÁßçÊñπÊ°àÁöÑÂÆûË∑µÁªÜËäÇ„ÄÇ" />
<meta name="keywords" content="homelab,oauth2-proxy,nginx-ingress-controller,GeoDNS,Authoritative DNS,ÂÆâÂÖ®,Èõ∂‰ø°‰ªª,Â≠òÂÇ®,ÊùÉÂ®Å DNS," />


<meta property="og:title" content="üßëüèø‚Äçüíª Homelab: Cloudflare is All your Need, or Not" />
<meta property="og:description" content="ÂõûÂà∞ÂéüÁÇπÔºåÂèàÂºÄÂßã‰∫Ü‰∏ÄÂπ¥‰∏ÄÂ∫¶ÁöÑ Homelab ÊäòËÖæ„ÄÇËøô‰∏ÄÊ¨°Ôºå ÊâìÁÆóÊï¥ÁÇπ„ÄåËµ∑Â§ú„ÄçÁ∫ßÊñπÊ°à :)
Âú®‰∏ä‰∏ÄÁØáÊñáÁ´†‰∏≠ÊèêÂèä‰∫Ü‰∏Ä‰∫õÁΩëÁªúÁõ∏ÂÖ≥ÁöÑÊñπÊ°àÔºåÊØîÂ¶ÇÂ¶Ç‰Ωï‰ΩøÁî® Cloudflare Tunnel ËøõË°å‚ÄúËá™Âª∫ÊúçÂä°ÂÖ®ÁêÉÂä†ÈÄü‚Äù„ÄÇÂÖ∂‰∏≠Ôºå‰πüÊèêÂèä‰∫ÜÂèØ‰ª•Ëá™Âª∫ GeoDNS ËææÂà∞Á±ª‰ººÁöÑÊïàÊûúÔºåÂú®ËøôÈáåÔºåÊàëÂ∞ÜËØ¶ÁªÜÊèèËø∞ÂêÑÁßçÊñπÊ°àÁöÑÂÆûË∑µÁªÜËäÇ„ÄÇ" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.cklau.cc/post/my-homelab-8/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2024-09-19T00:11:21+08:00" />
<meta property="article:modified_time" content="2024-09-19T00:11:21+08:00" />




<meta name="twitter:card" content="summary"/><meta name="twitter:title" content="üßëüèø‚Äçüíª Homelab: Cloudflare is All your Need, or Not"/>
<meta name="twitter:description" content="ÂõûÂà∞ÂéüÁÇπÔºåÂèàÂºÄÂßã‰∫Ü‰∏ÄÂπ¥‰∏ÄÂ∫¶ÁöÑ Homelab ÊäòËÖæ„ÄÇËøô‰∏ÄÊ¨°Ôºå ÊâìÁÆóÊï¥ÁÇπ„ÄåËµ∑Â§ú„ÄçÁ∫ßÊñπÊ°à :)
Âú®‰∏ä‰∏ÄÁØáÊñáÁ´†‰∏≠ÊèêÂèä‰∫Ü‰∏Ä‰∫õÁΩëÁªúÁõ∏ÂÖ≥ÁöÑÊñπÊ°àÔºåÊØîÂ¶ÇÂ¶Ç‰Ωï‰ΩøÁî® Cloudflare Tunnel ËøõË°å‚ÄúËá™Âª∫ÊúçÂä°ÂÖ®ÁêÉÂä†ÈÄü‚Äù„ÄÇÂÖ∂‰∏≠Ôºå‰πüÊèêÂèä‰∫ÜÂèØ‰ª•Ëá™Âª∫ GeoDNS ËææÂà∞Á±ª‰ººÁöÑÊïàÊûúÔºåÂú®ËøôÈáåÔºåÊàëÂ∞ÜËØ¶ÁªÜÊèèËø∞ÂêÑÁßçÊñπÊ°àÁöÑÂÆûË∑µÁªÜËäÇ„ÄÇ"/>



<meta itemprop="name" content="üßëüèø‚Äçüíª Homelab: Cloudflare is All your Need, or Not">
<meta itemprop="description" content="ÂõûÂà∞ÂéüÁÇπÔºåÂèàÂºÄÂßã‰∫Ü‰∏ÄÂπ¥‰∏ÄÂ∫¶ÁöÑ Homelab ÊäòËÖæ„ÄÇËøô‰∏ÄÊ¨°Ôºå ÊâìÁÆóÊï¥ÁÇπ„ÄåËµ∑Â§ú„ÄçÁ∫ßÊñπÊ°à :)
Âú®‰∏ä‰∏ÄÁØáÊñáÁ´†‰∏≠ÊèêÂèä‰∫Ü‰∏Ä‰∫õÁΩëÁªúÁõ∏ÂÖ≥ÁöÑÊñπÊ°àÔºåÊØîÂ¶ÇÂ¶Ç‰Ωï‰ΩøÁî® Cloudflare Tunnel ËøõË°å‚ÄúËá™Âª∫ÊúçÂä°ÂÖ®ÁêÉÂä†ÈÄü‚Äù„ÄÇÂÖ∂‰∏≠Ôºå‰πüÊèêÂèä‰∫ÜÂèØ‰ª•Ëá™Âª∫ GeoDNS ËææÂà∞Á±ª‰ººÁöÑÊïàÊûúÔºåÂú®ËøôÈáåÔºåÊàëÂ∞ÜËØ¶ÁªÜÊèèËø∞ÂêÑÁßçÊñπÊ°àÁöÑÂÆûË∑µÁªÜËäÇ„ÄÇ"><meta itemprop="datePublished" content="2024-09-19T00:11:21+08:00" />
<meta itemprop="dateModified" content="2024-09-19T00:11:21+08:00" />
<meta itemprop="wordCount" content="1678">
<meta itemprop="keywords" content="homelab,oauth2-proxy,nginx-ingress-controller,GeoDNS,Authoritative DNS,ÂÆâÂÖ®,Èõ∂‰ø°‰ªª,Â≠òÂÇ®,ÊùÉÂ®Å DNS," />
<meta name="referrer" content="no-referrer-when-downgrade" />

  <style>
  body {
    font-family: "Noto Serif SC", serif;
    font-weight: 500;
    font-style: normal;
    margin: auto;
    padding: 20px;
    max-width: 980px;
    text-align: left;
    background-color: #fff;
    word-wrap: break-word;
    overflow-wrap: break-word;
    line-height: 1.5;
    color: #444;
  }

  h1,
  h2,
  h3,
  h4,
  h5,
  h6,
  strong,
  b {
    color: #222;
  }

  a {
    color: #444;
    text-decoration: none;
     
  }

  .title {
    text-decoration: none;
    border: 0;
  }

  .title span {
    font-weight: 400;
  }

  nav a {
    margin-right: 10px;
  }

  textarea {
    width: 100%;
    font-size: 16px;
  }

  input {
    font-size: 16px;
  }

  content {
    line-height: 1.6;
  }

  main content p a {
    word-wrap: break-word;
    border: none;
    box-shadow: inset 0 -2px #444;
    transition-property: box-shadow;
    transition-duration: .1s;
  }

  table {
    width: 100%;
  }

  img {
    max-width: 100%;
  }

  code {
    padding: 2px 5px;
    background-color: #f2f2f2;
  }

  pre code {
    color: #222;
    display: block;
    padding: 20px;
    white-space: pre-wrap;
    font-size: 14px;
    overflow-x: auto;
  }

  div.highlight pre {
    background-color: initial;
    color: initial;
  }

  div.highlight code {
    background-color: unset;
    color: unset;
  }

  blockquote {
    border-left: 1px solid #999;
    color: #222;
    padding-left: 20px;
    font-style: italic;
  }

  footer {
    padding: 25px;
    text-align: center;
  }

  .helptext {
    color: #777;
    font-size: small;
  }

  .errorlist {
    color: #eba613;
    font-size: small;
  }

   
  ul.blog-posts {
    list-style-type: none;
    padding: unset;
    line-height: 2;
  }

  ul.blog-posts li {
    display: flex;
  }

  ul.blog-posts li span {
    flex: 0 0 6.5rem;
  }

  ul.blog-posts li time {
    color: #8e8d8d;
  }

  ul.blog-posts li a:visited {
    color: #8b6fcb;
  }


   


  .bg { background-color: #f0f0f0; }
  .chroma { background-color: #f0f0f0; }
  .chroma .x {  }
  .chroma .err {  }
  .chroma .cl {  }
  .chroma .lnlinks { outline: none; text-decoration: none; color: inherit }
  .chroma .lntd { vertical-align: top; padding: 0; margin: 0; border: 0; }
  .chroma .lntable { border-spacing: 0; padding: 0; margin: 0; border: 0; }
  .chroma .hl { background-color: #ffffcc }
  .chroma .lnt { white-space: pre; user-select: none; margin-right: 0.4em; padding: 0 0.4em 0 0.4em;color: #7f7f7f }
  .chroma .ln { white-space: pre; user-select: none; margin-right: 0.4em; padding: 0 0.4em 0 0.4em;color: #7f7f7f }
  .chroma .line { display: flex; }
  .chroma .k { color: #007020; font-weight: bold }
  .chroma .kc { color: #007020; font-weight: bold }
  .chroma .kd { color: #007020; font-weight: bold }
  .chroma .kn { color: #007020; font-weight: bold }
  .chroma .kp { color: #007020 }
  .chroma .kr { color: #007020; font-weight: bold }
  .chroma .kt { color: #902000 }
  .chroma .n {  }
  .chroma .na { color: #4070a0 }
  .chroma .nb { color: #007020 }
  .chroma .bp {  }
  .chroma .nc { color: #0e84b5; font-weight: bold }
  .chroma .no { color: #60add5 }
  .chroma .nd { color: #555555; font-weight: bold }
  .chroma .ni { color: #d55537; font-weight: bold }
  .chroma .ne { color: #007020 }
  .chroma .nf { color: #06287e }
  .chroma .fm {  }
  .chroma .nl { color: #002070; font-weight: bold }
  .chroma .nn { color: #0e84b5; font-weight: bold }
  .chroma .nx {  }
  .chroma .py {  }
  .chroma .nt { color: #062873; font-weight: bold }
  .chroma .nv { color: #bb60d5 }
  .chroma .vc {  }
  .chroma .vg {  }
  .chroma .vi {  }
  .chroma .vm {  }
  .chroma .l {  }
  .chroma .ld {  }
  .chroma .s { color: #4070a0 }
  .chroma .sa { color: #4070a0 }
  .chroma .sb { color: #4070a0 }
  .chroma .sc { color: #4070a0 }
  .chroma .dl { color: #4070a0 }
  .chroma .sd { color: #4070a0; font-style: italic }
  .chroma .s2 { color: #4070a0 }
  .chroma .se { color: #4070a0; font-weight: bold }
  .chroma .sh { color: #4070a0 }
  .chroma .si { color: #70a0d0 }
  .chroma .sx { color: #c65d09 }
  .chroma .sr { color: #235388 }
  .chroma .s1 { color: #4070a0 }
  .chroma .ss { color: #517918 }
  .chroma .m { color: #40a070 }
  .chroma .mb { color: #40a070 }
  .chroma .mf { color: #40a070 }
  .chroma .mh { color: #40a070 }
  .chroma .mi { color: #40a070 }
  .chroma .il { color: #40a070 }
  .chroma .mo { color: #40a070 }
  .chroma .o { color: #666666 }
  .chroma .ow { color: #007020; font-weight: bold }
  .chroma .p {  }
  .chroma .c { color: #60a0b0; font-style: italic }
  .chroma .ch { color: #60a0b0; font-style: italic }
  .chroma .cm { color: #60a0b0; font-style: italic }
  .chroma .c1 { color: #60a0b0; font-style: italic }
  .chroma .cs { color: #60a0b0; background-color: #fff0f0 }
  .chroma .cp { color: #007020 }
  .chroma .cpf { color: #007020 }
  .chroma .g {  }
  .chroma .gd { color: #a00000 }
  .chroma .ge { font-style: italic }
  .chroma .gr { color: #ff0000 }
  .chroma .gh { color: #000080; font-weight: bold }
  .chroma .gi { color: #00a000 }
  .chroma .go { color: #888888 }
  .chroma .gp { color: #c65d09; font-weight: bold }
  .chroma .gs { font-weight: bold }
  .chroma .gu { color: #800080; font-weight: bold }
  .chroma .gt { color: #0044dd }
  .chroma .gl { text-decoration: underline }
  .chroma .w { color: #bbbbbb }


 
.sidenote {
    font-size: 80%;         
    font-weight: normal;
    color: var(--theme-hl1-color);
    position: relative;     
}
 
@media (min-width: 1400px) {
    .sidenote {
        float: right;
        clear: right;            
        text-align: left;

         
            
        top: -3rem;             
        width: 20vw;            
        margin-right: -23vw;     
        margin-top: 1rem;       
    }
}
 
 
@media (max-width: 1400px) {
    .sidenote {
         
        float: right;
        text-align: left;

            
        width: 100%;  
        margin: 1rem 0;
        padding-left: 5%;  
    }
}
 
 
body {
    counter-reset: sidenote-counter;
}
.sidenote-number {
    counter-increment: sidenote-counter;
}
 
.sidenote::before {
    content: "\2020";
    position: relative;
    vertical-align: super;
    font-size: 0.9em;
    font-weight: bold;
}
 
.sidenote-number::after {
    content: "\2020";
    position: relative;
    vertical-align: super;
    font-size: 0.7em;
    font-weight: bold;
    color: var(--theme-body-color);
    display: inline;
    margin-right: 0.2rem;
}
@media (min-width: 1400px) {
     
    .sidenote-number:hover .sidenote {
        background-color: var(--theme-color-light);
    }
}

  
.card-container {
    display: flex;
    flex-direction: column;
    align-items: center;  
    gap: 5px;  
    padding: 5px;
}

.card {
    width: 80%;  
    box-shadow: 0 0px 0px rgba(0,0,0,0.1);  
    display: flex;
    align-items: center;  
    padding: 10px;
    background: white;  
    text-decoration: none;  
    color: inherit;  
}

.card img {
    width: 80px;  
    height: 80px;
    border-radius: 50%;  
    margin-right: 20px;  
}

.card .info h2 {
    margin: 0;
    font-size: 1.2em;  
}

.card .info p {
    margin: 5px 0 0;  
    font-size: 0.9em;
    color: #444;  
}
.card .info span{
    font-size: 0.5em;
    color: #666;
}
</style>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;500&display=swap" rel="stylesheet">
<script defer data-domain="nova.moe" src="https://possible.knat.network/js/script.js"></script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1844674035384472" crossorigin="anonymous"></script>
<link rel="alternate" type="application/rss+xml" href="https://blog.cklau.cc/feed.xml" title="ÁâπÂÄ´ËòáÁöÑÊó•ËàáÂ§ú">

</head>

<body>
  <header><a href="/" class="title">
  <h2>ÁâπÂÄ´ËòáÁöÑÊó•ËàáÂ§ú</h2>
</a>
<nav><a href="/">Home</a>

<a href="/post">[Blog]</a>

<a href="/post/scientia">[Scientia]</a>

<a href="/links">[Links]</a>

</nav>
</header>
  <main>
<h1>üßëüèø‚Äçüíª Homelab: Cloudflare is All your Need, or Not</h1>
<p>
  <i>
    <time datetime='2024-09-19' pubdate>
      19 Sep, 2024
    </time>
  </i>
</p>

<content>
  <p>ÂõûÂà∞ÂéüÁÇπÔºåÂèàÂºÄÂßã‰∫Ü‰∏ÄÂπ¥‰∏ÄÂ∫¶ÁöÑ Homelab ÊäòËÖæ„ÄÇËøô‰∏ÄÊ¨°Ôºå ÊâìÁÆóÊï¥ÁÇπ„ÄåËµ∑Â§ú„ÄçÁ∫ßÊñπÊ°à :)</p>
<p>Âú®‰∏ä‰∏ÄÁØáÊñáÁ´†‰∏≠ÊèêÂèä‰∫Ü‰∏Ä‰∫õÁΩëÁªúÁõ∏ÂÖ≥ÁöÑÊñπÊ°àÔºåÊØîÂ¶ÇÂ¶Ç‰Ωï‰ΩøÁî® Cloudflare Tunnel ËøõË°å‚ÄúËá™Âª∫ÊúçÂä°ÂÖ®ÁêÉÂä†ÈÄü‚Äù„ÄÇÂÖ∂‰∏≠Ôºå‰πüÊèêÂèä‰∫ÜÂèØ‰ª•Ëá™Âª∫ GeoDNS ËææÂà∞Á±ª‰ººÁöÑÊïàÊûúÔºåÂú®ËøôÈáåÔºåÊàëÂ∞ÜËØ¶ÁªÜÊèèËø∞ÂêÑÁßçÊñπÊ°àÁöÑÂÆûË∑µÁªÜËäÇ„ÄÇ</p>
<h2 id="Ëá™Âª∫-geodns-‰ª•ÊëÜËÑ±-cloudflare-ÂûÑÊñ≠">Ëá™Âª∫ GeoDNS ‰ª•ÊëÜËÑ± Cloudflare ÂûÑÊñ≠</h2>
<p>GeoDNS ÊòØ‰∏ÄÁßçÂü∫‰∫éËØ∑Ê±Ç‰ΩçÁΩÆÁöÑÊµÅÈáèÂàÜÈÖçËøáÁ®ãÔºåÈÄöËøáÂà§Êñ≠ËØ∑Ê±Ç IP ÁöÑÂú∞ÁêÜ‰ΩçÁΩÆÔºåÂàÜÈÖçÁ¶ª‰ªñÊúÄËøëÁöÑÂá∫Âè£ IP ‰ª•ËææÂà∞Âü∫‰∫éÂú∞ÁêÜË∑ØÁî±ÁöÑÊµÅÈáè‰ºòÂåñ„ÄÇËØ¥‰∫∫ËØùÂ∞±ÊòØÂêÑ‰∏™Â§ßÊ¥≤ÂàÜÂà´‰∏Ä‰∏™ IP„ÄÇ‰ΩÜÊòØÈóÆÈ¢òÊù•‰∫ÜÔºåË∞Å‰ºöÊèê‰æõËøôÁßçÁúãËµ∑Êù•Â∞±ÂæàÂ•ΩÁöÑÊúçÂä°Âë¢ÔºüËµõÂçöËè©Ëê®Ë°®Á§∫ÔºåÊàë‰ª¨ Anycast Ëµ∑ÂÆ∂ÔºåÂ§©ÁÑ∂Êó†Ê≥ïÊèê‰æõ GeoDNS„ÄÇÂõ†‰∏∫ÂØπ‰∫é Anycast DNS Êù•ËØ¥Ôºå‰ªñ‰ª¨‰ºöÂ∞Ü‰∏Ä‰∏™ IP ÈÄöËøá BGP ÁöÑÊñπÂºèÂú®Â§öÂú∞ÂÆ£ÂëäÔºåÈÇ£‰πàÂØπ‰∫éÁî®Êà∑Êù•ËØ¥ÔºåËÉΩÂê¶Âà∞ËææÁ¶ª‰ªñ‰ª¨ÊúÄËøëÁöÑ IP Â∞±ÂèñÂÜ≥‰∫éÊú¨Âú∞ÁΩëÁªúÊèê‰æõÂïÜÁöÑÊé•ÂÖ•ÊÉÖÂÜµÂíå‰ªãÂÖ•ÊÉÖÂÜµ„ÄÇ‰∏Ä‰∏™ÁÆÄÂçïÁöÑ‰æãÂ≠êÔºöÂ¶ÇÊûúÂΩìÂú∞ÁΩëÁªúÊúçÂä°ÂïÜÂü∫‰∫é‰∏Ä‰∫õÂéüÂõ†Ôºà‰æãÂ¶ÇÂÆâÂÖ®ÂíåÂÜÖÂÆπÂêàËßÑÁ≠âÂéüÂõ†ÔºâÂ∞Ü CDN Êèê‰æõÂïÜÁöÑ IP ÊÆµËøõË°åË∑ØÁî±Á∫ßÂà´ÁöÑÂä£ÂåñÔºåÂàôÊó†ËÆ∫ CDN Êèê‰æõÂïÜÂ§ö‰πàÁöÑÂä™ÂäõÔºå‰πüÊó†Ê≥ïËææÂà∞Âä†ÈÄüÁöÑÁõÆÁöÑ„ÄÇ‰ªéËÆ°ÁÆóÊú∫ÁΩëÁªúÊù•ËØ¥ÔºåAnycast ÁöÑÂÆûÁé∞ÊòØÂú®ÁΩëÁªúÂ±ÇÔºåËÄå GeoDNS ÊòØÂú®Â∫îÁî®Â±ÇÔºåÊâÄ‰ª• Anycast ‰∏çÁü•ÈÅìËØ∑Ê±ÇËÄÖÁöÑ IP ‰ΩçÁΩÆÔºåÊâÄ‰ª•‰ºöÂá∫Áé∞ËøôÊ†∑ÁöÑÊÉÖÂÜµÔºöËôΩÁÑ∂Âú® DNS ÁúãÊù•Ëøô‰∏™ËØ∑Ê±ÇÊõ¥Âä†Êé•ËøëÊüêÂú∞ÁöÑÊúçÂä°Âô®Ôºå‰ΩÜÂÆûÈôÖ‰∏äËøô‰∏™ CDN Á´ôÁÇπÁ¶ªÂéüÁ´ôÊõ¥Ëøú„ÄÇ</p>
<p>Âü∫‰∫é‰ª•‰∏äÁöÑÂá†ÁÇπÔºåÊàëÈÄâÊã©Êê≠Âª∫ GeoDNS Êù•Êõø‰ª£ Cloudflare ÁöÑ Anycast<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>„ÄÇ</p>
<h3 id="ÊùÉÂ®Å-dns-ÁöÑÂÆâË£Ö‰∏éÈÖçÁΩÆauthoritative-dns">ÊùÉÂ®Å DNS ÁöÑÂÆâË£Ö‰∏éÈÖçÁΩÆÔºàAuthoritative DNSÔºâ</h3>
<h4 id="ÂâçÊèê">ÂâçÊèê</h4>
<p>Áé∞Â≠òÊúâ‰∏çÂ∞ëÂºÄÊ∫êÊùÉÂ®Å DNS ËΩØ‰ª∂ÂèØ‰ª•ÈÄâÊã©ÔºåÊØîÂ¶Ç Bind9/PowerDNS Á≠âÁ≠âÔºåÊàëËøôÈáåÈÄâÊã©‰ΩøÁî® PowerDNSÔºåÂéüÂõ†ÊòØÂõ†‰∏∫‰ªñÊúâ pdns-admin ÂèØ‰ª•ËÆ©ÊàëËøõË°å web ÁÆ°ÁêÜÔºåËÄå‰∏çÊòØÈù¢ÂØπÂêÑÁßçÈÖçÁΩÆÊñá‰ª∂Ôºå ÂêåÊó∂ÂÆÉÊòØ‰ΩøÁî®Êï∞ÊçÆÂ∫ìËøõË°å DNS Á∫™ÂΩïÂ≠òÂÇ®ÔºåËÄå‰∏çÊòØË∑ü BIND9 ‰∏ÄÊ†∑ÁöÑÊñáÊú¨Â≠òÂÇ®ÔºåÊõ¥Âä†ÈÄÇÂêàÈ´òÂèØÁî®„ÄÇÂõ†‰∏∫Ê∂âÂèäÂà∞È´òÂèØÁî®ÔºåÈ¶ñÂÖàÊàë‰ª¨ÈúÄË¶ÅÂáÜÂ§á‰∏§Âè∞ VPSÔºåÊàëÈÄâÊã©‰∫Ü‰∏ÄÂè∞È¶ôÊ∏ØÁöÑÊúçÂä°Âô®Âíå‰∏ÄÂè∞Á∫ΩÁ∫¶ÁöÑÊúçÂä°Âô®‰Ωú‰∏∫ ns1 Âíå ns2„ÄÇÂêåÊó∂ÔºåÈô§‰∫ÜÈúÄË¶Å‰ΩøÁî®ÁöÑÂüüÂêçÔºåÊàë‰ª¨ËøòÈúÄË¶Å‰∏Ä‰∏™È¢ùÂ§ñÁöÑÂüüÂêçÂàÜÈÖçÁªô DNS ÊúçÂä°Âô®ÔºåÊâÄ‰ª•ÔºåÂü∫Á°ÄÂáÜÂ§áÂ¶Ç‰∏ã<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>Ôºö</p>
<table>
<thead>
<tr>
<th>ÂüüÂêç</th>
<th>IPV4</th>
<th>IPV6</th>
</tr>
</thead>
<tbody>
<tr>
<td>ns1.example.dns</td>
<td>191.103.113.114</td>
<td>79cc:5f8f:47b1:963e:d248:70ea:0186:b842</td>
</tr>
<tr>
<td>ns2.example.dns</td>
<td>31.84.179.51</td>
<td>9c7d:f2b6:1777:1904:fcfc:3a24:cccd:c0a6</td>
</tr>
<tr>
<td><a href="https://www.example.com">www.example.com</a></td>
<td>249.209.110.226,160.38.17.187,66.167.146.39</td>
<td>NULL</td>
</tr>
</tbody>
</table>
<p>Âú®Êê≠Âª∫ÊùÉÂ®Å DNS ÊúçÂä°Âô®ÁöÑ‰ΩøÁî®ÔºåÊàë‰ª¨Â∏∏Â∏∏Âê¨ËØ¥‰∏Ä‰∏™ËØçÂè´ÂÅöËÉ∂Ê∞¥Á∫™ÂΩï - Glue RecordÔºåËøô‰∏™Á∫™ÂΩï‰πüÊòØ‰∏ÄÁßç DNS Á∫™ÂΩïÔºå‰ΩÜÊòØ‰øùÂ≠òÂú®ÂüüÂêçÊ≥®ÂÜåÂ±ÄÁöÑ DNS ÊúçÂä°Âô®‰∏äÔºå‰æãÂ¶ÇÊü•ËØ¢ <code>www.example.com</code> ÁöÑ Á∫™ÂΩïÊó∂ÔºåËøô‰∏™ËØ∑Ê±ÇÈ¶ñÂÖàÂéªÂà∞ÈÄíÂΩí DNS ÊúçÂä°Âô® <code>R</code>Ôºå ÁÑ∂Âêé <code>R</code> ÂÜçÂéªËØ¢ÈóÆÂØπÂ∫îÁöÑ DNS Ê†πÊúçÂä°Âô® <code>A0</code>Ôºå ÂΩìÁÑ∂Ôºå<code>A0</code> Âπ∂‰∏çÂ≠òÊîæÊâÄÊúâÁöÑÁ∫™ÂΩïÔºå‰ªñÂè™‰ºöÂëäËØâ <code>R</code> ÂØπÂ∫îÁöÑÂüüÂêç <code>example.com</code> Â∫îËØ•ÂéªÂØπÂ∫îÁöÑÊùÉÂ®ÅÊúçÂä°Âô® <code>A1</code> ËøõË°åÊü•ËØ¢„ÄÇ ÊâÄ‰ª•ÔºåËÉ∂Ê∞¥Á∫™ÂΩïÂÆûÈôÖ‰∏äÂ∞±ÊòØ <code>A0</code> Âà∞ <code>A1</code> ÁöÑÊåáÂêë„ÄÇËÄåÊâÄÊúâÁöÑÊ†πÊúçÂä°Âô®ÈÉΩÂèØ‰ª•Âà∞ <a href="https://www.iana.org/domains/root/servers">IANA</a> Êü•Âà∞Ôºå ÂΩìÁÑ∂ÔºåÊàë‰ª¨‰πüÂèØ‰ª•Áõ¥Êé•Áî® <code>dig</code> Êü•Âà∞Ôºö</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">(</span>base<span style="color:#f92672">)</span> <span style="color:#f92672">{}</span> ~ dig com. NS + short
</span></span><span style="display:flex;"><span>;; Invalid option
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>; &lt;&lt;&gt;&gt; DiG 9.10.6 &lt;&lt;&gt;&gt; com. NS + short
</span></span><span style="display:flex;"><span>;; global options: +cmd
</span></span><span style="display:flex;"><span>;; Got answer:
</span></span><span style="display:flex;"><span>;; -&gt;&gt;HEADER<span style="color:#e6db74">&lt;&lt;- opcode: QUERY, status: NOERROR, id: 25108
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">;; flags: qr rd ra; QUERY: 1, ANSWER: 13, AUTHORITY: 0, ADDITIONAL: 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">;; OPT PSEUDOSECTION:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">; EDNS: version: 0, flags:; udp: 1220
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">;; QUESTION SECTION:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">;com.				IN	NS
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">;; ANSWER SECTION:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">com.			35830	IN	NS	h.gtld-servers.net.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">com.			35830	IN	NS	f.gtld-servers.net.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">com.			35830	IN	NS	k.gtld-servers.net.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">com.			35830	IN	NS	b.gtld-servers.net.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">com.			35830	IN	NS	c.gtld-servers.net.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">com.			35830	IN	NS	g.gtld-servers.net.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">com.			35830	IN	NS	d.gtld-servers.net.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">com.			35830	IN	NS	m.gtld-servers.net.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">com.			35830	IN	NS	a.gtld-servers.net.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">com.			35830	IN	NS	j.gtld-servers.net.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">com.			35830	IN	NS	e.gtld-servers.net.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">com.			35830	IN	NS	i.gtld-servers.net.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">com.			35830	IN	NS	l.gtld-servers.net.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">;; Query time: 15 msec
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">;; SERVER: 192.168.1.1#53(192.168.1.1)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">;; WHEN: Thu Sep 26 13:43:28 IST 2024
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">;; MSG SIZE  rcvd: 256
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">;; Got answer:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">;; -&gt;&gt;HEADER&lt;&lt;- opcode</span>: QUERY, status: NXDOMAIN, id: <span style="color:#ae81ff">48582</span>
</span></span><span style="display:flex;"><span>;; flags: qr rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>;; OPT PSEUDOSECTION:
</span></span><span style="display:flex;"><span>; EDNS: version: 0, flags:; udp: <span style="color:#ae81ff">4096</span>
</span></span><span style="display:flex;"><span>;; QUESTION SECTION:
</span></span><span style="display:flex;"><span>;short.				IN	A
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>;; Query time: <span style="color:#ae81ff">5</span> msec
</span></span><span style="display:flex;"><span>;; SERVER: 192.168.1.1#53<span style="color:#f92672">(</span>192.168.1.1<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>;; WHEN: Thu Sep <span style="color:#ae81ff">26</span> 13:43:28 IST <span style="color:#ae81ff">2024</span>
</span></span><span style="display:flex;"><span>;; MSG SIZE  rcvd: <span style="color:#ae81ff">34</span>
</span></span></code></pre></div><p>Êàë‰ª¨ÂèØ‰ª•ÁúãÂà∞ <code>.com</code>Ëøô‰∏™ÂüüÂêçÊòØÂú® <code>a.gtld-servers.net.</code> Âà∞ <code>l.gtld-servers.net.</code> Ëøô‰∫õ DNS Ê†πÊúçÂä°Âô®ËøõË°åÁ∫™ÂΩï„ÄÇÂΩìÁÑ∂ÔºåËøôÈáåÊâØËøú‰∫ÜÔºåËøòÊòØÂõûÂà∞ËÉ∂Ê∞¥Á∫™ÂΩï„ÄÇ‰∏ÄËà¨Êù•ËØ¥ÔºåÂüüÂêçÊ≥®ÂÜåÂïÜÁöÑÁΩëÁ´ôÈÉΩÂèØ‰ª•Ê∑ªÂä†ËÉ∂Ê∞¥Á∫™ÂΩïÔºåËÄåÊúâÁöÑÊ≥®ÂÜåÂïÜÂàôÊòØÈúÄË¶Å‰ªòË¥πÊâçËÉΩÊ∑ªÂä†ÔºåËøôÂèñÂÜ≥‰∫é‰Ω†ÁöÑÊúçÂä°Êèê‰æõÂïÜ„ÄÇÂêåÊó∂ÔºåÊúâÁöÑÊ≥®ÂÜåÂïÜÂπ∂Ê≤°Êúâ‰ΩøÁî® „ÄåËÉ∂Ê∞¥Á∫™ÂΩï„ÄçËøô‰∏™ËØçÔºåËÄåÊòØ‰ΩøÁî® „ÄåÊ≥®ÂÜå DNS ÊúçÂä°Âô®„ÄçÊàñËÄÖ „ÄåDNS Host„ÄçÔºå‰æãÂ¶ÇÊàë‰ΩøÁî®ÁöÑ<a href="https://cloud.tencent.com/document/product/242/54158">ËÖæËÆØ‰∫ë</a>Â∞±ÊòØÁß∞‰Ωú „ÄåDNS Host„ÄçÂ¶Ç‰∏ãÂõæÔºö</p>
<center>
    <img src="https://32cf906.webp.li/2024/09/dns-dnspod.png" width="70%" alt="DNS ËÉ∂Ê∞¥Á∫™ÂΩï">
</center>
<p>Âú®ÂÆåÊàê‰ª•ÂêéÔºåÊàë‰ª¨ËøòÈúÄË¶ÅÂ∞Ü <code>exmaple.dns</code> ÁöÑ NS ÊúçÂä°Âô®Êîπ‰∏∫ <code>ns1.example.dns</code> Âíå <code>ns2.example.dns</code><sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup>„ÄÇ</p>
<h4 id="ÂÆâË£Ö-powerdns-Âíå-mariadb-‰∏é-powerdns-ÂàùÂßãÈÖçÁΩÆ">ÂÆâË£Ö PowerDNS Âíå MariaDB ‰∏é PowerDNS ÂàùÂßãÈÖçÁΩÆ</h4>
<p>Êàë‰ª¨ÈúÄË¶ÅÂú®‰∏§Âè∞ÊúçÂä°Âô®‰∏äÈÉΩÂÆâË£Ö PowerDNS Âíå MariaDBÔºåËøôÈáåÔºåÊàëËÆ© NS1 ‰Ωú‰∏∫‰∏ªË¶ÅËäÇÁÇπËÄå NS2 ‰Ωú‰∏∫Â§á‰ªΩËäÇÁÇπ (‰∏§Âè∞ÊúçÂä°Âô®Âùá‰ΩøÁî® Debian 12)Ôºö</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sudo su
</span></span><span style="display:flex;"><span>apt-get update <span style="color:#f92672">&amp;&amp;</span> apt-get upgrade -y 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ÂØºÂÖ• PowerDNS Âíå MariaDB ÂÆòÊñπÊ∫êÂíåÁ≠æÂêç Âπ∂ ÂÆâË£Ö</span>
</span></span><span style="display:flex;"><span>curl -sSL https://repo.powerdns.com/FD380FBB-pub.asc | gpg --dearmor &gt; /usr/share/keyrings/powerdns.gpg
</span></span><span style="display:flex;"><span>cat &gt; /etc/apt/sources.list.d/pdns.list <span style="color:#e6db74">&lt;&lt; EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/powerdns.gpg] http://repo.powerdns.com/debian $(lsb_release -sc)-auth-49 main
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/powerdns.gpg] http://repo.powerdns.com/debian $(lsb_release -sc)-rec-50 main
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/powerdns.gpg] http://repo.powerdns.com/debian $(lsb_release -sc)-dnsdist-19 main
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">## ‰ºòÂÖà‰ΩøÁî® PowerDNS ÂÆòÊñπÊ∫êËøõË°åÂÆâË£Ö</span>
</span></span><span style="display:flex;"><span>cat &gt;&gt; /etc/apt/preferences.d/pdns <span style="color:#e6db74">&lt;&lt; EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Package: pdns-*
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Pin: origin repo.powerdns.com
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Pin-Priority: 600
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>curl -sSL https://mariadb.org/mariadb_release_signing_key.asc | gpg --dearmor &gt; /usr/share/keyrings/mariadb.gpg
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;deb [arch=</span><span style="color:#66d9ef">$(</span>dpkg --print-architecture<span style="color:#66d9ef">)</span><span style="color:#e6db74"> signed-by=/usr/share/keyrings/mariadb.gpg] https://mirror-cdn.xtom.com/mariadb/repo/11.4/debian </span><span style="color:#66d9ef">$(</span>lsb_release -sc<span style="color:#66d9ef">)</span><span style="color:#e6db74"> main&#34;</span> &gt; /etc/apt/sources.list.d/mariadb.list
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">## ÈúÄË¶ÅÂÆâË£Ö geoip Êèí‰ª∂Ôºå‰∏∫ÂêéÁª≠ÈÖçÁΩÆ geodns ÂÅöÂáÜÂ§á</span>
</span></span><span style="display:flex;"><span>apt-get update <span style="color:#f92672">&amp;&amp;</span> apt-get install pdns-server pdns-backend-mysql pdns-backend-geoip mariadb-server 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">## ÈÖçÁΩÆÊï∞ÊçÆÂ∫ìÂêåÊ≠•</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">### Âú® NS1 ÈáåÊâßË°åÂ¶Ç‰∏ãÂëΩ‰ª§Ôºö</span>
</span></span><span style="display:flex;"><span>mkdir /var/lib/mysql-bin
</span></span><span style="display:flex;"><span>chown mysql:mysql /var/lib/mysql-bin
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cat &gt; /etc/mysql/mariadb.conf.d/61-master.cnf <span style="color:#e6db74">&lt;&lt;EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[mysqld]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">skip-host-cache
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">skip-name-resolve
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">bind-address = 0.0.0.0 # ‰πüÂèØ‰ª•‰øÆÊîπ‰∏∫ÂÖ∂‰ªñ NS2 ÂèØ‰ª•ËÆøÈóÆÂà∞ÁöÑ NS1 ÁöÑ IP 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">server-id = $SRANDOM
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">log-bin = /var/lib/mysql-bin/binlog
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">expire_logs_days = 7
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#### ÈÄöËøá iptables ÈôêÂà∂ 3306 ÁöÑËÆøÈóÆ</span>
</span></span><span style="display:flex;"><span>iptables -I INPUT -p tcp --dport <span style="color:#ae81ff">3306</span> -j DROP
</span></span><span style="display:flex;"><span>iptables -I INPUT -s 127.0.0.1 -p tcp --dport <span style="color:#ae81ff">3306</span> -j ACCEPT 
</span></span><span style="display:flex;"><span>iptables -I INPUT -s &lt;NS2 ÁöÑ IP ÊàñËÄÖÂÖ∂‰ªñÊåáÂÆö IP ÊÆµ&gt; -p tcp --dport <span style="color:#ae81ff">3306</span> -j ACCEPT  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#### Êñ∞Âª∫‰∏Ä‰∏™ backup Áî®Êà∑Ôºå‰ΩøÂæó NS2 ÂèØ‰ª•ËÆøÈóÆ NS1 ÊâÄÊúâÊï∞ÊçÆÂ∫ì</span>
</span></span><span style="display:flex;"><span>mariadb -e <span style="color:#e6db74">&#34;GRANT REPLICATION SLAVE, REPLICATION CLIENT ON *.* to &#39;backup&#39;@&#39;%&#39; identified by &#39;backup_pass&#39;;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#### ÈáçÂêØ MariaDB Âπ∂Êü•ÁúãËøêË°åÊÉÖÂÜµ</span>
</span></span><span style="display:flex;"><span>systemctl restart mariadb
</span></span><span style="display:flex;"><span>systemctl status mariadb
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">### Âú® NS2 ÈáåÊâßË°åÂ¶Ç‰∏ãÂëΩ‰ª§Ôºö</span>
</span></span><span style="display:flex;"><span>mkdir /var/lib/mysql-bin
</span></span><span style="display:flex;"><span>chown mysql:mysql /var/lib/mysql-bin
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cat &gt; /etc/mysql/mariadb.conf.d/61-slave.cnf <span style="color:#e6db74">&lt;&lt;EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[mysqld]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">skip-host-cache
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">skip-name-resolve
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">server-id = $SRANDOM
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">relay-log = /var/lib/mysql-bin/relaylog
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">expire_logs_days = 7
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sed -i <span style="color:#e6db74">&#39;s/expire_logs_days/#expire_logs_days/g&#39;</span> /etc/mysql/mariadb.conf.d/50-server.cnf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#### ‰ªÖÂÖÅËÆ∏Êú¨Êú∫ËÆøÈóÆ 3306</span>
</span></span><span style="display:flex;"><span>iptables -I INPUT -p tcp --dport <span style="color:#ae81ff">3306</span> -j DROP
</span></span><span style="display:flex;"><span>iptables -I INPUT -s 127.0.0.1 -p tcp --dport <span style="color:#ae81ff">3306</span> -j ACCEPT
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#### ÈáçÂêØ MariaDB Âπ∂Êü•ÁúãËøêË°åÊÉÖÂÜµ</span>
</span></span><span style="display:flex;"><span>systemctl restart mariadb
</span></span><span style="display:flex;"><span>systemctl status mariadb
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">### Ê£ÄÊü• NS1 Âíå NS2 ‰∏§Âè∞ÊúçÂä°Âô®ÁöÑÊï∞ÊçÆÂ∫ì</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#### Âú® NS1 ‰∏≠ËøêË°å</span>
</span></span><span style="display:flex;"><span>mariadb -e <span style="color:#e6db74">&#34;show binary logs;\G&#34;</span> <span style="color:#75715e"># Â¶ÇÂá∫Áé∞ binlog.000001 Âíå file size ‰∏∫ 325 ÂàôÊ≠£Â∏∏ÔºàÊñ∞ÂÆâË£ÖÁöÑÊÉÖÂÜµ‰∏ãÔºâ</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#### Âú® NS2 ‰∏≠ËøêË°å</span>
</span></span><span style="display:flex;"><span>mariadb -e <span style="color:#e6db74">&#34;CHANGE MASTER TO MASTER_HOST=&#39;&lt;NS1-IP ADDR&gt;&#39;, MASTER_USER=&#39;backup&#39;, MASTER_PASSWORD=&#39;backup_pass&#39;, MASTER_PORT=3306, MASTER_LOG_FILE=&#39;binlog.000001&#39;, MASTER_LOG_POS=325; START SLAVE; SHOW SLAVE STATUS\G&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">### ÂØºÂÖ• PowerDNS Êï∞ÊçÆÂ∫ì</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#### Âú® NS1 ‰∏≠ËøêË°å</span>
</span></span><span style="display:flex;"><span>mariadb -u root
</span></span><span style="display:flex;"><span>CREATE DATABASE pdns_database DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci; 
</span></span><span style="display:flex;"><span>GRANT ALL ON pdns_database.* TO <span style="color:#e6db74">&#39;pdns_user&#39;</span>@<span style="color:#e6db74">&#39;%&#39;</span> IDENTIFIED BY <span style="color:#e6db74">&#39;pdns_password&#39;</span>; <span style="color:#75715e"># pdns_user Âíå pdns_password ÊòØ PowerDNS Êï∞ÊçÆÂ∫ìÁöÑÁî®Êà∑ÂêçÂíåÂØÜÁ†Å</span>
</span></span><span style="display:flex;"><span>FLUSH PRIVILEGES; 
</span></span><span style="display:flex;"><span>EXIT;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cd /usr/share/pdns-backend-mysql/schema
</span></span><span style="display:flex;"><span>mariadb -u pdns_user --default-character-set<span style="color:#f92672">=</span>utf8mb4 -p pdns_database &lt; schema.mysql.sql
</span></span><span style="display:flex;"><span>mariadb -u pdns_user --default-character-set<span style="color:#f92672">=</span>utf8mb4 -p pdns_database &lt; enable-foreign-keys.mysql.sql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#### Âú® NS2 ‰∏≠ËøêË°å</span>
</span></span><span style="display:flex;"><span>mariadb -e <span style="color:#e6db74">&#34;show databases;\G&#34;</span>  <span style="color:#75715e"># Â¶ÇÂ∑≤ÁªèÂêåÊ≠• pdns_database Âàô‰∏∫Ê≠£Â∏∏</span>
</span></span></code></pre></div><p>Âú®ÂÆåÊàêÊï∞ÊçÆÂ∫ìËÆæÁΩÆÂêéÔºåÊàë‰ª¨Â∞±ÂèØ‰ª•ÂºÄÂßãÂØπ PowerDNS ËøõË°åÂàùÂßãÂåñÈÖçÁΩÆÔºåÈ¶ñÂÖàÂà†Èô§ÈªòËÆ§ÂÆâË£ÖÁöÑ <code>/etc/powerdns/pdns.d/bind.conf</code>, ÁÑ∂ÂêéÊ∑ªÂä†‰∏Ä‰∏™ <code>/etc/powerdns/pdns.d/dns.conf</code> Âπ∂ËæìÂÖ•Ôºö</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>cat &gt;&gt; /etc/powerdns/pdns.d/dns.conf <span style="color:#e6db74">&lt;&lt; EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">launch=gmysql
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">gmysql-host=localhost
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">gmysql-user=pdns_user # Êï∞ÊçÆÂ∫ìÁî®Êà∑Âêç
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">gmysql-dbname=pdns_database # Êï∞ÊçÆÂ∫ìÂêç
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">gmysql-password=pdns_password # Êï∞ÊçÆÂ∫ìÂØÜÁ†Å
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">gmysql-dnssec=yes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">default-soa-content=ns1.example.dns hostmaster.example.dns 0 3600 14400 604800 3600
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">api=yes
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">api-key=random_api_key # api key ÂèØ‰ª•ÈöèÊÑèÊõ¥Êç¢ÔºåÊØîÂ¶Ç‰ΩøÁî® openssl ÁîüÊàêÔºöopenssl rand -base64 16
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">local-address=0.0.0.0 ::
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">local-port=53
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">webserver-address=0.0.0.0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">webserver-allow-from=127.0.0.1, ::1, 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">webserver-port=8081
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span></code></pre></div><p>Âú®ÂÆåÊàêÈÖçÁΩÆÂêéÔºåÈúÄË¶ÅÈáçÂêØ PowerDNSÔºö<code>systemctl restart pdns</code>Ôºå‰ΩÜÊòØÂú®ÈáçÂêØ‰πãÂâçÔºåÊàë‰ª¨ÂèØ‰ª•Ê≥®ÊÑèÂà∞ PowerDNS Âç†Áî®ÂæóÊòØ <code>53</code> Á´ØÂè£Ôºå‰ΩÜÊòØÈªòËÆ§ÊÉÖÂÜµ‰∏ãÔºåDebian/Ubuntu ÈÉΩ‰ºöË¢´Á≥ªÁªüÁöÑ <code>systemd-resolved</code> Âç†Áî®, ÊâÄ‰ª•ÔºåÊàë‰ª¨ÈúÄË¶ÅÂÖ≥Èó≠ÂÆÉÔºö</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># ‰ªÖÈíàÂØπ Debian 11/12ÔºåÂÖ∂‰ªñÁ≥ªÁªüËØ∑ÂèÇËÄÉÂØπÂ∫îÁ≥ªÁªüÁöÑÊïôÁ®ã</span>
</span></span><span style="display:flex;"><span>sudo su 
</span></span><span style="display:flex;"><span>systemctl stop systemd-resolved <span style="color:#f92672">&amp;&amp;</span> systemctl disable systemd-resolved
</span></span><span style="display:flex;"><span>cp /etc/resolv.conf /etc/resolv.conf.bak <span style="color:#f92672">&amp;&amp;</span> rm -rf /etc/resolv.conf
</span></span><span style="display:flex;"><span>cat &gt;&gt; /etc/resolv.conf <span style="color:#e6db74">&lt;&lt; EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">nameserver  1.1.1.1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">nameserver  8.8.8.8
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>systemctl restart networking
</span></span></code></pre></div><h4 id="powerdns-admin-ÂÆâË£Ö">PowerDNS-Admin ÂÆâË£Ö</h4>
<p><a href="https://github.com/PowerDNS-Admin/PowerDNS-Admin">PowerDNS Admin</a> ÊòØ‰∏Ä‰∏™Âü∫‰∫é Django ÁöÑ PowerDNS ÁÆ°ÁêÜËΩØ‰ª∂Ôºå‰∏ÄËà¨Êù•ËØ¥ÔºåÊàë‰ª¨‰ºöÂçïÁã¨ÈÉ®ÁΩ≤ËÄå‰∏çÊòØÈÉ®ÁΩ≤Âú® NS1 ÊàñËÄÖ NS2 ‰∏ä„ÄÇGitHub ‰∏äÊúâÂØπÂ∫îÁöÑ Docker ÂíåÊú¨Âú∞ÂÆâË£ÖÊïôÁ®ãÔºåËøôÈáåÔºåÊàëÂ∑≤ K3s/K8s ‰∏∫‰æãÔºö</p>
<p>È¶ñÂÖàÂàõÂª∫ namespaceÔºö</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Namespace</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">powerdns</span>
</span></span></code></pre></div><p>ÁÑ∂ÂêéÂàõÂª∫ PV Âíå PVCÔºåËøôÊòØ‰∏∫‰∫ÜÊåÅ‰πÖÂåñÂ≠òÂÇ®Êï∞ÊçÆÂ∫ì‰∏äÁöÑÊï∞ÊçÆÔºåÊàëËøôÈáå‰ΩøÁî®ÁöÑÊòØ <code>local-host</code> ÁöÑÂ≠òÂÇ®ÊñπÂºèÔºå‰πüÂèØ‰ª•‰ΩøÁî®ÂÖ∂‰ªñÁöÑÂ≠òÂÇ®ÂêéÁ´ØÔºåÊØîÂ¶Ç NFS ÊàñËÄÖ CephÔºö</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">PersistentVolume</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pdns-pv</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">capacity</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">storage</span>: <span style="color:#ae81ff">10Gi</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">accessModes</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">ReadWriteMany</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">persistentVolumeReclaimPolicy</span>: <span style="color:#ae81ff">Retain</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">storageClassName</span>: <span style="color:#ae81ff">local-storage</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">local</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/data/pdns</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">nodeAffinity</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">required</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">nodeSelectorTerms</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">matchExpressions</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">key</span>: <span style="color:#ae81ff">kubernetes.io/hostname</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">operator</span>: <span style="color:#ae81ff">In</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">values</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#ae81ff">base-server</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">PersistentVolume</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pdns-mysql-pv</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">capacity</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">storage</span>: <span style="color:#ae81ff">10Gi</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">accessModes</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">ReadWriteMany</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">persistentVolumeReclaimPolicy</span>: <span style="color:#ae81ff">Retain</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">storageClassName</span>: <span style="color:#ae81ff">local-storage</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">local</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/data/pdns</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">nodeAffinity</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">required</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">nodeSelectorTerms</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">matchExpressions</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">key</span>: <span style="color:#ae81ff">kubernetes.io/hostname</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">operator</span>: <span style="color:#ae81ff">In</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">values</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#ae81ff">base-server</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">PersistentVolumeClaim</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pdns-pvc</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">powerdns</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">accessModes</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">ReadWriteMany</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">resources</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">requests</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">storage</span>: <span style="color:#ae81ff">10Gi</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">storageClassName</span>: <span style="color:#ae81ff">local-storage</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumeName</span>: <span style="color:#ae81ff">pdns-pv</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">PersistentVolumeClaim</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pdns-mysql-pvc</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">powerdns</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">accessModes</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">ReadWriteMany</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">resources</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">requests</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">storage</span>: <span style="color:#ae81ff">10Gi</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">storageClassName</span>: <span style="color:#ae81ff">local-storage</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumeName</span>: <span style="color:#ae81ff">pdns-mysql-pv</span>
</span></span></code></pre></div><p>ÈöèÂêéÂàõÂª∫ <code>Deployment</code>, <code>Serivce</code> Âíå <code>Ingress</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">powerdns</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">powerdns</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchLabels</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">app</span>: <span style="color:#ae81ff">powerdns</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">app</span>: <span style="color:#ae81ff">powerdns</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">nodeName</span>: <span style="color:#ae81ff">base-server</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">powerdns</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">powerdnsadmin/pda-legacy:latest</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">imagePullPolicy</span>: <span style="color:#ae81ff">IfNotPresent</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">env</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">SECRET_KEY</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;&lt;random-secret-key&gt;&#34;</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">SQLALCHEMY_DATABASE_URI</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;mysql://powerdns-admin-user:powerdns-admin-password@127.0.0.1/powerdns-admin-database&#34;</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">GUNICORN_TIMEOUT</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;60&#34;</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">GUNICORN_WORKERS</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;4&#34;</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">GUNICORN_LOGLEVEL</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;DEBUG&#34;</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">OFFLINE_MODE</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;False&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">volumeMounts</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pdns-pvc</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/data</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">powerdns-admin-mariadb</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">mariadb:11.4</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">3306</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">env</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">MYSQL_ROOT_PASSWORD</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;mysql_root_password&#34;</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">MYSQL_DATABASE</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;powerdns-admin-database&#34;</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">MYSQL_USER</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;powerdns-admin-user&#34;</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">MYSQL_PASSWORD</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;powerdns-admin-password&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">volumeMounts</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pdns-mysql-pvc</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/var/lib/mysql</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pdns-pvc</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">persistentVolumeClaim</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">claimName</span>: <span style="color:#ae81ff">pdns-pvc</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pdns-mysql-pvc</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">persistentVolumeClaim</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">claimName</span>: <span style="color:#ae81ff">pdns-mysql-pvc</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Service</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">powerdns</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">powerdns</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">app</span>: <span style="color:#ae81ff">powerdns</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">protocol</span>: <span style="color:#ae81ff">TCP</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">port</span>: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">targetPort</span>: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">type</span>: <span style="color:#ae81ff">ClusterIP</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">networking.k8s.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Ingress</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">ingress-pdns</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">powerdns</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">rules</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">host</span>: <span style="color:#ae81ff">pdns.example.com</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">http</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">paths</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">pathType</span>: <span style="color:#ae81ff">Prefix</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">backend</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">service</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">name</span>: <span style="color:#ae81ff">powerdns</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">port</span>:
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">number</span>: <span style="color:#ae81ff">80</span>
</span></span></code></pre></div><p>Ê≥®ÂÜåÁöÑÁ¨¨‰∏Ä‰∏™Ë¥¶Âè∑Â∞±ÊòØ Admin Ë¥¶Âè∑ÔºåÂ¶ÇÊûúÊ≤°ÊúâÂ§ö‰∫∫‰ΩøÁî®ÁöÑÈúÄÊ±ÇÂç≥ÂèØÂú® <code>Settings - Authentication</code> ÈáåÂÖ≥Èó≠ <code>Allow users to sign up</code>„ÄÇÂú® Server Â°´ÂÖ• NS1 ÊàñËÄÖ NS2 ÁöÑ‰ø°ÊÅØÂç≥ÂèØ„ÄÇ ËÄåÂêéÔºåÂ∞±ÂèØ‰ª•ÂºÄÂßãÈÖçÁΩÆ GeoDNS ‰∫Ü„ÄÇ</p>
<h4 id="geodns-ÈÖçÁΩÆ">GeoDNS ÈÖçÁΩÆ</h4>
<p>Áî±‰∫é Maxmind GeoIP ÂºÄÂßãË¶ÅÊ±Ç GeoLite ÁöÑÁî®Êà∑Ê≥®ÂÜåË¥¶Âè∑Âπ∂‰ΩøÁî®ÂØÜÈí•ÊâçËÉΩ‰∏ãËΩΩÊï∞ÊçÆÂ∫ìÔºåÊâÄ‰ª•Á¨¨‰∏ÄÊ≠•ÔºåÊàë‰ª¨ÈúÄË¶ÅÂéª <a href="https://dev.maxmind.com/geoip/geolite2-free-geolocation-data">GeoLite2</a> Ê≥®ÂÜåË¥¶Âè∑Âπ∂ÂàõÂª∫ License Key„ÄÇÂú®ÂæóÂà∞ Key ‰ª•ÂêéÔºåÊàë‰ª¨Â∞±ÈúÄË¶ÅÂú® NS1 Âíå NS2 ÁßçÂÆâË£Ö <code>sudo apt-get install geoipupdate</code>ÔºåÂπ∂Â∞Ü <code>AccountID</code> Âíå <code>License Key</code> Â≠òÂÖ•ÊúçÂä°Âô®‰∏≠:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sudo su 
</span></span><span style="display:flex;"><span>cat &gt; /etc/GeoIP.conf <span style="color:#e6db74">&lt;&lt; EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">AccountID XXXXXX
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">LicenseKey XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EditionIDs GeoLite2-Country GeoLite2-City GeoLite2-ASN
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sudo geoipupdate -v 
</span></span></code></pre></div><p>Â¶ÇÊûú‰∏ÄÂàáÈ°∫Âà©ÔºåÊâÄÊúâÁöÑ <code>.mmdb</code> ÈÉΩ‰ºöÂ≠òÊîæÂà∞ <code>/usr/share/GeoIP</code> Ëøô‰∏™Ë∑ØÂæÑ‰∏ãÈù¢„ÄÇÂõûÂà∞ NS1 Âíå NS2 ÁöÑ <code>/etc/powerdns/pdns.d/dns.conf</code> ÈáåÔºåÊ∑ªÂä†Â¶Ç‰∏ãÂÜÖÂÆπÂπ∂ÈáçÊñ∞ÂêØÂä® PowerDNS Âç≥ÂèØÔºö</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>enable-lua-records<span style="color:#f92672">=</span>yes <span style="color:#75715e"># ÂêØÂä® lua script </span>
</span></span><span style="display:flex;"><span>launch<span style="color:#f92672">+=</span>geoip <span style="color:#75715e"># ÂêØÂä® geoip Êèí‰ª∂</span>
</span></span><span style="display:flex;"><span>geoip-database-files<span style="color:#f92672">=</span>/usr/share/GeoIP/GeoLite2-City.mmdb /usr/share/GeoIP/GeoLite2-Country.mmdb /usr/share/GeoIP/GeoLite2-ASN.mmdb
</span></span><span style="display:flex;"><span>log-dns-queries<span style="color:#f92672">=</span>yes 
</span></span></code></pre></div><p>ÂõûÂà∞ PowerDNS-Admin ÈáåÔºåÊàë‰ª¨ËøòÈúÄË¶ÅÂú® <code>Settings - Zone Records</code> ÈáåÊâìÂºÄ LUA ÊâçËÉΩÂú®Ëß£ÊûêÁ∫™ÂΩïÈáå‰ΩøÁî® lua script„ÄÇLua Á∫™ÂΩïÊúâÂæàÂ§öÁî®Ê≥ïÔºå ËØ¶ÁªÜÂèØ‰ª•ÂèÇËÄÉ<a href="https://doc.powerdns.com/authoritative/lua-records/">ÂÆòÁΩë</a>, ËøôÈáåÔºåÊàëÂè™‰ªãÁªç GeoDNS ÈúÄË¶ÅÊÄé‰πàËÆæÁΩÆÔºö</p>
<p>Êàë‰ª¨ÂèØ‰ª•È¶ñÂÖàËÆæÁΩÆ‰∏ÄÊù° Lua Á∫™ÂΩïÁªô <code>www.example.com</code>Ôºö<code>A    &quot;pickclosest({'249.209.110.226','160.38.17.187','66.167.146.39'})&quot;</code> ÁÑ∂Âêé‰ΩøÁî® <a href="https://tools.keycdn.com/ping">Ping Test</a> ËøõË°åÊµãËØïÔºö</p>
<center>
    <img src="https://32cf906.webp.li/2024/09/www-example-com-dns.png" width="70%" alt="GeoDNS ÊµãËØï">
</center>
<p>Êàë‰ª¨ÂèØ‰ª•ÁúãÂà∞Ôºå‰∏çÂêåÁöÑÂú∞ÊñπÂ∑≤ÁªèÂèØ‰ª•Ëß£ÊûêÂà∞‰∏çÂêåÁöÑ IP ‰∫ÜÔºåËøôÈáå Loss 100% ÊòØÂõ†‰∏∫ÊµãËØï IP ÈÉΩÊòØÈöèÊú∫ÁîüÊàêÁöÑÔºåÁêÜËÆ∫‰∏äÂ∫îËØ•‰πüÊòØ ping ‰∏çÈÄöÊâçÂêàÁêÜÔºåÊàë‰ª¨ËøôÈáåÊç¢ÊàêÁúüÂÆûÁöÑ IP ËØïËØïÔºö</p>
<ol>
<li>LAX: <code>67.198.150.72</code></li>
<li>AMS: <code>78.142.195.195</code></li>
<li>SIN: <code>89.28.239.46</code></li>
</ol>
<center>
    <img src="https://32cf906.webp.li/2024/09/www-example-com-geodns-2.png" width="70%" alt="GeoDNS ÊµãËØï">
</center>
<p>Êàë‰ª¨ÂèØ‰ª•ÁúãÂà∞Ôºå‰∏çÂêåÂú∞Âå∫Â∑≤ÁªèËß£ÊûêÂà∞‰∏çÂêåÂú∞Âå∫ÁöÑ IP ‰∫ÜÔºåÂÖ®ÁêÉ Ping ÁöÑÂª∂Ëøü‰πüÈÉΩÈôçÂà∞‰∫Ü 100ms ‰ª•‰∏ã(Èô§‰∫ÜÂç∞Â∫¶‰ª•Â§ñ)„ÄÇ</p>
<h2 id="‰ªéÊé•ÂÖ•ÁÇπÂà∞ÈõÜÁæ§">‰ªéÊé•ÂÖ•ÁÇπÂà∞ÈõÜÁæ§</h2>
<p>‰∏ä‰∏ÄÁØáÊñáÁ´†Èáå‰πüÊèêÂèä‰∫ÜÈÄöËøá <code>IPTABLES</code> ‰ªéÊé•ÂÖ•ÁÇπÂà∞ÈõÜÁæ§ÁöÑ External IP ÁöÑÁ´ØÂè£ËΩ¨ÂèëÔºå‰ΩÜÊòØÁªèËøáÊµãËØïÂèëÁé∞Ôºå<code>IPTABLES</code> Êó†Ê≥ïÂà©Áî®‰∏Ä‰∫õ TCP Êã•Â°ûÊéßÂà∂ÁÆóÊ≥ï‰ª•ÊèêÈ´òÁΩëÁªúÂêûÂêêÂíåÂª∂ËøüÔºåÁªèËøáÊøÄÊÉÖÁΩëÁªúÂÜ≤Êµ™ÔºåÂèëÁé∞‰∫ÜÂ¶Ç‰∏ãÁöÑ‰∏Ä‰∫õÂ∑•ÂÖ∑Ôºö</p>
<ol>
<li><a href="https://github.com/zhboner/realm">realm: A simple, high performance relay server written in rust</a></li>
<li><a href="https://github.com/go-gost/gost">gost: GO Simple Tunnel</a></li>
<li><a href="https://nginx.org/en/docs/stream/ngx_stream_core_module.html">Nginx - Stream Module</a></li>
<li><a href="https://www.haproxy.org/">Haproxy</a></li>
</ol>
<p>Â§ßÊ¶Ç‰∏çÊ≠¢ËøôÂá†ÁßçÂ∑•ÂÖ∑ÔºåÂè™ÊòØÈöèÊâã‰∏æÂá∫‰∫ÜËøôÂõõ‰∏™„ÄÇËøô‰∫õÂØπÊØî <code>IPTABLES</code> ÁöÑÂ•ΩÂ§ÑÊòØÂèØ‰ª•Âà©Áî® BBR Á≠âÁÆóÊ≥ïËøõ‰∏ÄÊ≠•ÊèêÈ´ò TCP ÁöÑ‰º†Ëæì„ÄÇÂú®ÂØπÊØî‰∫Ü‰∏ÄÁï™‰ª•ÂêéÔºåÊàëÊúÄÁªàÈÄâÊã©‰∫Ü Nginx„ÄÇ</p>
<h3 id="ÂÆâË£Ö-nginx">ÂÆâË£Ö Nginx</h3>
<p>‰∏éÂπ≥Êó∂ÂÆâË£Ö Nginx Áï•ÂæÆ‰∏çÂêåÔºåÊàë‰ª¨Áõ¥Êé•ÈÄöËøá <code>apt</code> ÂÆâË£ÖÁöÑ Nginx ‰∏çÂ∏¶ <code>stream</code> Ê®°ÂùóÔºåÊàë‰ª¨ÂèØ‰ª•ÈÄöËøá <code>nginx -V | grep steram</code> ËøõË°åÊü•Áúã„ÄÇËøôÈáåÊàëÈÄâÊã©Áõ¥Êé•Âéª‰∏ãËΩΩÊ∫êÁ†ÅÁºñËØëÂÆâË£ÖÔºö</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sudo apt -y install gcc make libssl-dev zlib1g-dev libgd-dev libgeoip-dev libpcre2-dev libpcre3-dev
</span></span><span style="display:flex;"><span>wget -O nginx.tar.gz https://nginx.org/download/nginx-1.23.1.tar.gz
</span></span><span style="display:flex;"><span>tar -xvf nginx.tar.gz <span style="color:#f92672">&amp;&amp;</span> cd ./nginx-1.23.1/
</span></span><span style="display:flex;"><span>sudo mkdir /usr/lib/nginx <span style="color:#f92672">&amp;&amp;</span> sudo mkdir /var/log/nginx <span style="color:#f92672">&amp;&amp;</span> sudo mkdir /etc/nginx <span style="color:#f92672">&amp;&amp;</span> sudo mkdir /var/cache/nginx
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>./configure <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--prefix<span style="color:#f92672">=</span>/etc/nginx <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--user<span style="color:#f92672">=</span>root <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--group<span style="color:#f92672">=</span>root <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--sbin-path<span style="color:#f92672">=</span>/usr/sbin/nginx <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--modules-path<span style="color:#f92672">=</span>/usr/lib/nginx/modules <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--conf-path<span style="color:#f92672">=</span>/etc/nginx/nginx.conf <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--error-log-path<span style="color:#f92672">=</span>/var/log/nginx/error.log <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--http-log-path<span style="color:#f92672">=</span>/var/log/nginx/access.log <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--pid-path<span style="color:#f92672">=</span>/var/run/nginx.pid <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--lock-path<span style="color:#f92672">=</span>/var/run/nginx.lock <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--http-client-body-temp-path<span style="color:#f92672">=</span>/var/cache/nginx/client_temp <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--http-proxy-temp-path<span style="color:#f92672">=</span>/var/cache/nginx/proxy_temp <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--http-fastcgi-temp-path<span style="color:#f92672">=</span>/var/cache/nginx/fastcgi_temp <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--http-uwsgi-temp-path<span style="color:#f92672">=</span>/var/cache/nginx/uwsgi_temp <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--http-scgi-temp-path<span style="color:#f92672">=</span>/var/cache/nginx/scgi_temp <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--with-file-aio <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--with-threads <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--with-http_addition_module <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--with-http_auth_request_module <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--with-http_dav_module <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--with-http_flv_module <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--with-http_gunzip_module <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--with-http_gzip_static_module <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--with-http_mp4_module <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--with-http_random_index_module <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--with-http_realip_module <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--with-http_secure_link_module <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--with-http_slice_module <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--with-http_ssl_module <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--with-http_stub_status_module <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--with-http_sub_module <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--with-http_v2_module <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--with-mail <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--with-mail_ssl_module <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--with-stream <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--with-stream_realip_module <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--with-stream_ssl_module <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--with-stream_ssl_preread_module
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sudo make <span style="color:#f92672">&amp;&amp;</span> sudo make install <span style="color:#f92672">&amp;&amp;</span> sudo mkdir /etc/nginx/sites-available <span style="color:#f92672">&amp;&amp;</span> sudo sudo mkdir /etc/nginx/sites-enabled
</span></span></code></pre></div><p>Âú®ÂÆåÊàêÂÆâË£ÖÂêéÔºåÊàë‰ª¨ËøòÈúÄË¶ÅÂú® <code>systemd</code> ‰∏≠Âä†ÂÖ•ÈÖçÁΩÆÊñá‰ª∂ÂØπ service ËøõË°åÊéßÂà∂Ôºö</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sudo su 
</span></span><span style="display:flex;"><span>cat &gt; /etc/systemd/system/nginx.service <span style="color:#e6db74">&lt;&lt; EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Unit]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Description=The NGINX HTTP and reverse proxy server
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">After=syslog.target network-online.target remote-fs.target nss-lookup.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Wants=network-online.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Service]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Type=forking
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">PIDFile=/run/nginx.pid
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecStartPre=/usr/sbin/nginx -t -c /etc/nginx/nginx.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecStart=/usr/sbin/nginx -c /etc/nginx/nginx.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecReload=/usr/sbin/nginx -s reload -c /etc/nginx/nginx.conf
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ExecStop=/bin/kill -s QUIT
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">PrivateTmp=true
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[Install]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">WantedBy=multi-user.target
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sudo systemctl daemon-reload
</span></span><span style="display:flex;"><span>sudo systemctl enable --now nginx
</span></span></code></pre></div><p>ËøôÊó∂ÔºåÊàë‰ª¨Âú®Áúã <code>nginx -V | grep stream</code> Â∞±ËÉΩÂèëÁé∞Ê®°ÂùóÂ∑≤ÁªèÊ≠£Â∏∏ÂÆâË£Ö‰∫Ü„ÄÇ</p>
<p>ÈÄöËøá stream Ê®°ÂùóÔºåÊàë‰ª¨Â∞±ÂèØ‰ª•ÈÄöËøá nginx ÂØπ TCP/UDP ÊµÅÈáèËøõË°åËΩ¨ÂèëÔºåÂêåÊó∂ÔºåËøòÂèØ‰ª•ÈÄöËøá SNI proxy Êù•ËΩ¨Âèë HTTPS ÊµÅÈáèÂà∞Ê∫êÁ´ôÔºåËøôÈáåÊàëÁªôÂá∫‰∏Ä‰∏™Ê†∑‰æãÔºö</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>stream <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    upstream cluster <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        server 192.168.101.151:443;
</span></span><span style="display:flex;"><span>        server 192.168.101.152:443;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    map $ssl_preread_server_name $upstream_server <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        default cluster;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    server <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        listen 443;
</span></span><span style="display:flex;"><span>        proxy_pass $upstream_server;
</span></span><span style="display:flex;"><span>        ssl_preread on;  <span style="color:#75715e"># Enable SNI reading</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>Ëá≥Ê≠§ÔºåÊàë‰ª¨Â∑≤ÁªèÂÆåÊàê‰∫Ü‰ªé client Âà∞ entrance ÂÜçÂà∞ source ÁöÑ‰∏§Ê≠•Ëµ∞ÊµÅÁ®ã„ÄÇÂΩìÁÑ∂ÔºåÈÄâÊã© nginx ÁöÑÂéüÂõ†‰∏ç‰ªÖ‰ªÖÊòØ TCP Âä†ÈÄüÔºåÊõ¥ÊòØÂõ†‰∏∫ÂèØ‰ª•Ê†πÊçÆÂüüÂêçËøõË°å‰∏çÂêåÂêéÁ´ØÁöÑÂàÜÊµÅÔºåËøô‰∫õÂ∫îËØ•ÊòØ IPTABLES/REALM Ëøô‰∫õÂ∑•ÂÖ∑Êó†Ê≥ïËææÂà∞ÁöÑ„ÄÇËÄåËá≥‰∫é‰∏∫‰ªÄ‰πà‰∏çÁî® HAProxy ÂàôÊòØÂõ†‰∏∫Êú¨‰∫∫‰∏çÂñÑ‰∫é‰ΩøÁî®ÂÆÉÔºåÊòØÊàëÁöÑÈîô„ÄÇ</p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>ÂÖ∂ÂÆû‰πüÊòØÂõ†‰∏∫Ê≤°Êúâ AS Âè∑Âú®ÊâãÔºå‰∏çÁÑ∂Â∞±ÊòØ„ÄåÊàëÈÄâÊã©Ëá™Âª∫ Anycast DNS ÊúçÂä°Âô®„Äç‰∫Ü ÔºöÔºâ&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>Êú¨Êñá‰∏≠ÊâÄÊèêÂèäÁöÑÊâÄÊúâ IP Âú∞ÂùÄÔºàÂåÖÊã¨ IPV4 Âíå IPV6ÔºâÂùáÊòØÈÄöËøá <a href="https://www.ipvoid.com/">IPVOID</a> ÈöèÊú∫ÁîüÊàê&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3">
<p>Áî±Ê≠§ÂèØ‰ª•ÁúãÂá∫ÔºåÂ¶ÇÊûúÂüüÂêçÊú¨Ë∫´‰∏çÈúÄË¶Å‰Ωú‰∏∫Ëá™Ë∫´ÁöÑ NS ÊúçÂä°Âô®ÔºåÂàôÊó†ÈúÄËÆæÁΩÆËÉ∂Ê∞¥Á∫™ÂΩïÔºåÂç≥ÔºåÂèØ‰ª•ÁúÅÁï•Ëøô‰∏ÄÊ≠•&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>
</content>

<p>
  
  <a href="https://blog.cklau.cc/tags/homelab/">#homelab</a>
  
  <a href="https://blog.cklau.cc/tags/oauth2-proxy/">#oauth2-proxy</a>
  
  <a href="https://blog.cklau.cc/tags/nginx-ingress-controller/">#nginx-ingress-controller</a>
  
  <a href="https://blog.cklau.cc/tags/geodns/">#GeoDNS</a>
  
  <a href="https://blog.cklau.cc/tags/authoritative-dns/">#Authoritative DNS</a>
  
  <a href="https://blog.cklau.cc/tags/%E5%AE%89%E5%85%A8/">#ÂÆâÂÖ®</a>
  
  <a href="https://blog.cklau.cc/tags/%E9%9B%B6%E4%BF%A1%E4%BB%BB/">#Èõ∂‰ø°‰ªª</a>
  
  <a href="https://blog.cklau.cc/tags/%E5%AD%98%E5%82%A8/">#Â≠òÂÇ®</a>
  
  <a href="https://blog.cklau.cc/tags/%E6%9D%83%E5%A8%81-dns/">#ÊùÉÂ®Å DNS</a>
  
</p>

  </main>
  <footer>


<p>
    <span><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">Á≤§ICPÂ§á2022102668Âè∑</a></span>

&copy; 2024 <a href="https://blog.cklau.cc">Junjie LIU</a>
    <a href="https://blog.cklau.cc/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a>
    <br>
Hosting and images served by <a href="https://cloud.tencent.com/">Tencent Cloud</a> / <a href="https://cloudflare.com/">Cloudflare</a> / <a href="https://webp.se/">WebP Cloud Services</a>
</p>

</footer>

    
</body>

</html>
