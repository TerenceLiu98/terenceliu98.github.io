<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>ç‰¹å€«è˜‡çš„æ—¥èˆ‡å¤œ</title>
    <link>https://blog.cklau.cc/</link>
      <atom:link href="https://blog.cklau.cc/index.xml" rel="self" type="application/rss+xml" />
    <description>ç‰¹å€«è˜‡çš„æ—¥èˆ‡å¤œ</description>
    <generator>Source Themes Academic (https://sourcethemes.com/academic/)</generator><language>en</language><lastBuildDate>Sat, 10 Aug 2024 00:11:21 +0800</lastBuildDate>
    <item>
      <title>ğŸ§‘ğŸ¿â€ğŸ’» Homelab: CloudFlare is All you Need</title>
      <link>https://blog.cklau.cc/post/my-homelab-7/</link>
      <pubDate>Sat, 10 Aug 2024 00:11:21 +0800</pubDate>
      <guid>https://blog.cklau.cc/post/my-homelab-7/</guid>
      <description>&lt;p&gt;å›åˆ°åŸç‚¹ï¼Œåˆå¼€å§‹äº†ä¸€å¹´ä¸€åº¦çš„ Homelab æŠ˜è…¾ã€‚è¿™ä¸€æ¬¡ï¼Œ æ‰“ç®—æ•´ç‚¹ã€Œèµ·å¤œã€çº§æ–¹æ¡ˆ :)&lt;/p&gt;
&lt;p&gt;ä½•ä¸ºä¼ä¸šçº§æ–¹æ¡ˆ?&lt;/p&gt;
&lt;p&gt;å¤§è‡´æ¥è¯´ï¼Œå°±æ˜¯å¾ˆç¨³ï¼Œéå¸¸ç¨³ï¼Œååˆ†æœ‰åäºŒåˆ†çš„ç¨³ã€‚è‡³å°‘æ˜¯æ­£å‘æ¨ç†çš„æ—¶å€™æ˜¯è¿™æ ·çš„ï¼Œè‡³äºæ„å¤–æƒ…å†µï¼Œä¸åˆ—å…¥è€ƒè™‘èŒƒå›´&lt;span class=&#34;sidenote-number&#34;&gt;
	&lt;small class=&#34;sidenote&#34;&gt;
	ä½œä¸ºä¼ä¸šçº§æ–¹æ¡ˆï¼Œè‡ªç„¶éœ€è¦æ˜¯éœ€è¦åº”æ€¥é¢„æ¡ˆï¼Œè‡³äºèƒ½ä¸èƒ½é‡ä¸Šå°±å†è®®
	&lt;/small&gt;
&lt;/span&gt;ã€‚ é‚£ä¹ˆä½œä¸ºä¸€ä¸ª &lt;code&gt;yaml&lt;/code&gt; ç©å®¶ï¼Œè‡ªç„¶è€Œç„¶çš„é€‰æ‹©å°±åªä¼šè½åœ¨ Kubernetes ä¹‹ä¸Šï¼Œè‡³äºå¦‚ä½•é€šè¿‡ &lt;code&gt;kubeadm&lt;/code&gt; æ­å»ºé«˜å¯ç”¨çš„ K8s é›†ç¾¤ï¼Œä¸åœ¨æœ¬æ–‡è®¨è®ºèŒƒå›´ä¹‹å†…ï¼Œè¯·å‚è€ƒä»¥å‰çš„æ–‡ç« ã€‚ å½“ç„¶ï¼Œä¸ºäº†&lt;ruby &gt;
    &lt;span&gt;å¢åŠ å¯è®¿é—®æ€§&lt;/span&gt;
    &lt;rp&gt;(&lt;/rp&gt;&lt;rt &gt;
            ç»•è¿‡åŸŸåå¤‡æ¡ˆ&lt;/rt&gt;&lt;rp&gt;)&lt;/rp&gt;
&lt;/ruby&gt;ï¼Œæˆ‘çš„ç¬¬ä¸€é€‰æ‹©å½“æ—¶æ˜¯é€‰æ‹©åœ°å¤„é¦™æ¸¯çš„æœåŠ¡å™¨ä½œä¸ºé›†ç¾¤çš„ä¸»æ§èŠ‚ç‚¹ã€‚æ— æ³•å¦è®¤çš„æ˜¯ï¼ŒAWS/Azure/GCP çš„æœåŠ¡å™¨æ˜¯æˆ‘ç­‰ç©·å­¦ç”Ÿæ— æ³•è´Ÿæ‹…å¾—èµ·çš„ï¼Œè€Œå°ä¼—å•†å®¶åˆæœ‰ç€æ¦‚ç‡è·‘è·¯/è¾ƒé«˜æ¦‚ç‡è¢«æ”»å‡»ï¼Œæœ¬ç€ã€Œèµ·å¤œçº§ã€çš„æ€æƒ³ï¼Œæœ€ç»ˆå°†é›†ç¾¤çš„ä¸»æ§èŠ‚ç‚¹å®šåœ¨äº†åƒç°ä¸­çš„è…¾è®¯äº‘å¹¿å·è½»é‡åº”ç”¨æœåŠ¡å™¨ï¼ˆç¨³å®šä¸”ä½å»¶è¿Ÿï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ç»è¿‡å¾ˆå¤šå¹´çš„å¤§æµªæ·˜æ²™ä¹‹åï¼Œæ‰‹é‡Œä»…å‰©ä¸‹ä¸¤å°æœºå™¨&lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;ï¼Œä¸€å°ä½œä¸ºä¸»å­˜å‚¨èŠ‚ç‚¹ (Riemann)ï¼Œè€Œå¦å¤–ä¸€å°åˆ™æ˜¯è®¡ç®—èŠ‚ç‚¹ (Nexus)ï¼Œæ¯”è¾ƒæœ‰æ„æ€çš„æ˜¯ï¼Œè®¡ç®—èŠ‚ç‚¹ä¸Šå…¶å®ä¹Ÿæ’äº†ä¸€äº›å­˜å‚¨ç”¨çš„ç¡¬ç›˜è€Œå­˜å‚¨èŠ‚ç‚¹ä¸Šä¹Ÿæœ‰ä¸€äº›è®¡ç®—èµ„æºã€‚ä¸ºäº†ä¸æµªè´¹å­˜å‚¨ä¸”å®Œæˆã€Œèµ·å¤œã€çº§çš„ä¸­å¿ƒæ€æƒ³ï¼Œæˆ‘é€‰æ‹©äº† GlusterFS ä½œä¸ºä¸»è¦çš„æ–‡ä»¶ç³»ç»Ÿã€‚è¯šç„¶ï¼Œ Ceph æ‰æ˜¯ä¸»æµï¼ŒGlusterFS è¿™ç§ç‰›å¤«äººæ‰æ˜¯&lt;del&gt;ç¨³å®šå¯é ä¹‹é€‰&lt;/del&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€åˆ‡éƒ¨ç½²å®Œæ¯•ä»¥åï¼Œå¦‚ä½•è®©èº«å¤„ UTC çš„æˆ‘å¿«é€Ÿè®¿é—® CST çš„å†…å®¹åˆ™æˆä¸ºäº†ä¸‹ä¸€ä¸ªä¼ä¸šçº§éš¾é¢˜ã€‚å¯¹äºçœŸæ­£çš„ä¼ä¸šæ¥è¯´ï¼Œå½“ç„¶ä¸éš¾ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;IPLC/IEPL ç›´æ¥æ‹‰ä¸“çº¿ï¼›ä½†ï¼Œæ¨ªè·¨äºšæ¬§å¤§é™†ï¼Œæˆ‘ç›¸ä¿¡ä¹Ÿä¸æ˜¯å¤šå°‘ä¼ä¸šå¯ä»¥æ‰¿æ‹…å¾—èµ·è¿™æ ·çš„ä¸“çº¿&lt;/li&gt;
&lt;li&gt;SD-WAN  ä¾æ‰˜æœåŠ¡å•†æä¾›çš„å…¨çƒä¼ è¾“ç½‘ç»œï¼Œé€šè¿‡ SDN æŠ€æœ¯åˆ°è¾¾ä¸åŒçš„ POP ç‚¹&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è€ƒè™‘åˆ°å­‘ç„¶ä¸€äººçš„æˆ‘å¹¶æ²¡æœ‰å¤ªå®½è£•çš„ç»è´¹ï¼Œæœ€ç»ˆæ²¡æœ‰é€‰æ‹©ååˆ†å¤æ‚çš„æ–¹æ¡ˆï¼Œè€Œæ˜¯ä¾æ‰˜èµ›åšè©è¨&lt;sup id=&#34;fnref:2&#34;&gt;&lt;a href=&#34;#fn:2&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;çš„å…¨çƒåŠ é€Ÿç½‘ç»œå®ç° SD-WAN çš„éƒ¨åˆ†åŠŸèƒ½ã€‚å½“ç„¶ï¼Œå¹¶ä¸æ˜¯å…¨ç¨‹ä¼ä¸šçº§ï¼Œè€Œæ˜¯ä¸€åŠä¼ä¸šçº§ã€‚å…ˆæ¥è¯´è¯´è¯´ã€Œèµ·å¤œã€çº§éƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;p&gt;è€ƒè™‘åˆ°èµ›åšè©è¨åœ¨ CST åœ°åŒºçš„ä½œç”¨æœ‰é™ï¼Œåœ¨ç­›é€‰äº†è®¸ä¹…åï¼Œæˆ‘é€‰æ‹©äº†å‡ ä¸ªä¸­è½¬ç‚¹ï¼šHKG/AMS/LAXã€‚åœ¨è¿™äº›åœ°æ–¹é€‰æ‹©å»‰ä»·ä¸”å“åº”è¿…é€Ÿçš„æœºå™¨ï¼Œæ¥å…¥åˆ°æˆ‘çš„èŠ‚ç‚¹ä¹‹ä¸­ï¼Œä½œä¸ºå‡ºç«™ç¬¬ä¸€æ­¥ã€‚æ³¨æ„ï¼Œè¿™äº›æœºå™¨å¹¶æ²¡æœ‰æ¥å…¥é›†ç¾¤ä¹‹ä¸­ï¼Œåªæ˜¯ä½œä¸ºä¸­è½¬ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šåšåˆ°äº†éš”ç¦»ï¼Œå› ä¸ºå³ä½¿è¿™äº›æœºå™¨æ²¦é™·/æœåŠ¡å•†è·‘è·¯æˆ‘çš„é›†ç¾¤ä¹Ÿä¸ä¼šæ”¶åˆ°å¤ªå¤§çš„ç‰µè¿&lt;sup id=&#34;fnref:3&#34;&gt;&lt;a href=&#34;#fn:3&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;3&lt;/a&gt;&lt;/sup&gt;ã€‚è‡³äºå¦‚ä½•ä¸­è½¬ï¼Œåˆ™æ˜¯ Wireguard+VxLAN ä¸€æŠŠæ¢­å†åŠ ä¸€ç‚¹ç‚¹çš„ TCP ä»¥åº”å¯¹å…¨çƒ ISP å¯¹ UDP çš„åŠ£åŒ–ã€‚å¹¶ä¸”ï¼Œæˆ‘å¹¶æ²¡æœ‰å°†ä¸»æ§èŠ‚ç‚¹ä¸æµ·å¤–æœºå™¨äº’è”ï¼Œè¿™æ ·ä¹Ÿé™ä½äº†ä¸»æ§èŠ‚ç‚¹è¢«æ”»ç ´çš„é£é™©ã€‚è€Œè‡³äºä¸ºä»€ä¹ˆè¿™æ ·å¯ä»¥è®¿é—®ï¼Œå°±å…¨é  K8S çš„ External IP äº†:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åœ¨é…ç½® MetalLB çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»º External IP æ± ï¼Œå¸¸è§„è®¾ç½®ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šæŠŠé‚£äº›å…¬ç½‘å¯è¾¾çš„ IP æ”¾è¿›å»ï¼Œæ¯”å¦‚æˆ‘è¿™é‡Œçš„è…¾è®¯äº‘çš„ IPï¼›ä½†åœ¨æˆ‘è¿™å¥—æ–¹æ¡ˆä¸­ï¼Œä»…éœ€è¦æŠŠ worker çš„å†…ç½‘ IP æ”¾å…¥å³å¯ï¼š
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;apiVersion&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;metallb.io/v1beta1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;kind&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;IPAddressPool&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;metadata&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;name&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;ip-pool&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;namespace&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;metallb-system&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;spec&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;addresses&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  - &lt;span style=&#34;color:#ae81ff&#34;&gt;192.168.101.101-192.168.101.102&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;# Riemann å’Œ Nexus çš„å†…ç½‘ IPï¼Œéœ€è¦ä¸»æ§èŠ‚ç‚¹ä¹Ÿå¯ä»¥è®¿é—®çš„ IP&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;---
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;apiVersion&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;metallb.io/v1beta1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;kind&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;L2Advertisement&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;metadata&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;name&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;public-ip&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;namespace&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;metallb-system&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;spec&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;ipAddressPools&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  - &lt;span style=&#34;color:#ae81ff&#34;&gt;ip-pool&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;é…ç½® Ingress Controllerï¼Œæˆ‘ç›®å‰é€‰æ‹©çš„æ˜¯å®˜æ–¹çš„ &lt;a href=&#34;https://github.com/kubernetes/ingress-nginx&#34;&gt;ingress-nginx-controller&lt;/a&gt;ï¼›å¦‚æœæƒ³è¦å……åˆ†åˆ©ç”¨ IP æ± ä¸­çš„æ‰€æœ‰ IPï¼Œ æˆ‘ä»¬åˆ™éœ€è¦åˆ†åˆ«åˆ›å»ºä¸¤ä¸ª ingress controllerï¼š
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# æ¯ä¸€ä¸ª ingress controller éƒ½æ˜¯ Load Balancerï¼Œ æ‰€ä»¥ä¸€å…±å¯ä»¥æ‹¿åˆ°ä¸¤ä¸ª IP&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;helm upgrade --install ingress-nginx-a ingress-nginx --repo https://kubernetes.github.io/ingress-nginx --namespace ingress-nginx-a --create-namespace
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;helm upgrade --install ingress-nginx-b ingress-nginx --repo https://kubernetes.github.io/ingress-nginx --namespace ingress-nginx-b --create-namespace
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;IPTABLES&lt;/code&gt; ä¸€æŠŠæ¢­ï¼Œè®©å¤–éƒ¨æœåŠ¡å™¨è¿›è¡Œç«¯å£è½¬å‘ï¼Œå½“ç„¶ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©å…¶ä»–å·¥å…·ï¼š
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;echo &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;net.ipv4.ip_forward = 1&amp;#34;&lt;/span&gt; | sudo tee /etc/sysctl.conf
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo iptables -t nat -A PREROUTING -p tcp -m multiport --dport 80,443 -j DNAT --to-destination 192.168.101.101:80
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo iptables -t nat -A POSTROUTING -p tcp -d 192.168.101.101 -m multiport --dport 80,443 -j SNAT --to-source 192.168.101.2
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸‰æ­¥èµ°ä»¥åï¼Œã€Œèµ·å¤œã€çº§çš„é“¾è·¯å°±æ„é€ å®Œæˆäº†ï¼Œè¿™æ—¶åªéœ€è¦æˆ‘ä»¬å°†åŸŸåè§£æåˆ°å¤–éƒ¨æœåŠ¡å™¨çš„ IP ä¸Šå³å¯è®¿é—®é›†ç¾¤å†…éƒ¨éƒ¨ç½²çš„ web æœåŠ¡ã€‚ä¸è¿‡ï¼Œåªæœ‰ä¸‰ä¸ªèŠ‚ç‚¹æ€ä¹ˆæœåŠ¡å…¨çƒï¼Œè¿˜æ˜¯ä¸å¤Ÿå…¨é¢ã€‚ä¸€ä¸ªä¼ä¸šçº§çš„æ–¹æ¡ˆä¸€å®šè¦åšåˆ°å…¨çƒè¦†ç›–ã€‚é‚£æ­¤æ—¶å°±é‚€è¯·åˆ°èµ›åšè©è¨ç™»åœºäº†ã€‚Cloudflare ç»™æ¯ä¸ªç”¨æˆ·éƒ½æä¾›äº†ä¸€ä¸ªéš§é“æœåŠ¡å«åš &lt;a href=&#34;https://www.cloudflare.com/products/tunnel/&#34;&gt;ã€ŒCloudflare Tunnelã€&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Cloudflare Tunnel provides you with a secure way to connect your resources to Cloudflare without a publicly routable IP address. With Tunnel, you do not send traffic to an external IP â€” instead, a lightweight daemon in your infrastructure (cloudflared) creates outbound-only connections to Cloudflareâ€™s global network. Cloudflare Tunnel can connect HTTP web servers, SSH servers, remote desktops, and other protocols safely to Cloudflare. This way, your origins can serve traffic through Cloudflare without being vulnerable to attacks that bypass Cloudflare.
æ‘˜è‡ª &lt;a href=&#34;https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/&#34;&gt;Cloudflare Tunnel å®˜æ–¹æ–‡æ¡£&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¿™é‡Œæåˆ°ï¼ŒCloudflare å®é™…ä¸Šæ˜¯ä»å†…ç½‘ç›´æ¥åˆ° Cloudflare çš„è¾¹ç¼˜èŠ‚ç‚¹ï¼Œè€Œä¸éœ€è¦æœåŠ¡éƒ¨ç½²åœ¨ä¸€ä¸ªå…¬ç½‘å¯è¾¾çš„æœåŠ¡å™¨ä¸Šï¼Œä½†æ˜¯åœ¨è¿™é‡Œï¼Œæˆ‘åœ¨ç›´å°†ä¸‰ä¸ªå…¬ç½‘å¯è¾¾çš„æœåŠ¡å™¨ä½œä¸ºè¿æ¥è¾¹ç¼˜èŠ‚ç‚¹å’ŒæºæœåŠ¡å™¨çš„ä¸­é—´è·³æ¿ï¼Œè€Œå…¶ä¸­çš„è·³æ¿å°±æ˜¯ CF Tunnelã€‚è¿™æ ·å¸ƒç½®çš„å¥½å¤„æ˜¯ï¼Œæˆ‘ä»¬çš„å›æºè·¯å¾„ä¸éœ€è¦ç»è¿‡çº·ç¹å¤æ‚çš„å…¬ç½‘ç»è¿‡æ— æ•°çš„ pop å’Œæ— å°½çš„ç»•è·¯ï¼Œè¢« BGP è½¬çš„æ™•å¤´è½¬å‘ï¼Œæœ€ç»ˆé—å¤±åœ¨å¤ªå¹³æ´‹ï¼›æµé‡åœ¨è¿›å…¥ CF Tunnel ä¼šå»å¯»æ‰¾ç¦»è‡ªå·±æœ€è¿‘çš„â€œæºâ€ç«™ï¼Œç„¶åä¸‹ä¸€è·³å°±æ˜¯â€æºâ€œç«™ï¼ˆé›†ç¾¤ï¼‰äº†&lt;sup id=&#34;fnref:4&#34;&gt;&lt;a href=&#34;#fn:4&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;4&lt;/a&gt;&lt;/sup&gt;ã€‚ Tunnel ä¼šè‡ªåŠ¨å¯»æ‰¾æœ€è¿‘çš„â€œæºâ€ç«™ä¹Ÿæ˜¯å®˜æ–¹æ–‡æ¡£æåŠçš„ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;By design, replicas(æ˜¯æŒ‡ cloudflared replicas) do not offer any level of traffic steering (random, hash, or round-robin). Instead, when a request arrives to Cloudflare, &lt;strong&gt;it will be forwarded to the replica that is geographically closest&lt;/strong&gt;. If that distance calculation is unsuccessful or the connection fails, we will retry others, but there is no guarantee about which connection is chosen.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¯¹äº Cloudflare æ¥è¯´ï¼Œå¯èƒ½ä»˜è´¹ç”¨æˆ·éœ€è¦çš„æ˜¯ traffic steeringï¼Œä½†å®é™…ä¸Šï¼Œæˆ‘éœ€è¦çš„æ˜¯ geo steeringã€‚è‡ªæ­¤ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç¾æ´²ç”¨æˆ·å¤§æ¦‚ç‡ä¼šè¿›å…¥éš§é“åˆ°è¾¾ LAXï¼Œç„¶åè·¨è¶Šå¤ªå¹³æ´‹å›æºï¼›&lt;/li&gt;
&lt;li&gt;æ¬§æ´²å’Œéƒ¨åˆ†äºšç»†äºšç”¨æˆ·ä¼šåˆ° AMSï¼Œç„¶åèµ°äº¬å¾·çº¿è·¯å›æºï¼›&lt;/li&gt;
&lt;li&gt;å…¶ä»–äºšç»†äºšå’Œå¤§æ´‹æ´²ç”¨æˆ·ä¼šåˆ°è¾¾ HKGï¼Œç„¶åå›æºï¼›&lt;/li&gt;
&lt;li&gt;ç›®å‰ï¼Œæ²¡æœ‰æµ‹è¯•è¿‡éæ´²çš„ä½“éªŒï¼Œæ‰€ä»¥æš‚ä¸”æ²¡æœ‰ç»“æœã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ç†è®ºä¸Šä¼¼ä¹ä¼šæœ‰åŠ é€Ÿï¼Œé‚£å®é™…ä¸Šæµ‹è¯•å‘¢ï¼Ÿæˆ‘ç”¨ &lt;a href=&#34;https://www.dotcom-tools.com/&#34;&gt;dotcom-tools&lt;/a&gt; å¯¹ç½‘ç«™æ‰“å¼€é€Ÿåº¦è¿›è¡Œæµ‹è¯•ï¼Œé€‰å–äº†é©¬å¾·é‡Œã€åç››é¡¿å’Œé¦™æ¸¯è¿›è¡Œæµ‹è¯•ï¼Œæ•ˆæœå¦‚ä¸‹å›¾ï¼Œå¯ä»¥çœ‹åˆ°ä¸‰åœ°å¹³å‡è®¿é—®é€Ÿåº¦ç¡®å®æ˜¯æœ‰æ‰€æå‡ï¼Œè€Œå…¶ä¸­åç››é¡¿åœ°åŒºçš„æµ‹è¯•ä¸å‡åé™ï¼Œè¿™ä¸ªå¯èƒ½æ˜¯æœ¬èº«æµ‹è¯•èŠ‚ç‚¹åˆ°â€œæºâ€ç«™çš„è·¯ç”±æ¯” CF çš„å¥½å§ï¼Œä¹Ÿæœ‰å¯èƒ½ CF å¸¦è¿™äº›æµé‡å»äº†æ¬§æ´²ï¼Œè¿™å°±ä¸å¾—è€ŒçŸ¥äº†ã€‚ä¸è¿‡æ€»ä½“è€Œè¨€ï¼Œå®éªŒåº”å½“ç®—ä½œæˆåŠŸã€‚&lt;/p&gt;
&lt;table&gt;
    &lt;tr&gt;
        &lt;td&gt;&lt;img src=&#34;https://32cf906.webp.li/2024/08/media-before-cf.png&#34; /&gt;&lt;/td&gt;
        &lt;td&gt;&lt;img src=&#34;https://32cf906.webp.li/2024/08/media-cf-speedup.png&#34;/&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td&gt;&lt;center&gt;Before&lt;/center&gt;&lt;/td&gt;
        &lt;td&gt;&lt;center&gt;After&lt;/center&gt;&lt;/td&gt;
    &lt;/tr&gt;
&lt;/table&gt;
&lt;p&gt;è‡ªæ­¤ï¼Œå…¨çƒåŠ é€Ÿéƒ¨åˆ†åˆ°æ­¤ç»“æŸã€‚å¤§æ¦‚çš„æœ‰ç‚¹æœ‰å¦‚ä¸‹å‡ æ¡ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä»»æ„æ·»åŠ æ¥å…¥ç‚¹ï¼šæˆ‘ä»¬ä»…éœ€è¦è®©æ–°å¢èŠ‚ç‚¹å’Œé›†ç¾¤å»ºç«‹é€šç•…è¿æ¥ï¼Œå³å¯éšæ—¶å¢ï¼ˆåˆ ï¼‰æ¥å…¥ç‚¹ï¼Œä¸»è¦ç›®çš„æ˜¯ç”¨æ¥åº”å¯¹ä¸åŒç½‘ç»œæ³¢åŠ¨å’Œ VPS æœåŠ¡å•† SLA æƒ…å†µã€‚&lt;/li&gt;
&lt;li&gt;éšè—æºç«™å’Œé™ä½è´¹ç”¨ï¼šå¦‚æœä½¿ç”¨ GeoDNS å’Œ CDN è¿›è¡ŒåŠ é€Ÿï¼Œåˆ™éœ€è¦æ”¯ä»˜ DNS åˆ†åŒºè§£æå’Œå¯¹åº” CDN çš„è´¹ç”¨ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼Œèµ›åšè©è¨çš„ DNS æ²¡æœ‰åˆ†åŒºè§£æï¼ŒGeo steering éœ€è¦ä»˜è´¹ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å½“ç„¶ï¼Œå®é™…ä¸Šæ–¹æ¡ˆä¾æ—§å­˜åœ¨ç¼ºé™·ï¼Œä¾‹å¦‚ï¼Œæ¥å…¥ç‚¹å’Œé›†ç¾¤è¿æ¥éœ€è¦æ‰‹åŠ¨é…ç½®ï¼ŒCF è·¯ç”±é»‘ç®±ã€‚å½“ç„¶ï¼Œå‰è€…æ˜¯æˆ‘çš„é—®é¢˜ï¼Œåè€…ä¹Ÿæ˜¯æˆ‘çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;div class=&#34;footnotes&#34; role=&#34;doc-endnotes&#34;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&#34;fn:1&#34;&gt;
&lt;p&gt;å®é™…ä¸Šæœ‰äº›åæ‚”ï¼Œä¸ºä»€ä¹ˆä¸æ˜¯å­˜å‚¨èŠ‚ç‚¹å«åš Nexus è®¡ç®—èŠ‚ç‚¹ Riemannï¼Œè¿™æ ·æ‰ç¬¦åˆäººè®¾ã€‚&amp;#160;&lt;a href=&#34;#fnref:1&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:2&#34;&gt;
&lt;p&gt;èµ›åšè©è¨ä¹‹æ‰€ä»¥æ˜¯è©è¨ï¼Œæ˜¯å› ä¸ºå–„ã€‚&amp;#160;&lt;a href=&#34;#fnref:2&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:3&#34;&gt;
&lt;p&gt;è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘é€‰æ‹©è…¾è®¯äº‘çš„æœåŠ¡å™¨ä½œä¸ºä¸»æ§èŠ‚ç‚¹çš„åŸå› ï¼Œæ¯•ç«Ÿæ˜¯å¤§å‚ã€‚&amp;#160;&lt;a href=&#34;#fnref:3&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:4&#34;&gt;
&lt;p&gt;è¿™é‡Œæåˆ°çš„ã€Œä¸‹ä¸€è·³ã€æ˜¯æŒ‡ overlay ç½‘ç»œé‡Œçš„ï¼Œå®é™…ä¸Šè¿˜æ˜¯éœ€è¦ç»è¿‡å¾ˆå¤š popï¼Œåªä¸è¿‡å› ä¸ºéƒ½åœ¨è¿™ä¸ªå¤§å†…ç½‘é‡Œä¸ä¼šè¢«å±•ç¤ºå‡ºæ¥ã€‚&amp;#160;&lt;a href=&#34;#fnref:4&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</description>
    </item>
    
    <item>
      <title>ğŸ” Authentik - An alternative of self-hosted Single-Sign-On Module That you might Need </title>
      <link>https://blog.cklau.cc/post/authentik/</link>
      <pubDate>Mon, 15 Apr 2024 00:12:00 +0000</pubDate>
      <guid>https://blog.cklau.cc/post/authentik/</guid>
      <description>&lt;p&gt;If you are working on a homelab, you might need a module to use one account to walk around. You might need Authentik. This is not a post for the introduction, but a post for let you need this Authentik, a self-hosted SSO application.&lt;/p&gt;
&lt;p&gt;æœ¬èº« Authentik çš„æ–‡æ¡£å’Œå¾ˆå¤šèµ„æ–™éƒ½æ˜¯ç”¨è‹±æ–‡åˆ¶ä½œçš„ï¼Œè€Œä¸­æ–‡ç¯å¢ƒä¸­ä¼¼ä¹è¿˜æ²¡æœ‰ä¸€ä¸ªå¾ˆå¥½çš„é›†åˆã€‚å¾ˆå·§ï¼Œ&lt;a href=&#34;https://ecwuuuuu.com&#34;&gt;@ECWU&lt;/a&gt; åˆ¶ä½œäº†ä¸€ç³»åˆ—å…³äº Authentik çš„æ•™ç¨‹ï¼Œç›®å‰æ¥çœ‹ï¼Œåº”è¯¥æ˜¯ä¸­æ–‡äº’è”ç½‘çš„ç¬¬ä¸€å¥—æ¯”è¾ƒå®Œæˆçš„æ•™ç¨‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://ecwuuuuu.com/series/authentik/&#34;&gt;Series: Authentik&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.bilibili.com/video/BV1pm41167WK/&#34;&gt;Authentik æ•™ç¨‹ç³»åˆ— - éƒ¨ç½²è‡ªå·±çš„å¼€æºèº«ä»½éªŒè¯æœåŠ¡ - ä»‹ç»ã€å®‰è£…å’Œé…ç½®&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;center&gt;
  &lt;img src=&#34;https://32cf906.webp.li/2024/08/ecwu-authentik.png&#34; width=70%&gt;
&lt;/center&gt;</description>
    </item>
    
    <item>
      <title>ğŸ§‘ğŸ¿â€ğŸ’» Multimodal Representation Leraning from both Text and Image</title>
      <link>https://blog.cklau.cc/post/scientia/multi-modality/</link>
      <pubDate>Thu, 08 Feb 2024 00:15:00 +0000</pubDate>
      <guid>https://blog.cklau.cc/post/scientia/multi-modality/</guid>
      <description>&lt;h2 id=&#34;before&#34;&gt;Before&lt;/h2&gt;
&lt;p&gt;For a long time, the machine learning model (deep learning model) cannot understand more than one modality, i.e., whether they knows how to do the text-based task or they know how to play with the image. As artificial intelligence, the researchers would like to the models have the cability of manipulating the multimodal data as the natural intelligence is not limited to just a single modality. Such that the AI shell read and write text while they could also see images and watch videos and hear the audio.&lt;/p&gt;
&lt;p&gt;However, different data mode has different representation, especially for the machine, i.e., different mode of data has different representation. Some of the modality can be approximated by the others, e.g. audio can be transformed into images via the Fourier Transformation &lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;
&lt;p&gt;Usually, the multimodal learning includes these five aspects [&lt;a class=&#34;hugo-simplecite-cite-hyperlink&#34; href=&#34;#bibreference-1&#34; title=&#34;T. BaltruÅ¡aitis, C. Ahuja, and L. Morency, Multimodal Machine Learning: A Survey and Taxonomy. arXiv, 2017. [Online]. Available: http://arxiv.org/abs/1705.09406 [Accessed: Feb. 8, 2024]. &#34;&gt;1&lt;/a&gt;]:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Representation: It is important for us to know how to represent each unimodality or multimodality&lt;/li&gt;
&lt;li&gt;Translation: This is the mapping from one data mode to another, e.g. using spectrogram to transform audio to image&lt;/li&gt;
&lt;li&gt;Alignment or Registration: This is the direct relation between elements from two or more different modalities. If they are in the same modality, we would call it &lt;em&gt;registration&lt;/em&gt;.&lt;/li&gt;
&lt;li&gt;Fusion: It is to join information from two or more modalities to perform a downstream task.&lt;/li&gt;
&lt;li&gt;Co-learning: Transforming knowledge from different modalities&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;For this series, we are not shaped by the five main aspects, instead, we would organized by modalities. In this post, we are focusing on the Text and Image, with such amounts of researchs and works, I decided to follow on the two papers: CLIP [&lt;a class=&#34;hugo-simplecite-cite-hyperlink&#34; href=&#34;#bibreference-2&#34; title=&#34;A. Radford, J. Kim, C. Hallacy, A. Ramesh, G. Goh, S. Agarwal, G. Sastry, A. Askell, P. Mishkin, J. Clark, G. Krueger, and I. Sutskever, Learning Transferable Visual Models From Natural Language Supervision, . &#34;&gt;2&lt;/a&gt;] and BLIP [&lt;a class=&#34;hugo-simplecite-cite-hyperlink&#34; href=&#34;#bibreference-3&#34; title=&#34;J. Li, D. Li, C. Xiong, and S. Hoi, BLIP: Bootstrapping Language-Image Pre-training for Unified Vision-Language Understanding and Generation, . &#34;&gt;3&lt;/a&gt;], some of their variants would be mentioned.&lt;/p&gt;
&lt;h2 id=&#34;clip-learning-transferable-visual-models-from-natural-language-supervision&#34;&gt;CLIP: Learning Transferable Visual Models From Natural Language Supervision&lt;/h2&gt;
&lt;p&gt;CLIP&amp;rsquo;s key contribution is its ability to map text and image into a shared embedding space based on the seperated text/image encoder. This shared multimodal embedding space makes text-to-image and image-to-text tasks so much easier. Not meaning that it can directly used in these tasks, but providing a idea that how to do the multimodal representation.&lt;/p&gt;
&lt;p&gt;Figure 1 shows the approach of CLIP model. Text and image are encoded by two different encoders $f_{\theta_i}$ and $g_{\theta_t}$, let $\mathbf{x} \in \mathbb{R}^{N \times H \times W \times C}$ as one batch of image, $\mathbf{y} \in \mathbb{R}^{N \times S}$ as one batch of text data,  the embedding of $\mathbf{x}$ and $\mathbf{y}$ then can be denoted as:&lt;/p&gt;
&lt;p&gt;$$\begin{aligned} \mathbf{f} &amp;amp;= f_{\theta_i}(\mathbf{x}) \in \mathbf{R}^{N \times D_i} \Rightarrow \mathbf{f}^e = L_i(\mathbf{f})  \cr  \mathbf{g} &amp;amp;= g_{\theta_t}(\mathbf{y}) \in \mathbf{R}^{N \times D_t} \Rightarrow \mathbf{g}^e = L_t(\mathbf{g}) \end{aligned}$$&lt;/p&gt;
&lt;p&gt;where $D_i$ and $D_t$ are the dimension of the image and text embedding, respectively. linear projectors $L_i$ and $L_t$ are used for mapping two embedding into the same dimension. The dot product between the image and text embedding is used to calculate the similarity between the text and image, i.e., $\mathcal{F} = \mathbf{f} \cdot \mathbf{g}$, where $\mathcal{F} \in \mathbb{R}^{N \times N}$ is the similarity matrix and the $\mathcal{F} \circ I_N$ is the positive sample set, and the others are the negative samples (In total, there are $N^2 - N$ negatives samples). The pseudocode of the CLIP model is shown in Figure 2 (original papers). The idea of CLIP model is relative naive, as it is a classic negative sampling method called batch negative sampling. However, intuitively, it is hard for us to do the model explanation, i.e., why does it work? Still, we could explan that the corresponding text and image are sharing the same ontology, but this kind of explanation is not grounded. More or less, the main contribution is that they create a huge dataset with the text and image pairs, including 400 million (image, text) pairs collected form of a variety of publicly available sources on the Internet. With this dataset, they don&amp;rsquo;t even need the pretrained encoder as the encoder can be trained simultaneously with the downstream alignment.&lt;/p&gt;
&lt;h3 id=&#34;implementation&#34;&gt;Implementation&lt;/h3&gt;
&lt;p&gt;Here is the simple implementation of CLIP:&lt;/p&gt;
&lt;details&gt;
  &lt;summary&gt;Implementation of Encoders&lt;/summary&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; torch 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; torch.nn &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; nn
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;from&lt;/span&gt; transformers &lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; AutoConfig, AutoModel, AutoModelForImageClassification
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; numpy &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; np
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;TextEncoder&lt;/span&gt;(nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Module):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; __init__(self, model_name&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;FacebookAI/roberta-base&amp;#34;&lt;/span&gt;:str, device&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;cpu&amp;#34;&lt;/span&gt;:str, pretrained&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;True&lt;/span&gt;:bool, freeze&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;False&lt;/span&gt;:bool):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        super(TextEncoder)&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;__init__()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;model &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; {&lt;span style=&#34;color:#66d9ef&#34;&gt;True&lt;/span&gt;: AutoModel&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;from_pretrained(model_name), 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                      &lt;span style=&#34;color:#66d9ef&#34;&gt;False&lt;/span&gt;: AutoModel&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;from_config(AutoConfig&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;from_pretrained(model_name))}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;out_dim &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; AutoConfig&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;from_pretrained(model_name)&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;hidden_size &lt;span style=&#34;color:#75715e&#34;&gt;# 768&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;freeze &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; freeze
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; freeze:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; name ,param &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;model&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;named_parameters():
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                param&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;requires_grad &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;False&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;forward&lt;/span&gt;(self, inputs):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;freeze:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;model&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;eval()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;pass&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        feature &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;functional&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;normalize(torch&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;mean(self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;model(&lt;span style=&#34;color:#f92672&#34;&gt;**&lt;/span&gt;inputs)&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;last_hidden_state, axis&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;), dim&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; feature
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ImageEncoder&lt;/span&gt;(nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Module):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; __init__(self, model_name&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google/vit-base-patch16-224&amp;#34;&lt;/span&gt;:str, device&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;cpu&amp;#34;&lt;/span&gt;:str, pretrained&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;True&lt;/span&gt;:bool, freeze&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;False&lt;/span&gt;:bool):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        super(TextEncoder)&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;__init__()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;model &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; {&lt;span style=&#34;color:#66d9ef&#34;&gt;True&lt;/span&gt;: AutoModelForImageClassification&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;from_pretrained(model_name), 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                      &lt;span style=&#34;color:#66d9ef&#34;&gt;False&lt;/span&gt;: AutoModelForImageClassification&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;from_config(AutoConfig&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;from_pretrained(model_name))}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;out_dim &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1000&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;# ViT is trained with ImageNet&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;freeze &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; freeze
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; freeze:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; name ,param &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;model&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;named_parameters():
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                param&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;requires_grad &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;False&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;forward&lt;/span&gt;(self, inputs):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        feature &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;model(&lt;span style=&#34;color:#f92672&#34;&gt;**&lt;/span&gt;inputs)&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;logits
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        feature &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; F&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;normalize(feature, dim&lt;span style=&#34;color:#f92672&#34;&gt;=-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; feature
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/details&gt;
&lt;details&gt;
  &lt;summary&gt;Implementation of Linear Projection&lt;/summary&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;LinearProject&lt;/span&gt;(nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Module):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; __init__(self, in_features, out_features):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          super(LinearProject)&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;__init__()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;projection &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Sequential([
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Linear(in_features, out_features), nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;GELU(), nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;LayerNorm(out_features)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          ])
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;forward&lt;/span&gt;(self, x):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          output &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;projection(x)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; output
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/details&gt;
&lt;details&gt;
  &lt;summary&gt;Implementation of CLIP Model&lt;/summary&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;CLIPModel&lt;/span&gt;(nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Module):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; __init__(self, model_name &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; {&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;TEXT&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;FacebookAI/roberta-base&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;IMG&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;google/vit-base-patch16-224&amp;#34;&lt;/span&gt;}:dict, 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                  device&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;cpu&amp;#34;&lt;/span&gt;:str, pretrained&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;True&lt;/span&gt;:bool, freeze&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;False&lt;/span&gt;:bool, hidden_dim&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;256&lt;/span&gt;:int):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        super(CLIPModel)&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;__init__()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;enc_t &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; TextEncoder(model_name&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;model_name[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;TEXT&amp;#34;&lt;/span&gt;], device&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;device, freeze&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;freeze)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;enc_i &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; ImageEncoder(model_name&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;model_name[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;IMG&amp;#34;&lt;/span&gt;], device&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;device, freeze&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;freeze)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;proj_t &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; LinearProject(self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;enc_t&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;out_dim, hidden_dim)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;proj_i &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; LinearProject(self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;enc_i&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;out_dim, hidden_dim)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;logit_scale &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Parameter(torch&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;ones([]))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;init_parameters()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;init_parameters&lt;/span&gt;(self):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;# turn temperature into a learnable parameter&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;init&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;constant_(self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;logit_scale, np&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;log(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.07&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;criterion&lt;/span&gt;(self, text, image):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        CE &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;functional&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;cross_entropy
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        labels &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; torch&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;arange(text&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;shape[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;], device&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;str(text&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;device), dtype&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;torch&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;long)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        logits_t &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; text &lt;span style=&#34;color:#f92672&#34;&gt;@&lt;/span&gt; image&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;T &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;logit_scale&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;exp()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        logits_i &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; image &lt;span style=&#34;color:#f92672&#34;&gt;@&lt;/span&gt; text&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;T &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;logit_scale&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;exp()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        loss &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (CE(logits_t, labels) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; CE(logits_i, labels)) &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; loss
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;forward&lt;/span&gt;(self, text, image):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        feature_t, feature_i &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;proj_t(self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;enc_t(text)), self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;proj_i(self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;enc_i(image))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        loss &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;criterion(feature_t, feature_i)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; feature_t, feature_i, self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;logit_scale, loss
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/details&gt;
&lt;h3 id=&#34;applications&#34;&gt;Applications&lt;/h3&gt;
&lt;p&gt;The first application of CLIP is classification. Since the CLIP model is relatively similar to the reitrival model, it can be easily implemented into the classification with zero-shot learning. The zero-shot learning is a task that the model can classify the unseen classes without any training data. See the second part of Figure 1, where for a given image, the model can classify the similarity between the given image and the prompted text, by calculating the similarity of image and each given sentence we could get the classification, vice versa. This can be seen as classification, or retrieval.&lt;/p&gt;
&lt;p&gt;The second application is the generation. The CLIP model can be used to generate the image from the given text. Although it cannot generate the image directly since it does not have any decoder, however, the CLIP can be seen as the backbone and provide the embedding for image or text generation. After the CLIP came out, OpenAI also released the DALL-E2, where they provide a model called unCLIP [&lt;a class=&#34;hugo-simplecite-cite-hyperlink&#34; href=&#34;#bibreference-4&#34; title=&#34;A. Ramesh, P. Dhariwal, A. Nichol, C. Chu, and M. Chen, Hierarchical Text-Conditional Image Generation with CLIP Latents. arXiv, 2022. [Online]. Available: http://arxiv.org/abs/2204.06125 [Accessed: Feb. 8, 2024]. &#34;&gt;4&lt;/a&gt;], it is a text-to-image generation model&lt;sup id=&#34;fnref:2&#34;&gt;&lt;a href=&#34;#fn:2&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;
&lt;h2 id=&#34;blip-hierarchical-text-conditional-image-generation-with-clip-latents&#34;&gt;BLIP: Hierarchical Text-Conditional Image Generation with CLIP Latents&lt;/h2&gt;
&lt;h2 id=&#34;empirical-research&#34;&gt;Empirical Research&lt;/h2&gt;
&lt;h2 id=&#34;reference&#34;&gt;Reference&lt;/h2&gt;
&lt;ol class=&#34;hugo-simplecite-reference-list&#34;&gt;&lt;li class=&#34;hugo-simplecite-reference-list-item&#34; id=&#34;bibreference-1&#34;&gt;T. BaltruÅ¡aitis,&amp;#32;C. Ahuja, and&amp;#32;L. Morency,&amp;#32;&lt;em&gt;Multimodal Machine Learning: A Survey and Taxonomy&lt;/em&gt;.&amp;#32;arXiv, 2017.&amp;#32;[Online]. Available: &lt;a class=&#34;hugo-simplecite-url-hyperlink&#34; rel=&#34;noopener&#34; target=&#34;_blank&#34; href=&#34;http://arxiv.org/abs/1705.09406&#34;&gt;http://arxiv.org/abs/1705.09406&lt;/a&gt;&amp;#32;[Accessed:
Feb. 8, 2024].
&lt;/li&gt;&lt;li class=&#34;hugo-simplecite-reference-list-item&#34; id=&#34;bibreference-2&#34;&gt;A. Radford,&amp;#32;J. Kim,&amp;#32;C. Hallacy,&amp;#32;A. Ramesh,&amp;#32;G. Goh,&amp;#32;S. Agarwal,&amp;#32;G. Sastry,&amp;#32;A. Askell,&amp;#32;P. Mishkin,&amp;#32;J. Clark,&amp;#32;G. Krueger, and&amp;#32;I. Sutskever,&amp;#32;&lt;q&gt;Learning Transferable Visual Models From Natural Language Supervision,&lt;/q&gt;&amp;#32;.&amp;#32;&lt;/li&gt;&lt;li class=&#34;hugo-simplecite-reference-list-item&#34; id=&#34;bibreference-3&#34;&gt;J. Li,&amp;#32;D. Li,&amp;#32;C. Xiong, and&amp;#32;S. Hoi,&amp;#32;&lt;q&gt;BLIP: Bootstrapping Language-Image Pre-training for Unified Vision-Language Understanding and Generation,&lt;/q&gt;&amp;#32;.&amp;#32;&lt;/li&gt;&lt;li class=&#34;hugo-simplecite-reference-list-item&#34; id=&#34;bibreference-4&#34;&gt;A. Ramesh,&amp;#32;P. Dhariwal,&amp;#32;A. Nichol,&amp;#32;C. Chu, and&amp;#32;M. Chen,&amp;#32;&lt;em&gt;Hierarchical Text-Conditional Image Generation with CLIP Latents&lt;/em&gt;.&amp;#32;arXiv, 2022.&amp;#32;[Online]. Available: &lt;a class=&#34;hugo-simplecite-url-hyperlink&#34; rel=&#34;noopener&#34; target=&#34;_blank&#34; href=&#34;http://arxiv.org/abs/2204.06125&#34;&gt;http://arxiv.org/abs/2204.06125&lt;/a&gt;&amp;#32;[Accessed:
Feb. 8, 2024].
&lt;/li&gt;&lt;/ol&gt;
&lt;div class=&#34;footnotes&#34; role=&#34;doc-endnotes&#34;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&#34;fn:1&#34;&gt;
&lt;p&gt;For more information, pleace check &lt;a href=&#34;https://en.wikipedia.org/wiki/Spectrogram&#34;&gt;Spectrogram&lt;/a&gt; and &lt;a href=&#34;https://ieeexplore.ieee.org/document/9859621&#34;&gt;Mel Spectrogram&lt;/a&gt;&amp;#160;&lt;a href=&#34;#fnref:1&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:2&#34;&gt;
&lt;p&gt;We would talk about the &amp;ldquo;downstream&amp;rdquo; research in the &lt;a href=&#34;#empirical-research&#34;&gt;&amp;ldquo;Empirical Research&amp;rdquo;&lt;/a&gt; section.&amp;#160;&lt;a href=&#34;#fnref:2&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>ğŸ›œ å¢ƒå†…å¤– CDN åˆ†æµé…ç½®</title>
      <link>https://blog.cklau.cc/post/cdn-divertor.zh/</link>
      <pubDate>Mon, 29 Jan 2024 00:00:00 +0800</pubDate>
      <guid>https://blog.cklau.cc/post/cdn-divertor.zh/</guid>
      <description>&lt;p&gt;æœ¬æ–‡çº¯å±ä¸ªäººè®°å½•ï¼Œä¸ä¿è¯æ˜¯æœ€ä¼˜è§£å†³æ–¹æ¡ˆï¼Œä»…ä¾›å‚è€ƒã€‚ å¯¹äºåšå®¢çš„å¢ƒå†…å¤– CDN åˆ†æµæœ‰å¾ˆå¤šæ›´åŠ ä¼˜é›…çš„æ–¹å¼ï¼Œè€Œæˆ‘é€‰æ‹©äº†æœ€è ¢çš„ã€Œè·³è½¬ã€ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‰ç½®æ¡ä»¶&#34;&gt;å‰ç½®æ¡ä»¶&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;æˆ‘çš„é™æ€åšå®¢æ˜¯æ‰˜ç®¡åœ¨ &lt;a href=&#34;https://pages.github.com&#34;&gt;GitHub Page&lt;/a&gt;ï¼Œå¹¶ä¸”ä½¿ç”¨äº† &lt;a href=&#34;https://www.cloudflare.com&#34;&gt;Cloudflare&lt;/a&gt; çš„ CDN æœåŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;æˆ‘æ‹¥æœ‰ä¸€å°å¢ƒå†…æœåŠ¡å™¨ï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ªå·²å¤‡æ¡ˆåŸŸåï¼Œå¯ä»¥æ»¡è¶³å›½å†… CDN çš„è¦æ±‚ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;å¢ƒå†…å¤–-cdn-åˆ†æµ&#34;&gt;å¢ƒå†…å¤– CDN åˆ†æµ&lt;/h2&gt;
&lt;h3 id=&#34;ç½‘ç«™è¿è¡Œ&#34;&gt;ç½‘ç«™è¿è¡Œ&lt;/h3&gt;
&lt;p&gt;æˆ‘çš„ç½‘ç«™éƒ¨ç½²æµç¨‹æ˜¯è¿™æ ·çš„ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åœ¨æœ¬åœ°ç¼–å†™åšå®¢å†…å®¹ï¼Œä½¿ç”¨ &lt;a href=&#34;https://gohugo.io&#34;&gt;Hugo&lt;/a&gt; ç”Ÿæˆé™æ€ç½‘é¡µè¿›è¡Œå†…å®¹æ¸²æŸ“è¿›è¡Œæ£€æŸ¥ã€‚&lt;/li&gt;
&lt;li&gt;å°† source file æ¨åŠ¨åˆ° &lt;a href=&#34;https://github.com/terenceliu98.github.io.source&#34;&gt;TerenceLiu98.github.io.source&lt;/a&gt; ä»“åº“ï¼Œä½¿ç”¨ GitHub Action è¿›è¡Œè‡ªåŠ¨éƒ¨ç½²ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨ GitHub Action ä¸­ï¼Œä½¿ç”¨ Hugo ç”Ÿæˆé™æ€ç½‘é¡µï¼Œå¹¶å°†ç”Ÿæˆçš„ç½‘é¡µæ¨é€åˆ° &lt;a href=&#34;https://github.com/terenceliu98.github.io&#34;&gt;TerenceLiu98.github.io&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;åœ¨ Cloudflare ä¸­ï¼Œå°† &lt;a href=&#34;https://github.com/terenceliu98.github.io&#34;&gt;TerenceLiu98.github.io&lt;/a&gt; ä»“åº“çš„å†…å®¹è¿›è¡Œ CDN åŠ é€Ÿã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;å…·ä½“é…ç½®&#34;&gt;å…·ä½“é…ç½®&lt;/h3&gt;
&lt;p&gt;ä½ éœ€è¦åœ¨å›½å†…çš„æœåŠ¡å™¨ä¸Šæ­å»ºä¸€ä¸ª HTTP æœåŠ¡ï¼Œç”¨äºåˆ†æµå¢ƒå†…çš„è¯·æ±‚ã€‚è¿™é‡Œæˆ‘ä½¿ç”¨äº† &lt;a href=&#34;https://www.nginx.com&#34;&gt;Nginx&lt;/a&gt; ä½œä¸º HTTP æœåŠ¡ï¼Œå› ä¸ºæˆ‘ä»ä¸€å¼€å§‹å°±åœ¨ä½¿ç”¨ nginx æ‰€ä»¥ç›¸å¯¹ç†Ÿæ‚‰ã€‚ä¸è¿‡ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»– HTTP æœåŠ¡ï¼Œæ¯”å¦‚ &lt;a href=&#34;https://caddyserver.com&#34;&gt;Caddy&lt;/a&gt;ï¼ŒCaddy æœ‰ä¸€ä¸ªå¾ˆå¥½çš„ç‰¹æ€§ï¼Œå°±æ˜¯å¯ä»¥è‡ªåŠ¨ç”³è¯· HTTPS è¯ä¹¦ï¼Œè¿™æ ·ä½ å°±ä¸éœ€è¦è‡ªå·±å»ç”³è¯·è¯ä¹¦äº†ã€‚æˆ‘è¿™é‡Œä½¿ç”¨ ACME è¿›è¡Œè¯ä¹¦ç”³è¯·ï¼Œæ‰€ä»¥å°±ä¸å†ä½¿ç”¨ Caddy äº†ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;server &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       	listen 80;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      	listen &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;::&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;:80;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      	server_name blog.rho.ac.cn;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;301&lt;/span&gt; https://$host$request_uri;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;server &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        listen &lt;span style=&#34;color:#ae81ff&#34;&gt;443&lt;/span&gt; ssl;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        server_name blog.rho.ac.cn;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ssl_certificate /home/ubuntu/acme-script/ssl/rho.ac.cn.pem;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ssl_certificate_key /home/ubuntu/acme-script/ssl/rho.ac.cn.key;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	root /var/www/terenceliu98.github.io;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	index index.php index.html index.htm;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  location / &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  	try_files $uri $uri/ &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;404;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…¶ä¸­ï¼Œ&lt;code&gt;server_name&lt;/code&gt; æ˜¯å‡†å¤‡çš„å¤‡æ¡ˆååŸŸåï¼Œ&lt;code&gt;root&lt;/code&gt; æŒ‡å‘çš„æ˜¯æˆ‘å­˜å‚¨åšå®¢å†…å®¹çš„åœ°æ–¹ï¼Œ&lt;code&gt;index&lt;/code&gt; æŒ‡å®šäº†é»˜è®¤çš„é¦–é¡µã€‚&lt;code&gt;ssl_certificate&lt;/code&gt; å’Œ &lt;code&gt;ssl_certificate_key&lt;/code&gt; æŒ‡å®šäº† HTTPS è¯ä¹¦çš„ä½ç½®ã€‚ä½ ä¹Ÿå¯ä»¥å¯¹ nginx é…ç½®æ–‡ä»¶è¿›è¡Œå®šåˆ¶ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚åœ¨å‡†å¤‡å¥½è¿™äº›ä»¥åï¼Œå¯ä»¥å°è¯•è¿è¡Œç½‘ç«™ï¼Œå¦‚æœæ²¡æœ‰é—®é¢˜ï¼Œé‚£ä¹ˆå°±å¯ä»¥è¿›è¡Œä¸‹ä¸€æ­¥äº†ã€‚&lt;/p&gt;
&lt;p&gt;å½“ç„¶ï¼Œè¿™é‡Œåº”è¯¥ä¼šé‡åˆ°ä¸€ä¸ªåŸŸåé”™è¯¯çš„é—®é¢˜ï¼Œå› ä¸ºåœ¨ Hugo é‡Œæˆ‘ä»¬é…ç½®äº† CNAMEï¼Œæ‰€ä»¥å®ƒåœ¨æ¸²æŸ“çš„æ—¶å€™ä¼šå°†åŸŸåæ›¿æ¢æˆ CNAME ä¸­æŒ‡å®šçš„åŸŸåï¼Œè¿™æ ·å°±ä¼šå‡ºç°åŸŸåä¸åŒ¹é…çš„é—®é¢˜ã€‚è¿™é‡Œæˆ‘ä½¿ç”¨äº†ä¸€ä¸ªå¾ˆè ¢çš„æ–¹å¼è§£å†³ï¼Œå°±æ˜¯åœ¨ Hugo æ¸²æŸ“ä¹‹åï¼Œè¿›è¡ŒåŸŸåæ›¿æ¢ã€‚è¿™é‡Œæˆ‘ä½¿ç”¨äº†ä¸€ä¸ª Bash è„šæœ¬ï¼Œå°†åŸŸåæ›¿æ¢æˆäº†æˆ‘å‡†å¤‡çš„å¤‡æ¡ˆååŸŸåã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git restore . &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; git pull
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; file in &lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;find -iname &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;*.html&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt;; &lt;span style=&#34;color:#66d9ef&#34;&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	sed -i &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;s/blog.cklau.cc/blog.rho.ac.cn/g&amp;#39;&lt;/span&gt; $file
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;done&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨ç½‘ç«™å¯ä»¥æ­£å¸¸è¿è¡Œåï¼Œæˆ‘ä»¬ä»…éœ€è¦åœ¨è…¾è®¯äº‘çš„ CDN æ§åˆ¶å°é‡Œæ·»åŠ è‡ªå·±çš„åŸŸåå³å¯ï¼Œå°†åŸŸåè§£æåˆ°æä¾›çš„ CNAMEï¼Œä¸»æºç«™æŒ‡å‘è‡ªå·±å›½å†…çš„æœåŠ¡å™¨ IPï¼Œé…ç½®å¥½å›æº Host å³å¯&lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;ã€‚å…¶ä»–å¹³å°ä¹Ÿæ˜¯ä¸€æ ·çš„æ–¹æ³•ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚&lt;/p&gt;
&lt;p&gt;Cloudflare çš„é…ç½®ä¹Ÿååˆ†ç®€å•ï¼Œä»…éœ€è¦åœ¨ Rules é‡Œæ·»åŠ ä¸€ä¸ªè§„åˆ™ï¼Œæˆ‘è¿™é‡Œé€‰æ‹©çš„æ˜¯æ ¹æ®å›½å®¶è¿›è¡Œåˆ†æµï¼Œè¿™æ ·è™½ç„¶æ˜¯ä¸€åˆ€åˆ‡ï¼Œä½†æ˜¯ç¡®å®ä¿è¯äº†ç”¨æˆ·çš„ä½¿ç”¨ä½“éªŒï¼ˆä¹Ÿæ˜¯å› ä¸ºæˆ‘ä¹°ä¸èµ· GeoDNSï¼‰ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åç»­&#34;&gt;åç»­&lt;/h3&gt;
&lt;p&gt;å› ä¸ºè…¾è®¯äº‘ CDN çš„ HTTPS éœ€è¦è‡ªå·±æä¾›è¯ä¹¦ï¼ˆä¹Ÿéœ€è¦ä»˜è´¹ï¼‰ï¼Œæ‰€ä»¥æˆ‘å°†åˆšæ‰ç”³è¯·åˆ°çš„ ACME è¯ä¹¦æ·»åŠ åˆ°äº†æŒ‡å®šçš„åœ°æ–¹ï¼Œä¸çŸ¥é“æ˜¯å¦æœ‰å¯ä»¥è‡ªåŠ¨åŒ–çš„æ–¹æ³•ï¼Œä¸ç„¶å°±éœ€è¦ä¸‰ä¸ªæœˆæ›´æ–°ä¸€æ¬¡è¯ä¹¦äº† ğŸ¥¹ ã€‚&lt;/p&gt;
&lt;div class=&#34;footnotes&#34; role=&#34;doc-endnotes&#34;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&#34;fn:1&#34;&gt;
&lt;p&gt;å›æº HOST å°±å¡«è‡ªå·±çš„åŸŸåå³å¯ï¼Œä¸éœ€è¦å¡« IPï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»é…ç½®äº† HTTP æœåŠ¡ï¼Œæ‰€ä»¥éœ€è¦åŸŸåè¿›è¡Œåˆ†æµã€‚&amp;#160;&lt;a href=&#34;#fnref:1&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</description>
    </item>
    
    <item>
      <title>ğŸ’» ä»ç™½è‹¹æœåˆ°é»‘è‹¹æœ - SER5 MAX çš„éª‡é‡‘å¡”ä¹‹æ—…</title>
      <link>https://blog.cklau.cc/post/hackintosh.zh/</link>
      <pubDate>Thu, 18 Jan 2024 00:12:00 +0000</pubDate>
      <guid>https://blog.cklau.cc/post/hackintosh.zh/</guid>
      <description>&lt;blockquote&gt;
&lt;p&gt;ğŸ’¡ For learning and communication purposes only. Commercial use is strictly prohibited.&lt;/p&gt;
&lt;p&gt;ğŸ’¡ æ­¤æ–‡ä¸ºæŠ€æœ¯å®è·µè®°å½•å’Œä¸ªäººå­¦ä¹ ç”¨é€”ï¼Œå¹¶åœ¨å®éªŒåå¸è½½åŠåˆ é™¤ç›¸å…³æ–‡ä»¶ï¼ŒåŒ…æ‹¬ä¸”ä¸é™ EFI æ–‡ä»¶å’Œé•œåƒã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;ä¸€å°-mini-pc&#34;&gt;ä¸€å° mini PC&lt;/h2&gt;
&lt;p&gt;ç¬”è€…ç›®å‰çš„å·¥ä½œå’Œç”Ÿæ´»åœ¨ä¸çŸ¥ä¸è§‰ä¹‹ä¸­å·²ç»æµ¸æ¶¦åœ¨ iOS + iPadOS + macOS ä¹‹ä¸­ï¼Œã€Œææœºå¤šå¹´ï¼Œå½’æ¥ä»æ˜¯ Appleã€åœ¨å½“å¹´çš„æˆ‘çœ‹æ¥ä¼¼ä¹æœªæ¥æ˜¯ä¼šä¸€å®šçš„ï¼Œä¹Ÿäº¦ç„¶å®ç°äº†ã€‚è€Œè‹¹æœå…¬å¸çš„ã€Œé‡‘å†…å­˜ï¼Œé“¶å›ºæ€ã€ç­–ç•¥è®©æˆ‘è¿™ä¸ªæ”¶å…¥å°šä¸å¦‚ Homeless çš„äººæŠ¬ä¸èµ·å¤´ã€‚ä¸å¾—å·²ï¼Œåœ¨äº’è”ç½‘å†²æµªä¸­ï¼Œå†¥å†¥ä¹‹ä¸­ï¼Œè®©æˆ‘çœ‹åˆ°äº†è¿™ä¸€å° mini PCï¼šBeelink SER5 MAXï¼Œç”±é›¶åˆ»å…¬å¸å¼€å‘çš„ä¸€å°å·´æŒå°ä¸»æœºã€‚å…·ä½“é…ç½®å¦‚ä¸‹: AMD Ryzen 7 5800H + 32GB DDR4 + 1T NVME SSDï¼Œä½œä¸ºä¸€ä¸ªæ‡’äººï¼Œå¹¶æ²¡æœ‰è´­ä¹°å‡†ç³»ç»Ÿï¼Œè€Œ 32GB å·²ç»å¯ä»¥æ»¡è¶³ä¸ªäººæ—¥å¸¸ä½¿ç”¨ã€‚è‡³äºç³»ç»Ÿçš„é€‰æ‹©ï¼Œå¦‚æœå¯ä»¥å’Œç¬”è€…å…¶ä»–è®¾å¤‡è¿›è¡Œã€Œåç‰©äº’è”ã€é‚£ä¾¿æ˜¯æœ€å¥½çš„&lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;ã€‚ä»è¿™é‡Œï¼Œå¼•å‡ºäº† Hackintoshã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¦‚ä½•èµ¶ä¸Šæ½®æµ&#34;&gt;å¦‚ä½•èµ¶ä¸Šæ½®æµ&lt;/h2&gt;
&lt;p&gt;ã€Œé»‘è‹¹æœã€æ˜¯æŒ‡åœ¨ä¸€å°æ²¡æœ‰è‹¹æœ Logo çš„ç”µè„‘ä¸Šè¿è¡Œéº¦é‡‘å¡”ç³»ç»Ÿçš„è¡Œä¸ºï¼Œå†å²è¯¦è§è¿™é‡Œï¼š&lt;a href=&#34;https://zh.wikipedia.org/wiki/Hackintosh&#34;&gt;Hackintosh&lt;/a&gt;ã€‚æ ¹æ®ã€Œå‹å· + é»‘è‹¹æœã€çš„å…³é”®è¯è¿›è¡Œæœç´¢ï¼Œæˆ‘æ‰¾åˆ°äº†ä¸€ç³»åˆ—å¤§å¤šæ˜¯åœ¨ 2023 å¹´ä¸­å‰æœŸå‘å¸ƒçš„æ–‡ç« å’Œè§†é¢‘ï¼Œæˆ‘æ ¹æ®å…¶ä¸­æ€»ç»“å‡ºå‡ ä¸ªå­—ï¼šå¯ä»¥è£…ä½†æ˜¯ä¸ç®—å¥½ç”¨ã€‚é¡ºè—¤æ‘¸ç“œï¼Œæˆ‘æ‰¾åˆ°äº†é»‘è‹¹æœâ€œæ€»éƒ¨â€ï¼š&lt;a href=&#34;https://blog.daliansky.net/&#34;&gt;é»‘æœå°å…µçš„éƒ¨è½é˜&lt;/a&gt;ã€‚åœ¨å¤§è‡´äº†è§£äº†é»‘è‹¹æœçš„å®‰è£…æ–¹å¼åï¼Œæˆ‘æœæ–­é€‰æ‹©äº†æœ€ç¨³å¦¥çš„æ–¹å¼ï¼Œä¸‹è½½åˆ«äººåˆ¶ä½œå¥½çš„å¸¦ EFI çš„é•œåƒï¼ŒBig Sur çš„ç³»ç»Ÿä¼¼ä¹ä¹Ÿä¸å¤ªå¤æ—©ï¼Œä¹Ÿè¶³å¤Ÿä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ä¸€ç³»åˆ—æŠ˜è…¾åï¼ŒBig Sur å·²ç»æ»¡è¶³ä¸äº†æˆ‘çš„ä½¿ç”¨äº†ï¼Œæ¯”å¦‚ï¼Œå› ä¸ºäººåœ¨æµ·å¤–ï¼Œå¹¶ä¸å¤ªèƒ½å¾ˆæ–¹ä¾¿çš„è´­å…¥ç½‘ç»œæ‘„åƒå¤´&lt;sup id=&#34;fnref:2&#34;&gt;&lt;a href=&#34;#fn:2&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;ï¼Œæ‰€ä»¥ï¼Œä¹˜ç€è‹¹æœçš„&lt;a href=&#34;https://support.apple.com/en-gb/102546&#34;&gt;æ˜¥é£&lt;/a&gt;ï¼Œæˆ‘æŠŠ Big Sur å‡çº§åˆ°äº† Ventura&lt;sup id=&#34;fnref:3&#34;&gt;&lt;a href=&#34;#fn:3&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;3&lt;/a&gt;&lt;/sup&gt;ã€‚è¿™æ ·ä»¥æ¥ï¼Œæˆ‘å°±å¯ä»¥ä½¿ç”¨æˆ‘çš„ iPhone ä½œä¸ºç½‘ç»œæ‘„åƒå¤´ç”¨æ¥å¼€ä¼š&lt;sup id=&#34;fnref:4&#34;&gt;&lt;a href=&#34;#fn:4&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;4&lt;/a&gt;&lt;/sup&gt;ã€‚åœ¨å‡çº§çš„è¿‡ç¨‹ä¸­ï¼Œå®é™…ä¸Šä¹Ÿæ˜¯é‡åˆ°äº†ä¸€äº›é˜»æ»ï¼Œæ¯”å¦‚ä¸€å¼€å§‹æˆ‘æ˜¯æƒ³ä»ä» Big Sur å‡çº§åˆ° Montereyï¼Œä½†æ˜¯åœ¨ä½¿ç”¨ OC Auxiliary Tool æ›´æ–°å®Œ OpenCore å’Œ Kext åå‘ç°æˆ‘æ²¡æœ‰åŠæ³•åœ¨å¯åŠ¨ Monterey å‹¾é€‰ &lt;a href=&#34;https://chefkissinc.github.io/nred/&#34;&gt;NootedRed&lt;/a&gt;ï¼Œè¿™å¯ä¸å¤ªå¥½ï¼Œå› ä¸ºå¤±å»äº†æ ¸æ˜¾å°±ç­‰äºå¤±å»äº†æ‰€æœ‰ã€‚åœ¨ä¸€é¡¿æŠ˜è…¾åï¼Œæˆ‘å†³å®šå°è¯•ä¸€ä¸‹ Ventura å¦‚æœä¸è¡Œçš„è¯ï¼Œå°±å¾…åœ¨ Big Sur ç®—äº†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒèµ„æ–™&#34;&gt;å‚è€ƒèµ„æ–™&lt;/h2&gt;
&lt;p&gt;æ‰€æœ‰çš„å‚è€ƒèµ„æ–™å‡æ¥è‡ªäº’è”ç½‘ï¼Œè¯¦è§ä¸‹é¢çš„é™„ä»¶æ ã€‚&lt;/p&gt;
&lt;div class=&#34;footnotes&#34; role=&#34;doc-endnotes&#34;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&#34;fn:1&#34;&gt;
&lt;p&gt;ã€Œåç‰©äº’è”ã€æ˜¯æœ¬äººé­”æ”¹çš„è¯æ±‡ï¼Œæ„æŒ‡ä¸ªäººçš„ç”µå­è®¾å¤‡å¯ä»¥ç›¸äº’è¿æ¥ã€‚&amp;#160;&lt;a href=&#34;#fnref:1&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:2&#34;&gt;
&lt;p&gt;ä¹Ÿä¸æƒ³å› ä¸ºè¿™ä¸ªè€Œä¹°ä¸€ä¸ªä½åˆ†è¾¨ç‡çš„æ‘„åƒå¤´&amp;#160;&lt;a href=&#34;#fnref:2&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:3&#34;&gt;
&lt;p&gt;å³ä¾¿ Ventura çš„éƒ¨åˆ†æ“ä½œé€»è¾‘çœŸçš„ä¸åƒæ˜¯ç”µè„‘ï¼Œæˆ‘ä¹Ÿå†³å®šå¿å—ã€‚&amp;#160;&lt;a href=&#34;#fnref:3&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:4&#34;&gt;
&lt;p&gt;è™½ç„¶è‡³ä»Šä¸ç†è§£ä¸ºä»€ä¹ˆé¬¼ä½¬å–œæ¬¢å¼€ä¼šå–œæ¬¢å¼€æ‘„åƒå¤´ï¼Œè„¸å’Œè‚¢ä½“è¯­è¨€ä¸æ˜¯æœ€é‡è¦çš„å¥½å—ã€‚&amp;#160;&lt;a href=&#34;#fnref:4&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</description>
    </item>
    
    <item>
      <title>ğŸ‘¨â€ğŸ“ è¯»å¤šå°‘ä¹¦å’Œå­¦å¤šå°‘ä¹ </title>
      <link>https://blog.cklau.cc/post/edu-in-child.zh/</link>
      <pubDate>Sun, 03 Dec 2023 23:58:00 +0800</pubDate>
      <guid>https://blog.cklau.cc/post/edu-in-child.zh/</guid>
      <description>&lt;blockquote&gt;
&lt;p&gt;æœ‰ä¸¤ç§è¯»ä¹¦ï¼šä¸€ç§æ˜¯èŒä¸šçš„è¯»ä¹¦ï¼Œä¸€ç§æ˜¯å—œå¥½çš„è¯»ä¹¦ã€‚å¤§å¤šæ•°äººçš„é˜…è¯»ï¼Œå±äºåè€…ã€‚ &amp;ndash; é²è¿…&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å›¾ä¹¦é¦†ï¼Œä¼¼ä¹å·²ç»æˆä¸ºè‡ªä¹ å®¤ï¼Œä¸€æ‰¹äººåœ¨ä¸ºè€ƒè¯•è€Œåšç€å‡†å¤‡ï¼Œå¦ä¸€æ‰¹äººåœ¨ä¸ºè€ƒä»€ä¹ˆè¯•è€Œå‡†å¤‡ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸€æ¬¡è¸å…¥é˜…è§ˆå®¤çš„æˆ‘ï¼Œå¹¶æ²¡æœ‰ä½“éªŒåˆ°è¯»ä¹¦çš„å¿«ä¹ã€‚æ‚å¿—å’Œç”»æŠ¥æ²¡æœ‰è®©æˆ‘æèµ·å…´è¶£ï¼Œè€Œå†—é•¿çš„æ–‡å­—æ›´æ˜¯è®©ä¸€ä¸ªå¤§å­—ä¸è¯†çš„å°ç«¥æ„Ÿåˆ°å´©æºƒã€‚è€Œæ¯å‘¨ä¸€èŠ‚çš„é˜…è¯»è¯¾ä¸­çš„ä½œè€…ä¼¼ä¹æƒ³è¡¨è¾¾çš„ã€Œæ ‡å‡†ã€ç†è§£ä¼¼ä¹æ²¡æœ‰ä¸€ä¸ªè„šå¼“åœçƒçš„ã€Œæ ‡å‡†ã€åŠ¨ä½œæ¥çš„é…£ç•…æ·‹æ¼“ï¼Œå½“ç„¶ï¼Œæ›´æ¯”ä¸ä¸Šè§‚å¯Ÿæ˜¾å¾®é•œä¸‹çš„æ´‹è‘±è¡¨çš®çš„ã€Œæ ‡å‡†ã€å®éªŒæµç¨‹æ¥çš„é¡ºå…¶è‡ªç„¶ã€‚å°å°å¹´çºªçš„æˆ‘ï¼Œè¢«ç§ä¸‹äº†ä¸€é¢—è¯»ä¹¦æ˜¯ä¸ºäº†ä»€ä¹ˆçš„ç§å­ï¼Œè€Œè¿™é¢—ç§å­è¢«è€ƒè¯•ç›´æ¥ææ­»äº†ã€‚ä¼¼ä¹ï¼Œè¯»ä¹¦å°±æ˜¯å­¦ä¹ ã€‚è€Œå­¦ä¹ æ˜¯ä¸ºäº†ä»€ä¹ˆçš„ç§å­ï¼Œå´åœ¨è€ƒè¯•çš„åº‡æŠ¤ä¸‹ï¼Œæš—æš—ç”Ÿæ ¹ã€‚æ— æ‰€ç•æƒ§çš„æˆ‘ï¼Œè¶ç€è¯¾é—´çš„ååˆ†é’Ÿå¥”å‘æ“åœºï¼Œè¿½æ±‚ç€å‹å“¨è¿›å…¥ç­çº§æ—¶è€å¸ˆæ— èƒ½ç‹‚æ€’çš„çœ¼ç¥ï¼›æ‹¿èµ·å·¥å…·ç®±å°†ä½“å‹å°äºæˆ‘çš„ç”µå­è®¾å¤‡æ‹†ä¸ªç»†ç¢ï¼Œè¿½æ±‚ç€å¤åŸåä¾æ—§å¯ä»¥ä½¿ç”¨çš„æ¬£å–œï¼›ç´§ç´§çš„æ¡ç€ä¸€æ”¯åˆšåˆšå‰Šå¥½çš„é“…ç¬”æš—æš—ç”¨åŠ›çš„å°†ç¬”å°–æŠ˜æ–­ï¼Œæ¢æ¥ä¸€ä¸ªå‰Šç¬”çš„å¤©é©¬è¡Œç©ºï¼›å·å·çš„æŠ˜ä¸‹ä¸€æ ¹æ ‘æï¼Œæ„Ÿå—ç€æ£èŠ±åœ¨è€³è¾¹å¸¦æ¥çš„é£å£°å‡Œå‰ï¼Œå´åœ¨ä¸‹ä¸€åˆ»å˜æˆçˆ¶æ¯ã€Œè—¤æ¡ç„–çŒªè‚‰ã€çš„è¶æ‰‹å…µå™¨ã€‚&lt;/p&gt;
&lt;p&gt;å°å°å­©çš„æ—¥å­æ€»æ˜¯è¿‡çš„å¾ˆæ…¢ï¼Œæ…¢åˆ°ç©äº†ä¸€æ•´å¤©ä¹Ÿè¿˜èƒ½åœ¨ 2100 å‰ç¡è§‰ï¼›å°å°å­©çš„æ—¥å­æ€»æ˜¯è¿‡çš„å¾ˆå¿«ï¼Œå¿«åˆ°ç©äº†ä¸€å°ä¼šå°±åˆ°äº† 2100ã€‚&lt;/p&gt;
&lt;p&gt;å­—æ‡‚å¾—è¶Šæ¥è¶Šå¤šï¼Œæ£€è®¨ç¯‡å¹…ä¹Ÿå°±è¶Šæ¥è¶Šé•¿ã€‚è¯­æ–‡è¯¾ä¸Šå“é‰´ã€Šé¬¼å¹ç¯ã€‹è®©æˆ‘è¿æ¥äº†äººç”Ÿçš„ç¬¬ä¸€ç¯‡é•¿æ–‡çš„å†™ä½œæœºä¼šï¼šä¸€ç¯‡ 3000 å­—çš„æ£€è®¨ã€‚åä¸ºæ£€è®¨ï¼Œå®ä¸ºé©³æ–¥ï¼Œè®©è¯­æ–‡è€å¸ˆå¤§æŠµæ˜¯æ”¾å¼ƒäº†æˆ‘è¿™æ ·ä¸€ä¸ªæ— è‰¯å­¦ç”Ÿï¼Œä¹Ÿè®©æˆ‘æœ‰äº†ååœ¨å…¨ç­æœ€åä¸€æ’çš„ç»ä½³é˜…è¯»ä½ã€‚çŠ¹è®°å¾—ï¼Œå¯¹äºã€Šæ™“é£æ•£æ–‡é›†ã€‹çš„æ¨¡ä»¿æ˜¯è€å¸ˆæœ€æ¬¢å–œçš„æ–‡é£ï¼Œä½†å—æ–¹æœ”å´æ‰æ˜¯æˆ‘çš„å¯è’™ã€‚ä¹Ÿä¸çŸ¥ç°åœ¨çš„è€å¸ˆæ˜¯å¦è¿˜æœ‰è¿™ç§è‡ªä¿¡ï¼Œè®¤ä¸ºè‡ªå·±çš„æ¨èæ‰æ˜¯å­¦ç”Ÿä¹‹æ‰€éœ€ï¼Œè€Œä»¥â€œéœ²éª¨â€ä¸ºç”±æŠ¹å»äº†ä¸€ä¸ªç”·å­©å¯¹äºã€Šè›™ã€‹çš„å‘å¾€ã€‚å½“æ—¶çš„å›¾ä¹¦é¦†ï¼Œæ²¡æœ‰äº†å°äººä¹¦ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ä¸€äº›è€æ‰ç‰™ï¼Œè€Œè¿™äº›å¹¶ä¸èƒ½è®©å­¦ç”Ÿæ¯•ä¸šå’Œå‡å­¦ï¼Œä¹Ÿè‡ªç„¶ï¼Œåªæœ‰å°‘æ•°äººä¼šæ¥ç¿»åŠ¨ã€‚èŒåŠ¨çš„å¿ƒå˜å¾—æ‡µæ‡‚ï¼Œæ±‚æ˜¯çš„äººè¿˜å¾—å®å¹²ï¼Œç¡ç€çš„äººæ‰ä¼šä¸åšæ¢¦ã€‚ä¸äººä¸€èµ·é•¿å¤§çš„ï¼Œè¿˜æœ‰å¯æ€œçš„åˆ†æ•°ï¼Œå®ƒå´æ˜¯æœ‰ç€è‡ªå·±çš„æƒ³æ³•ï¼Œä¼¼ä¹ä¸å¤ªæ„¿æ„ç»™æˆ‘ä¸€ç‚¹ç‚¹é¼“åŠ±ã€‚ä¸è¿‡ï¼Œä¸€ä¸ªå¾—è¿‡ä¸”è¿‡çš„äººï¼Œå½“ç„¶æ˜¯å½“æ··åˆ™æ··ï¼Œå­¦ä¹ ä¹‹ä¸­ï¼Œä¹ŸåŒ…å«ç€è¯»ä¹¦ä¸æ˜¯ã€‚&lt;/p&gt;
&lt;p&gt;å¹´è½»äººæ¥åˆ°äº†å¤§äººåˆ›å»ºçš„ä¸–ç•Œï¼Œæ²¡æœ‰å¸¦æ¥æ”¹å˜ä¸–ç•Œçš„èƒ½åŠ›ï¼Œç¡®å®æ‹¥æœ‰è€…æ”¹å˜ä¸–ç•Œçš„æ¬²æœ›ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ä¸€ç™¾å¹´å‰ï¼Œå¹³æ¿ç”µè„‘å¤§çº¦æ˜¯åœ¨åè½¬è¯¾å ‚ä¸Šç”¨çš„ï¼Œæ‰‹æœºå¸¦åˆ°å­¦æ ¡çš„ç¡®ä¹Ÿæ˜¯è¢«æ²¡æ”¶çš„ã€‚å¾®ä¿¡è¿˜æ²¡æœ‰æ‘‡ä¸€æ‘‡å’Œçº¢åŒ…è½¬è´¦ï¼Œè€Œå¼ ä¸€é¸£è¿˜åœ¨å‘å¾®åšï¼›iPad ä¹‹äºæˆ‘ï¼Œä¸æ³¥æ²™ä¹‹äºæˆ‘å¤§æŠµæ˜¯æ— å¼‚ï¼Œçš†æ˜¯å¨±ä¹ä¹‹ç‰©ã€‚æ¯å‘¨ä»æ¡Œä¸Šæ‘¸èµ°é›¶é’±ç½é‡Œçš„ä¸¤å—é’±ï¼Œä½“éªŒå—å‘¨å’Œä¸‰è¿&amp;quot;é“è‚©æ‹…é“ä¹‰ï¼Œå¦™æ‰‹è‘—æ–‡ç« &amp;quot;&lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;ã€‚åœ¨æ¯ç‡¥çš„åˆ·é¢˜ä¸­ï¼Œç« åŒ—æµ·çš„å‰è¿› 4 å’Œç”Ÿå‘½æ„å¿—å¸¦æ¥äº†èº«å¿ƒæ„‰æ‚¦ã€‚æ›¾ç»çš„ä¸€å‘³æ‰¹åˆ¤ï¼Œä¼¼ä¹ä¹Ÿåœ¨è¿™æ—¶æ²‰å¯‚ï¼Œå€’ä¸æ˜¯è¯¾ä¸šå‹åŠ›ï¼Œè€Œæ˜¯å¯»æ‰¾åˆ°å¯èƒ½çš„ç­”æ¡ˆä¹‹å‰ä¸æ„¿å†æåŠæ‰€è°“æ‰¹è¯„ã€‚ä¸€è·¯åˆ°ç°åœ¨ï¼Œä¼¼ä¹è¿™ä¸ªç­”æ¡ˆè‹¥éšè‹¥ç°ï¼Œä½†åˆæ— è¸ªå¯å¾ªã€‚ä½†åˆå¦‚ä½•ï¼Œæˆ‘å·²åœ¨å¯»æ‰¾çš„è·¯ä¸Šæ„Ÿå—åˆ°äº†æ˜Ÿå…‰é—ªè€€ã€‚äºæ˜¯è€…ï¼Œæ‰€è°“è¯»ä¹¦ä¹‹äºäººä¼¼ä¹å¯ä»¥çœ‹æˆä¸€ç§å·¥å…·ç†æ€§ï¼Œè€Œå­¦ä¹ åˆ™ä¸ºæ‰€è°“ä»·å€¼ç†æ€§ã€‚è€Œå¥¶å¤´ä¹å¸¦æ¥çš„ï¼Œæ˜¯ä¸€ç§â€œä¸‹åŒ»æ²»å·²ç—…â€çš„æ— èƒ½ç‹‚æ€’ï¼Œçƒ­ç‚¹çš„æ¨æ³¢åŠ©æ¾œä»¥è‡³äºæ¢çš„è‡å¤´ç§åˆ©&lt;sup id=&#34;fnref:2&#34;&gt;&lt;a href=&#34;#fn:2&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;ã€‚&lt;/p&gt;
&lt;p&gt;çˆ±äººï¼Œçˆ±å…·ä½“çš„äººï¼Œçˆ±è‡ªå·±ï¼Œä¹Ÿè¦çˆ±åˆ«äºº&lt;sup id=&#34;fnref:3&#34;&gt;&lt;a href=&#34;#fn:3&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;3&lt;/a&gt;&lt;/sup&gt;ã€‚&lt;/p&gt;
&lt;p&gt;â€œå®‰è€Œä¸å¿˜æ€å±ï¼Œå­˜è€Œä¸å¿˜äº¡ï¼Œæ²»è€Œä¸å¿˜ä¹±â€ï¼Œã€Šå‘¨æ˜“ã€‹è¯´å›å­åº”å½“å¦‚æ˜¯ã€‚ã€Œå±…å®‰æ€å±ã€æ˜¯æˆ‘ä»¬å¸¸å¸¸èƒ½å¬åˆ°çš„ï¼Œä¼¼ä¹ç°å®ä¸­ä¼¼ä¹ä¸åŒæ„æˆ‘ä»¬å·²ç»æˆ‘ä»¬å·²ç»å®‰èº«è¿™ç§è¯´æ³•ï¼Œè¿™å¤§æ¦‚çš„ç¡®ä¹Ÿæ˜¯ä¸€ç§å±…å®‰æ€å±ï¼Œå»å¯»æ‰¾è¿½å¯»æ›´é«˜çš„æ”¶å…¥ã€è¿½å¯»æ›´ç¨³å®šçš„å·¥ä½œã€æ›´å¥½çš„å‘å±•ï¼Œä»¥æ¢å¾—ä¸‹ä¸€é˜¶æ®µçš„ç¼“å†²æœŸã€‚æ‰€è°“çš„ã€Œè§‰é†’ã€ï¼Œç§ä»¥ä¸ºæ˜¯å¯»æ±‚ä¸€ç§ç‰¹ç«‹ç‹¬è¡Œçš„æ„Ÿè§‰ï¼Œä½†ä¹Ÿåªæ˜¯è·Ÿä»è€…ç½¢ã€‚åœ¨è¿™é‡Œæˆ‘ä¸è®ºè¯è¿™ä¸€ç‚¹ï¼Œå› ä¸ºè¿™ä¸ªä¸è¿‡æ˜¯æˆ‘çš„æš´è®ºç½¢äº†ã€‚ä½†æ˜¯ï¼Œæ— è®ºå¦‚ä½•ï¼Œæˆ‘ä»¬ä¾æ—§ç”Ÿæ´»åœ¨æˆ–å¤§æˆ–å°çš„ç¤¾ç¾¤ä¹‹ä¸­ï¼Œåœ¨çˆ±å…·ä½“çš„è‡ªå·±æ—¶ï¼Œçˆ±ä¸€çˆ±å…·ä½“çš„åˆ«äººã€‚&lt;/p&gt;
&lt;div class=&#34;footnotes&#34; role=&#34;doc-endnotes&#34;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&#34;fn:1&#34;&gt;
&lt;p&gt;æœ¬å¥åŸæ–‡ä¸ºâ€œé“è‚©æ‹…é“ä¹‰ï¼Œè¾£æ‰‹è‘—æ–‡ç« â€ï¼Œç”±æå¤§é’Šå…ˆç”Ÿå°†ã€Œè¾£ã€æ”¹ä¸ºã€Œå¦™ã€ã€‚æœ‰äººä¼šè®¤ä¸ºï¼Œè¿™æ˜¯ä¸€ç§çš„å‚²æ…¢ä¸åè§ï¼›æˆ‘ä¸ªäººè®¤ä¸ºè¿™æ›´æ˜¯å¯¹çŸ¥è¯†åˆ†å­ã€åª’ä½“è¡Œä¸šçš„ä¸€ç§é¼“åŠ±å’ŒæœŸæœ›ã€‚&amp;#160;&lt;a href=&#34;#fnref:1&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:2&#34;&gt;
&lt;p&gt;è¿™å¥è¯ï¼Œæ–‡æ³•ä¸é€šï¼Œç‹—å±ä¸æ˜¯ï¼Œåˆ«çœ‹ã€‚&amp;#160;&lt;a href=&#34;#fnref:2&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:3&#34;&gt;
&lt;p&gt;é™€æ€å¦¥è€¶å¤«æ–¯åŸºè¯´çš„ï¼Œæˆ‘æ”¹äº†ä¸€ç‚¹ã€‚&amp;#160;&lt;a href=&#34;#fnref:3&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</description>
    </item>
    
    <item>
      <title>ğŸ“» æ”¶éŸ³æœºï¼Œä½ è¿˜èƒ½æ´»å¤šä¹…</title>
      <link>https://blog.cklau.cc/post/podcast.zh/</link>
      <pubDate>Sun, 15 Oct 2023 00:11:21 +0800</pubDate>
      <guid>https://blog.cklau.cc/post/podcast.zh/</guid>
      <description>&lt;p&gt;åˆä¸­å¼€å§‹ï¼Œå¹¿æ’­å°±ä¼´éšç€æˆ‘çš„å¾ˆå¤šä¸ªæ—¥æ—¥å¤œå¤œï¼Œè™½ç„¶å½“æ—¶çš„æˆ‘ä¸å¤ªæ‡‚ä»€ä¹ˆæ˜¯ã€Œå£®é˜³è¯ã€ã€ã€Œç”·æ€§æ°¸è¿œçš„ç—›ã€ï¼Œã€Œä¸‰ä¸ªç–—ç¨‹å°±è§æ•ˆã€ï¼Œä½†æ˜¯æˆ‘å¤§æ¦‚çŸ¥é“äº†å¹¿æ’­æ˜¯åœ¨æ²¡è½äº†ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸€æ¬¡æ¥è§¦æ— çº¿ç”µç›¸å…³çš„é€šè®¯å¤§æ¦‚æ˜¯å¯¹è®²æœºï¼Œå› ä¸ºæˆ‘çˆ¶äº²å·¥ä½œçš„åŸå› ï¼Œä»å°å°±æ¥è§¦åˆ°è®¸å¤šå¯¹è®²æœºï¼Œä»æ°‘ç”¨åˆ°ä¸“ä¸šç”¨ï¼Œä»å…¨å…¬å¼€åˆ°åŠ å¯†ä¿¡é“ã€‚æ€»æ˜¯ä¼šæœŸå¾…ç€å‡ºè¡Œï¼Œå‡ºè¡Œçš„æ—¶å€™ï¼Œäººæ‰‹ä¸€ä¸ªå¯¹è®²æœºæ˜¯å¿…ä¸å¯å°‘çš„ï¼Œå¤§æŠµæ˜¯å› ä¸ºæ–°åƒå¹´çš„ç»æµç‰¹åŒºä¾æ—§æœ‰ç€ä¸å®‰ç¨³çš„æ²»å®‰ç½¢ï¼Œè€Œå¯¹è®²æœºåˆ™æ˜¯æœ€ä¾¿å®œçš„â€œè¿œâ€è·ç¦»å³æ—¶é€šä¿¡çš„å·¥å…·äº†ã€‚è¿˜è®°å¾—åˆ°åŒ—äº¬å¤©å®‰é—¨çœ‹å‡å›½æ——çš„é€”ä¸­ï¼Œå¯¹è®²æœºçš„æœç´¢åŠŸèƒ½å¸¦æˆ‘å¬åˆ°äº†äº¬åŸäº¤è­¦é—´çš„å¯¹è¯ï¼›ä¹Ÿè®°å¾—åœ¨å¹¿æ·±é«˜é€Ÿä¸Šå¡è½¦å’ŒåŒè¡Œçš„å¦ä¸€å°è½¦çš„å°ä¼™ä¼´ç”¨å¯¹è®²æœºçš„ã€Œæµè¡Œæ­Œä¸²çƒ§ã€ï¼›è¿™å¤§æ¦‚å°±æ— çº¿ç”µæ³¢å¸¦ç»™å¹´å¹¼çš„æˆ‘ä¸€äº›ä¹è¶£å§ï¼›&lt;/p&gt;
&lt;p&gt;åˆä¸­ï¼Œæ¯å¤©ä¸Šå­¦ä¹‹å‰å¿…åšçš„ä¸€ä»¶äº‹ï¼Œå°±æ˜¯æ‘¸èµ°çˆ¶æ¯æ·˜æ±°çš„ä¸€å°è¯ºåŸºäºšï¼Œä¸ºçš„å°±æ˜¯åœ¨ä¸‹è¯¾çš„æ—¶å€™å¯ä»¥æ¥ä¸Šä¸€ç›˜ç²¾å½©åˆºæ¿€çš„è´ªåƒè›‡å’Œä¸Šè¯¾æ—¶å¯ä»¥å·å¬æ”¶éŸ³æœºä¸ºä¹ã€‚é£æ‰¬ 971 çš„ã€ŠéŸ³ä¹ç¾é…’æ±‡ã€‹å¤§æ¦‚å°±æ˜¯æ¯å¤©æœ€æœŸå¾…çš„ä¸€æ¡£èŠ‚ç›®ï¼Œä¸çŸ¥é“æ€çš„ï¼Œä¸€ä¸ªé’æ˜¥æœŸç”·å­©ï¼Œç«Ÿç„¶å¯¹ä¸€æ¡£èŠè‘¡è„é…’çš„èŠ‚ç›®å¦‚æ­¤ä¹‹ä¸Šç˜¾ï¼Œä¹Ÿå› ä¸ºè¿™æ¡£èŠ‚ç›®è®©æˆ‘çŸ¥é“äº†åŸæ¥è‘¡è„é…’ä¸åªæœ‰æ³•å›½çš„æ³¢å°”å¤šå’Œå‹ƒè‰®ç¬¬è€Œã€Œæ–°ä¸–ç•Œäº§åœ°ã€çš„é…’ä¹Ÿæœ‰ç€è‡ªå·±ç‹¬æœ‰çš„é£å‘³ï¼Œè‘¡è„ä¹Ÿä¸ä»…æ˜¯ã€Œæœ‰ç±½å’Œæ— ç±½ã€ï¼Œèµ¤éœç ã€éœå¤šä¸½ã€ä½³ç¾ï¼Œè¿™äº›è‘¡è„ä¹Ÿä¼šæœ‰è¿™ä¸åŒçš„é£å‘³ã€‚è¿™å¯èƒ½å°±æ˜¯é•¿å¤§çš„æˆ‘æ€»çˆ±ä¹°ä¸Šä¸€ç“¶å¨å£«å¿Œå´åªç”¨æ¥åšèœçš„åŸå› ï¼›è€Œå¹´å¹¼çš„æˆ‘ï¼Œæ¯å¤©å¬ç€å¤§äººä»¬çš„è¨€è¯­ï¼Œçœ‹ç€é¾™åº”å°ã€ä½™ç§‹é›¨ã€å¼ æ™“é£ç­‰çš„æˆ–æ•£æ–‡æˆ–éšç¬”ï¼Œè€Œçƒ¦æ¼ç€ä»Šå¤©çš„ä½œæ–‡åº”è¯¥æ€ä¹ˆå†™ï¼Œä¸ºã€Œèµ‹æ–°è¯å¼ºè¯´æ„ã€çš„ç—›è‹¦ï¼Œåœ¨æ•²ä¸‹è¿™æ®µå­—çš„æˆ‘çœ‹æ¥ï¼Œæ˜¯ååˆ†çš„è´´åˆ‡çš„ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ååˆ†çš„å¹¸è¿ï¼Œå³ä½¿æ˜¯åˆä¸­éšæ„è€Œå®‰çš„å­¦ä¹ çŠ¶æ€ï¼Œä¹Ÿè®©æˆ‘æ··ä¸Šäº†ä¸€ä¸ªè¿‡å¾—å»çš„é«˜ä¸­ã€‚é«˜ä¸­çš„æˆ‘ï¼Œåœ¨è¯­æ–‡è€å¸ˆçš„â€œæ€‚æ¿â€ä¸‹ï¼Œå¼€å§‹äº†å¯¹æ­¦ä¾ å°è¯´çš„ç–¯ç‹‚è¿½æ±‚ï¼Œä»é‡‘åº¸å…¨é›†åˆ°å¤é¾™ï¼Œå†å›åˆ°æ¢ç¾½ç”Ÿï¼Œæ­¦ä¾ å°è¯´ä¹‹äºç”·ç”Ÿå°±åƒåŒ–å¦†ä¹‹äºå¥³ç”Ÿï¼Œä¼¼ä¹æ˜¯ä¸€ç§åˆ°äº†å¹´çºªå°±ä¸€å®šä¼šåšçš„äº‹&lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;ã€‚ä½å®¿åœ¨æ ¡çš„æˆ‘ï¼Œæ¯å¤©æœ€å¼€å¿ƒçš„é™¤äº†ã€Œé€ƒè¯¾æ‰“çƒã€ã€ã€Œåœ¨è¯¾å ‚ä¸Šç©æ‰‹æœºã€çœ‹å°è¯´ã€èŠå¤©ã€å°±æ˜¯æ¯å¤©æ™šè‡ªä¹ æ—¶å€™å¸¦ä¸Šè€³æœºï¼Œå°†æ‰‹æœºè°ƒåˆ° FM107.1ï¼ˆä¸­å¤®å›½é™…å¹¿æ’­ç”µå° - ç¯çƒèµ„è®¯å¹¿æ’­ï¼‰ï¼Œå¬ ã€Šæ–°é—»ç›˜ç‚¹ã€‹å’Œã€Šå¤§è¯ä½“å›ã€‹ï¼›ä»¥åŠåˆ°äº†æ·±å¤œä»¥åçš„æ­¦ä¾ è®²å¤ï¼ˆä¸æ˜¯ FM107.1ï¼‰ï¼›å´ä¹Ÿä¸çŸ¥é“åœ¨ä»€ä¹ˆæ—¶å€™å¼€å§‹ï¼Œä¸ä»…æ»¡è¶³äºå®æ—¶å¹¿æ’­ï¼Œæˆ‘å¼€å§‹è¿·ä¸Šäº†å¬æ’­å®¢ï¼Œå¯èƒ½å’Œå¾ˆå¤šäººä¸€æ ·ï¼Œæˆ‘çš„æ’­å®¢æ”¶å¬ç”Ÿæ¶¯å§‹äºã€Šç³–è’œå¹¿æ’­ã€‹ï¼Œä½†æˆ‘å‡ ä¹æ²¡æœ‰å¬è¿‡éŸ³ä¹ç±»ã€ç”µå½±ç±»èŠ‚ç›®ï¼Œè€Œæ˜¯å§‹äºã€Šç³–è’œå¥³å­è„±å£ç§€ã€‹å’Œã€Šç‹è¯´ç‹æœ‰ç†ã€‹ï¼Œå¤§æ¦‚æ˜¯ç›´æ¥äº†å½“çš„ä¹å­æ‰èƒ½ç»™è‹¦äºåšé¢˜çš„æˆ‘å¸¦æ¥ä¹å­ç½¢ã€‚&lt;/p&gt;
&lt;p&gt;å®é™…ä¸Šï¼Œä¸‹ç¬”ä¹‹å‰ï¼Œæˆ‘åªæ˜¯æ‰“ç®—å†™ä¸€ä¸‹æ¨èçš„æ’­å®¢ï¼Œæ¯”å¦‚ã€Šå‘å‘å¤§ç‹å›½ã€‹ã€ã€Šå†…æ ¸ææ…Œã€‹ã€ã€Šå­—å¼¹å­—ç•…ã€‹ã€ã€Šåº·å¸ˆå‚…å’Œæœ‹å‹ä»¬ã€‹ã€ã€Šæ«è¨€æ«è¯­ã€‹ã€ã€Šç§‘ç ”è¿™ç§ç”Ÿæ´»æ–¹å¼ã€‹ç­‰ç­‰&lt;sup id=&#34;fnref:2&#34;&gt;&lt;a href=&#34;#fn:2&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;ï¼Œè€Œæˆ‘æœ¬äººä¹Ÿæ›¾ç»ä»¥ä¸ºè‡ªå·±èƒ½æˆä¸ºä¸€ä¸ªç”µå°ä¸»æŒäººï¼Œå’Œç†Ÿäººå¯ä»¥ç•…æ‰€æ¬²è¨€ã€è¯´çš„å¤´å¤´æ˜¯é“çš„æˆ‘ï¼Œå´æ— æ³•é¢å¯¹éº¦å…‹é£å¼€å£ï¼ŒåŸºäºè¿™ä¸ªç°è±¡ï¼Œæœ¬äººè‰è‰çš„æ–­äº†è‡ªå·±å¹´å¹¼çš„æ¢¦æƒ³ã€‚æ‰€ä»¥ï¼Œæ’­å®¢æ˜¯ç”µå°åœ¨ IP ä¸Šçš„å¦ä¸€ç§å­˜æ´»æ–¹å¼å—ï¼ŸæŠ‘æˆ–æ˜¯ï¼Œä»–ä»¬ä»æ¥éƒ½æ˜¯è·¯äººï¼Œä»…ä»…æ˜¯èµ°çš„éƒ½æ˜¯äººè¡Œé“ã€‚é‚£å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼Œäººè¡Œé“ä¸ç®¡ä½ æ˜¯è°éƒ½èƒ½èµ°ï¼Œè€Œç”µå°å¤§æŠµæ˜¯éœ€è¦é—¨æ§›çš„ï¼›æ’­å®¢è¦çš„å¯èƒ½åªæ˜¯å…´è¶£ä¸ä¸€ç‚¹ç‚¹é¼“åŠ±ä¸æ”¯æŒã€‚&lt;/p&gt;
&lt;p&gt;å¯èƒ½ä¼šæœ‰é‚£ä¹ˆä¸€å¤©ï¼Œæˆ‘ä¹Ÿä¼šå¼€è‡ªå·±çš„æ’­å®¢èŠ‚ç›®ï¼Œè™½ç„¶å†…å®¹ã€æ ‡é¢˜ä»¥åŠæœªæ¥éƒ½æ²¡æœ‰æƒ³å¥½ï¼Œã€Œèƒ½æ´»å¤šä¹…ã€è¿™ä¸ªé—®é¢˜ï¼Œæœ¬èº«ä¸åº”è¯¥åœ¨å¼€å§‹å‰å»æ€è€ƒï¼›è¿™ä¸ªé—®é¢˜ï¼Œåªæœ‰åœ¨å¤ç›˜æ—¶æ‰ä¼šæ˜¾å¾—å°¤ä¸ºé‡è¦ã€‚è‡³äºè·¯åœ¨å“ªï¼Œèµ°ä¸€èµ°ï¼Œæ€»æ˜¯èƒ½è¸©åˆ°çš„ã€‚&lt;/p&gt;
&lt;p&gt;å†™äºä¸€ä¸ª 2 æ‘„æ°åº¦çš„æ™šä¸Šï¼Œéƒ½æŸæ—çš„é£å¾ˆå¤§ï¼Œæš–æ°”æ˜¯çœŸçš„æš–ï¼Œåªæ˜¯è¿™æ¹¿åº¦ä¸æ˜¯ä¸€ä¸ªäºŒåå¤šå¹´é•¿æœŸæ´»åœ¨å¹¿ä¸œçš„äººèƒ½æ¥å—çš„å§ã€‚&lt;/p&gt;
&lt;div class=&#34;footnotes&#34; role=&#34;doc-endnotes&#34;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&#34;fn:1&#34;&gt;
&lt;p&gt;æˆ‘å†™ä¸‹è¿™å¥è¯çš„æ—¶å€™ï¼Œå¹¶æ²¡æœ‰è§‰å¾—æœ‰ä»€ä¹ˆä¸å¦¥ï¼›ä½†å›å¤´å†è¯»çš„æ—¶å€™ï¼Œæˆ‘çŸ¥é“ä¸€å®šä¼šå¼•èµ·æŸäº›ç¾¤ä½“çš„ä¸æ»¡ã€‚&amp;#160;&lt;a href=&#34;#fnref:1&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:2&#34;&gt;
&lt;p&gt;æ’åä¸åˆ†å…ˆåï¼Œä¸”æœ‰äº›é¢‘é“å·²ç»å¾ˆä¹…æ²¡æœ‰æ›´æ–°äº†ã€‚&amp;#160;&lt;a href=&#34;#fnref:2&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</description>
    </item>
    
    <item>
      <title>ğŸ¤” A General Introduction of ML/DL Project Management and Knowledge Management - Project Management</title>
      <link>https://blog.cklau.cc/post/specification/</link>
      <pubDate>Fri, 28 Jul 2023 00:15:00 +0800</pubDate>
      <guid>https://blog.cklau.cc/post/specification/</guid>
      <description>&lt;p&gt;There are multiple articles have illustruated that the project(code) management is important:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://neptune.ai/blog/how-to-organize-deep-learning-projects-best-practices&#34;&gt;neptune.ai - how to organize deep learning projects&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.zhihu.com/question/269707221/answer/350542551&#34;&gt;æ·±åº¦å­¦ä¹ ç§‘ç ”ï¼Œå¦‚ä½•é«˜æ•ˆè¿›è¡Œä»£ç å’Œå®éªŒç®¡ç†ï¼Ÿ&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;In this guideline, I would mainly shows you how I manage my project&amp;rsquo;s code and link the new knowledge to the knowledge base.&lt;/p&gt;
&lt;h2 id=&#34;in-general&#34;&gt;In General&lt;/h2&gt;
&lt;p&gt;A lifecyle of a project may includes this five points&lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Planning and project setup
&lt;ul&gt;
&lt;li&gt;Define the task and scope out requirements&lt;/li&gt;
&lt;li&gt;Determine project feasibility&lt;/li&gt;
&lt;li&gt;Discuss general model tradeoffs (accuracy vs speed)&lt;/li&gt;
&lt;li&gt;Set up project codebase&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Data collection and labelling
&lt;ul&gt;
&lt;li&gt;Define ground truth (create labeling documentation)&lt;/li&gt;
&lt;li&gt;Build data ingestion pipeline&lt;/li&gt;
&lt;li&gt;Validate quality of data&lt;/li&gt;
&lt;li&gt;Label data and ensure ground truth is well-definend&lt;/li&gt;
&lt;li&gt;Revisit Step 1 and ensure data is sufficient for the task&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Model exploration
&lt;ul&gt;
&lt;li&gt;Establish baselines for model performance&lt;/li&gt;
&lt;li&gt;Start with a simple model using initial data pipeline&lt;/li&gt;
&lt;li&gt;Overfit simple model to training data&lt;/li&gt;
&lt;li&gt;Stay nimble and try many parallel (isolated) ideas during early stages&lt;/li&gt;
&lt;li&gt;Find SoTA model for your problem domain (if available) and reproduce results, then apply to your dataset as a second baseline&lt;/li&gt;
&lt;li&gt;Revisit Step 1 and ensure feasibility&lt;/li&gt;
&lt;li&gt;Revisit Step 2 and ensure data quality is sufficient&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Model refinement
&lt;ul&gt;
&lt;li&gt;Perform model-specific optimizations (ie. hyperparameter tuning)&lt;/li&gt;
&lt;li&gt;Iteratively debug model as complexity is added&lt;/li&gt;
&lt;li&gt;Perform error analysis to uncover common failure modes&lt;/li&gt;
&lt;li&gt;Revisit Step 2 for targeted data collection and labeling of observed failure modes&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Testing and evaluation
&lt;ul&gt;
&lt;li&gt;Evaluate model on test distribution; understand differences between train and test set distributions (how is â€œdata in the wildâ€ different than what you trained on)&lt;/li&gt;
&lt;li&gt;Revisit model evaluation metric; ensure that this metric drives desirable downstream user behavior&lt;/li&gt;
&lt;li&gt;Write tests for:
&lt;ul&gt;
&lt;li&gt;Input data pipeline&lt;/li&gt;
&lt;li&gt;Model inference functionality&lt;/li&gt;
&lt;li&gt;Model inference performance on validation data&lt;/li&gt;
&lt;li&gt;Explicit scenarios expected in production (model is evaluated on a curated set of observations)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;For each part of the project, there are multiple different tools we may use:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Planning and project step, in specific, it could be treated as the project tracking, thus, all the tracking tools can be used in the step, e.g., Confluence, YouTrack, Jira, Trello, etc..&lt;/li&gt;
&lt;li&gt;Data collection and labelling: If we are using the public dataset, we may ignore the labelling problem; however, if we are collecting and labelling our own dataset, we may consider these &lt;a href=&#34;https://github.com/HumanSignal/awesome-data-labeling&#34;&gt;awesome-labelling-tools&lt;/a&gt;; the next question for the data storage and collection is the versioning problem, we may consider these tools:
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://neptune.ai/&#34;&gt;Neptune&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://wandb.ai/&#34;&gt;WandB&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://dvc.org/&#34;&gt;DVC&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://lakefs.io/&#34;&gt;LakeFS&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://git-lfs.com/&#34;&gt;Git LFS&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;Log tracing
&lt;ol&gt;
&lt;li&gt;We can use &lt;code&gt;loggings&lt;/code&gt; or &lt;code&gt;tensorboard&lt;/code&gt; to store the log to the local directory&lt;/li&gt;
&lt;li&gt;We can also use &lt;code&gt;wandb&lt;/code&gt;, &lt;code&gt;neptune&lt;/code&gt; and other tools to store the log to both the local directory or the cloud&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;project-specification&#34;&gt;Project Specification&lt;/h2&gt;
&lt;p&gt;The project specification includes two aspects:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;project files specification&lt;/li&gt;
&lt;li&gt;git branche specification&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;project-files-specification&#34;&gt;Project files Specification&lt;/h3&gt;
&lt;p&gt;Here is the architecuture of a project&lt;sup id=&#34;fnref:2&#34;&gt;&lt;a href=&#34;#fn:2&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Files/Catalogue&lt;/th&gt;
&lt;th&gt;Detail&lt;/th&gt;
&lt;th&gt;Required&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;README.md&lt;/td&gt;
&lt;td&gt;Instruction of the project and the folder architecture&lt;/td&gt;
&lt;td&gt;YES&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;train.py&lt;/td&gt;
&lt;td&gt;Model Traning and Validation&lt;/td&gt;
&lt;td&gt;YES&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;test.py&lt;/td&gt;
&lt;td&gt;Model Testing&lt;/td&gt;
&lt;td&gt;YES&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;src/{model-name}.py&lt;/td&gt;
&lt;td&gt;Statement and Source code of the Model (For single model)&lt;/td&gt;
&lt;td&gt;YES&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;src/{model-name}.py&lt;/td&gt;
&lt;td&gt;Statement and Source code of the Model (For multiple models)&lt;/td&gt;
&lt;td&gt;YES&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;src/{modules-name}/{model-name}}.py&lt;/td&gt;
&lt;td&gt;Statement and Source code of the Model (For multiple submodules &amp;amp; single model)&lt;/td&gt;
&lt;td&gt;YES&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;src/{modules-name}/{model-name}.py&lt;/td&gt;
&lt;td&gt;Statement and Source code of the Model (For multiple submodules &amp;amp; multiple models)&lt;/td&gt;
&lt;td&gt;YES&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;utils/loss.py&lt;/td&gt;
&lt;td&gt;Implementation of loss function&lt;/td&gt;
&lt;td&gt;NO&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;utils/base.py&lt;/td&gt;
&lt;td&gt;utilities file&lt;/td&gt;
&lt;td&gt;NO&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;data/data.py&lt;/td&gt;
&lt;td&gt;Dataset and DataLoader Implemenetation&lt;/td&gt;
&lt;td&gt;NO&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;data/train.txt&lt;/td&gt;
&lt;td&gt;manifest file of training set&lt;/td&gt;
&lt;td&gt;NO&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;data/validate.txt&lt;/td&gt;
&lt;td&gt;manifest of validation set&lt;/td&gt;
&lt;td&gt;NO&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;data/test.txt&lt;/td&gt;
&lt;td&gt;manifest of testing set&lt;/td&gt;
&lt;td&gt;NO&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;experiment/{exp-name}/params.yaml&lt;/td&gt;
&lt;td&gt;configuration of the experiment&lt;/td&gt;
&lt;td&gt;YES&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;experiment/{exp-name}/log/&lt;/td&gt;
&lt;td&gt;folder to store the log file produced by the experiment&lt;/td&gt;
&lt;td&gt;YES&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;experiment/{exp-name}/model/&lt;/td&gt;
&lt;td&gt;folder to store the binary file of the trained models&lt;/td&gt;
&lt;td&gt;YES&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;experiment/{exp-name}/result/&lt;/td&gt;
&lt;td&gt;folder to store the model output (images, csv, etc.)&lt;/td&gt;
&lt;td&gt;YES&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;git-branch-specification&#34;&gt;Git Branch Specification&lt;/h3&gt;
&lt;p&gt;Every projects may face a problem: how to perform multiple experiments in parallel? We adopt the solution of git branch:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Each experiment has a corresponding git branch&lt;/li&gt;
&lt;li&gt;Three kinds of branches:
&lt;ol&gt;
&lt;li&gt;Temporary branches: start with &lt;code&gt;TEMP_&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Long-term branches: start with &lt;code&gt;MAIN_&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Project Introduction/Demo branch: &lt;code&gt;main&lt;/code&gt;: include the basic information of the project in the branch&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;The branches&amp;rsquo; name should includes:
&lt;ol&gt;
&lt;li&gt;Main purpose of the branch, i.e. model&amp;rsquo;s name&lt;/li&gt;
&lt;li&gt;Dataset it use: i.e., dataset&amp;rsquo;s name&lt;/li&gt;
&lt;li&gt;Others: whether the experiment include augmentation or other configuration&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Here are two examples:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;TEMP_PIX2PIX_DRIVE_NOAUG&lt;/code&gt; represents a temporary branch with &lt;code&gt;pix2pix&lt;/code&gt; model using &lt;code&gt;DRIVE&lt;/code&gt; dataset with no augmentation in data preprocessing&lt;/li&gt;
&lt;li&gt;&lt;code&gt;MAIN_PIX2PIX_MESSIDOR_AUG&lt;/code&gt; represents a long-term branch with &lt;code&gt;pix2pix&lt;/code&gt; model using &lt;code&gt;MESSIDOR&lt;/code&gt; dataset with augmentation in  data proprocessing&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;footnotes&#34; role=&#34;doc-endnotes&#34;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&#34;fn:1&#34;&gt;
&lt;p&gt;There are some extra steps, you may check them in &lt;a href=&#34;https://www.jeremyjordan.me/ml-projects-guide/&#34;&gt;Jeremey Jordan&amp;rsquo;s Blog&lt;/a&gt;&amp;#160;&lt;a href=&#34;#fnref:1&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:2&#34;&gt;
&lt;p&gt;For more detail, please check &lt;a href=&#34;https://git.cklau.cc/terenceliu/specification/&#34;&gt;CKLAU&amp;rsquo;s GitLab - Specification&lt;/a&gt;&amp;#160;&lt;a href=&#34;#fnref:2&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</description>
    </item>
    
    <item>
      <title>ğŸ‘¨â€ğŸ’» Style Transfer and Synthesis (1/3): Style Transfer in Image Synthesis</title>
      <link>https://blog.cklau.cc/post/scientia/dl-gan-1/</link>
      <pubDate>Sat, 17 Jun 2023 00:13:00 +0800</pubDate>
      <guid>https://blog.cklau.cc/post/scientia/dl-gan-1/</guid>
      <description>&lt;p&gt;There are multiple papers in the area of style transfer and image inversion or reconstruction. Here are some papers I read and would like to share with you:&lt;/p&gt;
&lt;h3 id=&#34;progressive-gan&#34;&gt;Progressive GAN&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Paper URL: &lt;a href=&#34;https://arxiv.org/abs/1710.10196&#34;&gt;ICLR 2018 - PROGRESSIVE GROWING OF GANS FOR IMPROVED QUALITY, STABILITY, AND VARIATION&lt;/a&gt; |&lt;/li&gt;
&lt;li&gt;Code URL: &lt;a href=&#34;https://git.cklau.cc/terenceliu/gans-models/-/tree/main/PGGAN&#34;&gt;https://git.cklau.cc/terenceliu/gans-models/-/tree/main/PGGAN&lt;/a&gt; |&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Key point&lt;/strong&gt;: They propose a novel training process of GAN model: progressive training, i.e. from small model to big model/from low resolution to high resolution&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&#34;some-hightlights&#34;&gt;Some Hightlights&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;The training (see Figure A) is from left to right,
&lt;ol&gt;
&lt;li&gt;start from  feature map, the model produce a (3x4x4) output from the generator $G_1$ and as the input of the discriminator $D_1$&lt;/li&gt;
&lt;li&gt;the second process is to upsample the feature map from $4 \times 4$ to $8 \times 8$ and produce a ($3 \times 8 \times 8$) output from the generator $G_2$ and as the input of the discriminator $D_2$&lt;/li&gt;
&lt;li&gt;continue with the process, for the last part of the progression, the model output the $1024 \times 1024$ image from the generator and as the input of the discriminator $D_m$&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;To avoid the influence/damage of the transition from low resolution to high resolution, they fade in the new layer smoothly (see Figure B):
&lt;ol&gt;
&lt;li&gt;they treat the layers that operate on the higher resolution like a residual block, whose weight $\alpha$ increases linearly from $0$ to $1$.&lt;/li&gt;
&lt;li&gt;By adjusting the weight of convolution-based output and upsampling-based output to control the final output: $(\alpha \cdot O_{\text{convolution layer}} + (1 - \alpha) \cdot O_{\text{upsample layer}})$&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;Minibatch Standard Deviation&lt;/li&gt;
&lt;li&gt;Equalize the Learning Rate&lt;/li&gt;
&lt;li&gt;Pixelwised Noramlization&lt;/li&gt;
&lt;/ol&gt;</description>
    </item>
    
    <item>
      <title>ğŸ§‘ğŸ¿â€ğŸ’» Homelab: A self-hosted GitHub Accelerator</title>
      <link>https://blog.cklau.cc/post/my-homelab-extra-1/</link>
      <pubDate>Sat, 17 Jun 2023 00:11:21 +0800</pubDate>
      <guid>https://blog.cklau.cc/post/my-homelab-extra-1/</guid>
      <description>&lt;p&gt;In general, there are multiple ways for you to accelerate the &lt;code&gt;git pull / git push&lt;/code&gt; or download the release/source code from &lt;a href=&#34;https://github.com&#34;&gt;GitHub&lt;/a&gt;:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;You may directly use a HTTP/HTTPS/SOCK5 proxy in your terminal &lt;code&gt;export https_proxy=https://[ip]:[port] http_proxy=http://[ip]:[port]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;You may use a public &lt;code&gt;github-proxy&lt;/code&gt;, e.g. &lt;a href=&#34;https://ghproxy.com&#34;&gt;ghproxy.com&lt;/a&gt; or &lt;a href=&#34;https://gh-proxy.com&#34;&gt;gh-proxy.com&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;You can also build a self-hosted &lt;code&gt;ghproxy&lt;/code&gt;-liked web service to avoid data leakage (if there is). With docker, you can set up the service in one or two minutes:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;version&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;3&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;services&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;gh-proxy&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;image&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;stilleshan/gh-proxy&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;container_name&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;gh-proxy&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;ports&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;12345&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;80&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;restart&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;always&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;With &lt;code&gt;nginx&lt;/code&gt; you can proxy the service to a sub-domain:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;# Upstream where your authentik server is hosted.
upstream ghproxy {
    server 127.0.0.1:12345;
    # Improve performance by keeping some connections alive.
    keepalive 10;
}

# Upgrade WebSocket if requested, otherwise use keepalive
map $http_upgrade $connection_upgrade_keepalive {
    default upgrade;
    &amp;#39;&amp;#39;      &amp;#39;&amp;#39;;
}

server {
    # HTTP server config
    listen 80;
    server_name ghproxy.example.com;

    # 301 redirect to HTTPS
    location / {
            return 301 https://$host$request_uri;
    }
}

server {
    # HTTPS server config
    listen 443 ssl http2;
    server_name ghproxy.example.com;

    # TLS certificates
    ssl_certificate /var/www/ssl/example.com.crt;
    ssl_certificate_key /var/www/ssl/example.com.key;

    # Proxy site
    location / {
        proxy_pass http://ghproxy;
        proxy_http_version 1.1;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host $host;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection $connection_upgrade_keepalive;
    }
}
&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
    
    <item>
      <title>ğŸ“˜ ä»ç†ç§‘åˆ°æ–‡ç§‘ - 2023 Fall å°è®°</title>
      <link>https://blog.cklau.cc/post/phd-application.zh/</link>
      <pubDate>Sat, 03 Jun 2023 00:11:21 +0800</pubDate>
      <guid>https://blog.cklau.cc/post/phd-application.zh/</guid>
      <description>&lt;p&gt;2023 Fall ç”³è¯·ç®—æ˜¯è½ä¸‹å¸·å¹•ï¼Œä»ä¸€å¼€å§‹æ‰“ç®—ç•™åœ¨ UIC/HKBU ç»§ç»­åš Medical Image å’Œ Mathematical Modelling åˆ°ç°åœ¨å‡†å¤‡å‰å¾€ Trinity College Dublin åš Political Scienceï¼Œä¹Ÿåœ¨æ­¤æ€»ç»“ä¸€ä¸‹è¿™ä¸€å¹´çš„æµç¨‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¥—ç£å’Œé‚®ä»¶&#34;&gt;å¥—ç£å’Œé‚®ä»¶&lt;/h2&gt;
&lt;p&gt;å…¶å®ç¬”è€…åœ¨ä¸€å¼€å§‹è¯» MPhil çš„æ—¶å€™ï¼Œå°±æœ‰åœ¨çœ‹ä¸€äº›å¯èƒ½çš„ PhD æœºä¼šï¼Œåœ¨ä¸€æ¬¡å¶ç„¶çš„æœºä¼šçœ‹åˆ°äº† CMU Heinz College çš„ä¸€ä¸ª joint PhD programmme, çªç„¶ç›´æ¥æ¿€å‘äº†æˆ‘çš„æ–‡ç§‘å¿ƒï¼ŒåŒæ—¶æ„Ÿå—åˆ°äº†ç¾å›½æ–‡ç§‘çš„ã€Œç§‘å­¦ä¸»ä¹‰ã€ç››è¡Œï¼Œå›½å†…æˆ–è€…æ¬§æ´²æ˜¯å¦ä¹Ÿä¼šé€šè¿‡é‡åŒ–æ–¹æ³•å¯¹ç¤¾ä¼šå­¦/æ”¿æ²»å­¦è¿›è¡Œç ”ç©¶å‘¢ã€‚æˆ‘è®¤ä¸ºæ›´å¤§çš„æ€è€ƒæ¥è¯´ï¼Œä¸è®ºæ˜¯æ–‡ç§‘è¿˜æ˜¯ç†ç§‘éƒ½ä¸€å®šéœ€è¦æ•°å­¦æ–¹æ³•ï¼Œç†ç§‘æ¯‹åº¸ç½®ç–‘ï¼Œæ•°å­¦ååˆ†çš„é‡è¦ï¼›å¯¹äºæ–‡ç§‘ç‰¹åˆ«æ˜¯ç¤¾ä¼šç§‘å­¦æ¥è¯´ï¼Œæœ€ç›´æ¥çš„ä¸€ä¸ªä¾‹å­æ¥è¯´ï¼Œç¤¾äº¤ç½‘ç»œå’Œå¤æ‚ç½‘ç»œç†è®ºå°±å·²ç»â€œæ··ä¸ºä¸€è°ˆâ€äº†ï¼›é‚£æ¯”å¦‚æ”¿æ²»ç›¸å…³çš„ä¸€äº›é¢˜ç›®ï¼šæ¯”è¾ƒæ”¿æ²»å­¦ä¸­çš„å˜é‡é€‰æ‹©ã€ä¸åŒæ”¿æ²»ä½“ç³»çš„æ²»ç†å¯¹æ¯”ç­‰ç­‰æˆ‘è®¤ä¸ºéƒ½å¯ä»¥é€šè¿‡ä¸€äº›é‡åŒ–çš„æ–¹å¼è¿›è¡Œç ”ç©¶ã€‚æ‰€ä»¥ä¹Ÿå¼€å§‹å…³æ³¨äº†è¿™ç§ interdisciplinary ç›¸å…³çš„ topicã€‚æ‰€ä»¥ï¼Œåœ¨äº†è§£åˆ°ç›¸å…³çš„ä¸€äº›è€å¸ˆä¹Ÿåœ¨åšè¿™äº›è¯¾é¢˜çš„æ—¶å€™ï¼Œå°±æ¯«ä¸çŠ¹è±«çš„å»å¥—ç£äº†ï¼Œå¤§æ¦‚å¥—ç£äº†å¤§æ¦‚ 10 ä¸ªè€å¸ˆå·¦å³ï¼Œä¸»è¦å›´ç»•ç€ Social Science å’Œ Information Science è¿™ä¸¤ä¸ªä¸“ä¸šï¼ŒåŒ…æ‹¬äº†å¦‚ä¸‹çš„å‡ ä¸ªå¤§å­¦ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Cornell University - å…³æ³¨åˆ°åº·å¥ˆå°”çš„ä¸€ä¸ªåŸå› æ˜¯åº·å¥ˆå°”çš„ TAM å’Œæœ€è¿‘ä¸€ä¸ªä»è¥¿åŒ—å¤§å­¦è¿‡å»çš„æ–°è€å¸ˆã€‚å½“ç„¶ï¼Œæˆ‘å¹¶æ²¡æœ‰è§‰å¾—å®ƒä»¬ä¼šè¦æˆ‘ï¼Œä¸è¿‡ä¹ŸæŠ±ç€è¯•ä¸€è¯•çš„å¿ƒæ€ï¼ˆè¯´ä¸å®šå‘¢&lt;/li&gt;
&lt;li&gt;Carnegie Mellon University - Heinz College çš„ joint PhD program ç¡®å®å¾ˆå¸å¼•æˆ‘ï¼Œå¯¹äº¤å‰æ„Ÿå…´è¶£çš„æœ‹å‹ä¹Ÿå¯ä»¥å»çœ‹çœ‹ï¼šEconomics + Public Policy/Machine Learning + Public Policy/Statsitics + Public Policy/Strategy, Entrepreneurship, and Technological Change&lt;/li&gt;
&lt;li&gt;MIT Statstics + Data Science Center - MIT ä¹Ÿæœ‰ä¸€ä¸ªå­¦ç§‘äº¤å‰é¡¹ç›®ï¼Œå…¶ä¸­ä¹ŸåŒ…æ‹¬äº† STAT + Political Science çš„é€‰æ‹©ã€‚ä¸ç”¨å¤šè¯´ï¼ŒæŠ•è¿™ä¸ªå°±æ˜¯ä¸ºäº†ç¢°å£&lt;/li&gt;
&lt;li&gt;University of Michigan - æ®æˆ‘æ‰€çŸ¥ï¼ŒUoM çš„å¤æ‚ç³»ç»Ÿç ”ç©¶ä¸­å¿ƒ CSCS ä¹Ÿæ˜¯å…¨çƒé¡¶å°–çš„å¤æ‚ç³»ç»Ÿç ”ç©¶æœºæ„ï¼Œä¸è¿‡ä»–ä»¬ä¼¼ä¹æ›´åé‡äºç»Ÿè®¡/ç‰©ç†/æ•°å­¦ç­‰ä¼ ç»Ÿæ¨¡å‹å»åšå¤æ‚ç³»ç»Ÿï¼Œæ²¡æœ‰ç‰¹åˆ«ä¸€ä¸ªè€å¸ˆä¼š cross social science.&lt;/li&gt;
&lt;li&gt;Chinese University of Hong Kong - CUHK çš„ç¤¾ä¼šç§‘å­¦åœ¨è®¡ç®—æ–¹é¢ç®—æ˜¯èµ°çš„æ¯”è¾ƒé å‰ï¼Œæ¯”å¦‚ä»–ä»¬æœ‰æˆç«‹ CSS Lab&lt;/li&gt;
&lt;li&gt;Hong Kong University of Science and Technology - HKUST çš„è®¡ç®—æœºåœ¨é¦™æ¸¯æˆ–è€…è¯´æ•´ä¸ªå¤§ä¸­ååœ°åŒºå®åŠ›åº”è¯¥æ¯‹åº¸ç½®ç–‘äº†ï¼ŒåŒæ—¶ä»–çš„ Soc Sci ä¹Ÿä¸å¼±&lt;/li&gt;
&lt;li&gt;Trinity College Dublin - ä¸€æ‰€ååˆ†ä¼ ç»Ÿçš„å¼ºæ–‡ç§‘çš„å­¦æ ¡ï¼ˆå¯èƒ½æ˜¯ä¸ªäººåè§ï¼Œè§‰å¾—å†å²é•¿çš„å­¦æ ¡æ–‡ç§‘éƒ½å¾ˆå¼ºï¼‰&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ–‡ç§‘ç›¸å…³çš„ç”³è¯·é€šå¸¸æ¥è¯´éƒ½æ˜¯å¼º committee çš„ï¼Œå› ä¸ºä¸æ­¢ä¸€ä¸ªè€å¸ˆè·Ÿæˆ‘è¡¨è¾¾äº†ï¼šã€Œè™½ç„¶æˆ‘æœ‰åé¢ï¼Œä½†æ˜¯éœ€è¦ committee åŒæ„æ‰èƒ½è¦ä½ ã€ã€‚å½“ç„¶ï¼Œè¿™ä¹Ÿå¯èƒ½åªæ˜¯ä¸€ç§è¯´è¾ç½¢ã€‚ç¬”è€…ååˆ†ä¸å–œæ¬¢å¼º committee çš„æ–¹å¼ï¼Œå¯èƒ½æ˜¯å› ä¸ºç¬”è€…çš„ GPA æˆç»©ååˆ†ä¸å¥½çœ‹ï¼Œæ‰€ä»¥å¹¶ä¸è§‰å¾—è‡ªå·±å¯¹èƒ½é€šè¿‡ committee çš„è€ƒæ ¸ã€‚ä½†æ˜¯è¿™å°±æ˜¯ä¸€ä¸ªæ‚–è®ºï¼Œæ–‡ç§‘çš„è€å¸ˆä¸€èˆ¬æ¥è¯´æ²¡æœ‰å¤ªå¤šçš„ funding å»ç‹¬ç«‹æ”¯æ’‘ä¸€ä¸ª PhD student å®Œæˆå‡ å¹´çš„å­¦ä¸šï¼Œæ‰€ä»¥è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæ–‡ç§‘åŸºæœ¬ä¸Šéƒ½æ˜¯å¼º committee çš„åŸå› ï¼Œä¸è¿‡æ€»å½’æ˜¯è¦è¯•ä¸€è¯•çš„ã€‚&lt;/p&gt;
&lt;p&gt;å…³äºå¦‚ä½•å†™å¥—ç£é‚®ä»¶ç¬”è€…æ˜¯æ²¡æœ‰å¤ªå¤šçš„ç»éªŒå’Œç»å†ï¼Œæˆ‘ä¸»è¦å°±æ˜¯å°†è‡ªå·±çš„ä¸€äº›ç»å†è¿›è¡Œäº†ä¸€äº›ç¼–æ’ï¼Œå…¶ä¸­åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸€æ®µï¼šæˆ‘æ¥ä¿¡çš„ç›®çš„æ˜¯ä»€ä¹ˆï¼ˆæˆ‘æ˜¯è°ï¼Œæˆ‘æ¥è‡ªå“ªé‡Œï¼Œæˆ‘çš„ç›®çš„æ˜¯ä»€ä¹ˆï¼‰
ç¬¬äºŒæ®µï¼šä¸ºä»€ä¹ˆæˆ‘è§‰å¾—æˆ‘åˆé€‚è¿™ä¸ª programme ï¼ˆæˆ‘åšè¿‡ä»€ä¹ˆï¼Œæˆ‘æ‹¥æœ‰å“ªäº›èƒ½åŠ›ï¼Œæˆ‘ä»Šåæ‰“ç®—åšä»€ä¹ˆï¼‰
ç¬¬ä¸‰æ®µï¼šå¹å˜˜ä¸€ä¸‹è‡ªå·±å’Œè€å¸ˆçš„åŒ¹é…åº¦ï¼ˆæˆ‘å¯¹ä½ æœ‰ä»€ä¹ˆäº†è§£ï¼Œå¯ä»¥é€šè¿‡è€å¸ˆçš„ paper è¿›è¡Œå…¥æ‰‹ï¼Œä¹Ÿå¯ä»¥é€‚å½“çš„æè®®ä¸¤ä¸ªé—®é¢˜ï¼‰
ç»“å°¾ï¼šlooking forward to your reply
åŒæ—¶ï¼Œä¹Ÿå¯ä»¥é™„ä¸Šè‡ªå·±çš„ä¸ªäººç½‘ç«™å’Œ GitHub é“¾æ¥ç­‰ï¼ŒæŠŠä¸€äº›ä½ ä¸æƒ³åœ¨è¿™æåˆ°çš„è¯/æˆæœæ”¾åˆ°ä¸ªäººç½‘ç«™é‡Œå°±å¥½ã€‚å½“ç„¶ï¼Œä¸Šè¿°ä»…ä¸ºæˆ‘è‡ªå·±çš„å¥—ç£ä¿¡çš„æ ·å¼ï¼Œç•¥å¾®ç¹å¤ä¸”å†—é•¿ï¼Œç»è¿‡è¿™æ®µæ—¶é—´çš„æ€è€ƒï¼Œç¬”è€…è§‰å¾—åº”è¯¥å°†ç¬¬äºŒæ®µå’Œç¬¬ä¸‰æ®µè¿›è¡Œç²¾ç®€å’Œæç‚¼ï¼Œèåˆæˆä¸€æ®µè¯å³å¯ï¼ˆä¸è¿‡ï¼Œæš‚æ—¶åº”è¯¥ä¸éœ€è¦å†å¥—ç£äº†ï¼Œå°±å†è¯´å§ï¼‰&lt;/p&gt;
&lt;h2 id=&#34;ç­‰å¾…å’Œæ”¶ä¿¡&#34;&gt;ç­‰å¾…å’Œæ”¶ä¿¡&lt;/h2&gt;
&lt;p&gt;ç­‰å¾…æ˜¯ä¸€ä¸ªæ¼«é•¿çš„è¿‡ç¨‹ï¼Œæˆ‘èµ·æ­¥æ¯”è¾ƒæ™šï¼Œå¤§æ¦‚æ˜¯äºŒé›¶äºŒäºŒåä¸€æœˆå¼€å§‹å»è”ç³»è€å¸ˆï¼Œå…¶å®è¿™ä¸ªæ—¶å€™å¾ˆå¤šè€å¸ˆéƒ½å·²ç»æœ‰æ„å‘å­¦ç”Ÿäº†ï¼Œæ‰€ä»¥æˆ‘ä¹Ÿæ”¶åˆ°äº†å¾ˆå¤š &amp;ldquo;ä½ å¯ä»¥ç”³è¯·ï¼Œä½†å¾—å­¦æ ¡/å­¦é™¢å®¡æ‰¹&amp;rdquo; è¿™ç§æˆ‘è®¤ä¸ºæ˜¯å§”å©‰çš„æ‹’ç»ã€‚ä½†ä¹Ÿæœ‰ä¸€äº›è€å¸ˆååˆ†æ„¿æ„ç»§ç»­äº¤æµï¼šçº¦ zoom è¿›è¡Œè¿›ä¸€æ­¥çš„æ²Ÿé€šç­‰ã€‚åœ¨èŠäº†å‡ æ¬¡ä¹‹åï¼ŒTCD çš„è€å¸ˆè¡¨ç¤ºå…¶å®æœ‰æ— ä¸€ç§å¯èƒ½å¯ä»¥å°†æˆ‘æŒ‚åœ¨è®¡ç®—æœºç³»æˆ–è€…ç»Ÿè®¡ç³»ï¼ˆå®é™…ä¸Šï¼ŒTCD åªå­˜åœ¨è®¡ç®—æœºä¸ç»Ÿè®¡ç³»è¿™ä¸€ä¸ªç³»ï¼‰ä¸‹é¢ç„¶ååšä»–çš„é¡¹ç›®ï¼Œåœ¨ä»–çœ‹æ¥ã€Œæ”¿æ²»ç§‘å­¦ã€çš„è¿™ä¸ªå¤´è¡”å¯èƒ½ä¼šå¯¼è‡´æˆ‘æ‰¾ä¸åˆ°å·¥ä½œï¼ˆä¸è®ºæ˜¯åœ¨å­¦æœ¯ç•Œè¿˜æ˜¯ä¸šç•Œï¼‰ï¼Œä¸è¿‡ä»–ä¹Ÿè¦å»æ‰¾ hcï¼Œè®©æˆ‘ç­‰ä»–ä¸€æ®µæ—¶é—´ã€‚è¿™æ—¶æ˜¯äºŒé›¶äºŒäºŒåäºŒæœˆ.&lt;/p&gt;
&lt;p&gt;åœ¨ç­‰äº†ä¸¤ä¸‰ä¸ªæœˆä»¥åï¼Œä¹Ÿå°±æ˜¯è¿‡å®Œå¹´ä»¥åï¼Œä¾æ—§æ²¡æœ‰ç‰¹åˆ«å¥½çš„æ¶ˆæ¯ï¼Œæ­¤æ—¶çš„æˆ‘è¿˜æ˜¯æ¯”è¾ƒå¹³é™ï¼Œå¦‚æœæ²¡æœ‰åˆ«çš„é€‰æ‹©çš„è¯æˆ‘ä¹Ÿå¯ä»¥ç•™ä¸‹å»åš Medical Image å§ï¼Œæ¯•ç«Ÿæ˜¯ä¸€ä¸ªå›½è‡ªç„¶ï¼ŒåŒæ—¶ CV + Medical ç¡®å®ä¹Ÿæ˜¯è¿‘æœŸçš„ä¸€ä¸ªçƒ­ç‚¹ä¹‹ä¸€ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ä¿æŒä½æˆ‘çš„ç»Ÿè®¡å­¦çš„â€œå­¦ä½ä¸€è‡´æ€§â€ã€‚æ­£å½“æˆ‘å‡†å¤‡æäº¤ PhD ç”³è¯·çš„æ—¶å€™ï¼Œä¸Šæ–‡æåˆ°çš„æƒ³å¸®æˆ‘æ‰¾ä¸€ä½ç»Ÿè®¡ç³»çš„ co-supervisor çš„è€å¸ˆè”ç³»äº†æˆ‘é—®æˆ‘æ˜¯å¦è¿˜å¯¹ä»–çš„é¡¹ç›®æ„Ÿå…´è¶£çš„æ—¶å€™ï¼Œçªç„¶æœ‰é‡ç‡ƒäº†æˆ‘å‡ºå»çš„å¸Œæœ›ã€‚é‚£è‡ªç„¶æ˜¯èµ¶ç´§ç­”åº”å’Œèµ¶å¿«è”ç³» zoom ä¸€ä¸‹ï¼Œé—®é—®æˆ‘éœ€è¦å‡†å¤‡äº›ä»€ä¹ˆï¼›å¤§æ¦‚å†…å®¹å°±æ˜¯æˆ‘è¦å‡†å¤‡ä¸€ä¸ªæŠ¥å‘Šï¼Œä¸»é¢˜çš„è¯æ˜¯å…³äºå¦‚ä½•å°†ä¸¤ä¸ªè€å¸ˆçš„ç ”ç©¶æ–¹å‘ä¸²è”åˆ°ä¸€èµ·ï¼ˆå¬èµ·æ¥ä¹Ÿååˆ†ä¹‹åˆç†ï¼‰ã€‚ä½†æœ‰è¶£çš„äº‹ï¼Œç»Ÿè®¡çš„è€å¸ˆæ˜¯åš Functional Data Analysis å’Œ Shape Analysis çš„ï¼Œè¿™ä¸¤ä¸ªé¢˜ç›®åœ¨æˆ‘çœ‹æ¥å®é™…ä¸Šå’Œæ”¿æ²»ç§‘å­¦çš„è€å¸ˆçš„é¢˜ç›®ä¸å¤ªç›¸å…³ï¼ŒFDA ä¼¼ä¹è¿˜å¥½ä¸€äº›ï¼Œæ¯•ç«Ÿæ˜¯å¯ä»¥åœ¨åšæ—¶é—´åºåˆ—ç›¸å…³çš„é—®é¢˜ï¼Œä½†æ˜¯ Shape Analysis æ˜¯åœ¨åšå½¢æ€å­¦ç›¸å…³çš„ç ”ç©¶ï¼Œè¿™ä¸¤ä¸ªé¢˜ç›®é¦–å…ˆéœ€è¦æ¯”è¾ƒå¼ºçš„æ•°å­¦åŠŸåº•ï¼ˆä¸ªäººè§‰å¾—ä¸€èˆ¬çš„ç»Ÿè®¡ç³»å‡ºèº«çš„å­¦ç”Ÿæ¯”è¾ƒéš¾å¯ä»¥ç›´æ¥ä¸Šæ‰‹ï¼ŒåŠ ä¹‹æˆ‘çš„çº¸é¢æˆç»©å¹¶ä¸å¥½çœ‹ï¼Œæ‰€ä»¥æ²¡æœ‰æŠ±ä»€ä¹ˆå¸Œæœ›ï¼‰ï¼ŒåŒæ—¶è¿™ä¸¤ä¸ªè€å¸ˆçš„ä¸¤ä¸ªé¡¹ç›®åšäº¤å‰åœ¨æˆ‘çœ‹æ¥ä¸ç®—å¾—ä¸Šååˆ†åˆé€‚ã€‚è‡ªç„¶ï¼Œæˆ‘ä¹Ÿæ²¡æœ‰è¢«ç»Ÿè®¡ç³»çš„è€å¸ˆçœ‹ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;åœ¨é¢è¯•å®Œçš„ä¸€å‘¨å·¦å³ï¼Œè€å¸ˆä¹Ÿå’Œæˆ‘çš„æ¨èäººè¿›è¡Œäº†ç”µè¯/è§†é¢‘æ²Ÿé€šï¼Œä¸¤ä½æ¨èäººä¹Ÿéƒ½ä»ä¸åŒçš„è§’åº¦ç»™ä»–æ¨é”€æˆ‘ï¼Œè¿™é‡Œä¹Ÿè¦ååˆ†æ„Ÿè°¢ä¸¤ä½ã€‚æœ€ç»ˆå†³å®š offer ç»™æˆ‘ä¸€ä¸ª PhD position in Political Science ï¼Œä½†å› ä¸ºæˆ‘çš„çº¸é¢æˆç»©ä¸å¥½ï¼Œæ‰€ä»¥éœ€è¦è·Ÿç³»é‡Œå§”å‘˜ä¼šå»äº‰å–ä¸€ä¸ª special caseã€‚çœ‹åˆ°è¿™å°é‚®ä»¶ï¼Œæˆ‘ç®—æ˜¯æ¯”è¾ƒå®‰å¿ƒäº†ï¼Œå› ä¸º special case è¿™ä¸ªå¦‚æœè€å¸ˆæ„¿æ„å¸®ä½  argue ä¸€èˆ¬ committee/graduate school é‚£è¾¹éƒ½ä¸ä¼šæœ‰å¤ªå¤§çš„é˜»æ‹¦ï¼ˆå› ä¸ºæˆ‘ç”³è¯· Mphil çš„æ—¶å€™å®é™…ä¸Šå°±å·²ç»éœ€è¦é€šè¿‡èµ° special case äº†ï¼Œæ‰€ä»¥æˆ‘æ¯”è¾ƒäº†è§£è¿™ä¸€éƒ¨åˆ†ï¼‰ã€‚é‚£å‰©ä¸‹çš„å°±æ˜¯èµ°æµç¨‹äº†ï¼Œåœ¨å­¦æ ¡ç”³è¯·ç³»ç»Ÿçš„å‰ä¸€å¤©ï¼Œæˆ‘å®Œæˆäº†æ‰€ä»¥èµ„æ–™çš„æŠ•é€’ï¼›ä¸€å‘¨åï¼Œæˆ‘çš„æ¨èäººä¹ŸæŠŠæ¨èä¿¡æäº¤ï¼›åœ¨æ¨èä¿¡æäº¤çš„å½“å¤©ï¼ŒåŒ—äº¬æ—¶é—´ 2230 å·¦å³ï¼Œæ”¶åˆ°äº†ç³»é‡Œçš„ informal offerï¼›å››å¤©åï¼ˆåŒ…å«ä¸€ä¸ªå‘¨æœ«ï¼‰ï¼Œæ”¶åˆ° firm letterã€‚&lt;/p&gt;
&lt;p&gt;å®Œå…¨çœ‹ä¸‹æ¥ï¼Œè¿™ä¸ªç”³è¯·å­£èµ°çš„ååˆ†çš„å¹¸è¿ï¼Œå…¶å®å¯ä»¥è¯´æ˜¯ã€Œååˆ†çš„ç¦»è°±ã€ï¼šæ€»ä½“çœ‹ä¸‹æ¥ï¼Œæˆ‘å¹¶æ²¡æœ‰å……è¶³çš„å‡†å¤‡ã€æ²¡æœ‰åè¶³çš„æŠŠæ¡ã€æ²¡æœ‰ä¸€ä¸ªå¾ˆå¥½çš„ä¿åº•å­¦æ ¡&lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;ï¼Œç”šè‡³æ²¡æœ‰å»è€ƒä¸€ä¸ªæ ‡åŒ–è€ƒè¯•ã€‚ä¹Ÿå°±è¿‡æ¥äº†ã€‚æœ¬æ¥ä»¥ä¸ºè½¬æ–‡è‡³å°‘éœ€è¦æˆ‘é›…æ€è€ƒåˆ° 7 ä»¥ä¸Šï¼Œæˆ‘ä¼°è®¡æ˜¯å› ä¸ºä¹‹å‰çš„å‡ æ¬¡ zoom ä¹Ÿç»™è€å¸ˆç•™ä¸‹äº†ã€Œè‹±è¯­å¯ä»¥æ­£å¸¸äº¤æµã€çš„æ„Ÿè§‰ï¼ŒåŠ ä¸Šæäº¤äº†ä¸€ä»½ã€Œå…¨è‹±æ•™å­¦è¯æ˜ã€çš„ç¼˜æ•…ç½¢ã€‚ä½œä¸ºä¸€ä¸ªçº¯çº¯çš„æ··å­ï¼Œæˆ‘æ„Ÿåˆ°ååˆ†çš„å¹¸è¿ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å…³äºä¸“ä¸š&#34;&gt;å…³äºä¸“ä¸š&lt;/h2&gt;
&lt;p&gt;æˆ‘ç°åœ¨ç”³è¯·åˆ°çš„æ˜¯ Trinity College Dublin çš„ PhD position in Political Scienceã€‚ä¸ºä»€ä¹ˆä¼šç”³è¯·è¿™ä¸ªä¸“ä¸šå…¶å®ä¹Ÿæ˜¯æœºç¼˜å·§åˆï¼Œé™¤äº†ä¸€å¼€å§‹è¯´çš„çœ‹åˆ°æœ‰è¿™æ · intradisciplinary çš„é¡¹ç›®ä»¥å¤–ï¼Œä¸ªäººå…¶å®ä¸€ç›´æƒ³åšä¸€ä¸ªå…³äºç¤¾äº¤ç½‘ç»œçš„é¢˜ç›®ï¼Œä½†æ˜¯å› ä¸ºæŸäº›åŸå› ï¼Œä¸€ç›´æ²¡æœ‰å¼€é¢˜ã€‚ä½†æ˜¯ï¼Œå‡†å¤‡å·¥ä½œå€’æ˜¯åšäº†ä¸å°‘ï¼Œæ¯”å¦‚çœ‹çœ‹ä»¥åèƒ½æ‰¾åˆ°ä»€ä¹ˆ positionï¼ˆå…¸å‹çœ¼é«˜æ‰‹ä½ï¼‰ï¼Œå°±åœ¨ç½‘ä¸Šå†²æµªçš„æ—¶å€™çœ‹åˆ°äº†ä¸€äº›å…³äºè®¡ç®—ç¤¾ä¼šå­¦/æ”¿æ²»å­¦çš„è€å¸ˆçš„èµ„æ–™ï¼Œå‘ç°å…¶å®åœ¨è¿™äº›äººæ–‡ç¤¾ç§‘çš„ä¸“ä¸šï¼ŒSTAT å’Œ Mathematical Modelling å·²ç»æˆä¸ºäº†å®ƒä»¬ä¸å¯æˆ–ç¼ºçš„ä¸€éƒ¨åˆ†äº†ï¼Œä¸ä»…ä»…æ˜¯å·¥å…·ï¼Œç”šè‡³å¯ä»¥è¯´æ˜¯èå…¥åˆ°äº†ä»–ä»¬çš„ç ”ç©¶èŒƒå¼ã€‚å®šé‡ç ”ç©¶ï¼ˆquantitative researchï¼‰å·²ç»ä»å°ä¼—æ¨å‘äº†ç¤¾ä¼šå­¦/æ”¿æ²»å­¦çš„å¤§éƒ¨åˆ†ç ”ç©¶é¢†åŸŸã€‚åŒæ—¶ï¼Œåœ¨è¿™ä¸ª AI å’Œ DL å‘å±•çš„è¿…é€Ÿçš„æ—¶é—´ï¼Œå…¶å®æœ‰å¾ˆå¤šå¯ç”¨çš„æŠ€æœ¯æ˜¯å¯ä»¥ç§»æ¤åˆ°æ–‡ç§‘èº«ä¸Šçš„ï¼Œæœ€ç®€å•çš„ä¾‹å­å°±æ˜¯ NLPï¼Œé€šè¿‡æœºå™¨å»å¯¹è¯­æ–™çš„åˆ†æï¼Œä»è€Œå¾—åˆ°ä¸€äº›æˆ‘ä»¬æƒ³è¦çš„ç»“æœï¼ŒåŒ…æ‹¬ä½†ä¸é™äº translation/summarization/generationï¼ŒåŒæ—¶ï¼Œæ¨¡å‹æ˜¯å¦å…¬å¹³/æ— å/å°Šé‡äº‹å®è¿™äº›é—®é¢˜ä¹Ÿæ˜¯ ethic of AI éœ€è¦å»å®šä¹‰çš„ï¼›åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿåè¿‡æ¥å¯¹è¿™äº›æŠ€æœ¯è¿›è¡Œæ”¹è¿›å’Œ â€œfinetuneâ€ã€‚æ¯”å¦‚ï¼Œæˆ‘å³å°†è¦å¼€å§‹åšçš„ Conflict Prediction å®é™…ä¸Šåœ¨ Political Science é‡Œä¹Ÿç®—æ˜¯ä¸€ä¸ªååˆ†å°ä¼—çš„æ–¹å‘ï¼Œä¸è¿‡æ—¢ç„¶æ¶‰åŠåˆ°äº† Prediction é‚£ä¹ˆè‡ªç„¶è€Œç„¶çš„é‡åŒ–/æœºå™¨å­¦ä¹ çš„æ–¹æ³•ä¹Ÿåº”è¯¥æ˜¯å¯ä»¥å¹¿æ³›çš„åº”ç”¨åœ¨è¿™ä¸Šé¢ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç»Ÿè®¡/æœºå™¨å­¦ä¹ ä¸Šå¤§é‡çš„ spatio-temporal model éƒ½å¯ä»¥ç”¨åœ¨è¿™ä¸Šé¢&lt;/li&gt;
&lt;li&gt;æ–‡æœ¬/éŸ³è§†é¢‘/å›¾åƒåˆ†æï¼ŒåŒ…æ‹¬ç‰¹å¾å¯¹é½ä¸å¤šæ¨¡æ€ç‰¹å¾èåˆ&lt;/li&gt;
&lt;li&gt;å› æœæ•ˆåº”&lt;/li&gt;
&lt;li&gt;æ¨¡å‹çš„ unbiasedness/faithfulness ç ”ç©¶&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;åœ¨æˆ‘çœ‹æ¥ï¼Œè¿™ä¸ªå°±æ˜¯ä¸€ä¸ªååˆ†è´´è¿‘ XAI(explanable AI) å’Œ AGI(Artificial general intelligence) çš„æ–¹å‘ï¼Œä¾‹å¦‚ï¼Œç¤¾ä¼šç§‘å­¦ä¸­ä¹Ÿåœ¨å¼€å§‹å¹¿æ³›ä½¿ç”¨é¢„æµ‹æ¨¡å‹ï¼Œé‚£è¿™äº›é¢„æµ‹æ¨¡å‹åº”è¯¥å¦‚ä½•å¸®åŠ©å†³ç­–æˆ–è€…è¯´æ¨¡å‹åœ¨åšå†³ç­–çš„æ—¶å€™æ˜¯å¦æœ‰ decision biasï¼Œå¦‚ä½•é€è¿‡ XAI å»è¿›è¡Œå˜é‡è§£é‡Šç­‰ï¼Œè¿™äº›éƒ½æ˜¯æˆ‘ä»¬éœ€è¦ç ”ç©¶çš„ã€‚è€Œ AGI æœºå¯ä»¥ä½œä¸ºæˆ‘ä»¬çš„ç ”ç©¶å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºæˆ‘ä»¬çš„ç ”ç©¶ç›®æ ‡ï¼šä½œä¸ºç ”ç©¶å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥å°† AGI æˆ–è€…è¿‘ä¼¼ AGI èµ‹äºˆä¸€å®šçš„äººæ ¼/ç‰¹å¾ï¼Œè®©å…¶æ¨¡æ‹ŸæŸä¸€ç±»çš„äº‹ç‰©ä»è€Œè¾¾åˆ°ä¸€ä¸ª simulation çš„æ•ˆæœï¼›ä½œä¸ºç ”ç©¶ç›®æ ‡ï¼Œåœ¨ç¬”è€…çš„å®šä¹‰ä¸­ AGI é™¤äº†é€šç”¨æ€§ä»¥å¤–ï¼Œå®ƒè¿˜éœ€è¦ä¸€äº›äººç±»æ²¡æœ‰çš„æŠ€èƒ½ï¼Œä¾‹å¦‚æ¶ˆé™¤ bias å’Œå°Šé‡äº‹å®ï¼Œé‚£ä¹ˆè¿™ä¸ªå°±ç±»ä¼¼äºåç¦»ä¿®æ­£ï¼Œå¦‚ä½•æ‰èƒ½è®©ä»–åœ¨æ¥å—å¤§é‡ biased çš„æ•°æ®è®­ç»ƒçš„åŒæ—¶ debias å‘¢&lt;sup id=&#34;fnref:2&#34;&gt;&lt;a href=&#34;#fn:2&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ï¼Œç¬”è€…è®¤ä¸ºè¿™ç§äº¤å‰å­¦ç§‘å…¶å®ä¹Ÿæ˜¯ä¸€ä¸ªä¸é”™çš„é“è·¯é€‰æ‹©ï¼Œä¸¤è¾¹å¯ä»¥äº’ç›¸è¡¥è¶³ä¸€äº›æ¬ ç¼ºçš„çŸ¥è¯†ã€è¿›è¡Œä¸€äº›ä¸åŒå­¦ç§‘ç›´æ¥çš„äº¤æµå’Œæ€ç»´ç¢°æ’ã€‚å¸Œæœ›ï¼Œåé¢è¿™å››å¹´é‡Œï¼Œå¯ä»¥è®©æˆ‘æ„Ÿå—åˆ°è‡ªç„¶ç§‘å­¦å’Œç¤¾ä¼šç§‘å­¦çš„äº¤æ±‡ä¹‹ç¾ï¼Œä¹Ÿå¸Œæœ›è‡ªå·±å¯ä»¥åšå‡ºæ¥ä¸€äº›çœ‹èµ·æ¥ä¸å¤ªå·®çš„ç ”ç©¶å§ã€‚&lt;/p&gt;
&lt;h2 id=&#34;åè®°&#34;&gt;åè®°&lt;/h2&gt;
&lt;h3 id=&#34;å…³äºç­¾è¯&#34;&gt;å…³äºç­¾è¯&lt;/h3&gt;
&lt;p&gt;çˆ±å°”å…°ç­¾è¯ä¹Ÿæ˜¯ç”± VFS ä¸€æ‰‹åŒ…åŠçš„ï¼Œåªè¦å‡†å¤‡å¥½èµ„æ–™ç„¶åå»é€’äº¤èµ„æ–™å°±å¥½äº†ã€‚éœ€è¦å‡†å¤‡çš„èµ„æ–™å¯ä»¥åœ¨çˆ±å°”å…°å¤§ä½¿é¦†æ‰¾åˆ° &lt;a href=&#34;https://www.dfa.ie/media/missions/china/visas/English-version-Study-visa-checklist-March-2023.pdf&#34;&gt;Documentation&lt;/a&gt;/&lt;a href=&#34;https://www.dfa.ie/media/missions/china/visas/Study.pdf&#34;&gt;å­¦ä¹ ç­¾è¯æ–‡ä»¶æ¸…å•&lt;/a&gt;ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œéœ€è¦å¦‚ä¸‹èµ„æ–™ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç”³è¯·æ‘˜è¦ (from &lt;a href=&#34;https://www.visas.inis.gov.ie/AVATS/OnlineHome.aspx&#34;&gt;AVATS&lt;/a&gt;) + ï¼ˆé¢„çº¦ç¡®è®¤ + ç¼´è´¹å•ï¼‰ï¼Œ åä¸¤ä¸ªæ˜¯åœ¨ VFS å®Œæˆä¸é¢„çº¦å VFS å‘åˆ°é‚®ä»¶çš„ä¸¤ä¸ª PDF&lt;/li&gt;
&lt;li&gt;ç­¾è¯ç”³è¯·ä¿¡ï¼Œæ˜¯ä¸€å°ç»™ç­¾è¯å®˜è¯´æ˜å¦‚ä¸‹å‡ ç‚¹çš„ä¿¡ï¼š
&lt;ol&gt;
&lt;li&gt;ä½ æ˜¯è°ï¼Œä½ ä½åœ¨å“ªï¼Œæ€ä¹ˆèƒ½è”ç³»ä¸Šä½ ï¼ˆé‚®ç®± + ç”µè¯ï¼‰&lt;/li&gt;
&lt;li&gt;å»çˆ±å°”å…°çš„ç›®çš„ï¼Œæ‰“ç®—ä»€ä¹ˆæ—¶å€™å»+ä»€ä¹ˆæ—¶å€™å›ï¼Œé€—ç•™æœŸé—´ä½åœ¨å“ª&lt;/li&gt;
&lt;li&gt;å£°æ˜è‡ªå·±æœ‰æ— äº²æœ‹å¥½å‹åœ¨çˆ±å°”å…°/æ¬§ç›Ÿï¼ŒåŒæ—¶å£°æ˜è‡ªå·±æœ‰æ—  XXX çš„å€¾å‘&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;ï¼ˆæ‰€æœ‰ï¼‰æŠ¤ç…§ + å‡ºå…¥å¢ƒè®°å½•&lt;/li&gt;
&lt;li&gt;ç…§ç‰‡ ($35\text{mm} \times 45 \text{mm}$) $\times 2$&lt;/li&gt;
&lt;li&gt;å­¦ä½è¯ã€æ¯•ä¸šè¯ã€æˆç»©å•ï¼›å­¦ä¿¡ç½‘çš„å­¦å†è®¤è¯/å­¦ç±è®¤è¯/å­¦ä½è®¤è¯(éå¿…éœ€)&lt;/li&gt;
&lt;li&gt;æˆ·å£æœ¬å…¨æœ¬å¤å°ä»¶ + è‹±æ–‡ç¿»è¯‘ä»¶ï¼ˆå¯ä»¥è‡ªè¡Œç¿»è¯‘ï¼‰&lt;/li&gt;
&lt;li&gt;çˆ±å°”å…°é«˜æ ¡çš„ Offer + å¥–å­¦é‡‘ä¿¡ ï¼ˆä¸€èˆ¬å¯ä»¥è®©å­¦é™¢ç§˜ä¹¦å¸®å¿™å†™ä¸€å°ä¿¡ï¼Œè¯æ˜ä½ æ˜¯ Fully Funded + æ¯å‘¨å·¥ä½œæ—¶é•¿ + â€œå¦‚æœ‰ç–‘é—®å¯ä»¥è”ç³»å­¦æ ¡â€ï¼Œ ç±»ä¼¼äºä»‹ç»ä¿¡ï¼›åŒæ—¶å¦‚æœä¿¡ä¸­æåˆ°ç¬¦åˆå…¥æ ¡æ¡ä»¶ï¼Œé‚£ä¸‹é¢çš„è¯­è¨€æˆç»©åº”è¯¥å¯ä»¥çœå»ï¼‰&lt;/li&gt;
&lt;li&gt;ä¿é™©ä¿å•&lt;/li&gt;
&lt;li&gt;è¯­è¨€æˆç»©å•ï¼ˆå¦‚åœ¨ä¸­å¤–åˆåŠé«˜æ ¡å°±è¯»ï¼Œå¯ä»¥ç”¨â€œå…¨è‹±æ•™å­¦è¯æ˜â€ï¼Œæˆ–è€…æœ¬èº«åœ¨è®¤å¯çš„æµ·å¤–é«˜æ ¡å°±è¯»åº”è¯¥ä¸éœ€è¦æä¾›é¢å¤–è¯­è¨€æˆç»©ï¼‰&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä»¥ä¸Šæåˆ°çš„æ‰€æœ‰ææ–™ï¼Œå¦‚æœåŸä»¶æ˜¯ä¸­æ–‡ï¼Œåˆ™éœ€è¦æä¾›è‹±æ–‡ç¿»è¯‘ä»¶ï¼Œæ¯”å¦‚å­¦ä¿¡ç½‘çš„è®¤è¯å°±æä¾›ç¿»è¯‘æœåŠ¡ï¼›æˆ·å£æœ¬ã€æˆç»©å•è¿™ç§å°±å¯ä»¥è‡ªè¡Œç¿»è¯‘ã€‚ æ³¨æ˜ï¼š&lt;em&gt;æœ¬äººäº 2023 å¹´ 7 æœˆ 17 æ—¥åœ¨å¹¿å· VFS é€’äº¤ç­¾è¯ä¿¡æ¯ï¼Œç­¾è¯äº 2023 å¹´ 8 æœˆ 8 æ—¥ä»åŒ—äº¬å‡ºå‘ï¼Œ 2023 å¹´ 8 æœˆ 10 å·åˆ°æ‰‹ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;h3 id=&#34;å…³äºæœºç¥¨&#34;&gt;å…³äºæœºç¥¨&lt;/h3&gt;
&lt;p&gt;å› ä¸ºä¸ªäººçš„æé™æ“ä½œï¼Œå¯¼è‡´æˆ‘çš„ç¡•å£«ç­”è¾©æ˜¯åœ¨ 8 æœˆ 29 å·å®Œæˆçš„ï¼Œåœ¨æ­¤ä¹‹å‰æˆ‘é¢„è®¢äº† 8 æœˆ 30 å·çš„ã€Œå¹¿å· - ä¼Šæ–¯å¦å¸ƒå°” - éƒ½æŸæ—ã€çš„åœŸèˆªè”ç¨‹ï¼ˆä¹Ÿå°±å¯¼è‡´äº†æˆ‘çš„ç­”è¾©åªèƒ½åœ¨ 29 å·å®Œæˆï¼‰ï¼Œç›´æ¥å¯¼è‡´äº†æˆ‘æ²¡æœ‰å¤ªå¤šæ—¶é—´æ”¶æ‹¾è¡Œæã€‚è™½ç„¶ä½†æ˜¯ï¼Œæˆ‘ä¾æ—§æ˜¯é¡ºåˆ©ç­”è¾©å®Œæˆèµ¶ä¸Šäº†é£æœºï¼Œåªä¸è¿‡å¤§å®¶ä¸è¦å­¦æˆ‘æè¿™ç§ ã€Œeverything under controlã€çš„æé™æ“ä½œ ğŸ«¡&lt;/p&gt;
&lt;h3 id=&#34;å…³äºå…¥å­¦å’Œå±…ä½&#34;&gt;å…³äºå…¥å­¦å’Œå±…ä½&lt;/h3&gt;
&lt;p&gt;å…¶å®æœ¬äººä¾æ—§è’™åœ¨é¼“é‡Œï¼Œå¾ˆå¤šå­¦æ ¡é‡Œçš„äº‹æƒ…è¿˜æ²¡ææ¸…æ¥šï¼Œä½†æ˜¯æˆ‘ç›¸ä¿¡ ğŸ‡®ğŸ‡ª æœ¬åœ°çš„ä¸€äº›ä¸»è¦äº‹é¡¹å°±åŒ…æ‹¬å¦‚ä¸‹å‡ ç‚¹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å„ç§å¡ç‰‡(è¿™äº›å¡ç‰‡å¾ˆå¤§ç¨‹åº¦éœ€è¦ä½ å…ˆæ‹¥æœ‰ä¸€å¼ å­¦ç”Ÿå¡ï¼Œæ‰€ä»¥å°½å¿«æ³¨å†Œå¹¶åœ¨ &lt;a href=&#34;tcard.tcd.ie&#34;&gt;tcard&lt;/a&gt; å®Œæˆå­¦ç”Ÿå¡çš„ç”³é¢†)
&lt;ol&gt;
&lt;li&gt;IRP(Irish Residence Permit) = æŠ¤ç…§ + proof of address + proof of registration + é“¶è¡Œå¡ (â‚¬300)&lt;/li&gt;
&lt;li&gt;PPSN(Personal Public Service Number) =  offer letter + proof of registration + proof of address + proof of identity&lt;/li&gt;
&lt;li&gt;é“¶è¡Œå¡(BOI/AIB/Revolut) = proof of identity + visa + student id card&lt;/li&gt;
&lt;li&gt;Leap Card = &lt;a href=&#34;https://leapcard.ie&#34;&gt;leapcard.ie&lt;/a&gt; + &lt;a href=&#34;https://www.tcdsu.org/services/student-leap-card&#34;&gt;TCDSU çš„ varification&lt;/a&gt; + proof of identity&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;å„ç§ APP:
&lt;ol&gt;
&lt;li&gt;TESCO Ireland: åŠ å…¥ Tesco ä¼šå‘˜å­˜ç§¯åˆ†&lt;/li&gt;
&lt;li&gt;Tesco Mobile/My48/Vodafone: ç”µè¯è´¹å……å€¼&lt;/li&gt;
&lt;li&gt;Leap Top-Up: å……å€¼ leap card çš„ï¼Œä½†æ˜¯æˆ‘æ²¡æœ‰ä¸‹è½½ï¼Œæˆ‘ç”¨ç½‘é¡µç«¯å……å€¼&lt;/li&gt;
&lt;li&gt;Trinity Life: å­¦æ ¡çš„ä¸€ä¸ªå®˜æ–¹ App å¯ä»¥æŸ¥çœ‹è‡ªå·±çš„è¯¾è¡¨å’Œå‰å¾€æ¯ä¸ªå±‹å­çš„è·¯çº¿&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;footnotes&#34; role=&#34;doc-endnotes&#34;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&#34;fn:1&#34;&gt;
&lt;p&gt;ä¸ªäººä¸æ˜¯ååˆ†å¸Œæœ›ä»æœ¬ç§‘åˆ°åšå£«éƒ½åœ¨ HKBU æˆ–è€…æ‹¿ HKBU çš„å­¦ä½ï¼Œä¸ªäººè¿˜æ˜¯å¸Œæœ›å¯ä»¥å‡ºå»èµ°èµ°çš„ã€‚HKBU æ˜¯ä¸€æ‰€å¾ˆå¥½çš„å­¦æ ¡ï¼Œè™½ç„¶ä»–çš„æ’ååœ¨æ‰ï¼Œä½†æ˜¯æˆ‘ä¾æ—§è§‰å¾— HKBU åœ¨è‚²äººæ–¹é¢æœ‰å…¶ç‹¬åˆ°ä¹‹å¤„ï¼Œè¿™ä¸ªå°±æ˜¯å¦ä¸€ä¸ªæ•…äº‹äº†ã€‚&amp;#160;&lt;a href=&#34;#fnref:1&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:2&#34;&gt;
&lt;p&gt;è¿™é‡Œæåˆ°çš„ä¸€äº›æƒ³æ³•éƒ½æ˜¯ç¬”è€…ä¸æˆç†Ÿçš„èƒ¡ç¼–ä¹±é€ ï¼Œåˆ‡å‹¿å½“çœŸã€‚&amp;#160;&lt;a href=&#34;#fnref:2&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</description>
    </item>
    
    <item>
      <title>Links</title>
      <link>https://blog.cklau.cc/links/</link>
      <pubDate>Sat, 03 Jun 2023 00:11:21 +0800</pubDate>
      <guid>https://blog.cklau.cc/links/</guid>
      <description>&lt;h2 id=&#34;-blogs-that-i-might-read&#34;&gt;ğŸ¤“ Blogs that I might read&lt;/h2&gt;
&lt;p&gt;&lt;div class=&#34;card-container&#34;&gt;
	&lt;a href=https://yhi.moe class=&#34;card&#34;&gt;
	  &lt;img src=https://avatars-githubusercontent.webp.se/jyhi&gt;
	  &lt;div class=&#34;info&#34;&gt;
		  &lt;h2&gt;Junde Yhi &amp;nbsp &lt;span&gt;https://yhi.moe&lt;/span&gt;&lt;/h2&gt;
		  &lt;p&gt;Proficient in computer tech (specializing in IoT), open source evangelist.&lt;/p&gt;
	  &lt;/div&gt;
	&lt;/a&gt;
&lt;/div&gt;
&lt;div class=&#34;card-container&#34;&gt;
	&lt;a href=https://ecwuuuuu.com/ class=&#34;card&#34;&gt;
	  &lt;img src=https://avatars-githubusercontent.webp.se/ECWU&gt;
	  &lt;div class=&#34;info&#34;&gt;
		  &lt;h2&gt;ECWU &amp;nbsp &lt;span&gt;https://ecwuuuuu.com/&lt;/span&gt;&lt;/h2&gt;
		  &lt;p&gt;Assistant Instructur, PhD student in  ğŸ‡®ğŸ‡ª UCD,  focusing on NLP, Medical imaging, &amp;amp; cloud-native&lt;/p&gt;
	  &lt;/div&gt;
	&lt;/a&gt;
&lt;/div&gt;
&lt;div class=&#34;card-container&#34;&gt;
	&lt;a href=https://junru.dev/ class=&#34;card&#34;&gt;
	  &lt;img src=https://avatars-githubusercontent.webp.se/billzhonggz&gt;
	  &lt;div class=&#34;info&#34;&gt;
		  &lt;h2&gt;Junru Zhong &amp;nbsp &lt;span&gt;https://junru.dev/&lt;/span&gt;&lt;/h2&gt;
		  &lt;p&gt;PhD candidate in Chinese University of Hong Kong&lt;/p&gt;
	  &lt;/div&gt;
	&lt;/a&gt;
&lt;/div&gt;
&lt;div class=&#34;card-container&#34;&gt;
	&lt;a href=https://yfqiu.netlify.app/ class=&#34;card&#34;&gt;
	  &lt;img src=https://avatars-githubusercontent.webp.se/yfqiu98&gt;
	  &lt;div class=&#34;info&#34;&gt;
		  &lt;h2&gt;Yifu Qiu &amp;nbsp &lt;span&gt;https://yfqiu.netlify.app/&lt;/span&gt;&lt;/h2&gt;
		  &lt;p&gt;PhD candidate in The University of Edinburgh and Cambridge University, 2023 Apple Scholars&lt;/p&gt;
	  &lt;/div&gt;
	&lt;/a&gt;
&lt;/div&gt;
&lt;div class=&#34;card-container&#34;&gt;
	&lt;a href=https://www.drjchn.com/ class=&#34;card&#34;&gt;
	  &lt;img src=https://avatars-githubusercontent.webp.se/DRJ31&gt;
	  &lt;div class=&#34;info&#34;&gt;
		  &lt;h2&gt;Reijie Deng &amp;nbsp &lt;span&gt;https://www.drjchn.com/&lt;/span&gt;&lt;/h2&gt;
		  &lt;p&gt;Full-stack developer&lt;/p&gt;
	  &lt;/div&gt;
	&lt;/a&gt;
&lt;/div&gt;
&lt;div class=&#34;card-container&#34;&gt;
	&lt;a href=https://www.lzc.app/ class=&#34;card&#34;&gt;
	  &lt;img src=https://avatars-githubusercontent.webp.se/lzcapp&gt;
	  &lt;div class=&#34;info&#34;&gt;
		  &lt;h2&gt;Laurence Luo &amp;nbsp &lt;span&gt;https://www.lzc.app/&lt;/span&gt;&lt;/h2&gt;
		  &lt;p&gt;Developer, geek&lt;/p&gt;
	  &lt;/div&gt;
	&lt;/a&gt;
&lt;/div&gt;
&lt;div class=&#34;card-container&#34;&gt;
	&lt;a href=https://9baka.moe/ class=&#34;card&#34;&gt;
	  &lt;img src=https://avatars-githubusercontent.webp.se/ninekirin&gt;
	  &lt;div class=&#34;info&#34;&gt;
		  &lt;h2&gt;Kirin Baka &amp;nbsp &lt;span&gt;https://9baka.moe/&lt;/span&gt;&lt;/h2&gt;
		  &lt;p&gt;New generation UICHCC bellwether&lt;/p&gt;
	  &lt;/div&gt;
	&lt;/a&gt;
&lt;/div&gt;
&lt;div class=&#34;card-container&#34;&gt;
	&lt;a href=https://www.haotian22.top/ class=&#34;card&#34;&gt;
	  &lt;img src=https://avatars-githubusercontent.webp.se/HaoTian22&gt;
	  &lt;div class=&#34;info&#34;&gt;
		  &lt;h2&gt;Hao Tian &amp;nbsp &lt;span&gt;https://www.haotian22.top/&lt;/span&gt;&lt;/h2&gt;
		  &lt;p&gt;Student in UIC, studying Media and Communication Studies&lt;/p&gt;
	  &lt;/div&gt;
	&lt;/a&gt;
&lt;/div&gt;
&lt;div class=&#34;card-container&#34;&gt;
	&lt;a href=https://blog.steven53.top/ class=&#34;card&#34;&gt;
	  &lt;img src=https://blog.steven53.top/img/avatar_hue48002d6542a472818c02b5f0bee8ed1_780708_300x0_resize_box_3.png&gt;
	  &lt;div class=&#34;info&#34;&gt;
		  &lt;h2&gt;Steven Wu &amp;nbsp &lt;span&gt;https://blog.steven53.top/&lt;/span&gt;&lt;/h2&gt;
		  &lt;p&gt;NULL&lt;/p&gt;
	  &lt;/div&gt;
	&lt;/a&gt;
&lt;/div&gt;
&lt;div class=&#34;card-container&#34;&gt;
	&lt;a href=https://zlicdt.github.io class=&#34;card&#34;&gt;
	  &lt;img src=https://zlicdt.github.io/img/avatar.png&gt;
	  &lt;div class=&#34;info&#34;&gt;
		  &lt;h2&gt;zlicdt &amp;nbsp &lt;span&gt;https://zlicdt.github.io&lt;/span&gt;&lt;/h2&gt;
		  &lt;p&gt;ãªã«ï¼Ÿï¼Ÿ&lt;/p&gt;
	  &lt;/div&gt;
	&lt;/a&gt;
&lt;/div&gt;
&lt;div class=&#34;card-container&#34;&gt;
	&lt;a href=https://chrdsite.rinchord.studio/ class=&#34;card&#34;&gt;
	  &lt;img src=https://chrdsite.rinchord.studio/content/images/size/w256h256/format/jpeg/2024/09/1000023288.jpg&gt;
	  &lt;div class=&#34;info&#34;&gt;
		  &lt;h2&gt;æ¸ºå®™å‡›å¨´ &amp;nbsp &lt;span&gt;https://chrdsite.rinchord.studio/&lt;/span&gt;&lt;/h2&gt;
		  &lt;p&gt;æ¸ºä¹‹èˆŸï¼Œå®‡ä¹‹å¥&lt;/p&gt;
	  &lt;/div&gt;
	&lt;/a&gt;
&lt;/div&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>ğŸ¥¼ RetiGAN: A GAN-based model on retinal Image synthesis</title>
      <link>https://blog.cklau.cc/post/scientia/10.1016-j.bspc.2022.104004/</link>
      <pubDate>Sun, 02 Apr 2023 00:13:00 +0800</pubDate>
      <guid>https://blog.cklau.cc/post/scientia/10.1016-j.bspc.2022.104004/</guid>
      <description>&lt;h2 id=&#34;before-tldr&#34;&gt;Before (TL;DR)&lt;/h2&gt;
&lt;p&gt;The field of medical imaging is rapidly adopting artificial intelligence (AI) as a promising technology, with a particular focus on deep learning techniques. These AI methods have the potential to be applied across a range of tasks in medical imaging, from image acquisition and reconstruction to analysis and interpretation. For instance, Computed Tomography(CT), Magnetic Resonance Imaging, Positron Emission Tomography (PET), Mammography, Ultrasound, and X-ray, haved be used for early detection, diagnosis, and treatment of diseases. In the clinic, medical image interpretation in the clinic has relied on human experts, such as radiologists and physicians. However, due to the wide range of pathologies and the risk of human fatigue, researchers and doctors have started to explore the potential of computer-assisted interventions. While progress in computational medical image analysis has not been as rapid as in medical imaging technologies, the situation is improving with the introduction of machine learning techniques.&lt;/p&gt;
&lt;p&gt;Machine learning techniques, such as deep learning, have shown promise in assisting human experts in medical image interpretation. By training algorithms on large datasets of medical images, these techniques can help identify patterns and features that are difficult for human experts to detect. As a result, they have the potential to improve diagnostic accuracy and reduce the risk of errors.&lt;/p&gt;
&lt;p&gt;As the field of machine learning continues to evolve, it is likely that we will see more applications of these techniques in medical imaging. While they will not replace the need for human experts, they can provide valuable assistance and help improve patient outcomes.&lt;/p&gt;
&lt;p&gt;As the very first blog on Medical CV/Medical Image processing, I am trying to introduce a paper working on retinal image synthesis, The authors of this paper have combined multiple classical deep learning techniques that were developed before 2021.&lt;/p&gt;
&lt;p&gt;For those who are new to the field of deep learning and medical computer vision, the content of the paper is easily understandable. The authors have used these techniques to synthesize retinal images, which has the potential to aid in the diagnosis and treatment of various eye diseases.&lt;/p&gt;
&lt;p&gt;Overall, this paper highlights the potential of deep learning techniques in medical image processing and provides a valuable contribution to the field. As a newcomer to this field, it is an excellent resource for gaining a better understanding of the applications of deep learning in medical computer vision.&lt;/p&gt;
&lt;h2 id=&#34;a-novel-retinal-image-generation-model-with-the-preservation-of-structural-similarity-and-high-resolution&#34;&gt;A novel retinal image generation model with the preservation of structural similarity and high-resolution&lt;/h2&gt;
&lt;p&gt;The paper can be found in &lt;a href=&#34;https://doi.org/10.1016/j.bspc.2022.104004&#34;&gt;10.1016/j.bspc.2022.104004&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;In this paper, the proposed a new retinal image generation model call &lt;strong&gt;RetiGAN&lt;/strong&gt; based on the adversarial learning. The goal of this model is to &lt;strong&gt;generate high-resolution synthetic images&lt;/strong&gt; that preserve the structual similarity of the original images. To achieve this, they embed the VGG network into their RetiGAN to guarantee the high-level semantic information can be extracted and used in the content loss to guide the model to retain the semantic contents of the original image. To solved the problem of blurring and incpomplete edge, the embed the smoothed images into the training set to improve the edge sharpness of the generated images.&lt;/p&gt;
&lt;p&gt;In general, the RetiGAN can be divied into four modules:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;U-Net: for the Vessel tree segmentation&lt;/li&gt;
&lt;li&gt;Generator $G$: learns to generate plausible retinal image&lt;/li&gt;
&lt;li&gt;Discriminator $D$: learns to distinguish the generator&amp;rsquo;s fake image from real image&lt;/li&gt;
&lt;li&gt;VGG modules: perform high-level feature extraction on the generated retinal image and the original image. In this way, the global semantic features of the retinal image can be well preserved.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Basically, the idea/architecture of the $G$ and $D$ are from the &lt;a href=&#34;https://tcwang0509.github.io/pix2pixHD/&#34;&gt;pix2pixHD&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;u-net&#34;&gt;U-Net&lt;/h3&gt;
&lt;p&gt;The U-Net network is based on a fully convolutional neural network, whose characteristic is that a small amount of training images can be used to obtain a good segmentation effect, very suitable for the field of medical images. The architecture of U-Net is similar to the &lt;em&gt;encoder-decoder&lt;/em&gt; architecture, where the left-side of the &amp;ldquo;U&amp;rdquo; is the encoder block, and the right-side is the decoder block&lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Encoder: is a 4-layer architecture:
&lt;ul&gt;
&lt;li&gt;extracts a meaningful feature map from the input image&lt;/li&gt;
&lt;li&gt;each layer includes two convolution layers and one max-pooling for the down-sampling&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Decoder: is a 4-layer architecture:
&lt;ul&gt;
&lt;li&gt;up-sampling the feature map&lt;/li&gt;
&lt;li&gt;each layer includes two convolution layers&lt;/li&gt;
&lt;li&gt;for each layer, it concatenates the corresponding encoder&amp;rsquo;s features (using &lt;code&gt;torchvision.transforms.CenterCrop&lt;/code&gt; to maintain the size)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;In this article, they use U-Net as the tool to separate the background and the vessel tree, as the vessel tree is treated as the input for the generator $G$.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# code example for the U-Net&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;DualConv&lt;/span&gt;(nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Module):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; __init__(self, in_channel, out_channel):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        super(DualConv, self)&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;__init__()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;conv &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Sequential(
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;ReflectionPad2d(padding&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Conv2d(in_channel, out_channel, kernel_size&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, padding&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;InstanceNorm2d(out_channel, affine&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;False&lt;/span&gt;),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;ReLU(inplace&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;True&lt;/span&gt;),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Conv2d(out_channel, out_channel, kernel_size&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, padding&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;InstanceNorm2d(out_channel, affine&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;False&lt;/span&gt;),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;ReLU(inplace&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;True&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        )
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;forward&lt;/span&gt;(self, x):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;conv(x)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; x
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Encoder&lt;/span&gt;(nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Module):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;# 3 is for RGB, 1 is for grayscale&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; __init__(self, channels &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;64&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;128&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;256&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;512&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1024&lt;/span&gt;]):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        super(Encoder, self)&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;__init__()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;encblocks &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;ModuleList([DualConv(channels[i], channels[i&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;]) &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; i &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; range(len(channels) &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)])
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;maxpool2d &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;MaxPool2d(&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;forward&lt;/span&gt;(self, x):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        output &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; []
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; encblock &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;encblocks:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; encblock(x)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            output&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;append(x)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;maxpool2d(x)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; output
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Decoder&lt;/span&gt;(nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Module):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; __init__(self, channels&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;1024&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;512&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;256&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;128&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;64&lt;/span&gt;], mode&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;trans&amp;#34;&lt;/span&gt;):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        super()&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;__init__()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;channels &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; channels
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; mode &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;bilinear&amp;#34;&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;upsampling &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;ModuleList([nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Sequential(nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Upsample(scale_factor&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, mode&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;bilinear&amp;#34;&lt;/span&gt;, align_corners&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;True&lt;/span&gt;), 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                                            nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Conv2d(channels[i], channels[i&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;], kernel_size&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)) &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; i &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; range(len(channels)&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)])
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;upsampling &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;ModuleList([nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;ConvTranspose2d(channels[i], channels[i&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;], kernel_size&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, stride&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;) &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; i &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; range(len(channels)&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)])
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;decblocks &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;ModuleList([DualConv(channels[i], channels[i&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;]) &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; i &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; range(len(channels)&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)]) 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;forward&lt;/span&gt;(self, x, encoder_features):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; i &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; range(len(self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;channels)&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;upsampling[i](x)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            enc_ftrs &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;crop(encoder_features[i], x)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; torch&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;cat([x, enc_ftrs], dim&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;decblocks[i](x)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; x
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;crop&lt;/span&gt;(self, enc_ftrs, x):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        _, _, H, W &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; x&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;shape
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        enc_ftrs   &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; torchvision&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;transforms&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;CenterCrop([H, W])(enc_ftrs)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; enc_ftrs
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;UNet&lt;/span&gt;(nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Module):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; __init__(self, enc_channels&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;64&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;128&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;256&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;512&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1024&lt;/span&gt;], dec_channels&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;1024&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;512&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;256&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;128&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;64&lt;/span&gt;], num_class&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, mode&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;trans&amp;#34;&lt;/span&gt;):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        super(UNet, self)&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;__init__()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;encoder &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Encoder(channels&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;enc_channels)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;decoder &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Decoder(channels&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;dec_channels, mode&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;mode)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;output &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Sequential(nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Conv2d(dec_channels[&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;], num_class, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;), nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Sigmoid())
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;forward&lt;/span&gt;(self, x):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        enc_out &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;encoder(x)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        out &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;decoder(enc_out[::&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;][&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;], enc_out[::&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;][&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;:])
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        out &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;output(out)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; out
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;generator-g&#34;&gt;Generator $G$&lt;/h3&gt;
&lt;p&gt;The gneerator is is a standard encoder-decoder architecture, which can be seperated into three parts:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;down-sampling module&lt;/li&gt;
&lt;li&gt;residual blocks&lt;/li&gt;
&lt;li&gt;up-sampling module&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;where it is the &lt;em&gt;GlobalGenerator&lt;/em&gt; in pix2pixHD model, focusing on the coarse high-resolution image. In pix2pixHD, they have seconde generator called &lt;em&gt;LocalEnhancer&lt;/em&gt;, focusing on the feature encoding and decoding enhancement. The &lt;em&gt;LocalEnhancer&lt;/em&gt; is used to refine the image by adding more details to improve the image quality. The input of the &lt;em&gt;GlobalGenerator&lt;/em&gt; in pix2pixHD is the downsampled label map $s_{\text{down}}$, and the output is the corse generated image $\hat{x}_{\text{down}}$. With the addition operation with the feature map $Enc_{\text{L}}(s)$: $(Enc_{\text{L}}(s) + \hat{x}_{\text{down}})$, the &lt;em&gt;LocalEnhancer&lt;/em&gt; output the final $\hat{x}$.&lt;/p&gt;
&lt;p&gt;In RetiGAN, the simply using the &lt;em&gt;GlobalGenerator&lt;/em&gt; as the generator, since the retinal image are more simplier than the image using in pix2pixHD, where the fundus image are all indomain information, thus, using one generator can reduce model complexity.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;## ResBlock ##&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ResBlock&lt;/span&gt;(nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Module):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; __init__(self, in_channel):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        super(ResBlock, self)&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;__init__()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;resblock &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Sequential(
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Conv2d(in_channel, in_channel, kernel_size&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, stride&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, padding&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, padding_mode&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;reflect&amp;#34;&lt;/span&gt;),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;InstanceNorm2d(in_channel),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;ReLU(inplace&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;True&lt;/span&gt;),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Conv2d(in_channel, in_channel, kernel_size&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, stride&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, padding&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, padding_mode&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;reflect&amp;#34;&lt;/span&gt;),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;InstanceNorm2d(in_channel)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        )
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;forward&lt;/span&gt;(self, x):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        out &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; x &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;resblock(x)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; out
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;## Generator ##&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;GlobalGenerator&lt;/span&gt;(nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Module):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; __init__(self, in_channel&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, out_channel&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, filters&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;64&lt;/span&gt;, n_enc&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, n_bottle&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;9&lt;/span&gt;, mode&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;trans&amp;#34;&lt;/span&gt;):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        super(GlobalGenerator, self)&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;__init__()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        encoder &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;ModuleList([
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Conv2d(in_channels&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;in_channel, out_channels&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;filters, kernel_size&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;, stride&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, padding&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, padding_mode&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;reflect&amp;#34;&lt;/span&gt;),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;InstanceNorm2d(filters, affine&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;False&lt;/span&gt;),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;ReLU(inplace&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;True&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ])
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; i &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; range(n_enc):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            multiplier &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; filters &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;**&lt;/span&gt; i)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            encoder&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;append(nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Conv2d(in_channels&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;multiplier, out_channels&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;multiplier &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, kernel_size&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, stride&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, padding&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, padding_mode&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;reflect&amp;#34;&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            encoder&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;append(nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;InstanceNorm2d(multiplier &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, affine&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;False&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            encoder&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;append(nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;ReLU(inplace&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;True&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        resblocks &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;ModuleList([])
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; i &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; range(n_bottle):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            resblocks&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;append(ResBlock(multiplier &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        decoder &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;ModuleList([])
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;#multiplier = multiplier * 2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; i &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; range(n_enc):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            multiplier &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; int(filters &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;**&lt;/span&gt; (n_enc &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; i)))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; mode &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;trans&amp;#34;&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                decoder&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;append(nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;ConvTranspose2d(in_channels&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;multiplier, out_channels&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;int(multiplier &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;), kernel_size&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, stride&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, padding&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, output_padding&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;elif&lt;/span&gt; mode &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;shuffle&amp;#34;&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                decoder&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;append(nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Conv2d(in_channels&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;multiplier, out_channels&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;int(multiplier &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;**&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;), kernel_size&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, stride&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, padding&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                decoder&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;append(nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;PixelShuffle(&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                decoder&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;append(nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Upsample(scale_factor&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, mode&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;bilinear&amp;#34;&lt;/span&gt;, align_corners&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;True&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                decoder&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;append(nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Conv2d(in_channels&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;multiplier, out_channels&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;int(multiplier &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;), kernel_size&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            decoder&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;append(nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;InstanceNorm2d(int(multiplier &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;), affine&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;False&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            decoder&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;append(nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;ReLU(inplace&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;True&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        decoder&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;append(nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Conv2d(in_channels&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;int(multiplier &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;), out_channels&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;out_channel, kernel_size&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;, stride&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, padding&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, padding_mode&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;reflect&amp;#34;&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        decoder&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;append(nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Tanh())
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        model &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; encoder &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; resblocks &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; decoder
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;model &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Sequential(&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;model)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;forward&lt;/span&gt;(self, x):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        out &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;model(x)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; out
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;LocalEnhancer&lt;/span&gt;(nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Module):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; __init__(self, in_channel&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, out_channel&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, filters&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;64&lt;/span&gt;, n_enc&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, n_bottle&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;9&lt;/span&gt;):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        super(LocalEnhancer, self)&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;__init__()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;# G2 Encoder &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        encoder &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;ModuleList([
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Conv2d(in_channels&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;in_channel, out_channels&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;int(filters &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;), kernel_size&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;, stride&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, padding&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, padding_mode&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;reflect&amp;#34;&lt;/span&gt;),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;InstanceNorm2d(int(filters &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;), affine&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;False&lt;/span&gt;),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;ReLU(inplace&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;True&lt;/span&gt;),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ])
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        encoder&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;append(nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Conv2d(in_channels&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;int(filters &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;), out_channels&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;filters, kernel_size&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, stride&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, padding&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, padding_mode&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;reflect&amp;#34;&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        encoder&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;append(nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;InstanceNorm2d(filters, affine&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;False&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        encoder&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;append(nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;ReLU(inplace&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;True&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;encoder &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Sequential(&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;encoder)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;# G1 Encoder-Decoder&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;generator &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; GlobalGenerator(in_channel&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;in_channel, out_channel&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;out_channel, filters&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;64&lt;/span&gt;, n_enc&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, n_bottle&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;9&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;model[:&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;# G2 ResBlock&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        resblocks &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;ModuleList([])
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; i &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; range(&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            resblocks&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;append(ResBlock(filters))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;resblocks &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Sequential(&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;resblocks)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;# G2 Decoder&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        decoder &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;ModuleList([
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;ConvTranspose2d(in_channels&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;filters, out_channels&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;int(filters &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;), kernel_size&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, stride&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, padding&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, output_padding&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Conv2d(in_channels&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;int(filters &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;), out_channels&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;out_channel, kernel_size&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;, stride&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, padding&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, padding_mode&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;reflect&amp;#34;&lt;/span&gt;),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Tanh()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ])
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;decoder &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Sequential(&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;decoder)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;# Downsampling for G1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;downsample &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;AvgPool2d(&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, stride&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, padding&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, count_include_pad&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;False&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;forward&lt;/span&gt;(self, x):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        enc_out &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;encoder(x)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        gen_out &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;generator(self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;downsample(x))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        res_out &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;resblocks(torch&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;add(enc_out, gen_out))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        out &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;decoder(res_out)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; out
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;discriminator-d&#34;&gt;Discriminator $D$&lt;/h3&gt;
&lt;p&gt;The basic idea of the discriminator is following this two equation $D(\hat{s}, \hat{x}) \mapsto \mathbf{0}$, and $D(s, x) \mapsto \mathbf{1}$, where $D$ measures the distance between fake image pairs with zero, and real image pairs with one.&lt;/p&gt;
&lt;p&gt;In this paper (or in pix2pixHD), they adapted the discriminator architecutre proposed by &lt;a href=&#34;https://arxiv.org/abs/1611.07004v3&#34;&gt;PatchGAN&lt;/a&gt;, where the PatchGAN discriminator takes in image patches rather than an entire image. These patches are typically small square regions of the input image, such as 70x70 or 256x256 pixels. The PatchGAN discriminator produces a matrix of scalar values that represent the probability of each patch being real or fake. By operating at the patch level, the PatchGAN discriminator is able to capture more fine-grained details of the image and provide more precise feedback to the generator. This can lead to higher quality image generation.&lt;/p&gt;
&lt;p&gt;Instead of using one discriminator, they use two discriminator, $D_1$ is for the original size images and $D_2$ is for the down-sampled images.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;## PatchDiscriminator&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;PatchDiscriminator&lt;/span&gt;(nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Module):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; __init__(self, in_channel&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, filters&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;64&lt;/span&gt;, n_blocks&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        super(PatchDiscriminator, self)&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;__init__()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;model &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;ModuleList([
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Conv2d(in_channels&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;in_channel, out_channels&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;filters, kernel_size&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;, stride&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, padding&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;LeakyReLU(&lt;span style=&#34;color:#ae81ff&#34;&gt;0.2&lt;/span&gt;, inplace&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;True&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ])
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; i &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; range(n_blocks&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            multiplier &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; filters &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; (&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;**&lt;/span&gt; i)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;model&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;append(nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Conv2d(multiplier, multiplier &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, kernel_size&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;, stride&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, padding&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;model&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;append(nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;InstanceNorm2d(multiplier &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, affine&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;False&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;model&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;append(nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;LeakyReLU(&lt;span style=&#34;color:#ae81ff&#34;&gt;0.2&lt;/span&gt;, inplace&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;True&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;model&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;append(nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Conv2d(multiplier &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, multiplier &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;, kernel_size&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;, stride&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, padding&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;model&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;append(nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Conv2d(multiplier &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, kernel_size&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;, stride&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, padding&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;model &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Sequential(&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;model)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;forward&lt;/span&gt;(self, x):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        out &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;model(x)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; out
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;## MultiScaleDiscriminator&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;MultiScaleDiscriminator&lt;/span&gt;(nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Module):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&amp;#39;&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;    By default, there are three separate sub-discriminator(D1, D2, D3) to generate prediction
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;    They all have the same architectures but D2 and D3 operate on inputs downsampled by 2x and 4x, respectively
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;    &amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; __init__(self, in_channel&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, filters&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;64&lt;/span&gt;, n_blocks&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, n_dim&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        super(MultiScaleDiscriminator, self)&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;__init__()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;n_dim &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; n_dim
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;downsample &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;AvgPool2d(kernel_size&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, stride&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, padding&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, count_include_pad&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;False&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        model_template &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; PatchDiscriminator(in_channel&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;in_channel, filters&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;filters, n_blocks&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;n_blocks)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; i &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; range(n_dim):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            setattr(self, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;model&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;{}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;format(i), model_template)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;forward&lt;/span&gt;(self, x):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        out &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; []
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; i &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; range(self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;n_dim):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            model &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; getattr(self, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;model&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;{}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;format(i))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; i &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;downsample(x)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            out&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;append(model(x))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; out
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;vgg-perceptual-information-extraction&#34;&gt;VGG (Perceptual Information Extraction)&lt;/h3&gt;
&lt;p&gt;The VGG architecture consists of a series of convolutional layers with small 3x3 filters, followed by max pooling layers. The number of filters in each convolutional layer is gradually increased as the network gets deeper. The final layers of the network consist of fully connected layers that perform the classification task.&lt;/p&gt;
&lt;p&gt;VGG is often used in conjunction with perceptual loss in deep learning applications, particularly in image synthesis and style transfer tasks.&lt;/p&gt;
&lt;p&gt;Perceptual loss&lt;sup id=&#34;fnref:2&#34;&gt;&lt;a href=&#34;#fn:2&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;2&lt;/a&gt;&lt;/sup&gt; is a type of loss function that is based on the idea of using a pre-trained deep neural network, such as VGG, to measure the similarity between two images. In the context of image synthesis, the goal is to generate an image that is visually similar to a target image. Perceptual loss can be used to measure the difference between the generated image and the target image in terms of their high-level features, such as texture, color, and object structure.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Perception&lt;/span&gt;(nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Module):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&amp;#39;&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;    Compute the perceptual information based on VGG pretained model 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\b&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;egin{align*}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;        \mathcal&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;{L}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;_{&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\t&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;ext&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;{VGG}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;} = \mathbb&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;{E}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;_{s,x}\left[\sum_{i=1}^N\dfrac&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;{1}{M_i}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;\left|\left|F^i(x) - F^i(G(s))&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\r&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;ight|&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\r&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;ight|_1&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\r&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;ight]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;    \end{align*}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;    &amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; __init__(self):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        super(Perception, self)&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;__init__()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        vgg19 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; torchvision&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;models&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;vgg19(weights&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;DEFAULT&amp;#34;&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;features
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;models &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;ModuleList([
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            vgg19[:&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            vgg19[&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            vgg19[&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;12&lt;/span&gt;],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            vgg19[&lt;span style=&#34;color:#ae81ff&#34;&gt;12&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;21&lt;/span&gt;],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            vgg19[&lt;span style=&#34;color:#ae81ff&#34;&gt;21&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;30&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ])
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#75715e&#34;&gt;# no need to update the parameters&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; param &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;parameters():
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            param&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;requires_grad &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;False&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;forward&lt;/span&gt;(self, x):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        out &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; []
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        out&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;append(x)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; model &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;models:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; model(x)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            out&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;append(x)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; out
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;loss-function&#34;&gt;Loss function&lt;/h3&gt;
&lt;p&gt;In general, there are two losses: &lt;em&gt;Generato Loss&lt;/em&gt; $\mathcal{L}_G$ and &lt;em&gt;Discriminator Loss&lt;/em&gt; $\mathcal{L}_D$.&lt;/p&gt;
&lt;p&gt;The &lt;em&gt;Generator Loss&lt;/em&gt; includes these three sub-loss:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Adversarial loss: $\mathcal{L}_{\text{adv}}$: is used to train the generator network by making it generate synthetic data that can fool the discriminator network into thinking that it is real data. The adversarial loss is computed based on the output of the discriminator network.$\mathcal{L}_{\text{adv}}= \left|\left|D(G(s)), 1\right|\right|_2$&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Feature Matching Loss $\mathcal{L}_{\text{FM}}$: In pix2pixHD, the authors found this to stabilize training. In this case, this forces the generator to produce natural statistics at multiple scales. This feature-matching loss is similar to StyleGANâ€™s&lt;sup id=&#34;fnref:3&#34;&gt;&lt;a href=&#34;#fn:3&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;3&lt;/a&gt;&lt;/sup&gt; perceptual loss. For some semantic label maps s and corresponding image $x$: $\mathcal{L}_{\text{FM}} = \mathbb{E}_{s,x}\left[\sum_{i=1}^T\dfrac{1}{N_i}\left|\left|D^{(i)}_k(s, x) - D^{(i)}_k(s, G(s))\right|\right|_1\right]$, where $T$ is the total number of layers, $N_i$ is the number of elements at layer $i$ and $D_k^{(i)}$ denotes the $i$-th layer in discriminator $k$.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Peceptual Loss $\mathcal{L}_{\text{VGG}}$: In pix2pixHD, the authors report minor performance improvements when adding perceptual loss, formulated as $\mathcal{L}_{\text{VGG}} = \mathbb{E}_{s,x}\left[\sum_{i=1}^N\dfrac{1}{M_i}\left|\left|F^i(x) - F^i(G(s))\right|\right|_1\right]$, where $F^i$ denotes the $i$th layer with $M_i$ elements of the VGG19 network.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Overall, $\mathcal{L}_G = \lambda_0\mathcal{L}_{\text{GAN}} + \lambda_1 \mathcal{L}_{\text{FM}} + \lambda_2 \mathcal{L}_{\text{VGG}}$, where $\lambda_i$ are the parameters.&lt;/p&gt;
&lt;p&gt;The Discriminator Loss in this paper is similar to the PatchGANâ€™s. However, to solve the blurring and incomplete edges, they include an additional set of images $x_b$ , where $x_b$ are generated by removing precise edges in training images x (Canny edge detector &amp;amp; Gaussian filter). After the smoothed images x_b are included into the training set, the main task for the discriminator is not only to improve the ability of discriminating the generated from the real ones, but also to discriminate the smoothed and the clear ones.&lt;/p&gt;
&lt;p&gt;$\mathcal{L}_D = \mathbb{E}[logD(x)] + \mathbb{E}[log(1 - D(\hat{x}))] + \mathbb{E}[log(1 - D(\hat{x_b}))]$&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;## Perceptual Loss&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;PerceptualLoss&lt;/span&gt;(nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Module):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;#34;&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;    compute perceptual loss with VGG network from both real and fake images (updating the Generator)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;    &amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; __init__(self, device&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;cpu&amp;#34;&lt;/span&gt;):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        super(PerceptualLoss, self)&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;__init__()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;model &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Perception()&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;to(device)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;criterion &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;L1Loss()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;LAMBDA &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; [&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;32&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;16&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;forward&lt;/span&gt;(self, predict, target):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        loss &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; real, fake, weight &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; zip(self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;model(target), self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;model(predict), self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;LAMBDA):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            loss &lt;span style=&#34;color:#f92672&#34;&gt;+=&lt;/span&gt; weight &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;criterion(real&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;detach(), fake)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; loss
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;## Adversarial Loss &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;AdversarialLoss&lt;/span&gt;(nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Module):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;#34;&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;    computes adversarial loss from nested list of fakes outputs from discriminator. (updating the Generator)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;    &amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; __init__(self):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        super(AdversarialLoss, self)&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;__init__()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;criterion &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;MSELoss()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;forward&lt;/span&gt;(self, predict, is_real&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;True&lt;/span&gt;):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        loss &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        target &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; torch&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;ones_like &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; is_real &lt;span style=&#34;color:#66d9ef&#34;&gt;else&lt;/span&gt; torch&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;zeros_like
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; preds &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; predict:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            loss &lt;span style=&#34;color:#f92672&#34;&gt;+=&lt;/span&gt; self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;criterion(preds, target(preds))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; loss
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;FeatureMatchLoss&lt;/span&gt;(nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Module):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&amp;#39;&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;    Compute feature matching loss from nested lists of fake and real outputs from discriminator. (updating the Ganerator)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;    https://proceedings.neurips.cc/paper/2016/file/8a3363abe792db2d8761d6403605aeb7-Paper.pdf
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\b&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;egin{align*}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;        \mathcal&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;{L}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;_{&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\t&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;ext&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;{FM}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;} = \mathbb&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;{E}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;_{s,x}\left[\sum_{i=1}^T\dfrac&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;{1}{N_i}&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;\left|\left|D^{(i)}_k(s, x) - D^{(i)}_k(s, G(s))&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\r&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;ight|&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\r&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;ight|_1&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\r&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;ight]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;    \end{align*}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;    &amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; __init__(self):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        super(FeatureMatchLoss, self)&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;__init__()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;criterion &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;L1Loss()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;forward&lt;/span&gt;(self, predict, target):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        loss &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0.0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; real_feature, fake_feature &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; zip(target, predict):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; real, fake &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; zip(real_feature, fake_feature):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                loss &lt;span style=&#34;color:#f92672&#34;&gt;+=&lt;/span&gt; self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;criterion(real&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;detach(), fake)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; loss
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;GeneratorLoss&lt;/span&gt;(nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;Module):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&amp;#39;&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;    Combine the Adversarial-Loss, Feature Maching Loss, and Perceptual Loss together with different weights
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;    &amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; __init__(self, LAMBDA0&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, LAMBDA1&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;100&lt;/span&gt;, LAMBDA2&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;, n_dim&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        super(GeneratorLoss, self)&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;__init__()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        SCALE &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; LAMBDA0 &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; LAMBDA1 &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; LAMBDA2
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;LAMBDA &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; [LAMBDA0 &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; SCALE, LAMBDA1 &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; SCALE, LAMBDA2 &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; SCALE]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;n_dim &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; n_dim
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;adv_loss &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; AdversarialLoss()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;per_loss &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; PerceptualLoss()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;fm_loss &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FeatureMatchLoss()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;forward&lt;/span&gt;(self, fake, real, predict, target):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        loss &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;LAMBDA[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;adv_loss(predict&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;predict, is_real&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;True&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; \
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;         self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;LAMBDA[&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;per_loss(predict&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;fake, target&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;real) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; \
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;         self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;LAMBDA[&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;fm_loss(predict&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;predict, target&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;target) &lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt; self&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;n_dim
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; loss
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;footnotes&#34; role=&#34;doc-endnotes&#34;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&#34;fn:1&#34;&gt;
&lt;p&gt;The U-Net is not a &lt;em&gt;encoder-decoder&lt;/em&gt; architecture, as it does not contain a &amp;ldquo;latant&amp;rdquo; layer, however, the shapes are similar, to simply, I just call it as &lt;em&gt;encoder-decoder&lt;/em&gt;.&amp;#160;&lt;a href=&#34;#fnref:1&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:2&#34;&gt;
&lt;p&gt;To see more about perceptual loss, you may check &lt;a href=&#34;https://arxiv.org/abs/1603.08155&#34;&gt;Perceptual Losses for Real-Time Style Transfer and Super-Resolution&lt;/a&gt;&amp;#160;&lt;a href=&#34;#fnref:2&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:3&#34;&gt;
&lt;p&gt;&lt;a href=&#34;https://nvlabs.github.io/stylegan2/versions.html&#34;&gt;StyleGAN, from 1 to 3&lt;/a&gt;&amp;#160;&lt;a href=&#34;#fnref:3&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</description>
    </item>
    
    <item>
      <title>ğŸ§‘ğŸ¿â€ğŸ’» K3s/Kubernetes - From K3s to Kubernetes: Build a High availability Kubernetes Cluster with Kubeadm</title>
      <link>https://blog.cklau.cc/post/k8s-setup-2/</link>
      <pubDate>Sun, 19 Feb 2023 22:42:17 +0800</pubDate>
      <guid>https://blog.cklau.cc/post/k8s-setup-2/</guid>
      <description>&lt;p&gt;Why we need a High availability Kubernetes? In production-ready environment, a system hang is not affordable. The Kubernetes can help us handling the containers&amp;rsquo; replica or the pod/service rescheduling. However, If there is only one control node, this may cause a big problem. Thus, when we talking about K8s&amp;rsquo;s HA, usually, we are talking on the control plane&amp;rsquo;s HA. I am not saying that the worker node are not important, or do not need HA, but, more importantly, is the control nodes&amp;rsquo; safety.&lt;/p&gt;
&lt;h2 id=&#34;before&#34;&gt;Before,&lt;/h2&gt;
&lt;p&gt;The prerequisites of build a high availability K8s cluster:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Three or more machines that meet K8s&amp;rsquo;s minimum requirements for the control-plane nodes. The quantities of control nodes usually are an odd numbers (to avoid split-brain). Thus, the minimum number is three.&lt;/li&gt;
&lt;li&gt;Three or more machines that meet K8s&amp;rsquo;s minimum requirements for the worker nodes.&lt;/li&gt;
&lt;li&gt;Full network connectivity between all machines in the cluster&lt;/li&gt;
&lt;li&gt;Superuser privileges on all machines&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Here is my nodes:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;Hostname&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;IP address&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;Usage&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;newton&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;192.168.101.1&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;load balancer&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;cantor&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;192.168.102.1&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;control-plane&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;gauss&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;192.168.102.2&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;control-plane&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;freud&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;192.168.103.1&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;control-plane&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;hilbert&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;192.168.102.3&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;worker&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;einstein&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;192.168.104.1&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;worker&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;bohr&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;192.168.104.2&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;worker&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;As you can see, there are three control-plane, three worker, and one load-balancer.&lt;/p&gt;
&lt;h2 id=&#34;installation&#34;&gt;Installation&lt;/h2&gt;
&lt;p&gt;First, we need to modify the host &lt;code&gt;/etc/hosts&lt;/code&gt; to map IP address to host names:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;newton    192.168.101.1
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cantor    192.168.102.1
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gauss     192.168.102.2
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;freud     192.168.103.1
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;hilbert   192.168.103.1
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;einstein  192.168.104.1
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;bohr      192.168.104.2
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;This step&lt;/strong&gt; is important, without this step, the &lt;code&gt;etcd&lt;/code&gt; cluster may be failed to establish.&lt;/p&gt;
&lt;p&gt;Modify the kernel parameters and install the tools we need:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ipvsadm&lt;/li&gt;
&lt;li&gt;netfilter&lt;/li&gt;
&lt;li&gt;containerd&lt;/li&gt;
&lt;li&gt;kubeadm&lt;/li&gt;
&lt;li&gt;kubelet&lt;/li&gt;
&lt;li&gt;kubectl&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;echo &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;=== install ipvsadm ===&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt-get install ipvsadm -y 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;modprobe -- ip_vs
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;modprobe -- ip_vs_rr
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;modprobe -- ip_vs_wrr
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;modprobe -- ip_vs_sh
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;modprobe -- nf_conntrack
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cat &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;lt;&amp;lt;EOF | sudo tee /etc/modules-load.d/ipvs.conf
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;ip_vs
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;ip_vs_rr
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;ip_vs_wrr
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;ip_vs_sh
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;nf_conntrack
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo sysctl --system
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;echo &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;done&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;echo &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;=== load overlay &amp;amp; br_netfilter, setup netfilter ===&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo modprobe overlay &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sudo modprobe br_netfilter
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cat &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;lt;&amp;lt;EOF | sudo tee /etc/modules-load.d/containerd.conf
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;overlay
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;br_netfilter
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cat &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;lt;&amp;lt;EOF | sudo tee /etc/sysctl.d/99-kubernetes-cri.conf
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;net.bridge.bridge-nf-call-iptables  = 1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;net.ipv4.ip_forward                 = 1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;net.bridge.bridge-nf-call-ip6tables = 1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo sysctl --system
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;echo &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;done&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;echo &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;=== ip forwarding ===&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cat &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;lt;&amp;lt;EOF | sudo tee /etc/sysctl.conf
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;kernel.sysrq = 1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;net.ipv6.conf.all.disable_ipv6=0
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;net.ipv6.conf.default.disable_ipv6=0
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;net.ipv6.conf.lo.disable_ipv6=0
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;kernel.printk = 5
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;echo &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;=== install containerd ===&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo mkdir -p /etc/apt/keyrings
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;echo &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;deb [arch=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;dpkg --print-architecture&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt; signed-by=/etc/apt/keyrings/docker.gpg] https://mirrors.bfsu.edu.cn/docker-ce/linux/ubuntu &lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;lsb_release -cs&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt; stable&amp;#34;&lt;/span&gt; | sudo tee /etc/apt/sources.list.d/docker.list &amp;gt; /dev/null
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt-get update &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sudo apt-get -y install containerd.io
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo mkdir -p /etc/containerd &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sudo containerd config default | sudo tee /etc/containerd/config.toml
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cat &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;lt;&amp;lt;EOF | sudo tee /etc/crictl.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;runtime-endpoint: unix:///run/containerd/containerd.sock
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;debug: false
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo sed &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;s/SystemdCgroup = false/SystemdCgroup = true/&amp;#39;&lt;/span&gt; /etc/containerd/config.toml &amp;gt; .etc.containerd/config.toml
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;echo &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;done&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;echo &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;=== install kubeadm kubelet kubectl ===&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt install -y apt-transport-https ca-certificates curl
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;curl https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg | sudo apt-key add - 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;echo &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;deb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main&amp;#39;&lt;/span&gt; | sudo tee -a /etc/apt/sources.list.d/kubernetes.list
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt-get update
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt-get -y install kubelet kubeadm kubectl
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;echo &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;install kubelet kubeadm kubectl...done&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;echo &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;start kubelet&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo systemctl enable --now kubelet
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Run the above script on every machines, for the worker nodes, you may not install the &lt;code&gt;kubeadm&lt;/code&gt;, &lt;code&gt;kubelet&lt;/code&gt; and &lt;code&gt;kubectl&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Install the HAproxy in &lt;code&gt;newton - 192.168.101.1&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt-get install haproxy -y
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;## put this text in /etc/haproxy/haproxy.cfg&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;frontend kube-apiserver
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  bind 192.168.101.1:6443
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  mode tcp
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  option tcplog
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  default_backend kube-apiserver
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;backend kube-apiserver
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    mode tcp
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    option tcp-check
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    balance source
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    server k8s-master1 192.168.102.1:6443 check fall &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt; rise &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    server k8s-master2 192.168.102.2:6443 check fall &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt; rise &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    server k8s-master2 192.168.103.1:6443 check fall &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt; rise &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Run the &lt;code&gt;kubeadm init&lt;/code&gt; in the first control node, here is my modified script:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo kubeadm init &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;	--kubernetes-version 1.26.0 &lt;span style=&#34;color:#ae81ff&#34;&gt;\ &lt;/span&gt;               
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	--control-plane-endpoint 192.168.101.1:6443 &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;	--apiserver-advertise-address 192.168.102.1 &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;	--upload-certs &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;	--service-cidr&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;10.96.0.0/12 &lt;span style=&#34;color:#ae81ff&#34;&gt;\ &lt;/span&gt;   &lt;span style=&#34;color:#75715e&#34;&gt;# (optional)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	--pod-network-cidr&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;10.244.0.0/16 &lt;span style=&#34;color:#ae81ff&#34;&gt;\ &lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;# (optional)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	--image-repository registry.cn-hangzhou.aliyuncs.com/google_containers &lt;span style=&#34;color:#ae81ff&#34;&gt;\ &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        --v &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;where &lt;code&gt;--control-plane-endpoint&lt;/code&gt; should be the load-balancer&amp;rsquo;s IP, and &lt;code&gt;--apiserver-advertise-address&lt;/code&gt; should be local IP; &lt;code&gt;--image-repository&lt;/code&gt; is specify the repository, which is helpful for the user who cannot access &lt;code&gt;registry.k8s.io&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Wait for a while, if you can see the output like this, it means that you have successfully install the Kubernetes on the first machine:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Your Kubernetes control-plane has initialized successfully!
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;To start using your cluster, you need to run the following as a regular user:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  mkdir -p $HOME/.kube
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  sudo chown &lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;id -u&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt;:&lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;id -g&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt; $HOME/.kube/config
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Alternatively, &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; you are the root user, you can run:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  export KUBECONFIG&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;/etc/kubernetes/admin.conf
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;You should now deploy a pod network to the cluster.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Run &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;kubectl apply -f [podnetwork].yaml&amp;#34;&lt;/span&gt; with one of the options listed at:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  https://kubernetes.io/docs/concepts/cluster-administration/addons/
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;You can now join any number of the control-plane node running the following command on each as root:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  kubeadm join 192.168.101.1:6443 --token xxxxxxxxxxxxxxxxxxxxxxxxx &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;	--discovery-token-ca-cert-hash sha256:xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;	--control-plane --certificate-key xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Please note that the certificate-key gives access to cluster sensitive data, keep it secret!
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;As a safeguard, uploaded-certs will be deleted in two hours; If necessary, you can use
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;kubeadm init phase upload-certs --upload-certs&amp;#34;&lt;/span&gt; to reload certs afterward.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Then you can join any number of worker nodes by running the following on each as root:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kubeadm join 192.168.101.1:6443 --token xxxxxxxxxxxxxxxxxxxxxx &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;	--discovery-token-ca-cert-hash sha256:xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This output show three points:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;How to load the &lt;code&gt;KUBECONFIG&lt;/code&gt; to current user&amp;rsquo;s home directory&lt;/li&gt;
&lt;li&gt;How to add worker nodes to this cluster&lt;/li&gt;
&lt;li&gt;How to add other control-plane to this cluster&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;You can see that the output only give one certificate for worker/control node, however, we have multiple work/control nodes, thus, we need to generate token and certificates for each of them:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;For the worker node: &lt;code&gt;sudo kubeadm token create --print-join-command&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;For other control-plane node: &lt;code&gt;echo &amp;quot;$(sudo kubeadm token create --print-join-command) --control-plane --certificate-key $(sudo kubeadm init phase upload-certs --upload-certs | tail -1)&amp;quot;&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Copy the output to each corresponding nodes and run the script, wait for a while and you can see it works.&lt;/p&gt;
&lt;h2 id=&#34;troubleshooting&#34;&gt;Troubleshooting&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;How to Install Helm for the user who cannot access &lt;code&gt;GitHub&lt;/code&gt;: &lt;code&gt;wget https://goodrain-pkg.oss-cn-shanghai.aliyuncs.com/pkg/helm &amp;amp;&amp;amp; chmod +x helm &amp;amp;&amp;amp; sudo mv helm /usr/local/bin/&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;How to change node&amp;rsquo;s &lt;code&gt;InternalIP&lt;/code&gt;: Go to &lt;code&gt;/var/lib/kubelet/kubeadm-flags.env&lt;/code&gt;, add &lt;code&gt;--node-ip=xxx.xxx.xxx.xxx&lt;/code&gt; at the end of &lt;code&gt;BELET_KUBEADM_ARGS&lt;/code&gt; and &lt;code&gt;sudo systemctl restart kubelet&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;</description>
    </item>
    
    <item>
      <title>ğŸ§‘ğŸ¿â€ğŸ’» Homelab: My Distributed Homelab (2)</title>
      <link>https://blog.cklau.cc/post/my-homelab-6/</link>
      <pubDate>Tue, 24 Jan 2023 00:11:21 +0800</pubDate>
      <guid>https://blog.cklau.cc/post/my-homelab-6/</guid>
      <description>&lt;h2 id=&#34;before&#34;&gt;Before&lt;/h2&gt;
&lt;p&gt;I built a distributed Homelab, which is not good enough, where&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;I set up multiple endpoints to forfill the connection of Mainland China&amp;rsquo;s connection and other countries&amp;rsquo; with two CDN (Tencent CDN and Cloudflare)&lt;/li&gt;
&lt;li&gt;The network bottleneck is in the BGP router, where the machine in GZ is only 6Mbps&lt;/li&gt;
&lt;li&gt;Distributed storage, but not connected&lt;/li&gt;
&lt;li&gt;Some of them are running Docker, and some are running K3s, which is not a bad thing, but I want a dashboard to centralized the server configuration&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Thus, I need to re-design the architecture:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Buy a new VM, which has 100Mbps (dynamic) to replace GZ machine - Done&lt;/li&gt;
&lt;li&gt;Network re-design, how to maximize the usage of each machine&amp;rsquo;s bandwith&lt;/li&gt;
&lt;li&gt;Set up a root DNS server, to &amp;ldquo;hijack&amp;rdquo; the local domain - based on &lt;a href=&#34;https://www.powerdns.com/&#34;&gt;PowerDNS&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Build a distributed object storage system as the underlay of the file system - based on &lt;a href=&#34;https://min.io/&#34;&gt;MinIO&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;network-re-design&#34;&gt;Network Re-design&lt;/h2&gt;
&lt;p&gt;Since I have multiple different server in differnt locations, I still keep them into different ASN:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;AS4242101 - CN-SOUTH-1 (Guangzhou, China) - 192.168.101.0/24&lt;/li&gt;
&lt;li&gt;AS4242102 - CN-EAST-1 (Shanghai, China) - 192.168.102.0/24&lt;/li&gt;
&lt;li&gt;AS4242103 - AP-EAST-1 (HKSAR, China) - 192.168.103.0/24&lt;/li&gt;
&lt;li&gt;AS4242104 - AP-SOUTHEAST-1 (Mumbai, India) - 192.168.104.0/24&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Previously, &lt;code&gt;AS4242104&lt;/code&gt; is the machines located in Japan, however, during the Spring Festival, I accidentlly got the quota of ARM machines from Oracle Cloud, thus, I replace the machine X86 machines from Japan to ARM machines to Mumbai. The ARM machine is much powerful then the free-X86, where it has 2C/12G and the X86 has only 1C/1G.&lt;/p&gt;
&lt;p&gt;Besides, I also includes the intranet of my home into the L-NET. The meaning of &amp;ldquo;include&amp;rdquo; is that they are acting as the client of L-NET.  Therefore, I desided to set up an external tunnel for the &amp;ldquo;user&amp;rdquo; side where the edge access points forward the traffic to the correct machine. However, since clients are using multiple different OS (Windows, Linux, iOS, macOS, Android), I choose &lt;a href=&#34;https://ocserv.gitlab.io/www/&#34;&gt;OCServ&lt;/a&gt; as the tunnel tools for clients, and keep using Wireguard as the backbone VPN. Anyconnect is more compatible to different distribution.&lt;/p&gt;
&lt;h2 id=&#34;self-hosted-dns-server&#34;&gt;Self-hosted DNS Server&lt;/h2&gt;
&lt;p&gt;My domain is hosted on Cloudflare, however, different services are on different machines and the intranet machines do not need to be routed to CF&amp;rsquo;s access points. Thus, The authoritative DNS server is needed to &amp;ldquo;hijack&amp;rdquo; the domain within the L-NET.&lt;/p&gt;
&lt;p&gt;I set up two DNS server in different region as main/backup architecture. In this way, if one server down, the second server can be used as the backup.&lt;/p&gt;
&lt;p&gt;I have tried &lt;a href=&#34;https://www.isc.org/bind/&#34;&gt;Bind9&lt;/a&gt; and &lt;a href=&#34;https://www.powerdns.com/&#34;&gt;PowerDNS&lt;/a&gt;. Both are easy if we deploy them via Docker:&lt;/p&gt;
&lt;h3 id=&#34;bind9-dns-service&#34;&gt;Bind9 DNS Service&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;version&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;3&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;services&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;bind9&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;container_name&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;dns-aristotle&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;image&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;ubuntu/bind9:latest&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;environment&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;BIND9_USER=root&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;TZ=Asia/Shanghai&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;ports&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;192.168.103.1:53:53/tcp&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;# bind to the wireguard IP addr&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;192.168.103.1:53:53/udp&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;volumes&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;./config:/etc/bind&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;./cache:/var/cache/bind&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;./records:/var/lib/bind&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;restart&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;always&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;## master DNS server - 192.168.103.1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;acl internal &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    192.168.100.0/20;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;options &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    allow-query &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt; internal; &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    allow-transfer &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt; internal; &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    allow-notify &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt; 192.168.101.2; &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;; &lt;span style=&#34;color:#75715e&#34;&gt;# 192.168.101.2 is the second DNS server&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;zone &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;local.cklau.cc&amp;#34;&lt;/span&gt; IN &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    type slave;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    masters &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt; 192.168.103.1; &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    file &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/etc/bind/local.cklau.cc.zone&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$TTL 2d
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;$ORIGIN cklau.cc.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;@               IN      SOA     ns.cklau.cc. info.cklau.cc &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                &lt;span style=&#34;color:#ae81ff&#34;&gt;2022122800&lt;/span&gt;      ; serial
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                12h             ; refresh
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                15m             ; retry
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                3w              ; expire
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                3h              ; minimum ttl
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                                &lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		IN 	NS	ns1.cklau.cc.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		IN 	NS	ns2.cklau.cc.
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ns1             IN      A       192.168.103.1
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ns2             IN      A       192.168.101.2
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;;	-- cn-south-1
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;newton		IN	A	192.168.101.1
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;aristotle	IN	A	192.168.101.2
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;riemann		IN 	A	192.168.101.3
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;;	-- cn-east-1
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;hilbert		IN	A	192.168.102.1
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;;	-- ap-east-1
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;freud		IN	A	192.168.103.1
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;;	-- ap-south-1	
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;einstein	IN	A	192.168.104.1
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;;	-- application
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;auth		IN	A	192.168.100.46
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;git			IN	A	192.168.101.3
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;powerdns-and-adguard-home&#34;&gt;PowerDNS and Adguard Home&lt;/h3&gt;
&lt;p&gt;I just follow the instructure from &lt;a href=&#34;https://u.sb/debian-install-powerdns/&#34;&gt;Debian 11 / Ubuntu 22.04 å®‰è£… PowerDNS å’Œ PowerDNS-Admin è‡ªå»ºæƒå¨ DNS æ•™ç¨‹&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;As soon as I set up the PowerDNS, I use as as one of the upstream DNS servers of my Adguard Home. With the PowerDNS, I can easily control the domain resolution inside the intranet. Here is the example of DNS setting in Adg:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;/cloud.cklau.cc/&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;192.168.101.2
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;1.1.1.1
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;1.0.0.1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;storage-and-file-system&#34;&gt;Storage and File system&lt;/h2&gt;
&lt;p&gt;Previously, I use Nextcloud as my webdrive, however, since there is a uploading limition in Cloudflare&amp;rsquo;s TOS, the Nextcloud is not suitable for using CDN. I replaced it with &lt;a href=&#34;https://www.seafile.com/en/home/&#34;&gt;Seafile&lt;/a&gt; as it is fast and simple. Yes, NextCloud can provide more features, but its performance is not good enough, sometimes the web interface take around 5-10sec to load for each action you perform. I am not familiar with PHP thus, I just kept the default settings of the page response, which may cause the performance issue.&lt;/p&gt;
&lt;p&gt;I migrated the storage to Seafile, which natively support block storage and end-to-end encryption. The Chunk uploading mechanism may bypass the uploading limit of Cloudflare. I test it several time by uploading cuple large files and all of them passed. (Some intrstruction says it may not, but in my case it does)&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;version&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;2.0&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;services&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;db&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;image&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;mariadb:10.1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;container_name&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;seafile-mysql&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;environment&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;MYSQL_ROOT_PASSWORD=seafile&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;MYSQL_LOG_CONSOLE=true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;volumes&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;./mysql:/var/lib/mysql&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;networks&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;seafile-net&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;restart&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;always&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;memcached&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;image&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;memcached:1.6&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;container_name&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;seafile-memcached&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;entrypoint&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;memcached -m 256&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;networks&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;seafile-net&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;restart&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;always&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;seafile&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;image&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;seafileltd/seafile-mc:latest&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;container_name&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;seafile&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#75715e&#34;&gt;#command: pip install requests_oauthlib&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;ports&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;9999:80&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;volumes&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;/mnt/storage/seafile:/shared&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;environment&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;DB_HOST=db&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;DB_ROOT_PASSWD=seafile&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;TIME_ZONE=Etc/UTC&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;SEAFILE_ADMIN_EMAIL=&amp;lt;admin-email&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;SEAFILE_ADMIN_PASSWORD=&amp;lt;admin-password&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;SEAFILE_SERVER_LETSENCRYPT=false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;SEAFILE_SERVER_HOSTNAME=seafile.example.com&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;depends_on&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;db&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;memcached&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;networks&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;seafile-net&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;restart&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;always&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;networks&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;seafile-net&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Also, seafile natively support Single-Sign-on with LDAP and OAuth2, by following the &lt;a href=&#34;https://manual.seafile.com/deploy/oauth/&#34;&gt;Manual&lt;/a&gt;&amp;rsquo;s instruction. The configuration path is: &lt;code&gt;/opt/seafile/conf/seahub_settings.py&lt;/code&gt;.&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>ğŸ‘¨â€ğŸ’» My Personal Experimental Network: L-Net 1.2</title>
      <link>https://blog.cklau.cc/post/lnet-3/</link>
      <pubDate>Tue, 03 Jan 2023 00:16:21 +0800</pubDate>
      <guid>https://blog.cklau.cc/post/lnet-3/</guid>
      <description>&lt;h2 id=&#34;before&#34;&gt;Before&lt;/h2&gt;
&lt;p&gt;In the previous project: &lt;a href=&#34;https://blog.cklau.cc/post/lnet-2/&#34; title=&#34;My Personal Experimental Network&#34;&gt;Homelab&lt;/a&gt;, I upgraded my configuration on the L-Net, where I tried eBGP and iBGP for the routing exchange between different subnet.&lt;/p&gt;
&lt;p&gt;However, since, there are too many interface in the backbone device. In this post, I tried to build a overlay network with VXLAN over Wireguard.&lt;/p&gt;
&lt;h2 id=&#34;vxlan&#34;&gt;VXLAN&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;VXLAN, Virtual eXtensible LAN is a network virtualization technology that attempts to address the scalability problems associated with large cloud computing deployments. It uses a VLAN-like encapsulation technique to encapsulate OSI layer 2 Ethernet frames within layer 4 UDP datagrams, using 4789 as the default IANA-assigned destination UDP port number.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;In short, it is a extension for VLAN where VLAN only use 12 bit and can only cantains 4094 VLANs, however, VXLAN use 24-bit (VNI, vxlan network identfier) which can allows more vlan as it has a large MAC address tables. However, in my scenario, I build vxlan over wireguard just because vxlan interface is on layer 2 where it contains MAC address which provide more flexibility, e.g. multicast, broadcast, and etc..&lt;/p&gt;
&lt;h3 id=&#34;point-to-point-vxlan&#34;&gt;Point to Point VXLAN&lt;/h3&gt;
&lt;p&gt;Assumes that there are two machines: A wth &lt;code&gt;192.168.100.100/32&lt;/code&gt; and B with &lt;code&gt;192.168.100.101/32&lt;/code&gt;, and we want to create a overlay CIDR &lt;code&gt;10.100.0.0/24&lt;/code&gt;.  To do so, first we need to create the vxlan interface &lt;code&gt;vxlanAB&lt;/code&gt; in each machine, assign the ip to the interface and set up the interace:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# for machine A&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ip link add vxlanAB type vxlan id &lt;span style=&#34;color:#ae81ff&#34;&gt;42&lt;/span&gt; dstport &lt;span style=&#34;color:#ae81ff&#34;&gt;4789&lt;/span&gt; remote 192.168.100.101 local 192.168.100.100 dev eth0
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ip addr add 10.100.0.1/24 dev vxlanAB
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ip link set vxlanAB up
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# for machine B&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ip link add vxlanAB type vxlan id &lt;span style=&#34;color:#ae81ff&#34;&gt;42&lt;/span&gt; dstport &lt;span style=&#34;color:#ae81ff&#34;&gt;4789&lt;/span&gt; remote 192.168.100.100 local 192.168.100.101 dev eth0
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ip addr add 10.100.0.2/24 dev vxlanAB
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ip link set vxlanAB up
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# try to ping from A to B &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ping 10.100.0.2
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;multicast-vxlan&#34;&gt;Multicast VXLAN&lt;/h3&gt;
&lt;p&gt;If we have three machines, A wth &lt;code&gt;192.168.100.100/32&lt;/code&gt;, B with &lt;code&gt;192.168.100.101/32&lt;/code&gt; and C with &lt;code&gt;192.168.100.102/32&lt;/code&gt;. We can us VXLAN&amp;rsquo;s multicast for auto dscovery by adding the vtep into the multicast group&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# for machine A&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ip link add vxlanABC type vxlan id &lt;span style=&#34;color:#ae81ff&#34;&gt;42&lt;/span&gt; dstport &lt;span style=&#34;color:#ae81ff&#34;&gt;4789&lt;/span&gt; group 239.1.1.1 dev eth0
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ip addr add 10.100.0.1/24 dev vxlanABC
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ip link set vxlanABC up
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# for machine B&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ip link add vxlanABC type vxlan id &lt;span style=&#34;color:#ae81ff&#34;&gt;42&lt;/span&gt; dstport &lt;span style=&#34;color:#ae81ff&#34;&gt;4789&lt;/span&gt; group 239.1.1.1 dev eth0
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ip addr add 10.100.0.2/24 dev vxlanABC
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ip link set vxlanABC up
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# for machine C&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ip link add vxlanABC type vxlan id &lt;span style=&#34;color:#ae81ff&#34;&gt;42&lt;/span&gt; dstport &lt;span style=&#34;color:#ae81ff&#34;&gt;4789&lt;/span&gt; group 239.1.1.1 dev eth0
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ip addr add 10.100.0.3/24 dev vxlanABC
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ip link set vxlanABC up
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# try to ping from A to B/C&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ping 192.168.0.&lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;2, 3&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Multicast VXLAN has multiple benefits, for example, auto discovery of other VTEPs shareingthe same multicast group, group bandwidth usage (packets are replaced as late as possible). However, since Wireguard is a Layer 3 tunnel, which means we cannot multicast or broadcast via it. With &lt;code&gt;ifconfig&lt;/code&gt;, it shows: &lt;code&gt;wg0: flags=209&amp;lt;UP,POINTOPOINT,RUNNING,NOARP&amp;gt;  mtu 1420&lt;/code&gt;. In this way we can only build the tunnel with unicast addresses, which can be easily done by using iproute2. We keep the assumption of machines&amp;rsquo; name and ip, and develop a unicast flooding:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Machine A will send a ARP package asking &lt;code&gt;who is 10.100.0.2&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;this package will send to all machines&amp;rsquo; VTEP&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# for machine A&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ip link add vxlanABC type vxlan id &lt;span style=&#34;color:#ae81ff&#34;&gt;42&lt;/span&gt; dstport &lt;span style=&#34;color:#ae81ff&#34;&gt;4789&lt;/span&gt; dev eth0
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;bridge fdb append to 00:00:00:00:00:00 dst 192.168.100.101 dev vxlanABC
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;bridge fdb append to 00:00:00:00:00:00 dst 192.168.100.102 dev vxlanABC
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ip addr add 10.100.0.1/24 dev vxlanABC
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ip link set vxlanABC up
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# for machine B&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ip link add vxlanABC type vxlan id &lt;span style=&#34;color:#ae81ff&#34;&gt;42&lt;/span&gt; dstport &lt;span style=&#34;color:#ae81ff&#34;&gt;4789&lt;/span&gt; dev eth0
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;bridge fdb append to 00:00:00:00:00:00 dst 192.168.100.100 dev vxlanABC
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;bridge fdb append to 00:00:00:00:00:00 dst 192.168.100.102 dev vxlanABC
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ip addr add 10.100.0.1/24 dev vxlanABC
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ip link set vxlanABC up
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# for machine C&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ip link add vxlanABC type vxlan id &lt;span style=&#34;color:#ae81ff&#34;&gt;42&lt;/span&gt; dstport &lt;span style=&#34;color:#ae81ff&#34;&gt;4789&lt;/span&gt; dev eth0
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;bridge fdb append to 00:00:00:00:00:00 dst 192.168.100.100 dev vxlanABC
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;bridge fdb append to 00:00:00:00:00:00 dst 192.168.100.101 dev vxlanABC
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ip addr add 10.100.0.1/24 dev vxlanABC
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ip link set vxlanABC up
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;In this scheme, we set up a unknown-unicast traffic, where a machine recives unicast traffic intended to be delivered to a destination that is not in its forwarding information base, which means every machine in the network will receive the VXLAN message, we can use &lt;code&gt;tcpdump -vni vxlanABC&lt;/code&gt; to check this message:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;20:19:56.674410 ARP, Ethernet &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;len 6&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;, IPv4 &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;len 4&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;, Request who-has 10.100.0.1 tell 10.100.0.2, length &lt;span style=&#34;color:#ae81ff&#34;&gt;28&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;20:19:56.706706 ARP, Ethernet &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;len 6&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;, IPv4 &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;len 4&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;, Reply 10.100.0.1 is-at 4e:b8:1f:b5:df:6f, length &lt;span style=&#34;color:#ae81ff&#34;&gt;28&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;With this solution, the machine can receives all the MAC-IP to FDB after a while.&lt;/p&gt;
&lt;h2 id=&#34;l-net-12&#34;&gt;L-Net 1.2&lt;/h2&gt;
&lt;p&gt;Previously, I set up multiple wireguard tunnels for establishing the backbone network. However,  dozen of interfaces is ok but not elegant. Also, if we want to develop a full-mesh network, we need $2n-2$ tunnels for $n$ nodes. With the implemenetation of VXLAN over Wireguard, the underlay full-mesh network(wireguard) can be easily developed.&lt;/p&gt;
&lt;p&gt;In wireguard configuration, we can use &lt;code&gt;PreUp/PostUp - PreDown/PostDown&lt;/code&gt; command to set up ip route before/after the wireguard interface up/down. Thus, we can set up the vxlan configuration inside the wireguard configuration. Under this configuration, we no longer care about the wireguard&amp;rsquo;s ip addr, instead, we are using the vxlan&amp;rsquo;s ip addr. Here is an example:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;Interface&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Address &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; 192.168.228.166/24
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ListenPort &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;51820&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;PrivateKey &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &amp;lt;pri-key&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Table &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; off
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;PostUp &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; ip link add v%i type vxlan id &lt;span style=&#34;color:#ae81ff&#34;&gt;49371&lt;/span&gt; dstport &lt;span style=&#34;color:#ae81ff&#34;&gt;4789&lt;/span&gt; ttl &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; dev %i
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;PostUp &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; bridge fdb append to 00:00:00:00:00:00 dst 192.168.228.128 dev v%i
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;PostUp &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; bridge fdb append to 00:00:00:00:00:00 dst 192.168.228.60 dev v%i
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;PostUp &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; ip address add 192.168.102.1/24 dev v%i
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;PostUp &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; ip address add fde9:632e:2c3f:0:62bb:bbe3:3778:37ad/64 dev v%i
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;PostUp &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; ip link set v%i up
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;PreDown &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; ip link set v%i down
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;PreDown &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; ip link delete v%i
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;Peer&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Name = gauss&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;PublicKey &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &amp;lt;pub-key&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;AllowedIPs &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; 192.168.228.128/32
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;PersistentKeepalive &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;25&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Endpoint &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; xxx.xxx.xxx.xxx:51820
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;Peer&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Name = hilbert&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;PublicKey &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &amp;lt;pub-key&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;AllowedIPs &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; 192.168.228.60/32
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;PersistentKeepalive &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;25&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Endpoint &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; xxx.xxx.xxx.xxx:51820
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Since, the vxlan&amp;rsquo;s traffic is over wireguard&amp;rsquo;s interface, intuitively, I use &lt;code&gt;PostUp&lt;/code&gt; in the configuration. By following the &lt;em&gt;unicast flooding&lt;/em&gt; configuration, we can set up the vxlan inside the wireguard config file. For the router, we can keep &lt;code&gt;iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE&lt;/code&gt; in the &lt;code&gt;PostUp&lt;/code&gt; as we are trying to use it as the gateway for network traffic.&lt;/p&gt;
&lt;p&gt;Based on the experience above, I modify the &lt;a href=&#34;https://github.com/TerenceLiu98/wgtools/tree/vxlan&#34;&gt;wgtools&lt;/a&gt; to fit the demands. In the new branch, we did not care about the wireguard&amp;rsquo;s addr, instead, we focus on the vxlan&amp;rsquo;s addr. Thus, I just use &lt;code&gt;192.168.200.0/16&lt;/code&gt; for generate the wg connection. For the rest part are basically the same from the previous.&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>ğŸ‘¨â€ğŸ’» My Personal Experimental Network: L-Net 1.1</title>
      <link>https://blog.cklau.cc/post/lnet-2/</link>
      <pubDate>Mon, 26 Dec 2022 00:16:21 +0800</pubDate>
      <guid>https://blog.cklau.cc/post/lnet-2/</guid>
      <description>&lt;h2 id=&#34;before&#34;&gt;Before&lt;/h2&gt;
&lt;p&gt;In the previous project: &lt;a href=&#34;https://blog.cklau.cc/post/lnet-1/&#34; title=&#34;My Personal Experimental Network&#34;&gt;Homelab&lt;/a&gt;, I create a experimental network and I call it L-Net 1.0. However, I am trying to redesign the network as I am trying to maximize the usage of all the bandwidth,  route auto-correction, and manage the resources based on one machine outside the cluster. Here is the diagram:&lt;/p&gt;
&lt;p&gt;Here, as usual, I made three network areas, â€œEast-Asia-CNâ€ is &lt;code&gt;192.168.101.0/24&lt;/code&gt; , â€œSoutheast-Asia-HKSARâ€œ is &lt;code&gt;192.168.102.0/24&lt;/code&gt;, and â€œEast-Aisa-JPâ€œ is &lt;code&gt;192.168.103.0/24&lt;/code&gt;.  As you can see, I draw three routers in the diagram, but it is four, and I will explain why. For the backbone network, For Mainland China $\Leftrightarrow$ HKSAR is &lt;code&gt;10.255.101.0/24&lt;/code&gt;,  Mainland China $\Leftrightarrow$ Japan is &lt;code&gt;10.255.102.0/24&lt;/code&gt; and Japan $\Leftrightarrow$ HKSAR  is &lt;code&gt;10.255.103.0/24&lt;/code&gt;. One more thing, I combine my Singapore server into the â€œSoutheast-Asia-HKâ€œ network as I only have one server in South Asia, and the combination can reduce multiple configurations.&lt;/p&gt;
&lt;h2 id=&#34;howto&#34;&gt;HOWTO&lt;/h2&gt;
&lt;h2 id=&#34;wireguard&#34;&gt;Wireguard&lt;/h2&gt;
&lt;p&gt;Yes, I still use my script &lt;a href=&#34;https://github.com/TerenceLiu98/wgtools&#34;&gt;wgtools&lt;/a&gt; to generate the Wireguard configuration. However, if we try to use iBGP inside the network area, we need to create a star-shaped network and disable changing the routing table. Here is an example:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#################################&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#### Configuration of router ####&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#################################&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;Interface&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Address &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; 192.168.101.1/32,fd4f:3f1f:d743:0:ccce:d274:c262:ff9b/128
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ListenPort &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;51820&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;PrivateKey &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &amp;lt;router-private-key&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Table &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; off
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;Peer&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Name = node-1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;PublicKey &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &amp;lt;node-1-public-key&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;AllowedIPs &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; 192.168.101.2/32,fd4f:3f1f:d743:0:f8e3:c5be:c0fa:dd2f/128
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;PersistentKeepalive &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;25&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Endpoint &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &amp;lt;node-1-ip-address&amp;gt;:51820
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;Peer&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Name = node-2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;PublicKey &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &amp;lt;node-3-public-key&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;AllowedIPs &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; 192.168.101.3/32,fd4f:3f1f:d743:0:8174:fd0f:3627:4c50/128
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;PersistentKeepalive &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;25&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Endpoint &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &amp;lt;node-2-ip-address&amp;gt;:51820
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#################################&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#### Configuration of node-1 ####&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#################################&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;Interface&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Address &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; 192.168.101.1/32,fd4f:3f1f:d743:0:ccce:d274:c262:ff9b/128
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ListenPort &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;51820&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;PrivateKey &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &amp;lt;node-1-private-key&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Table &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; off
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;Peer&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Name = router&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;PublicKey &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &amp;lt;router-public-key&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;AllowedIPs &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; 0.0.0.0/0,::/0
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;PersistentKeepalive &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;25&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Endpoint &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &amp;lt;rnode-1-ip-address&amp;gt;:51820
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;As you can see that we set &lt;code&gt;Table = off&lt;/code&gt;  For routers, we need to set the connection to other nodes; for other nodes, we need to set the &lt;code&gt;AllowedIPs = 0.0.0.0/0, ::/0&lt;/code&gt; to allow routing based on the iBGP.&lt;/p&gt;
&lt;h3 id=&#34;ebgp-and-ibgp&#34;&gt;eBGP and iBGP&lt;/h3&gt;
&lt;p&gt;After setting up the Wirewuard, we need to set up the eBGP and iBGP. Let&amp;rsquo;s set up the iBGP first:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt-get install bird2 &lt;span style=&#34;color:#75715e&#34;&gt;# install bird2 in both routers and nodes&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Create template &lt;code&gt;sudo vim /etc/bird/template.conf&lt;/code&gt;, by creating a template we can import the template for duplicated setting:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# https://bird.network.cz/?get_doc&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;define LOCAL_ASN &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &amp;lt;net-area-ASN&amp;gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;define NET &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;[]&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;# mark down all the ip in all the net area&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;template bgp tpl_ibgp &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    local as LOCAL_ASN; &lt;span style=&#34;color:#75715e&#34;&gt;# &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    med metric on;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    path metric on;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    error wait time 5, 10; &lt;span style=&#34;color:#75715e&#34;&gt;# Minimum and maximum delay in seconds between a protocol failure (either local or reported by the peer) and automatic restart. Doesn not apply when disable after error is configured. If consecutive errors happen, the delay is increased exponentially until it reaches the maximum. Default: 60, 300.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    error forget time 20; &lt;span style=&#34;color:#75715e&#34;&gt;# Maximum time in seconds between two protocol failures to treat them as a error sequence which makes error wait time increase exponentially.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    multihop 1;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    graceful restart on;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ipv4 &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        import filter &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; net ~ NET &lt;span style=&#34;color:#66d9ef&#34;&gt;then&lt;/span&gt; accept;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            reject;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        export filter &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; net ~ NET &lt;span style=&#34;color:#66d9ef&#34;&gt;then&lt;/span&gt; accept;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            reject;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        next hop self;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        gateway recursive; &lt;span style=&#34;color:#75715e&#34;&gt;# since we are using multihop we cannot use gateway direct&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Set up the &lt;code&gt;/etc/bird/bird.conf&lt;/code&gt;:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;#############
# for router:
router id &amp;lt;router-id&amp;gt;;

include &amp;#34;/etc/bird/template.conf&amp;#34;;

protocol device {
    scan time 5;
}

protocol kernel {
    ipv4 {
        import all;
        export all;
    };
    merge paths on;
}

protocol direct {
    ipv4;
    interface &amp;#34;&amp;lt;wg-interface-name&amp;gt;&amp;#34;;
}

protocol static cn {
    ipv4;
    route &amp;lt;node-1-ip&amp;gt; via &amp;#34;&amp;lt;wg-interface-name&amp;gt;&amp;#34;;
    route &amp;lt;node-2-ip&amp;gt; via &amp;#34;&amp;lt;wg-interface-name&amp;gt;&amp;#34;;
}

protocol bgp cantor from tpl_ibgp {
    neighbor &amp;lt;node-2-ip&amp;gt; internal;
    rr client;
}


#############
# for node 1:
router id &amp;lt;node-1-id&amp;gt;;

include &amp;#34;/etc/bird/template.conf&amp;#34;;

protocol device {
    scan time 5;
}

protocol kernel {
    ipv4 {
        import all;
        export all;
    };
    merge paths on;
}

protocol direct {
    ipv4;
    interface &amp;#34;&amp;lt;wg-interface-name&amp;gt;&amp;#34;;
}

protocol static cn {
    ipv4;
    route &amp;lt;router-ip&amp;gt; via &amp;#34;&amp;lt;wg-interface-name&amp;gt;&amp;#34;;
}

protocol bgp cantor from tpl_ibgp {
    neighbor &amp;lt;router-ip&amp;gt; internal;
    rr client;
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Here you can see that we create a static route between the router and node-1, and this could be seen as the &lt;code&gt;PostUp = ip addr add &amp;lt;local-ip&amp;gt; peer &amp;lt;remote-ip&amp;gt; dev %i&lt;/code&gt;  in Wireguard configuration.  After the configuration of bird we can simply use &lt;code&gt;sudo birdc c &amp;amp;&amp;amp; sudo birc show protocols&lt;/code&gt; to check whether the iBGP is established.&lt;/p&gt;
&lt;p&gt;For the eBGP part, it is similar to the iBGP part, we need a template and settings:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;### At Template in Both router-1 and router-2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# https://bird.network.cz/?get_doc&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;define LOCAL_ASN &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &amp;lt;net-area-ASN&amp;gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;define NET &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;[]&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;# mark down all the ip in all the net area&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;template bgp tpl_ebgp &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    local as LOCAL_ASN;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    path metric 1;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    direct;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    graceful restart on;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ipv4 &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        import filter &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; net ~ NET &lt;span style=&#34;color:#66d9ef&#34;&gt;then&lt;/span&gt; accept;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            reject;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        export filter &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; net ~ NET &lt;span style=&#34;color:#66d9ef&#34;&gt;then&lt;/span&gt; accept;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            reject;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        next hop self;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        gateway direct;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;For the settings:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;############# /etc/bird/bird.conf&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# for router-1:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# ... add a new protocol bgp &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;protocol bgp area1_area_2 from tpl_ebgp &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    neighbor &amp;lt;router2-ip&amp;gt; as router2_ASN;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;############# /etc/bird/bird.conf&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# for router-2:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# ... add a new protocol bgp &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;protocol bgp area_2_area_1 from tpl_ebgp &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    neighbor &amp;lt;router1-ip&amp;gt; as router1_ASN;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;After the configuration, we can easily build a link-local and pseudo-link-global network by using the BGP protocol. In these configurations, I use IP address as the filter, you may try ASN as the filter, here is an example,&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;filter FILTER_ASN
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;int set accept_asn; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    accept_asn &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;area1_ASN, area2_ASN, area3_ASN&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; bgp_path.last ~ accept_asn &lt;span style=&#34;color:#66d9ef&#34;&gt;then&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        accept;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    reject;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;template bgp tpl_ebgp &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    local as LOCAL_ASN;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    path metric 1;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    direct;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    graceful restart on;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ipv4 &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        import filter FILTER_ASN;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        export filter FILTER_ASN;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        next hop self;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        gateway direct;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Here are some points you may concern about:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;If your router is needed to be attached, the backbone networkâ€™s CIDR needs to be accepted by the BGP, I try multiple times but I did not fix this issue.&lt;/li&gt;
&lt;li&gt;Inside a network area, all nodes are in a  star topology network and the router is the root node. This means if the router is down, the connections between nodes are also down. You may use wgsd to establish a direct connection inside the network area.&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;wireguard-multiplexing&#34;&gt;Wireguard multiplexing?&lt;/h2&gt;
&lt;p&gt;In the standard Wireguard, each interface corresponds to one port and if we have multiple different settings configuration we may lost in the port selection or just do not remember the which port percisely link to the interface. Under this circumstance, I use &lt;a href=&#34;https://github.com/ginuerzh/gost&#34;&gt;gost&lt;/a&gt; to aggregate the interfaces&amp;rsquo; ports into one port.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# download the latest version from github&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;wget https://github.com/ginuerzh/gost/releases/download/v2.11.4/gost-linux-amd64-2.11.4.gz
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;gzip -d gost-linux-amd64-2.11.4.gz
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo mv gost-linux-amd64-2.11.4 /usr/local/bin/gost &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sudo chmow +x /usr/local/bin/gost
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo cat &amp;gt; /etc/systemd/system/gost.service &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;lt;&amp;lt; EOF
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;[Unit]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;Description=Gost Proxy
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;After=network.target
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;Wants=network.target
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;[Service]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;Type=simple
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;ExecStart=/usr/local/bin/gost -C /etc/gost/config.json
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;Restart=always
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;[Install]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;WantedBy=multi-user.target
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mkdir /etc/gost
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cat &amp;gt; /etc/gost/config.json &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;lt;&amp;lt; EOF
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;    &amp;#34;Debug&amp;#34;: true,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;    &amp;#34;Retries&amp;#34;: 0,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;    &amp;#34;ServeNodes&amp;#34;: [
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;        &amp;#34;udp://:51820/127.0.0.1:51821,127.0.0.1:51822,127.0.0.1:21823&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;    ]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo systemctl enable --now gost
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Then, we can use &lt;code&gt;51820&lt;/code&gt; for all three interface&amp;rsquo;s connection.&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>ğŸ§‘ğŸ¿â€ğŸ’» Homelab: How to build a AIO home-server</title>
      <link>https://blog.cklau.cc/post/my-homelab-5/</link>
      <pubDate>Mon, 24 Oct 2022 00:11:21 +0800</pubDate>
      <guid>https://blog.cklau.cc/post/my-homelab-5/</guid>
      <description>&lt;h2 id=&#34;before&#34;&gt;Before&lt;/h2&gt;
&lt;p&gt;I buy this machine for multiple reasons, but must importantly, the previous NAS is built on a very old machine and the disk are &amp;ldquo;second-hand&amp;rdquo;, thus, I am not sure the stability of the old guy. And I got my bonus of the previous project, so I just spent the money on this bunch of hardware. For this time, I don&amp;rsquo;t want it be a pure NAS, and it should be a ALL-IN-ONE machine.&lt;/p&gt;
&lt;h2 id=&#34;hardware&#34;&gt;Hardware&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Module&lt;/th&gt;
&lt;th&gt;Series&lt;/th&gt;
&lt;th&gt;Price&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;CPU + Motherboard&lt;/td&gt;
&lt;td&gt;Intel Xeon D-1581 + &lt;a href=&#34;https://www.huoshen99.com/&#34;&gt;HSGM D1581-R3&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;Â¥498&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Memory&lt;/td&gt;
&lt;td&gt;second-hand ECC DDR3 1600 16GB $\times$ 4&lt;/td&gt;
&lt;td&gt;Â¥79&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Graphic card&lt;/td&gt;
&lt;td&gt;Old NVIDIA RTX 2060&lt;/td&gt;
&lt;td&gt;Â¥0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Storage-SSD&lt;/td&gt;
&lt;td&gt;DAHUA C900 512GB&lt;/td&gt;
&lt;td&gt;Â¥245&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Storage-HDD&lt;/td&gt;
&lt;td&gt;TOSHIBA MG04ACA400N 4T $\times$ 4&lt;/td&gt;
&lt;td&gt;Â¥1340&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Case&lt;/td&gt;
&lt;td&gt;not named&lt;/td&gt;
&lt;td&gt;Â¥399&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Total&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;Â¥2561&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;The reason I chose Xeon D-1581 is that I do not expect playing games or running some programs that expect high performance of single-core on this machine, instead, I need multiple cores for virtural machine for some experiment, where I don&amp;rsquo;t need to spend money on the VPS. This is also explain why I need 64GB for RAM. For the storage part, I split the 4 hard disk into two group and each group has 2 disk, the group 1 I create a raid 1 for the important file storage, like photos, documentation and my code; the group 2 I create a LVM volume for daily storage, for example, the movie, music, and etc..&lt;/p&gt;
&lt;h2 id=&#34;software&#34;&gt;Software&lt;/h2&gt;
&lt;p&gt;I use Ubuntu 22.04 LTS as my base system, there is no reason/explanation, I familiar with ubuntu and I trust it can do a great job in the long-time task. Here is the configuration I have done on this machine:&lt;/p&gt;
&lt;h3 id=&#34;nvidia-driver-and-cuda&#34;&gt;NVIDIA DRIVER and CUDA&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# check PCI &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo lspci -v | grep -i nvidia
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# update &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt-get update &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sudo apt-get upgrade -y
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# install nv driver&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt-get install nvidia-driver-510 &lt;span style=&#34;color:#75715e&#34;&gt;# for some reason I use 510 as I found it is the most stable in my system&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# install nv cuda toolkit&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt-get install nvidia-cuda-toolkit
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# install nvidia-container-toolkit&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;curl -s -L https://nvidia.github.io/libnvidia-container/gpgkey | sudo apt-key add -
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;echo &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;deb https://nvidia.github.io/libnvidia-container/stable/ubuntu20.04/$(ARCH) /&amp;#39;&lt;/span&gt; | sudo tee /etc/apt/sources.list.d/nvidia-container-toolkit.list
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt-get update &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sudo apt-get install nvidia-container-toolkit
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo reboot
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# after rebooting, verify that the GPU is working or not:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;nvidia-smi &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; nvcc -V
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;container-lxc-and-lxd&#34;&gt;Container: LXC and LXD&lt;/h3&gt;
&lt;p&gt;LXC stands for Linux Containers, I choose using the LXC as it can be easily used in PCI passthrough by just follow the above instruction and install the &lt;code&gt;nvidia-container-toolkit&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# install lxd&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo snap install lxd
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# create a zfs storage pool&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt install zfsutils-linux
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo zpool create -f &amp;lt;pool-name&amp;gt; &amp;lt;your disk&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;## if you need raid 1:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo zpool create -f &amp;lt;pool-name&amp;gt; /dev/&amp;lt;disk-1&amp;gt; /dev/&amp;lt;disk-2&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# lxd initilization&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo lxd init
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# specify the storage pool to the pool that just create before&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# create a template profile check the meaning of the command before you use it&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;lxc profile create &amp;lt;template-name&amp;gt;                      &lt;span style=&#34;color:#75715e&#34;&gt;# create a template &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;lxc profile device add pgu-template gpu gpu             &lt;span style=&#34;color:#75715e&#34;&gt;# add the gpu device      &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;lx profile set &amp;lt;template-name&amp;gt; nvidia.runtime&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;true      &lt;span style=&#34;color:#75715e&#34;&gt;# use nvidia-runtime&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;lx profile set &amp;lt;template-name&amp;gt; security.nesting&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;true    &lt;span style=&#34;color:#75715e&#34;&gt;# allow nesting runtime (running ctr inside)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# launch a container&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;lxc launch ubuntu:22.04 &amp;lt;ctr-name&amp;gt; -p &amp;lt;profile-name&amp;gt; -s &amp;lt;lxc-storage-name&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# run nvidia-smi inside the container&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;lxc exec &amp;lt;ctr-name&amp;gt; -- nvidia-smi
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;With the above setting, the container will simply use the same &lt;code&gt;nvidia-driver&lt;/code&gt;, if you want to use the different driver, you can &lt;code&gt;set &amp;lt;template-name&amp;gt; nvidia.runtime=false&lt;/code&gt; and install the driver inside the container.&lt;/p&gt;
&lt;h2 id=&#34;storage-raid1-and-lvm-volume&#34;&gt;Storage: Raid1 and LVM volume&lt;/h2&gt;
&lt;p&gt;Assume that we have &lt;code&gt;/dev/sda&lt;/code&gt;, &lt;code&gt;/dev/sdb&lt;/code&gt;, &lt;code&gt;/dev/sdc&lt;/code&gt;, and &lt;code&gt;/dev/sdd&lt;/code&gt;, we can simply use &lt;code&gt;mdadm&lt;/code&gt; to create a Raid1:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# create raid 1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo mdadm --create --verbose /dev/md0 --level&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; --raid-devices&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; /dev/sda /dev/sdb
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# check the process of creation&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo cat /proc/mdstat
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# creaet file system&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo mkfs.ext4 -F /dev/md0
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# create a mount point&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo mkdir -p /mnt/storage
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# mount the storage (temporary)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo mount /dev/md0 /mnt/storage
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# mount the storage (persistent)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;echo &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;/dev/md0 /mnt/storage ext4 defaults,nofail,discard 0 0&amp;#39;&lt;/span&gt; | sudo tee -a /etc/fstab
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;For the LVM volume:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# create a physical volumes on the top of the remaining dick&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo pvcreate /dev/sdc /dev/sdd &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sudo pvs
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# create a volume group named as `lv-storage`&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo vgcreate vg-storage /dev/sdc /dev/sdd &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sudo vgdisplay vg-storage
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# create two logical volumes &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;## the first one is for the lxd and the remains are for daily storage&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo lvcreate -n lxd-tool -L 120G vg-storage &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; lvs
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo lvcreate -n daily-storage -l 100%FREE vg-storage &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; lvs
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# create zfs pool &amp;amp; ext4 &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo zpool create lxdPool /dev/vg-storage/lxd-pool
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo mkfs.ext4 -F /dev/vg-storage/daily-storage
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# create a mount point&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo mkdir -p /mnt/daily-storage
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# mount the storage (temporary)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo mount /dev/vg-storage/daily-storage /mnt/daily-storage
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# mount the storage (persistent)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;echo &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;/dev/vg-storage/daily-storage /mnt/daily-storage ext4 defaults,nofail,discard 0 0&amp;#39;&lt;/span&gt; | sudo tee -a /etc/fstab
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# create the storage status&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;df -h
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;For the mounting, you can also use the &lt;code&gt;uuid&lt;/code&gt; to mount the storage. Simply use &lt;code&gt;blkid&lt;/code&gt; and you can find the disk&amp;rsquo;s uuid.&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>ğŸ§‘ğŸ¿â€ğŸ’» K3s/Kubernetes - From K3s to Kubernetes: Set up a Kubernetes in a nutshell</title>
      <link>https://blog.cklau.cc/post/k8s-setup-1/</link>
      <pubDate>Sun, 23 Oct 2022 00:11:21 +0800</pubDate>
      <guid>https://blog.cklau.cc/post/k8s-setup-1/</guid>
      <description>&lt;h1 id=&#34;before&#34;&gt;Before&lt;/h1&gt;
&lt;h2 id=&#34;what-is-kuberntes&#34;&gt;What is Kuberntes&lt;/h2&gt;
&lt;p&gt;Kubernetes, is an open-source system for automating deployment, scaling, and management of containerized applications. Usually, we call it &lt;code&gt;K8s&lt;/code&gt; as there are 8 characters between &lt;code&gt;K&lt;/code&gt; and &lt;code&gt;s&lt;/code&gt; :).&lt;/p&gt;
&lt;p&gt;Basically, all the application are &lt;strong&gt;containerized&lt;/strong&gt;, and we can easily the reason why we use K8s is that the use of microservices increasing, away from traditional monolithic-type applications. As a result, containers provide the perfeet host form these individual microservices as &lt;strong&gt;containers manage dependencies, are indipendent, OS-agnostic and ephemaral, amongst other benefits&lt;/strong&gt;, which is very powerful and suitable for users as we want users to run their application isolated and donot be influenced by others.&lt;/p&gt;
&lt;p&gt;Here are the benefits of kubernetes:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;High Availability - this simply means that your application will always up and running, whether you have a new update to roll-out or have some unexpected pods crashing&lt;/li&gt;
&lt;li&gt;Scalability - K8s supports autoscaling and will automatically scale up your cluster as soon as you need it, and scale it back down to save resources.&lt;/li&gt;
&lt;li&gt;Disaster Recovery  - this can ensures that the application will always have the latest data and states of your applicaions (based on the HA)&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;the-modules-inside-the-kubernetes&#34;&gt;The modules inside the Kubernetes&lt;/h2&gt;
&lt;p&gt;There are two kinds of node inside a K8s cluster:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;control-plane&lt;/code&gt;: is used for nodes control and applications scheduling
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;kube-apiserver&lt;/code&gt;: provide K8s API service, and it validates and configures data for the api objects which include pods, services, replicationcontroller, and others.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;kube-controller-manager&lt;/code&gt;: is a daemon where we can see it as the HQ of control. It is a control loop taht watches the shared state of the cluster through the api erver and makes changes attempting to move the current state towards the desired state.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;kube-scheduler&lt;/code&gt;: is a control plane process which assigns Pods to Nodes, where we can see it as the HQ of scheduling. The scheduler determines which Nodes are valid placements for each Pod in the scheduling queue according to constraints and available resources. The scheduler then ranks each valid Node and binds the Pod to a suitable Node.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;node&lt;/code&gt;: usually, applications are usally running  on these nodes
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;kubelet&lt;/code&gt;: is the primary &amp;ldquo;node agent&amp;rdquo; that runs on each node. It can register the node with the apiserver using one of hostname; a flag to override the hostname; or specific logic for a cloud provider&lt;/li&gt;
&lt;li&gt;&lt;code&gt;kube-proxy&lt;/code&gt;: reflects services as defined in the K8s API on each node and can do simple TCP, UDP, and SCTP stream fowarding on round robin TCP, UDP, and SCTP forwarding across a set of backends.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;how-to-install&#34;&gt;How to Install&lt;/h1&gt;
&lt;p&gt;There are multiple different way to install K8s on no matter bare metal or virtual machine. For example:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://minikube.sigs.k8s.io/docs/&#34;&gt;Minkube&lt;/a&gt;: for learn and develop&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/kubernetes/kubeadm&#34;&gt;kubeadm&lt;/a&gt;: production-ready&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/kubernetes/kops&#34;&gt;kOps&lt;/a&gt;: production-ready&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/kubernetes-sigs/kubespray&#34;&gt;kubespray&lt;/a&gt;: production-redy&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;In here I choose Kubeadm.&lt;/p&gt;
&lt;h2 id=&#34;preperation&#34;&gt;Preperation&lt;/h2&gt;
&lt;p&gt;Previously, Kubernetes cannot start when the swap on. However, in &lt;a href=&#34;https://kubernetes.io/blog/2021/08/09/run-nodes-with-swap-alpha/&#34;&gt;Version 1.22&lt;/a&gt; they support for usingthe swap memory, thus, it is not neccessary to turn of the swap, but still, you can turn it off if you want:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo swapoff -a
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Then, we may need to specify the ip and hostname on the &lt;code&gt;/etc/hosts&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cat &amp;gt;&amp;gt; /etc/hosts &amp;lt;&amp;lt; EOF
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;192.168.10.2  cantor
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;192.168.10.3  gauss
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;192.168.10.4  hilbert  
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;To install &lt;code&gt;containerd&lt;/code&gt; as the container engine on the system, install some pre-requisite modules:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo modprobe overlay &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sudo modeprobe br_netfilter
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;You can also ensure these are persistent and configure the &lt;code&gt;sysctl parameters&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cat &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;lt;&amp;lt;EOF | sudo tee /etc/modules-load.d/containerd.conf
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;overlay
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;br_netfilter
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cat &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;lt;&amp;lt;EOF | sudo tee /etc/sysctl.d/99-kubernetes-cri.conf
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;net.bridge.bridge-nf-call-iptables  = 1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;net.ipv4.ip_forward                 = 1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;net.bridge.bridge-nf-call-ip6tables = 1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo systtl --system
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;install-containerd&#34;&gt;Install Containerd&lt;/h2&gt;
&lt;p&gt;Since Version 1.24 of Kubernetes, &lt;a href=&#34;https://kubernetes.io/blog/2022/05/03/kubernetes-1-24-release-announcement/#major-themes&#34;&gt;the dockershim is deperated&lt;/a&gt; and move on of using Containerd.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo mkdir -p /etc/apt/keyrings
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;echo &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;deb [arch=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;dpkg --print-architecture&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt; signed-by=/etc/apt/keyrings/docker.gpg] https://mirrors.bfsu.edu.cn/docker-ce/linux/ubuntu &lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;lsb_release -cs&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt; stable&amp;#34;&lt;/span&gt; | sudo tee /etc/apt/sources.list.d/docker.list &amp;gt; /dev/null
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt-get install docker-ce docker-ce-cli containerd.io docker-compose-plugin
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo mkdir -p /etc/containerd &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sudo containerd config default | sudo tee /etc/containerd/config.toml
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# You can also try mirrors.bfsu.edu.cn - Docker mirrors &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo mkdir -p /etc/apt/keyrings
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;echo &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;deb [arch=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;dpkg --print-architecture&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt; signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;  &lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;lsb_release -cs&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt; stable&amp;#34;&lt;/span&gt; | sudo tee /etc/apt/sources.list.d/docker.list &amp;gt; /dev/null
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt-get install docker-ce docker-ce-cli containerd.io docker-compose-plugin
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo mkdir -p /etc/containerd &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sudo containerd config default | sudo tee /etc/containerd/config.toml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;You may wonder why I install the docker as the K8s does not need it anymore, actually, I don&amp;rsquo;t know why, but if I miss this package, the &lt;code&gt;kubeadm init&lt;/code&gt; will fails for some reasons.&lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;p&gt;We need some modification of &lt;code&gt;/etc/containerd/config.toml&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# set SystemdCgroup as true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;plugins.&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;io.containerd.grpc.v1.cri&amp;#34;&lt;/span&gt;.containerd.runtimes.runc.options&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  BinaryName &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  CriuImagePath &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  CriuPath &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  CriuWorkPath &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  IoGid &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  IoUid &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  NoNewKeyring &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; false
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  NoPivotRoot &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; false
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  Root &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ShimCgroup &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  SystemdCgroup &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; true
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# To accelerate the installations, change sand_box mirros to aliyun (optional) &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sandbox_image &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;registry.cn-hangzhou.aliyuncs.com/pause:3.6&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;install-kubernetes&#34;&gt;Install Kubernetes&lt;/h2&gt;
&lt;p&gt;Use &lt;code&gt;aubeadm&lt;/code&gt; to initlization the cluster:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo kubeadm init --pod-network-cidr &amp;lt;pod-cidr&amp;gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;        --service-cidr &amp;lt;service-cidr&amp;gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;        --apiserver-advertise-address &amp;lt;your-ip&amp;gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;        --control-plane-endpoint &amp;lt;your-ip&amp;gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;        --v &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# To accelerate the installations, change sand_box mirros to aliyun (optional) &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo kubeadm init --pod-network-cidr &amp;lt;pod-cidr&amp;gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;        --service-cidr &amp;lt;service-cidr&amp;gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;        --apiserver-advertise-address &amp;lt;your-ip&amp;gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;        --control-plane-endpoint &amp;lt;your-ip&amp;gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;        --image-repository registry.cn-hangzhou.aliyuncs.com/google_containers &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;        --v &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# after the initlization you need to create the kubeconfig&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;mkdir -p $HOME/.kube
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo chown &lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;id -u&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt;:&lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;id -g&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt; $HOME/.kube/config
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;After the intilization, you also need Container Network Interface (CNI), I choose &lt;code&gt;flannel&lt;/code&gt; since I used to use it in my K3s cluster.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kubectl apply -f https://raw.githubusercontent.com/flannel-io/flannel/master/Documentation/kube-flannel.yml
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Wait for any while and check the whether the kubernetes (pods and nodes) is running properly.&lt;/p&gt;
&lt;h2 id=&#34;install-the-metallb&#34;&gt;Install the MetalLB&lt;/h2&gt;
&lt;p&gt;Unlike the &lt;a href=&#34;https://github.com/k3s-io/klipper-lb&#34;&gt;K3s&lt;/a&gt;, the Kubernetes does not contain a intergrated LoadBalancer, thus, we need to install it by ourselves. I use &lt;a href=&#34;https://metallb.universe.tf/concepts/&#34;&gt;MetalLB&lt;/a&gt; in here. There are multiple ways to install the MetalLB, I use the manifest to install it.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;kubectl apply -f https://raw.githubusercontent.com/metallb/metallb/v0.13.7/config/manifests/metallb-native.yaml
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# defining the IPs to assign  to the loadbalancer ssevices (I choose L2 in here)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;cat &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;lt;&amp;lt;EOF | sudo tee metallb-ips.yaml
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;apiVersion: metallb.io/v1beta1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;kind: IPAddressPool
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;  name: ip-pool
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;  namespace: metallb-system
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;  addresses:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;  - 10.0.4.4/32  # the external IP of your nodes
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;  - 10.0.4.15/32
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;---
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;apiVersion: metallb.io/v1beta1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;kind: L2Advertisement
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;metadata:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;  name: metal-l2-advertisement
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;  namespace: metallb-system
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;spec:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;  ipAddressPools:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;  - ip-pool
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;That&amp;rsquo;s it, you can choose a &lt;code&gt;ingress-controller&lt;/code&gt; you like and after install it, a K8s (v1.25.3) cluster is configured :)&lt;/p&gt;
&lt;div class=&#34;footnotes&#34; role=&#34;doc-endnotes&#34;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&#34;fn:1&#34;&gt;
&lt;p&gt;I think the reason is that I missed the &lt;code&gt;runc&lt;/code&gt; package.&amp;#160;&lt;a href=&#34;#fnref:1&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</description>
    </item>
    
    <item>
      <title>ğŸ‘¨â€ğŸ’» My Personal Experimental Network: L-Net</title>
      <link>https://blog.cklau.cc/post/lnet-1/</link>
      <pubDate>Tue, 18 Oct 2022 00:11:21 +0800</pubDate>
      <guid>https://blog.cklau.cc/post/lnet-1/</guid>
      <description>&lt;h2 id=&#34;before&#34;&gt;Before&lt;/h2&gt;
&lt;p&gt;In the previous project: &lt;a href=&#34;https://blog.cklau.cc/post/my-homelab-1/&#34; title=&#34;My Homelab 2&#34;&gt;Homelab&lt;/a&gt;, I listed all my devices and VPS on a table, where all the VPS own a specific public IP, and I tried to use the Wireguard to connect them into a Full-mesh intranet.&lt;/p&gt;
&lt;p&gt;However, to investigate deeper into the network performance, I started to learn how to federate these clusters while not affecting the current usage. What&amp;rsquo;s more, if I can federate this isolated network, I don&amp;rsquo;t need to build separate services in different clusters. For instance, I can use a single &lt;a href=&#34;https://prometheus.io/&#34;&gt;Prometheus&lt;/a&gt; to monitor all the devices and no more millions of virtual interfaces :rofl:&lt;/p&gt;
&lt;h2 id=&#34;design&#34;&gt;Design&lt;/h2&gt;
&lt;p&gt;We are using the &lt;code&gt;Wireguard&lt;/code&gt; to generate the virtual network interface for each node or each cluster. Between the clusterâ€™s router, we also generate an isolated Wireguard tunnel between two nodes. Here is an example: &lt;code&gt;a1&lt;/code&gt; is the router of the cluster &lt;code&gt;A&lt;/code&gt; and &lt;code&gt;b&lt;/code&gt; is the central router of the whole L-Net and &lt;code&gt;A&lt;/code&gt;â€™s IP address is &lt;code&gt;172.12.1.0/24&lt;/code&gt; , then we need an extra IP address(an extra Wireguard tunnel) for &lt;code&gt;a â†’ b&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Under this circumstance, we can connect the nodes inside the &lt;code&gt;A (a2, a3, â€¦)&lt;/code&gt;  to &lt;code&gt;b&lt;/code&gt;, and other nodes  from &lt;code&gt;C (c1, c2, c3, â€¦)&lt;/code&gt; can also connect to &lt;code&gt;A&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Here is the topology of my design:&lt;/p&gt;
&lt;p&gt;Those bold-colored dotted lines can be seen as the Backbone network, and the slim-colored dotted lines can be seen as the internet/intranet. The slim-black dotted line shows that cross IP range is accessible as long as the client allows the traffic.&lt;/p&gt;
&lt;h2 id=&#34;network-configuration&#34;&gt;Network Configuration&lt;/h2&gt;
&lt;h3 id=&#34;loc-1---mainland-china&#34;&gt;Loc 1 - Mainland, China&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Network Interface: &lt;code&gt;cn&lt;/code&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;IP address: &lt;code&gt;192.168.10.0/24&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Allowed IP: &lt;code&gt;192.168.141.x/32, 192.168.{20,30}.0/24&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Network Interface (Router): &lt;code&gt;sgcn&lt;/code&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;IP address: &lt;code&gt;192.168.141.0/24&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Allowed IP: &lt;code&gt;0.0.0.0/0&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Service Provider&lt;/th&gt;
&lt;th&gt;Location&lt;/th&gt;
&lt;th&gt;Name&lt;/th&gt;
&lt;th&gt;Public IP&lt;/th&gt;
&lt;th&gt;Private IP&lt;/th&gt;
&lt;th&gt;Purpose&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Tencent Cloud&lt;/td&gt;
&lt;td&gt;GZ&lt;/td&gt;
&lt;td&gt;newton&lt;/td&gt;
&lt;td&gt;(secret)&lt;/td&gt;
&lt;td&gt;192.168.10.1 / 192.168.141.2&lt;/td&gt;
&lt;td&gt;Router&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Tencent Cloud&lt;/td&gt;
&lt;td&gt;SH&lt;/td&gt;
&lt;td&gt;gauss&lt;/td&gt;
&lt;td&gt;(secret)&lt;/td&gt;
&lt;td&gt;192.168.10.2&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Tencent Cloud&lt;/td&gt;
&lt;td&gt;SH&lt;/td&gt;
&lt;td&gt;cantor&lt;/td&gt;
&lt;td&gt;(secret)&lt;/td&gt;
&lt;td&gt;192.168.10.3&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Tencent Cloud&lt;/td&gt;
&lt;td&gt;SH&lt;/td&gt;
&lt;td&gt;hilbert&lt;/td&gt;
&lt;td&gt;(secret)&lt;/td&gt;
&lt;td&gt;192.168.10.4&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;China Telecom Cloud&lt;/td&gt;
&lt;td&gt;GZ&lt;/td&gt;
&lt;td&gt;NA&lt;/td&gt;
&lt;td&gt;(secret)&lt;/td&gt;
&lt;td&gt;192.168.10.5&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;loc-2---japan&#34;&gt;Loc 2 - Japan&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Network Interface: &lt;code&gt;jp&lt;/code&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;IP address: &lt;code&gt;192.168.20.0/24&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Allowed IP: &lt;code&gt;192.168.142.0/32, 192.168.{10, 30}.0/24&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Network Interface (Router): &lt;code&gt;sgjp&lt;/code&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;IP address: &lt;code&gt;192.168.142.0/24&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Allowed IP: &lt;code&gt;0.0.0.0/0&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Service Provider&lt;/th&gt;
&lt;th&gt;Location&lt;/th&gt;
&lt;th&gt;Name&lt;/th&gt;
&lt;th&gt;Public IP&lt;/th&gt;
&lt;th&gt;Private IP&lt;/th&gt;
&lt;th&gt;Purpose&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Oracle Cloud&lt;/td&gt;
&lt;td&gt;JP&lt;/td&gt;
&lt;td&gt;einstein&lt;/td&gt;
&lt;td&gt;(secret)&lt;/td&gt;
&lt;td&gt;192.168.20.1 / 192.168.142.2&lt;/td&gt;
&lt;td&gt;Router&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Oracle Cloud&lt;/td&gt;
&lt;td&gt;JP&lt;/td&gt;
&lt;td&gt;bohr&lt;/td&gt;
&lt;td&gt;(secret)&lt;/td&gt;
&lt;td&gt;192.168.20.2&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;loc-3---hksar-china&#34;&gt;Loc 3 - HKSAR, China&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Network Interface: &lt;code&gt;hk&lt;/code&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;IP address: &lt;code&gt;192.168.30.0/24&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Allowed IP: &lt;code&gt;192.168.143.0/32, 192.168.{20, 30}.0/24&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Network Interface (Router): &lt;code&gt;sghk&lt;/code&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;IP address: &lt;code&gt;192.168.143.0/24&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Allowed IP: &lt;code&gt;0.0.0.0/0&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Service Provider&lt;/th&gt;
&lt;th&gt;Location&lt;/th&gt;
&lt;th&gt;Name&lt;/th&gt;
&lt;th&gt;Public IP&lt;/th&gt;
&lt;th&gt;Private IP&lt;/th&gt;
&lt;th&gt;Purpose&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Cube Cloud&lt;/td&gt;
&lt;td&gt;HK&lt;/td&gt;
&lt;td&gt;turing&lt;/td&gt;
&lt;td&gt;(secret)&lt;/td&gt;
&lt;td&gt;192.168.30.3 / 192.168.143.2&lt;/td&gt;
&lt;td&gt;Router&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Tencent Cloud&lt;/td&gt;
&lt;td&gt;HK&lt;/td&gt;
&lt;td&gt;neumann&lt;/td&gt;
&lt;td&gt;(secret)&lt;/td&gt;
&lt;td&gt;192.168.30.1&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Tencent Cloud&lt;/td&gt;
&lt;td&gt;HK&lt;/td&gt;
&lt;td&gt;hinton&lt;/td&gt;
&lt;td&gt;(secret)&lt;/td&gt;
&lt;td&gt;192.168.30.2&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;loc-4---singapore&#34;&gt;Loc 4 - Singapore&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Network Interface: &lt;code&gt;sgcn&lt;/code&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;IP address: &lt;code&gt;192.168.141.0/24&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Allowed IP: &lt;code&gt;0.0.0.0/0&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Network Interface: &lt;code&gt;sgjp&lt;/code&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;IP address: &lt;code&gt;192.168.142.0/24&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Allowed IP: &lt;code&gt;0.0.0.0/0&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Network Interface: &lt;code&gt;sghk&lt;/code&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;IP address: &lt;code&gt;192.168.143.0/24&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Allowed IP: &lt;code&gt;0.0.0.0/0&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Service Provider&lt;/th&gt;
&lt;th&gt;Location&lt;/th&gt;
&lt;th&gt;Name&lt;/th&gt;
&lt;th&gt;Public IP&lt;/th&gt;
&lt;th&gt;Private IP&lt;/th&gt;
&lt;th&gt;Purpose&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Tencent Cloud&lt;/td&gt;
&lt;td&gt;SG&lt;/td&gt;
&lt;td&gt;bayes&lt;/td&gt;
&lt;td&gt;(secret)&lt;/td&gt;
&lt;td&gt;192.168.141.1 / 192.168.142.1 / 192.168.143.1&lt;/td&gt;
&lt;td&gt;Central Router&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;configuration&#34;&gt;Configuration&lt;/h2&gt;
&lt;h3 id=&#34;backbone-network&#34;&gt;â€œBackbone Networkâ€&lt;/h3&gt;
&lt;p&gt;As usual, I use the tool I wrote &lt;a href=&#34;https://github.com/TerenceLiu98/wgtools&#34;&gt;wgtools&lt;/a&gt; to generate Wireguard configuration. However, the tool is built for the full-mesh configuration, thus, for the â€œbackboneâ€ network, we need to modify the config, here is an example: in the  &lt;code&gt;sgcn&lt;/code&gt;  interface, I put the following settings in &lt;code&gt;bayes&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;Interface&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Address &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; 192.168.141.1/24
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ListenPort &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;51821&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;PrivateKey &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &amp;lt;interface-prikey&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Table &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; off
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;Peer&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Name = cn-router&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;PublicKey &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &amp;lt;peer-pubkey&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;AllowedIPs &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; 0.0.0.0/0
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;PersistentKeepalive &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;25&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Endpoint &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; xxx.xxx.xxx.xxx:51821
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The reason why we need to set the Address of the Interface to &lt;code&gt;/24&lt;/code&gt; is that if we want the subnet of &lt;code&gt;newton&lt;/code&gt; are accessible, which means that &lt;code&gt;192.168.141.2/32&lt;/code&gt; need to be accessible from both sides as it is the bridge between &lt;code&gt;sgcn&lt;/code&gt; and &lt;code&gt;cn&lt;/code&gt; as the &lt;code&gt;sgcn&lt;/code&gt; the interface is the bridge between the â€œexternalâ€ to the â€œinternalâ€. Here is the setting in &lt;code&gt;newton&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;Interface&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Address &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; 192.168.141.2/24 &lt;span style=&#34;color:#75715e&#34;&gt;# the same reason, this interface is the &amp;#34;bridge&amp;#34; &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ListenPort &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;51821&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;PrivateKey &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; cJgoIHnDfCl+p8D7KE0jCBkRipEwe3K6Jq7FG8OTzlo&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Table &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; off
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;Peer&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Name = bayes&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;PublicKey &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; FF85tV+bkTWA3rNHpn+sapA/08JV7HO92y/I1P+xsRE&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;AllowedIPs &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; 0.0.0.0/0
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;PersistentKeepalive &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;25&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Endpoint &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; xxx.xxx.xxx.xxx:51821
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Similarly, you can modify the Address and Endpoint for &lt;code&gt;sgjp&lt;/code&gt; and &lt;code&gt;sghk&lt;/code&gt; .&lt;/p&gt;
&lt;h3 id=&#34;intranetinternet&#34;&gt;â€œIntranet/Internetâ€&lt;/h3&gt;
&lt;p&gt;It is easy to generate the configuration with my tools, or maybe you can generate them manually, which is not the key for the configuration. The important part is that for each node of the â€œintranetâ€œ, you can control which other subnet can access to you. Take &lt;code&gt;gauss&lt;/code&gt; and &lt;code&gt;einstein&lt;/code&gt; as an example, if you want &lt;code&gt;gauss&lt;/code&gt; can access from the &lt;code&gt;einstein&lt;/code&gt; then you need to add the address of &lt;code&gt;einstein&lt;/code&gt; in the &lt;code&gt;newton&lt;/code&gt;â€™s &lt;code&gt;AllowedIPs&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# configuration of gauss&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;Interface&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Address &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; 192.168.10.2/32,fd0b:76a0:952b:0:afa3:e03c:fe6d:2e55/128
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ListenPort &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;51820&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;PrivateKey &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &amp;lt;gauss-privkey&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;PostUp &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; iptables -A FORWARD -i %i -j ACCEPT; iptables -A FORWARD -o %i -j ACCEPT; iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;PostDown &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; iptables -D FORWARD -i %i -j ACCEPT; iptables -D FORWARD -o %i -j ACCEPT; iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;Peer&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Name = newton&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;PublicKey &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &amp;lt;newton-pubkey&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;AllowedIPs &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; 192.168.20.1/32,192.168.248.1/32,fd0b:76a0:952b:0:e96f:2dae:80a8:b578/128
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;PersistentKeepalive &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;25&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Endpoint &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; xxx.xxx.xxx.xxx:51820
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This is because &lt;code&gt;newton&lt;/code&gt; is the bridge between &lt;code&gt;cn&lt;/code&gt; and &lt;code&gt;jp&lt;/code&gt; , or more specifically, the &lt;code&gt;einstein&lt;/code&gt; â€˜s traffic needs to go through the &lt;code&gt;jp â†’ sgjp â†’ sgcn â†’ cn&lt;/code&gt; , and for &lt;code&gt;sgcn â†’ cn&lt;/code&gt; you need to add the &lt;code&gt;192.168.20.1/32&lt;/code&gt; in the &lt;code&gt;AllowedIPs&lt;/code&gt; and &lt;code&gt;cn&lt;/code&gt; will know that this traffic can be accepted by the &lt;code&gt;cn&lt;/code&gt; and itâ€™s routed via the &lt;code&gt;192.168.248.1/32&lt;/code&gt;.&lt;/p&gt;
&lt;h3 id=&#34;wireguard-site-to-site-configuration&#34;&gt;Wireguard Site-to-Site Configuration&lt;/h3&gt;
&lt;p&gt;For intuitive thinking, we need to connect cn-router, hksar-router, jp-router, with three different tunnel, however, from here I choose &lt;code&gt;OSPF(Open Shortest Path First, an Internal Gateway Protocol, or IGP)&lt;/code&gt; and &lt;code&gt;iBGP(Interior Border Gateway Protocol)&lt;/code&gt; to resolve the routing problem.&lt;/p&gt;
&lt;p&gt;There are multiple different tools we can use: &lt;code&gt;bird2&lt;/code&gt;, &lt;code&gt;quagga&lt;/code&gt;, and etc.. I use &lt;code&gt;bird2&lt;/code&gt; in here.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt-get install bird2 &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sudo systemctl stop bird2
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The reason why I stop the process at first is that I don&amp;rsquo;t want the &amp;ldquo;bad&amp;rdquo; configuration to influence the network.&lt;/p&gt;
&lt;h4 id=&#34;ospf---open-shortest-path-frist&#34;&gt;OSPF - Open Shortest Path Frist&lt;/h4&gt;
&lt;p&gt;OSPF is an interior gateway protocol (IGP) that routes packets within a single autonomous system (AS). OSPF uses link-state information to make routing decisions, making route calculations using the shortest-path-first (SPF) algorithm (also referred to as the Dijkstra algorithm). Each router running OSPF floods link-state advertisements throughout the AS or area that contain information about that routerâ€™s attached interfaces and routing metrics. Each router uses the information in these link-state advertisements to calculate the least cost path to each network and create a routing table for the protocol.&lt;/p&gt;
&lt;p&gt;First, let&amp;rsquo;s try OSPF first.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;## cn-router&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;router id 192.168.199.1;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;protocol device &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;protocol kernel &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ipv4 &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        export where proto &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;wg&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;protocol ospf v2 sgcn &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ipv4 &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        import where net !~ 192.168.141.0/24;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        export all;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    area 192.168.141.0 &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        interface &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;sgcn&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;protocol ospf v2 cn &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ipv4 &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        export all;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    area 192.168.10.0 &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        interface &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;cn&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;where &lt;code&gt;router id&lt;/code&gt; is the specific id for the router, it looks like a IP address, however, it actually just arbitrary 32-bit numbers that are by convection written in dotted-quad notation.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;protocol deive&lt;/code&gt; help use to get information about netowkr interfaces from the kernel&lt;/li&gt;
&lt;li&gt;&lt;code&gt;protocol kernel&lt;/code&gt; performs synchronization of BIRD&amp;rsquo;s routing tables with the OS kernel and here we export the &lt;code&gt;wg&lt;/code&gt; protocol&amp;rsquo;s routing&lt;/li&gt;
&lt;li&gt;&lt;code&gt;protocol ospf v2 sgcn&lt;/code&gt; sets up the the OSPFv2 instance we&amp;rsquo;ll use for the wireguard connection. Note that the &lt;code&gt;sgcn&lt;/code&gt; is the id I give to this instance, it can be arbitrary id; we import all the routes it receives over OSPF into its routing table and &lt;code&gt;export all;&lt;/code&gt;.
&lt;ul&gt;
&lt;li&gt;The &lt;code&gt;import where net !~ 192.168.141.0/24;&lt;/code&gt; line configures BIRD to avoid pulling in any routes to the &lt;code&gt;192.168.141.0/24&lt;/code&gt; subnet from OSPFâ€‰â€”â€‰this is the subnet weâ€™re using for the WireGuard connection between &lt;code&gt;cn-router&lt;/code&gt; and &lt;code&gt;sg-router&lt;/code&gt;. This route is already set up in the &lt;code&gt;/etc/wireguard/sgcn.conf&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;The &lt;code&gt;area 192.168.141.0&lt;/code&gt; block configures BIRD to use the area with an ID of &lt;code&gt;192.168.141.0&lt;/code&gt; for OSPF on the specified interface. This ID is also an arbitrary 32-bit number. The &lt;code&gt;interface &amp;quot;sgcn&amp;quot;&lt;/code&gt; specifies that the &lt;code&gt;sgcn&lt;/code&gt; interface we set up is included in the area definition.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;With this setting, the router will listen for and setd out OSPF broadcasts on the &lt;code&gt;sgcn&lt;/code&gt; interface, importing the routes learned from OSPF into the table, and exporting the other routes in its table to share over OSPF. As you can se &lt;code&gt;protocol ospf v2 cn&lt;/code&gt; is the OSPF for the &lt;code&gt;cn&lt;/code&gt; LAN.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# start bird&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo systemctl start bird
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# check birdc status&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo birdc 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# reload configuration&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo birdc configurate
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# check ospf &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo birdc show ospf
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# check route table&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo birdc show route
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;With the above configuration, &lt;code&gt;cn-router&lt;/code&gt; and &lt;code&gt;sg-router&lt;/code&gt; can communicate and exchange routing table, the next step is to propagate &lt;code&gt;cn&lt;/code&gt; and to &lt;code&gt;sg&lt;/code&gt;&amp;rsquo;s node. We can still use &lt;code&gt;OSPF&lt;/code&gt; for routing.&lt;/p&gt;
&lt;p&gt;As you can see, two LAN OSPF can sharing the local routing table to each other via the &lt;code&gt;sgcn&lt;/code&gt; and &lt;code&gt;sgjp&lt;/code&gt;.&lt;/p&gt;
&lt;h4 id=&#34;ibgp---interior-border-gateway-protocol&#34;&gt;iBGP - Interior Border Gateway Protocol&lt;/h4&gt;
&lt;p&gt;IBGP is used inside the autonomous systems. It is used to provide information to your internal routers. It requires all the devices in same autonomous systems to form full mesh topology or either of Route reflectors and Confederation for prefix learning.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# configuration of cn-router&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;router id 192.168.199.1;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;define LOCAL_ASN &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; 4242420100;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;protocol device &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;protocol kernel &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ipv4 &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        export where proto &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;wg&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;protocol ospf v2 wg &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ipv4 &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        import where net !~ 192.168.141.0/24;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        export all;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    area 192.168.141.0 &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        interface &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;sgcn&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;protocol direct &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ipv4;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    interface &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;cn&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;protocol bgp lnet_sgcn &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    local 192.168.141.2 as 4242420100;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    neighbor 192.168.141.1 as 4242420100;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    multihop 1;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    graceful restart on;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    rr client;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ipv4 &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        import all;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        export all;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;code&gt;protocal direct&lt;/code&gt; block with the actual name of the roter&amp;rsquo;s LAN interface, for here, my router&amp;rsquo;s LAN interface is &lt;code&gt;cn&lt;/code&gt;. The &lt;code&gt;protocal direct&lt;/code&gt; is required as it is used to import the direct interface routes for the LAN interface into BIRD&amp;rsquo;s routing table, so that it can add the correct next hop to the routes from the other site that it will share via BGP.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;protocal bgp lnet&lt;/code&gt; is used to define the BGP section, again, the &lt;code&gt;lnet_sgnn&lt;/code&gt; is just arbitrary ID for the protocal, you can use any word/number you want.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;export all&lt;/code&gt; directs BIRD to share all the rotes in the routing table with the other iBGP server. &lt;code&gt;next hop self&lt;/code&gt; directs it to adjust those roures to make the Wireguard router itself the next hop in all those routes. This will share the rotes the Wireguard roter learned from the other site, using the Wireguard router it elf as the link to the site.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;local 192.168.141.2 as 424220100&lt;/code&gt; and &lt;code&gt;neighbor 192.168.141.1 as 424220100&lt;/code&gt; is defining the AS number of local machine and the neighbor. If these two ASN are the same, we are defining a &lt;code&gt;iBGP&lt;/code&gt; and if there are different we are defining a &lt;code&gt;eBGP&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;For now, I have tried &lt;code&gt;OSPF&lt;/code&gt; and &lt;code&gt;iBGP&lt;/code&gt;. But I just simply follow the instruction and did not dig into the high-level setting.&lt;/p&gt;
&lt;p&gt;is supported $\frac{1}{2}$&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>ğŸ§‘ğŸ¿â€ğŸ’» K3s/Kubernetes - Set up a K3s Cluster with your VPS (Extra Story 1)</title>
      <link>https://blog.cklau.cc/post/k3s-setup-extra-1/</link>
      <pubDate>Sun, 02 Oct 2022 10:00:00 +0800</pubDate>
      <guid>https://blog.cklau.cc/post/k3s-setup-extra-1/</guid>
      <description>&lt;p&gt;As I have mentioned in &lt;a href=&#34;https://blog.cklau.cc/post/k3s-setup-2/&#34; title=&#34;K3s Setup 2&#34;&gt;K3s Setup 2&lt;/a&gt;, usually, it is not easy for the China&amp;rsquo;s user to access &lt;code&gt;https://gcr.io&lt;/code&gt;, &lt;code&gt;https://k8s.gcr.io&lt;/code&gt; or &lt;code&gt;https://ghcr.io&lt;/code&gt;. Thus, under this circumstance, we may set up a server as the registry proxy endpoint.&lt;/p&gt;
&lt;h2 id=&#34;some-options&#34;&gt;Some options&lt;/h2&gt;
&lt;p&gt;DockerHub provide a &amp;ldquo;offical&amp;rdquo; package called &lt;a href=&#34;https://docs.docker.com/registry/&#34;&gt;Docker Registry&lt;/a&gt; where it is a stateless, hightly scalable server side application that stores and lets users distribute Docker images.&lt;/p&gt;
&lt;p&gt;Nexus Repository OSS, provided by Sonatype, is an open source repository that supports many artifact formats, including Docker, Javaâ„¢, and npm.&lt;/p&gt;
&lt;p&gt;Harbor, provided by VMWare,  is an opensource registry that secure artifacts with policies and role-based access control, ensures images are scanned and free from vulnerabilities, and signs images as trusted.&lt;/p&gt;
&lt;h2 id=&#34;nexus-as-registry-proxy&#34;&gt;Nexus as registry proxy&lt;/h2&gt;
&lt;p&gt;It is easy for us to build the Nexus repositry, simply with the &lt;code&gt;docker-compose.yml&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;version&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;3.7&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;services&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;nexus&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;image&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;sonatype/nexus3:latest&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;environment&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;INSTALL4J_ADD_VM_PARAMS&lt;/span&gt;: -&lt;span style=&#34;color:#ae81ff&#34;&gt;Xms128m -Xmx512m -XX:MaxDirectMemorySize=512m&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;# decrease the occupancy rate of nexus&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;container_name&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;nexus3&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;restart&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;always&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;ports&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;8081&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;8081&lt;/span&gt;   &lt;span style=&#34;color:#75715e&#34;&gt;# port of frontend of the nexus repo&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;8082&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;8082&lt;/span&gt;   &lt;span style=&#34;color:#75715e&#34;&gt;# port of the docker proxy&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;volumes&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      -  &lt;span style=&#34;color:#ae81ff&#34;&gt;./data:/nexus-data&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;With &lt;code&gt;sudo docker compose up -d&lt;/code&gt;, we can easily run the nexus. &lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;p&gt;For the reverse proxy, I use nginx and here is the configuration:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;server &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    listen 80;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    server_name nexus.exmaple.com;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;301&lt;/span&gt; https://$server_name$request_uri;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;server &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    listen 80;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    server_name mirrors.example.com;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;301&lt;/span&gt; https://$server_name$request_uri;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;server &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    listen 80;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    server_name registry.example.com;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;301&lt;/span&gt; https://$server_name$request_uri;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;server &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    listen &lt;span style=&#34;color:#ae81ff&#34;&gt;443&lt;/span&gt; ssl;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    server_name nexus.example.com;  &lt;span style=&#34;color:#75715e&#34;&gt;# nexus frontend&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ssl_certificate &amp;lt;path-of-certificate&amp;gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ssl_certificate_key &amp;lt;path-of-certificate-key&amp;gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ssl_session_timeout  5m;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ssl_ciphers HIGH:!aNULL:!MD5;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ssl_protocols SSLv3 TLSv1 TLSv1.1 TLSv1.2;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ssl_prefer_server_ciphers   on;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    location / &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        proxy_pass http://127.0.0.1:8081;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        proxy_set_header Host $host;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        proxy_set_header X-Real-IP $remote_addr;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        proxy_set_header Via &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;nginx&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;server &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    listen &lt;span style=&#34;color:#ae81ff&#34;&gt;443&lt;/span&gt; ssl;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    server_name mirrors.exmaple.com; &lt;span style=&#34;color:#75715e&#34;&gt;# docker proxy&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ssl_certificate &amp;lt;path-of-certificate&amp;gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ssl_certificate_key &amp;lt;path-of-certificate-key&amp;gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ssl_session_timeout  5m;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ssl_ciphers HIGH:!aNULL:!MD5;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ssl_protocols SSLv3 TLSv1 TLSv1.1 TLSv1.2;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ssl_prefer_server_ciphers   on;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    location / &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        proxy_pass http://127.0.0.1:8082;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        proxy_set_header Host $host;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        proxy_set_header X-Real-IP $remote_addr;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        proxy_set_header Via &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;nginx&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        client_max_body_size 1024M;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;server &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    listen &lt;span style=&#34;color:#ae81ff&#34;&gt;443&lt;/span&gt; ssl;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    server_name registry.exmaple.com; &lt;span style=&#34;color:#75715e&#34;&gt;# docker proxy&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ssl_certificate &amp;lt;path-of-certificate&amp;gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ssl_certificate_key &amp;lt;path-of-certificate-key&amp;gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ssl_session_timeout  5m;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ssl_ciphers HIGH:!aNULL:!MD5;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ssl_protocols SSLv3 TLSv1 TLSv1.1 TLSv1.2;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ssl_prefer_server_ciphers   on;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    location / &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        proxy_pass http://127.0.0.1:8083;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        proxy_set_header Host $host;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        proxy_set_header X-Real-IP $remote_addr;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        proxy_set_header Via &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;nginx&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        client_max_body_size 1024M;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;After setting up the nexus and nginx, we can go to &lt;code&gt;https://nexus.example.com&lt;/code&gt; to set up the proxy rules.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;For Docker: &lt;code&gt;Creat Repository&lt;/code&gt; -&amp;gt; Choose &lt;code&gt;docker(proxy)&lt;/code&gt; -&amp;gt;  &lt;code&gt;Remote storage = https://registry-1.docker.io&lt;/code&gt; and &lt;code&gt;Docker Index = Use Docker Hub&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;For &lt;a href=&#34;https://ghcr.io&#34;&gt;ghcr.io&lt;/a&gt;:  Creat Repository&lt;code&gt;-&amp;gt; Choose&lt;/code&gt;docker(proxy)&lt;code&gt;-&amp;gt; &lt;/code&gt;Remote storage = &lt;a href=&#34;https://ghcr.io&#34;&gt;https://ghcr.io&lt;/a&gt;`&lt;/li&gt;
&lt;li&gt;For &lt;a href=&#34;https://gcr.io&#34;&gt;gcr.io&lt;/a&gt;:  Creat Repository&lt;code&gt;-&amp;gt; Choose&lt;/code&gt;docker(proxy)&lt;code&gt;-&amp;gt; &lt;/code&gt;Remote storage = &lt;a href=&#34;https://gcr.io&#34;&gt;https://gcr.io&lt;/a&gt;`&lt;/li&gt;
&lt;li&gt;For &lt;a href=&#34;https://k8s.gcr.io&#34;&gt;k8s.gcr.io&lt;/a&gt;:  Creat Repository&lt;code&gt;-&amp;gt; Choose&lt;/code&gt;docker(proxy)&lt;code&gt;-&amp;gt; &lt;/code&gt;Remote storage = &lt;a href=&#34;https://k8s.gcr.io&#34;&gt;https://k8s.gcr.io&lt;/a&gt;`&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Create a group&lt;/strong&gt;:  Creat Repository&lt;code&gt;-&amp;gt; Choose&lt;/code&gt;docker(group)&lt;code&gt;-&amp;gt; &lt;/code&gt;HTTP: 8082&lt;code&gt;-&amp;gt;&lt;/code&gt;Allow anaymous docker pull&lt;code&gt;(to allow &lt;/code&gt;docker pull` without authentication) -&amp;gt; select members into the group&lt;/li&gt;
&lt;li&gt;Go to &lt;code&gt;Security-Realms&lt;/code&gt; and activate &lt;code&gt;Docker Bearer Token Realm&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Then, you may try pulling image in you server:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo docker pull mirrors.example.com/library/nginx:alpine                                &lt;span style=&#34;color:#75715e&#34;&gt;# from Docker Hub&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo docker pull mirrors.example.com/zvonimirsun/yourls                                  &lt;span style=&#34;color:#75715e&#34;&gt;# from ghcr.io&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo docker pull mirrors.example.com/google-containers/kubernetes-dashboard-amd64:v1.8.3 &lt;span style=&#34;color:#75715e&#34;&gt;# from gcr.io&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo docker pull mirrors.example.com/coreos/kube-state-metrics:v1.5.0                    &lt;span style=&#34;color:#75715e&#34;&gt;# from quay.io&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;For the system&amp;rsquo;s &lt;code&gt;containerd&lt;/code&gt;, you can simply go to &lt;code&gt;/etc/containerd/containerd/config.toml&lt;/code&gt; and modify the configuration and restart &lt;code&gt;sudo systemctl restart containered&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;plugins.cri.registry.mirrors&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;plugins.cri.registry.mirrors.&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;docker.io&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    endpoint &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;https://mirrors.example.com&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;plugins.cri.registry.mirrors.&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;quay.io&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    endpoint &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;https://mirrors.example.com&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;plugins.cri.registry.mirrors.&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ghcr.io&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    endpoint &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;https://mirrors.example.com&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;plugins.cri.registry.mirrors.&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;gcr.io&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    endpoint &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;https://mirrors.example.com&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;plugins.cri.registry.mirrors.&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;k8s.gcr.io&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    endpoint &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;https://mirrors.example.com&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;For the rancher&amp;rsquo;s &lt;code&gt;containerd&lt;/code&gt;, k3s will generate config.toml for containerd in &lt;code&gt;/var/lib/rancher/k3s/agent/etc/containerd/config.toml&lt;/code&gt;, for advanced customization for this file you can create another file called &lt;code&gt;config.toml.tmpl&lt;/code&gt; in the same directory and it will be used instead. Then, modify the configuration into the file and restart the &lt;code&gt;sudo systemctl restart k3s&lt;/code&gt; or &lt;code&gt;sudo systemctl restart k3s-agent&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;plugins.cri.registry.mirrors&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;plugins.cri.registry.mirrors.&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;docker.io&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    endpoint &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;https://mirrors.example.com&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;plugins.cri.registry.mirrors.&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;quay.io&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    endpoint &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;https://mirrors.example.com&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;plugins.cri.registry.mirrors.&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ghcr.io&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    endpoint &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;https://mirrors.example.com&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;plugins.cri.registry.mirrors.&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;gcr.io&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    endpoint &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;https://mirrors.example.com&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;plugins.cri.registry.mirrors.&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;k8s.gcr.io&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    endpoint &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;https://mirrors.example.com&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;footnotes&#34; role=&#34;doc-endnotes&#34;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&#34;fn:1&#34;&gt;
&lt;p&gt;Before you up the yaml, create the folder first and give the proper permission, for me: &lt;code&gt;mkdir data &amp;amp;&amp;amp; chmod 777 data&lt;/code&gt; is good enough. The default password is stored in &lt;code&gt;data/admin.password&lt;/code&gt;.&amp;#160;&lt;a href=&#34;#fnref:1&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</description>
    </item>
    
    <item>
      <title>ğŸ§‘ğŸ¿â€ğŸ’» K3s/Kubernetes - Set up a K3s Cluster with your VPS (2)</title>
      <link>https://blog.cklau.cc/post/k3s-setup-2/</link>
      <pubDate>Mon, 26 Sep 2022 00:11:21 +0800</pubDate>
      <guid>https://blog.cklau.cc/post/k3s-setup-2/</guid>
      <description>&lt;p&gt;Generating a basic K3s cluster is quite easy by following the &lt;a href=&#34;https://doc.k3s.io&#34;&gt;K3s&amp;rsquo;s Doc&lt;/a&gt;. let try to modify it into High Availability Cluster. Single server cluster can meet a variety of use cases, but for environments where uptime of the Kubenetes control plane is critical, where we need the High Availability configuration. There are two ways for High Availability:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;High Availability with an External DB (for example, &lt;a href=&#34;https://www.postgresql.org/&#34;&gt;PostgreSQL&lt;/a&gt;, &lt;a href=&#34;https://www.mysql.com/&#34;&gt;MySQL&lt;/a&gt;,  &lt;a href=&#34;https://mariadb.org/&#34;&gt;MariaDB&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;High Availability with Embedded DB (&lt;a href=&#34;https://etcd.io/&#34;&gt;etcd&lt;/a&gt;)&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;I chose the second one - with Embedded DB.&lt;/p&gt;
&lt;h2 id=&#34;enviornment&#34;&gt;Enviornment&lt;/h2&gt;
&lt;p&gt;Here is the list of my device:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;Node Name&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;Location&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;Specification&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;OS&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;Network&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;IP&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;hilbert(master)&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Tencent Cloud (SH-CN)&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;4C8G&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Ubuntu 20.04 LTS&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Pbulic IP + Wireguard&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1.xx.xx.xx + 192.168.36.1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;cantor(master)&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Tencent Cloud (SH-CN)&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;2C4G&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Ubuntu 20.04 LTS&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Pbulic IP + Wireguard&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;110.xx.xx.xx + 192.168.36.2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;newton(agent)&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Tencent Cloud (GZ-CN)&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1C2G&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Ubuntu 20.04 LTS&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Pbulic IP + Wireguard&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;119.xx.xx.xx + 192.168.36.3&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;k3s-installation&#34;&gt;K3s Installation&lt;/h2&gt;
&lt;h3 id=&#34;k3s-server-node&#34;&gt;K3s Server Node&lt;/h3&gt;
&lt;p&gt;To set up the Server, I follow the instruction from &lt;a href=&#34;https://k3s.io&#34;&gt;K3s&lt;/a&gt; with a little modification, since I want to customize the network and node name. Here is the command I used for server-installation:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;curl -sfL https://get.k3s.io | K3S_TOKEN&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&amp;lt;token&amp;gt;  INSTALL_K3S_EXEC&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;server \
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;        --node-ip &lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;ip addr show eth0 | sed -n &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;/inet /{s/^.*inet \([0-9.]\+\).*$/\1/;p}&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt; \
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;        --token &lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;openssl rand --hex 16&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt; \
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;        --advertise-address &lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;ip addr show eth0 | sed -n &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;/inet /{s/^.*inet \([0-9.]\+\).*$/\1/;p}&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt; \
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;        --node-external-ip &lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;ip addr show eth0 | sed -n &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;/inet /{s/^.*inet \([0-9.]\+\).*$/\1/;p}&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;  \
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;        --flannel-iface eth0   \
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;        --node-name &lt;/span&gt;$HOSTNAME&lt;span style=&#34;color:#e6db74&#34;&gt; \
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;        --cluster-init&amp;#34;&lt;/span&gt; sh -
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;where you can see that &lt;code&gt;--node-ip&lt;/code&gt; is the ip address to advertise for node; &lt;code&gt;--advertise-address&lt;/code&gt; is the ip address that apiserver user to advertise to members of the cluster; &lt;code&gt;--node-external-ip&lt;/code&gt; is the external ip address to advertise for node; &lt;code&gt;--flannel-iface&lt;/code&gt; is to override the default flannel interface.&lt;/p&gt;
&lt;p&gt;For whom can not access Google and GitHub fluently, you may try:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# for whom can not access Google and Github fluently, you may try:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;curl -sfL https://rancher-mirror.oss-cn-beijing.aliyuncs.com/k3s/k3s-install.sh | INSTALL_K3S_MIRROR&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;cn INSTALL_K3S_EXEC&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;server \
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;        --node-ip &lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;ip addr show wg0 | sed -n &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;/inet /{s/^.*inet \([0-9.]\+\).*$/\1/;p}&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt; \
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;        --token &lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;openssl rand --hex 16&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt; \
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;        --advertise-address &lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;ip addr show wg0 | sed -n &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;/inet /{s/^.*inet \([0-9.]\+\).*$/\1/;p}&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt; \
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;        --node-external-ip &lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;ip addr show wg0 | sed -n &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;/inet /{s/^.*inet \([0-9.]\+\).*$/\1/;p}&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;  \
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;        --flannel-iface wg0   \
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;        --node-name &lt;/span&gt;$HOSTNAME&lt;span style=&#34;color:#e6db74&#34;&gt; \
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;        --cluster-init&amp;#34;&lt;/span&gt; sh -
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;To generate the token, I used &lt;code&gt;openssl rand --hex 16&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Similarly, for the second server, you can use the same configuration above with IPs&amp;rsquo; substitution.&lt;/p&gt;
&lt;h3 id=&#34;k3s-node&#34;&gt;K3s node&lt;/h3&gt;
&lt;p&gt;For the K3s node, you can simply reuse the above command with a modification: change &lt;code&gt;server&lt;/code&gt; to &lt;code&gt;agent&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;curl -sfL https://rancher-mirror.oss-cn-beijing.aliyuncs.com/k3s/k3s-install.sh | INSTALL_K3S_MIRROR&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;cn INSTALL_K3S_EXEC&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;agent \
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;        --server https://&amp;lt;server-ip&amp;gt;:6443 \
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;        --token &amp;lt;token&amp;gt; \
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;        --node-ip &lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;ip addr show wg0 | sed -n &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;/inet /{s/^.*inet \([0-9.]\+\).*$/\1/;p}&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt; \
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;        --flannel-iface wg0 \
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;        --node-name &lt;/span&gt;$HOSTNAME&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&lt;/span&gt; sh -
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;After the installation of the server and node, you may check whether the server can reach the node correctly:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo kubectl get nodes -o wide
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# NAME      STATUS   ROLES                       AGE   VERSION        INTERNAL-IP    EXTERNAL-IP     OS-IMAGE           KERNEL-VERSION      CONTAINER-RUNTIME&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# cantor    Ready    control-plane,etcd,master   9h    v1.24.6+k3s1   10.210.120.2   xxx.xxx.xxx.xxx   Ubuntu 20.04 LTS   5.4.0-126-generic   containerd://1.6.8-k3s1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# hilbert   Ready    control-plane,etcd,master   9h    v1.24.6+k3s1   10.210.120.1   xxx.xxx.xxx.xxx   Ubuntu 20.04 LTS   5.4.0-126-generic   containerd://1.6.8-k3s1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# newton    Ready    worker                      9h    v1.24.6+k3s1   10.210.120.3   10.210.120.3    Ubuntu 20.04 LTS   5.4.0-126-generic   containerd://1.6.8-k3s1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo kubectl top nodes
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# NAME      CPU(cores)   CPU%   MEMORY(bytes)   MEMORY%&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# cantor    445m         22%    2451Mi          71%&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# hilbert   300m         7%     3942Mi          52%&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# newton    90m          9%     1118Mi          56%&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;helm-installlation&#34;&gt;Helm Installlation&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://helm.sh&#34;&gt;Helm&lt;/a&gt; is the package manager of kubernetes, where usually we can use it to download and install pre-packed applications to our cluster. To install it, we can go to helm&amp;rsquo;s GitHub release to find the compiled binary file and download it. Here is an example for the Linux amd64:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;wget https://get.helm.sh/helm-v3.10.0-linux-amd64.tar.gz -O helm.tar.gz
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;tar -xvf helm.tar.gz
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo mv linux-amd64/helm /usr/local/bi
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;helm version
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# version.BuildInfo{Version:&amp;#34;v3.10.0&amp;#34;, GitCommit:&amp;#34;ce66412a723e4d89555dc67217607c6579ffcb21&amp;#34;, GitTreeState:&amp;#34;clean&amp;#34;, GoVersion:&amp;#34;go1.18.6&amp;#34;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;change-the-mirrors-for-containerd-optional&#34;&gt;Change the mirrors for Containerd (Optional)&lt;/h2&gt;
&lt;p&gt;For some reason, the China region&amp;rsquo;s network may be stuck and cannot connect (or very slow) to some of the website, sadly, gcr.io&lt;code&gt;and&lt;/code&gt;quay.io` are inside the list. Thus, we may need to change to the China&amp;rsquo;s mirrors.&lt;/p&gt;
&lt;p&gt;For example: we can subsitute the &lt;code&gt;quay.io&lt;/code&gt; with &lt;code&gt;https://quay-mirror.qiniu.com&lt;/code&gt; and &lt;code&gt;gcr.io&lt;/code&gt; we can use &lt;code&gt;https://registry.aliyuncs.com&lt;/code&gt;. For the docker, we can use the &lt;a href=&#34;https://www.daocloud.io/&#34;&gt;Daocloud&lt;/a&gt;&amp;rsquo;s script to update the mirrors. This may help speeding up the installication process in the after step.&lt;/p&gt;
&lt;h2 id=&#34;cert-manager-installation-and-configuration&#34;&gt;Cert-Manager Installation and Configuration&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://cert-manager.io/&#34;&gt;Cert-Manager&lt;/a&gt; is a cloud-native certificate management tool which can help us automatically sign SSL/TLC certificate from Let&amp;rsquo;s Encrypt with ACME. Typically, Cert-Manager offers two challenge validations - HTTP01 and DNS01 challenges. In here, we use DNS01, but for now, let us install the Cert-Manager first.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Add the helm repository and update repo: &lt;code&gt;sudo helm repo add jetstack https://charts.jetstack.io &amp;amp;&amp;amp; sudo helm repo update&lt;/code&gt; &lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/li&gt;
&lt;li&gt;Install the cert-manager: &lt;code&gt;helm install cert-manager jetstack/cert-manager --namespace cert-manager --create-namespace --version v1.9.1 --set installCRDs=true&lt;/code&gt; (create a NS; cert-manager&amp;rsquo;s version is v1.9.1; install the CRD resources)&lt;/li&gt;
&lt;li&gt;Check the cert-manager&amp;rsquo;s status: &lt;code&gt;sudo kubectl get pods --namespace cert-manager&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;After installing the cert-manager, we need to go to [Cloudflare&amp;rsquo;s dashboard(https://dash.cloudflare.com/profile) to create a API token with &amp;ldquo;Edit zone DNS&amp;rdquo; template, set permission: &lt;code&gt;Zone - DNS - Edit&lt;/code&gt; and &lt;code&gt;Zone - Zone - Read&lt;/code&gt;, other can be default. Remember that the API will only show onee, you may need to copy it before turn of the tab.&lt;/p&gt;
&lt;p&gt;Create a yaml (&lt;code&gt;cloudflare-api-token-secret.yaml&lt;/code&gt; and you may change the file name) and start a new Issuer:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;apiVersion&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;v1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;kind&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;Secret&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;metadata&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;name&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;cloudflare-api-token-secret&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;# you may change the name&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;namespace&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;cert-manager&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;type&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;Opaque&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;stringData&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;api-token&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;lt;CF-API-TOKEN&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Create another yaml (&lt;code&gt;ClusterIssuer.yaml&lt;/code&gt;):&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;apiVersion&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;cert-manager.io/v1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;kind&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;ClusterIssuer&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;metadata&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;name&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;letsencrypt-dns01&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;spec&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;acme&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;privateKeySecretRef&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;name&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;letsencrypt-dns01&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;email&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;lt;your-email-addr&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;server&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;https://acme-v02.api.letsencrypt.org/directory&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;solvers&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    - &lt;span style=&#34;color:#f92672&#34;&gt;dns01&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;cloudflare&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#f92672&#34;&gt;email&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;lt;your-cf-account-email-addr&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#f92672&#34;&gt;apiTokenSecretRef&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#f92672&#34;&gt;name&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;cloudflare-api-token-secret&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;# need to be same with the above yaml metadata&amp;#39;s name&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#f92672&#34;&gt;key&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;api-token&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Create the third yaml (&lt;code&gt;Certificate.yaml&lt;/code&gt;):&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;apiVersion&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;cert-manager.io/v1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;kind&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;Certificate&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;metadata&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;name&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;lt;domain-name&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;# you may change the name&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;namespace&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;default&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;spec&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;dnsNames&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  - &lt;span style=&#34;color:#ae81ff&#34;&gt;example.com&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  - &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;*.example.com&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;issuerRef&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   &lt;span style=&#34;color:#f92672&#34;&gt;kind&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;ClusterIssuer&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;   &lt;span style=&#34;color:#f92672&#34;&gt;name&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;letsencrypt-dns01&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;# Cite ClusterIssuer and use DNS01 for the challenge&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;secretName&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;lt;secret-name&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;# the certificate with store in this cecret and you may change it &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Then, apply these three yaml file, and wait for a while. Use &lt;code&gt;sudo kubectl describe certificate&lt;/code&gt; to check the status.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo kubectl describe certificate
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;NAME           READY    SECRET       AGE
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&amp;lt;domain-name&amp;gt;   True    &amp;lt;secret&amp;gt;      1m
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;If it is ready, it means that the certificate is Issued.&lt;/p&gt;
&lt;h2 id=&#34;rancher-installation&#34;&gt;Rancher Installation&lt;/h2&gt;
&lt;p&gt;It is easy to install the Rancher, Rancher is a complete software stack for teams adopting containers. It addresses the operational and security challenges of managing multiple Kubernetes clusters, while providing DevOps teams with integrated tools for running containerized workloads.&lt;/p&gt;
&lt;p&gt;Similar to the installation of Cert-Manager:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo helm repo add rancher-latest https://releases.rancher.com/server-charts/latest &lt;span style=&#34;color:#75715e&#34;&gt;# add &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo helm install rancher rancher-latest/rancher --namespace cattle-system --create-namespace --set hostname&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;rancher.k3s.cklau.ml --set bootstrapPassword&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;admin --set ingress.tls.source&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;secret
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Then, we need to create a certificate and an ingress for Rancher where we can use our domain to access:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;apiVersion&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;cert-manager.io/v1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;kind&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;Certificate&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;metadata&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;name&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;tls-rancher-ingress&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;namespace&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;cattle-system&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;spec&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;secretName&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;lt;secret-name&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;commonName&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;*.example.com&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;dnsNames&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  - &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;*.example.com&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;issuerRef&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;name&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;letsencrypt&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;kind&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;ClusterIssuer&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;---
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;apiVersion&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;networking.k8s.io/v1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;kind&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;Ingress&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;metadata&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;name&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;rancher&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;namespace&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;cattle-system&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;annotations&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;cert-manager.io/cluster-issuer&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;letsencrypt-dns01&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;spec&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;rules&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  - &lt;span style=&#34;color:#f92672&#34;&gt;host&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;rancher.example.com&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;http&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;paths&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#f92672&#34;&gt;backend&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;          &lt;span style=&#34;color:#f92672&#34;&gt;service&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#f92672&#34;&gt;name&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;rancher&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#f92672&#34;&gt;port&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;              &lt;span style=&#34;color:#f92672&#34;&gt;number&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;80&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;pathType&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;ImplementationSpecific&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;tls&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  - &lt;span style=&#34;color:#f92672&#34;&gt;hosts&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    - &lt;span style=&#34;color:#ae81ff&#34;&gt;rancher.example.com&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;secretName&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;&amp;lt;secret-name&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;After apply the yaml, we may check whether the rancher install properly: &lt;code&gt;sudo kubectl get pods --namespace cattle-system&lt;/code&gt; and check &lt;code&gt;rancher.example.com&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;footnotes&#34; role=&#34;doc-endnotes&#34;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&#34;fn:1&#34;&gt;
&lt;p&gt;For some reason, I met some problems with helm but they all correlated to the &lt;code&gt;KUBECONFIG&lt;/code&gt;. Thus, you may copy the &lt;code&gt;KUBECONFIG&lt;/code&gt; to &lt;code&gt;~/.kube/config&lt;/code&gt; and this may solve your problem: &lt;code&gt;sudo cat /etc/rancher/k3s/k3s.yaml &amp;gt; ~/.kube/config&lt;/code&gt;&amp;#160;&lt;a href=&#34;#fnref:1&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</description>
    </item>
    
    <item>
      <title>ğŸ§‘ğŸ¿â€ğŸ’» K3s/Kubernetes - Set up a K3s Cluster with your VPS (1)</title>
      <link>https://blog.cklau.cc/post/k3s-setup-1/</link>
      <pubDate>Sat, 24 Sep 2022 00:11:21 +0800</pubDate>
      <guid>https://blog.cklau.cc/post/k3s-setup-1/</guid>
      <description>&lt;h2 id=&#34;before&#34;&gt;Before&lt;/h2&gt;
&lt;p&gt;K3s is a lightweight Kubernetes which is more suitable for the Edge/IoT/CI/ARM scenario/devices. Usually, for person, we do not have multiple high-performance device like 24c server or even higher. Hence, K3s is a way we can learn how to set up a kubernetes cluster.&lt;/p&gt;
&lt;p&gt;For me, I am a bare metal fanatic many year ago, but I changed into a Docker user after I know more about virtualization and containers.  These OS-level virtualization is more convenient when we are trying to migrate our service, like blog migration, authentication migration, etc.&lt;/p&gt;
&lt;h2 id=&#34;environment&#34;&gt;Environment&lt;/h2&gt;
&lt;p&gt;Here is the list of my device:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;Node Name&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;Location&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;Specification&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;OS&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;Network&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;IP&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;hilbert(server)&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Tencent Cloud (SH-CN)&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;4C8G&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Ubuntu 20.04 LTS&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Pbulic IP + Wireguard&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1.xx.xx.xx + 192.168.36.1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;cantor(server)&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Tencent Cloud (SH-CN)&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;2C4G&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Ubuntu 20.04 LTS&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Pbulic IP + Wireguard&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;110.xx.xx.xx + 192.168.36.2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;newton(worker)&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Tencent Cloud (GZ-CN)&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1C2G&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Ubuntu 20.04 LTS&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Pbulic IP + Wireguard&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;119.xx.xx.xx + 192.168.36.3&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;The reason I would like to setup K3s over Wireguard is because of the expandability. Once over the wireguard, I could add other VPS/Server into the LAN and as a node of the K3s cluster easily even if the node does not has a networking problem and as the Wireguard is safe enough I do not have to consider the security issues of nodes&amp;rsquo; interconnection.&lt;/p&gt;
&lt;p&gt;Change servers&amp;rsquo; name:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo hostnamectl --static set-hostname node1 &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sudo hostnamectl  set-hostname node1
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo hostnamectl --static set-hostname node2 &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sudo hostnamectl  set-hostname node2
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo hostnamectl --static set-hostname node3 &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sudo hostnamectl  set-hostname node3
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;set-up-wireguard&#34;&gt;Set up Wireguard&lt;/h3&gt;
&lt;p&gt;I write a &lt;a href=&#34;https://github.com/TerenceLiu98/wgtools&#34;&gt;tool&lt;/a&gt; which can help me set up the Wireguard configuration (you can also try this tool, and any issue or pull request is welcomed)&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Generate a network interface: &lt;code&gt;python add.py network wg0&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Add peers: &lt;code&gt;python add.py node wg0 node1&lt;/code&gt; &amp;amp; &lt;code&gt;python add.py node wg0 node2&lt;/code&gt; &amp;amp; &lt;code&gt;python ad.py node wg0 node3&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Modify the endpoint: &lt;code&gt;python modify wg0 node1 Endpoint 1.xxx.xxx.xxx&lt;/code&gt; &amp;amp; &lt;code&gt;python modify wg0 node2 Endpoint 110.xxx.xxx.xxx&lt;/code&gt; &lt;code&gt;python modify wg0 node3 Endpoint 119.xxx.xxx.xxx&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Generata Wireguard configuration: &lt;code&gt;python generate.py wg0 node1&lt;/code&gt; &amp;amp; &lt;code&gt;python generate.py wg0 node2&lt;/code&gt; &amp;amp; &lt;code&gt;python generate.py wg0 node3&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Copy the Wireguard config to each node: &lt;code&gt;scp node1.conf user_name@node1:~/wg0.conf&lt;/code&gt; &amp;amp; &lt;code&gt;scp node2.conf user_name@node2:~/wg0.conf&lt;/code&gt; &amp;amp; &lt;code&gt;scp node2.conf user_name@node2:~/wg0.conf&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Add static entry to the hosts file:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo cat &amp;gt; /etc/hosts &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;lt;&amp;lt;EOF
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;192.168.1.1 node1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;192.168.1.2 node2
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;192.168.1.3 node3
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
    </item>
    
    <item>
      <title>ğŸ§‘ğŸ¿â€ğŸ’» Homelab: Don&#39;t Let the Docker escape from the ufw&#39;s control</title>
      <link>https://blog.cklau.cc/post/my-homelab-4/</link>
      <pubDate>Thu, 21 Jul 2022 00:11:21 +0800</pubDate>
      <guid>https://blog.cklau.cc/post/my-homelab-4/</guid>
      <description>&lt;p&gt;&amp;ldquo;Uncomplicated firewall&amp;rdquo;, a.k.a, UFW, is the new/next-generation of firewall of Linux system. As says in its name, &amp;ldquo;uncomplicated&amp;rdquo; is the feature. However, in some situation, it is still complicated, for example, works with Docker.&lt;/p&gt;
&lt;p&gt;Usually, for the homelab/VPS, we self-host a bunch of services and use them with reverse proxy (like Nginx, Caddy, Traefik) with different subdomain. However, Docker tries to modify the firewall rules without notification, like this:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ubuntu@myserver:~$ sudo ufw status
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Status: active
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;To                         Action      From
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;--                         ------      ----                 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;80&lt;/span&gt;                         ALLOW       Anywhere                  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;443&lt;/span&gt;                        ALLOW       Anywhere                                 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;22&lt;/span&gt;                         ALLOW       Anywhere                           
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;80&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;v6&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;                    ALLOW       Anywhere &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;v6&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;             
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;443&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;v6&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;                   ALLOW       Anywhere &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;v6&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;                          
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;22&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;v6&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;                    ALLOW       Anywhere &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;v6&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;In ufw list, I only allow the SSH port and HTTP/HTTPS ports. However, in &lt;code&gt;IPTABLES&lt;/code&gt;, we can see that:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ubuntu@bayes:~$ sudo iptables -L DOCKER
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Chain DOCKER &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;7&lt;/span&gt; references&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;target     prot opt source               destination         
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ACCEPT     tcp  --  anywhere             172.21.0.2           tcp dpt:http
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ACCEPT     tcp  --  anywhere             172.21.0.2           tcp dpt:3012
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ACCEPT     tcp  --  anywhere             172.28.0.2           tcp dpt:9000
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ACCEPT     tcp  --  anywhere             172.19.0.3           tcp dpt:postgresql
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ACCEPT     tcp  --  anywhere             172.19.0.2           tcp dpt:6379
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ACCEPT     tcp  --  anywhere             172.19.0.4           tcp dpt:9001
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ACCEPT     tcp  --  anywhere             172.19.0.4           tcp dpt:9000
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ACCEPT     tcp  --  anywhere             172.18.0.5           tcp dpt:9443
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ACCEPT     tcp  --  anywhere             172.18.0.5           tcp dpt:9000
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ACCEPT     tcp  --  anywhere             172.20.0.2           tcp dpt:8082
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ACCEPT     tcp  --  anywhere             172.20.0.2           tcp dpt:tproxy
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The Docker turn only multiple ports which does not show in the UFW list.&lt;/p&gt;
&lt;h2 id=&#34;how-to-avoid-this&#34;&gt;How to avoid this&lt;/h2&gt;
&lt;p&gt;First, make sure that the SSH port is allowed in UFW, and each container can be reached:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo ufw allow ssh              &lt;span style=&#34;color:#75715e&#34;&gt;# or ssh ufw allow &amp;lt;ssh-port&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ufw allow from 172.17.0.0/16    &lt;span style=&#34;color:#75715e&#34;&gt;# allow containers communication&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ufw default deny incoming
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ufw default allow outgoing
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ufw default allow routed
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ufw disable &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; ufw enable
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Then, we need to go the Docker&amp;rsquo;s daemon to modify the configuration:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo mkdir -p /lib/systemd/system/docker.service.d
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo cat &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;lt;&amp;lt; EOF &amp;gt; /lib/systemd/system/docker.service.d/override.conf
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;[Service]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;ExecStart=
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;ExecStart=/usr/bin/dockerd
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo cat &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;lt;&amp;lt; EOF &amp;gt; /etc/docker/daemon.json
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;  &amp;#34;hosts&amp;#34;: [&amp;#34;fd://&amp;#34;],
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;  &amp;#34;dns&amp;#34;: [&amp;#34;8.8.8.8&amp;#34;, &amp;#34;8.8.4.4&amp;#34;],
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;  &amp;#34;iptables&amp;#34;: false
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo systemctl daemon-reload &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sudo systemctl restart docker
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Last, we need to configura the Docker&amp;rsquo;s NAT to make sure that all the containers can route via the &lt;code&gt;docker0&lt;/code&gt; interface:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo cat &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;lt;&amp;lt; EOF &amp;gt;&amp;gt; /etc/ufw/before.rules
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;*nat
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;:POSTROUTING ACCEPT [0:0]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;-A POSTROUTING ! -o docker0 -s 172.17.0.0/16 -j MASQUERADE
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;COMMIT
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;EOF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
    </item>
    
    <item>
      <title>ğŸ§‘ğŸ¿â€ğŸ’» Homelab: My Distributed Homelab</title>
      <link>https://blog.cklau.cc/post/my-homelab-2/</link>
      <pubDate>Thu, 21 Jul 2022 00:11:21 +0800</pubDate>
      <guid>https://blog.cklau.cc/post/my-homelab-2/</guid>
      <description>&lt;h2 id=&#34;networking&#34;&gt;Networking&lt;/h2&gt;
&lt;p&gt;For the homelab, I would like to choose a commerical company&amp;rsquo;s product, as the service can be guaranteed by the company reputation. All my devices can connect to the WAN via NAT1 such that I don&amp;rsquo;t need the nat passthrough solution. I choose &lt;a href=&#34;https://tailscale.com/&#34;&gt;Tailscale&lt;/a&gt; as I mentioned, it performs well under my testing. Just follow the instruction and the networking problem is solved.&lt;/p&gt;
&lt;h2 id=&#34;service&#34;&gt;Service&lt;/h2&gt;
&lt;p&gt;For the homelab, I would like to docker as it is very covinence and can set up easily.&lt;/p&gt;
&lt;p&gt;To install the docker, I just follow the intrduction from the &lt;a href=&#34;https://docs.docker.com/engine/install/ubuntu/&#34;&gt;document&lt;/a&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# uninstall old versions (if installed) &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt-get install remove docker docker-engine docker.io containere runc
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# install using the repository&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt-get update
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt-get install ca-certificates curl gnupg lsb-release &lt;span style=&#34;color:#75715e&#34;&gt;# some preliminary&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo mkdir -p /etc/apt/keyrings &lt;span style=&#34;color:#75715e&#34;&gt;# add gpg key&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;## add key&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;echo &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;deb [arch=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;dpkg --print-architecture&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt; signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;  &lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;lsb_release -cs&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt; stable&amp;#34;&lt;/span&gt; | sudo tee /etc/apt/sources.list.d/docker.list &amp;gt; /dev/null
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# OPTIONAL: for China&amp;#39;s user you may use mirrors.bfsu.edu.cn for a smooth download experience&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;echo &lt;span style=&#34;color:#ae81ff&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;deb [arch=&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;dpkg --print-architecture&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt; signed-by=/etc/apt/keyrings/docker.gpg] https://mirrors.bfsu.edu.cn/docker-ce/linux/ubuntu \
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;  &lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;$(&lt;/span&gt;lsb_release -cs&lt;span style=&#34;color:#66d9ef&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt; stable&amp;#34;&lt;/span&gt; | sudo tee /etc/apt/sources.list.d/docker.list &amp;gt; /dev/null
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# update apt repository and install docker and related packages&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo apt-get update &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sudo apt-get install docker-ce docker-ce-cli containerd.io docker-compose-plugin -y
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# check docker verion&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;sudo docker version
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Client: Docker Engine - Community&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#  Version:           20.10.18&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#  API version:       1.41&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#  Go version:        go1.18.6&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#  Git commit:        b40c2f6&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#  Built:             Thu Sep  8 23:11:43 2022&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#  OS/Arch:           linux/amd64&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#  Context:           default&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#  Experimental:      true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Server: Docker Engine - Community&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#  Engine:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#   Version:          20.10.18&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#   API version:      1.41 (minimum version 1.12)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#   Go version:       go1.18.6&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#   Git commit:       e42327a&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#   Built:            Thu Sep  8 23:09:30 2022&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#   OS/Arch:          linux/amd64&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#   Experimental:     false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#  containerd:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#   Version:          1.6.8&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#   GitCommit:        9cd3357b7fd7218e4aec3eae239db1f68a5a6ec6&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#  runc:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#   Version:          1.1.4&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#   GitCommit:        v1.1.4-0-g5fd4c4d&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#  docker-init:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#   Version:          0.19.0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;#   GitCommit:        de40ad0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;multimedia&#34;&gt;MultiMedia&lt;/h3&gt;
&lt;p&gt;There are multiple multimedia software, for istance, &lt;a href=&#34;https://www.plex.tv/&#34;&gt;Plex&lt;/a&gt;, &lt;a href=&#34;https://emby.media&#34;&gt;Emby&lt;/a&gt;, &lt;a href=&#34;https://jellyfin.org&#34;&gt;Jellyfin&lt;/a&gt;, and &lt;a href=&#34;https://kodi.tv/&#34;&gt;KODI&lt;/a&gt;. For some reason, I did not want to pay too much money of the media service as I just want a place that can show the poster and brief introduction of the video, and I don&amp;rsquo;t need too much &amp;ldquo;fancy&amp;rdquo; features. By comparison, I choose Jellyfin, the &amp;ldquo;open-source version of Emby&amp;rdquo;, as me multimedia server and I install it via the &lt;code&gt;docker-compose.yml&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;version&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;2.1&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;services&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;jellyfin&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;image&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;lscr.io/linuxserver/jellyfin:latest&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;container_name&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;jellyfin&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;environment&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;PUID=1000&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;PGID=1000&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;TZ=Asia/Shanghai&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;volumes&lt;/span&gt;: &lt;span style=&#34;color:#75715e&#34;&gt;# map the physical volume to the container&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;/path/to/library:/config       &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;/path/to/tvseries:/data/tvshows&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;/path/to/movies:/data/movies&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;ports&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;8096&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;8096&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;restart&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;always&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;# when docker restart, the docker image will auto restart&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;authentication&#34;&gt;Authentication&lt;/h3&gt;
&lt;p&gt;There are many authentication software that support Oauth, for instance, &lt;a href=&#34;https://goauthentik.io/&#34;&gt;Authentik&lt;/a&gt;, &lt;a href=&#34;https://www.okta.com/&#34;&gt;Okta&lt;/a&gt;, &lt;a href=&#34;https://auth0.com/&#34;&gt;auth0&lt;/a&gt;, &lt;a href=&#34;https://github.com/ory/hydra&#34;&gt;Ory Hydra&lt;/a&gt;, &lt;a href=&#34;https://www.keycloak.org/&#34;&gt;KeyCloak&lt;/a&gt;, an there are some authentication cloud services, like &lt;a href=&#34;https://authing.cn&#34;&gt;authing.com&lt;/a&gt;. By comparsion, I choose Authentik and KeyCloak, authentik has a good-looking interface, and KeyCloak is a widely used software, which mean there are more example and solution on the interest. The authentik is used for my self-hosted services, and the KeyCloak is for the other serive that I need to provide to other users. Similarly, I use &lt;code&gt;docker-compose.yml&lt;/code&gt; to set up these services:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Authentik&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# you need to set up the ENV parameters on other file call `.env`, check https://goauthentik.io/docs/installation/docker-compose for the detail&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;version&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;3.4&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;services&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;postgresql&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;image&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;docker.io/library/postgres:12-alpine&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;restart&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;unless-stopped&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;healthcheck&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;test&lt;/span&gt;: [&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;CMD-SHELL&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;pg_isready -d $${POSTGRES_DB} -U $${POSTGRES_USER}&amp;#34;&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;start_period&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;20s&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;interval&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;30s&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;retries&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;timeout&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;5s&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;volumes&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;database:/var/lib/postgresql/data&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;environment&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;POSTGRES_PASSWORD=${PG_PASS:?database password required}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;POSTGRES_USER=${PG_USER:-authentik}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;POSTGRES_DB=${PG_DB:-authentik}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;env_file&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;.env&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;redis&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;image&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;docker.io/library/redis:alpine&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;command&lt;/span&gt;: --&lt;span style=&#34;color:#ae81ff&#34;&gt;save 60 1 --loglevel warning&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;restart&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;unless-stopped&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;healthcheck&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;test&lt;/span&gt;: [&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;CMD-SHELL&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;redis-cli ping | grep PONG&amp;#34;&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;start_period&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;20s&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;interval&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;30s&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;retries&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;timeout&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;3s&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;volumes&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;redis:/data&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;server&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;image&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;${AUTHENTIK_IMAGE:-ghcr.io/goauthentik/server}:${AUTHENTIK_TAG:-2022.9.0}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;restart&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;unless-stopped&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;command&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;server&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;environment&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;AUTHENTIK_REDIS__HOST&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;redis&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;AUTHENTIK_POSTGRESQL__HOST&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;postgresql&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;AUTHENTIK_POSTGRESQL__USER&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;${PG_USER:-authentik}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;AUTHENTIK_POSTGRESQL__NAME&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;${PG_DB:-authentik}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;AUTHENTIK_POSTGRESQL__PASSWORD&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;${PG_PASS}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#75715e&#34;&gt;# AUTHENTIK_ERROR_REPORTING__ENABLED: &amp;#34;true&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;volumes&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;./media:/media&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;./custom-templates:/templates&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;geoip:/geoip&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;env_file&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;.env&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;ports&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;0.0.0.0:${AUTHENTIK_PORT_HTTP:-9000}:9000&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;0.0.0.0:${AUTHENTIK_PORT_HTTPS:-9443}:9443&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;worker&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;image&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;${AUTHENTIK_IMAGE:-ghcr.io/goauthentik/server}:${AUTHENTIK_TAG:-2022.9.0}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;restart&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;unless-stopped&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;command&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;worker&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;environment&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;AUTHENTIK_REDIS__HOST&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;redis&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;AUTHENTIK_POSTGRESQL__HOST&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;postgresql&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;AUTHENTIK_POSTGRESQL__USER&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;${PG_USER:-authentik}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;AUTHENTIK_POSTGRESQL__NAME&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;${PG_DB:-authentik}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;AUTHENTIK_POSTGRESQL__PASSWORD&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;${PG_PASS}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#75715e&#34;&gt;# AUTHENTIK_ERROR_REPORTING__ENABLED: &amp;#34;true&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;# This is optional, and can be removed. If you remove this, the following will happen&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;# - The permissions for the /media folders aren&amp;#39;t fixed, so make sure they are 1000:1000&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;# - The docker socket can&amp;#39;t be accessed anymore&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;user&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;root&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;volumes&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;./media:/media&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;./certs:/certs&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;/var/run/docker.sock:/var/run/docker.sock&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;./custom-templates:/templates&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;geoip:/geoip&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;env_file&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;.env&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;volumes&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;database&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;driver&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;local&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;redis&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;driver&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;local&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# KeyClock&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;version&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;3&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;services&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;postgres&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;image&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;postgres&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;volumes&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        - &lt;span style=&#34;color:#ae81ff&#34;&gt;./data:/var/lib/postgresql/data&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;environment&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;POSTGRES_DB&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;keycloak&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;POSTGRES_USER&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;keycloak&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;POSTGRES_PASSWORD&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;password&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;keycloak&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;image&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;keycloak/keycloak:latest&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;environment&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;DB_VENDOR&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;POSTGRES&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;DB_ADDR&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;postgres&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;DB_DATABASE&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;keycloak&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;DB_USER&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;keycloak&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;DB_SCHEMA&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;public&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;DB_PASSWORD&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;password      &lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;# change it if you want&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;KEYCLOAK_USER&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;admin&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;KEYCLOAK_PASSWORD&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;Pa55w0rd&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;# change it if you want &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;PROXY_ADDRESS_FORWARDING&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;true&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;REDIRECT_SOCKET&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;proxy-https&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;ports&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        - &lt;span style=&#34;color:#ae81ff&#34;&gt;8080&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;8080&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;depends_on&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        - &lt;span style=&#34;color:#ae81ff&#34;&gt;postgres&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;working-and-coding&#34;&gt;Working and Coding&lt;/h3&gt;
&lt;p&gt;Most of the time, I just use the local environment for the documentation and coding, however, sometimes I will re-build the computer and to avoid the data loss. Thus, I choose &lt;a href=&#34;https://github.com/outline/outline&#34;&gt;outline&lt;/a&gt; for the documentation, &lt;a href=&#34;https://www.dokuwiki.org/dokuwiki&#34;&gt;dokuwiki&lt;/a&gt; for building the wiki system, [Nexcloud] as my personal Net storage,  and &lt;a href=&#34;https://gitea.io&#34;&gt;Gitea&lt;/a&gt; as my self-hosted code repository. Outline is a Nation-alternative software which also provide a beatiful, realtime knowledge base, where I can easily store my throught and idea wia the web. Dokuwiki is a well-known wiki system without a database backend, which means I can easily migrate it to any place. Between Gitea and Gitlab, I choose Gitea at last because GitLab&amp;rsquo;s hardware requirement is too high that I don&amp;rsquo;t have enough resources to run a GitLab and I just need a place to store my code, not those extra features.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# outline &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# you need to set up the ENV parameters on other file call `.env`, check https://app.getoutline.com/s/770a97da-13e5-401e-9f8a-37949c19f97e/doc/docker-7pfeLP5a8t for the detail&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;version&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;3&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;services&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;outline&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;image&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;outlinewiki/outline&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;env_file&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;./docker.env&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;command&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;sh -c &amp;#34;yarn sequelize:migrate --env=production-ssl-disabled &amp;amp;&amp;amp; yarn start --env=production-ssl-disabled&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;ports&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;3000&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3000&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;    depends_on:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;      - postgres
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;      - redis
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;  redis:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;    image: redis
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;    env_file: ./docker.env
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;    ports:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;      - &amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;6379&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;6379&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;    volumes:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;      - ./redis.conf:/redis.conf
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;    command: [&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;redis-server&amp;#34;, &amp;#34;/redis.conf&amp;#34;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;healthcheck&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;test&lt;/span&gt;: [&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;CMD&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;redis-cli&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ping&amp;#34;&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;interval&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;10s&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;timeout&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;30s&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;retries&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;postgres&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;image&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;postgres&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;env_file&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;./docker.env&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;ports&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;5432:5432&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;volumes&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;database-data:/var/lib/postgresql/data&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;healthcheck&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;test&lt;/span&gt;: [&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;CMD&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;pg_isready -U user&amp;#34;&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;interval&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;30s&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;timeout&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;20s&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;retries&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;environment&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;POSTGRES_USER&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;user      &lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;# change it if you want&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;POSTGRES_PASSWORD&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;pass  &lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;# change it if you want&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;POSTGRES_DB&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;outline&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;storage&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;image&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;minio/minio:latest&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;env_file&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;./docker.env&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;ports&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;9000:9000&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;9001:9001&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;entrypoint&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;sh&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;command&lt;/span&gt;: -&lt;span style=&#34;color:#ae81ff&#34;&gt;c &amp;#39;minio server /data --console-address &amp;#34;:9001&amp;#34;&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;deploy&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;restart_policy&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;condition&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;on&lt;/span&gt;-&lt;span style=&#34;color:#ae81ff&#34;&gt;failure&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;volumes&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;/mnt/minio/data:/data&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;/mnt/minio/config:/root/.minio&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;healthcheck&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;test&lt;/span&gt;: [&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;CMD&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;curl&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;-f&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;http://storage:9000/minio/health/live&amp;#34;&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;interval&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;30s&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;timeout&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;20s&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;retries&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;volumes&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;storage-data&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#ae81ff&#34;&gt;database-data&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# dokuwiki&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;version&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;2&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;services&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;dokuwiki&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;image&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;docker.io/bitnami/dokuwiki&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;ports&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;8089:8080&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;volumes&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;./dokuwiki:/bitnami/dokuwiki&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Nextcloud&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;version&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;2&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;services&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;app&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;container_name&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;nextcloud_app&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;image&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;nextcloud&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;restart&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;always&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;ports&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;10000&lt;/span&gt;:&lt;span style=&#34;color:#ae81ff&#34;&gt;80&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;environment&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;DATABASE_URL=mysql+pymysql://nextcloud:nextcloud@db/nextcloud&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;REDIS_URL=redis://redis:6379&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;volumes&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;/opt/nextcloud/www:/var/www/html&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;depends_on&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;db&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;redis&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;networks&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;default&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;internal&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;db&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;container_name&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;nextcloud_db&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;image&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;mariadb:10.5&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;restart&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;always&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;environment&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;MYSQL_ROOT_PASSWORD=nextcloud  &lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;# change it if you want&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;MYSQL_USER=nextcloud           &lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;# change it if you want&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;MYSQL_PASSWORD=nextcloud       &lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;# change it if you want&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;MYSQL_DATABASE=nextcloud       &lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;# change it if you want&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;volumes&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;/opt/nextcloud/db:/var/lib/mysql&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;networks&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;internal&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;command&lt;/span&gt;: --&lt;span style=&#34;color:#ae81ff&#34;&gt;transaction-isolation=READ-COMMITTED --binlog-format=ROW&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;redis&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;container_name&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;nextcloud_redis&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;image&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;redis&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;volumes&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;/opt/nextcloud/redis/data:/data&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;/opt/nextcloud/redis/redis.conf:/etc/redis/redis.conf&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;restart&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;always&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;networks&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;internal&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;command&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;redis-server /etc/redis/redis.conf --appendonly yes&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;networks&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;default&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;internal&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;internal&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Gitea&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;version&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;3&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;networks&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;gitea&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;external&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;services&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;server&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;image&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;gitea/gitea:latest&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;container_name&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;gitea&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;environment&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;USER_UID=1000&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;USER_GID=1000&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;GITEA__database__DB_TYPE=postgres&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;GITEA__database__HOST=db:5432  &lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;# change it if you want&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;GITEA__database__NAME=gitea    &lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;# change it if you want&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;GITEA__database__USER=gitea    &lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;# change it if you want&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;GITEA__database__PASSWD=gitea  &lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;# change it if you want&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;restart&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;always&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;networks&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;gitea&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;volumes&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;./gitea:/data&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;/etc/timezone:/etc/timezone:ro&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;/etc/localtime:/etc/localtime:ro&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;ports&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;3000:3000&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;1022:22&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;depends_on&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;db&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;db&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;image&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;postgres:14&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;restart&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;always&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;environment&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;POSTGRES_USER=gitea&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;POSTGRES_PASSWORD=gitea&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;POSTGRES_DB=gitea&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;networks&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;gitea&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;volumes&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;./postgres:/var/lib/postgresql/data&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;rss-feed-reader&#34;&gt;RSS Feed Reader&lt;/h3&gt;
&lt;p&gt;I use Miniflux as my RSS Feed Reader, the reason why I give Tiny Tiny RSS is that Miniflux V2 is written by Go-lang and I don&amp;rsquo;t like PHP.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;version&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;3.4&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;services&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;miniflux&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;image&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;miniflux/miniflux:latest&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;ports&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;8080:8080&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;depends_on&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;db&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;environment&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;DATABASE_URL=postgres://miniflux:secret@db/miniflux?sslmode=disable&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;RUN_MIGRATIONS=1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;CREATE_ADMIN=1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;ADMIN_USERNAME=admin&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;ADMIN_PASSWORD=Pa55word&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;OAUTH2_USER_CREATION=true&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;OAUTH2_PROVIDER=oidc&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;OAUTH2_CLIENT_ID=&amp;lt;oauth-client-id&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;OAUTH2_CLIENT_SECRET=&amp;lt;oauth-client-secret&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;OAUTH2_REDIRECT_URL=&amp;lt;miniflux-url&amp;gt;oauth2/oidc/callback&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;OAUTH2_OIDC_DISCOVERY_ENDPOINT=&amp;lt;oidc-endpoint&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;db&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;image&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;postgres:latest&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;environment&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;POSTGRES_USER=miniflux&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;POSTGRES_PASSWORD=secret&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;volumes&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;miniflux-db:/var/lib/postgresql/data&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;healthcheck&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;test&lt;/span&gt;: [&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;CMD&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;pg_isready&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;-U&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;miniflux&amp;#34;&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;interval&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;10s&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;start_period&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;30s&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;volumes&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;miniflux-db&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;key-and-password-management&#34;&gt;Key and Password Management&lt;/h2&gt;
&lt;p&gt;There are multiple different password manager, Google Password Manager, 1Password, LastPass, etc.. But I choose Bitwarden as I can self-host the software on my own machine and I don&amp;rsquo;t need to worry about the data leakage.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;version&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;3&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;services&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;bitwarden&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;image&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;bitwardenrs/server&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;container_name&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;bitwardenrs&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;restart&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;always&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;ports&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        - &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;127.0.0.1:8000:80&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        - &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;127.0.0.1:3012:3012&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;volumes&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#ae81ff&#34;&gt;./bw-data:/data&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;environment&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;WEBSOCKET_ENABLED&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;true&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;SIGNUPS_ALLOWED&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;false&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;WEB_VAULT_ENABLED&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;true&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;ADMIN_TOKEN&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;lt;admin-token&amp;gt;&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;# you can generate the token by using openssl: `openssl rand -hex 32`&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
    </item>
    
    <item>
      <title>ğŸ§‘ğŸ¿â€ğŸ’» Homelab: My Network setup</title>
      <link>https://blog.cklau.cc/post/my-homelab-3/</link>
      <pubDate>Thu, 21 Jul 2022 00:11:21 +0800</pubDate>
      <guid>https://blog.cklau.cc/post/my-homelab-3/</guid>
      <description>&lt;h2 id=&#34;in-general&#34;&gt;In General&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://bucket.cklau.cc/outline-bucket/uploads/f96d0f35-cf0a-46bd-aeca-b1a1ac9052c9/d9c7631a-cd68-4016-903c-27c804edce1a/server.png&#34; alt=&#34;Network&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;tools-i-use&#34;&gt;Tools I use&lt;/h2&gt;
&lt;p&gt;I choose Wireguard since itâ€™s fast because of its light design, and itâ€™s secure because it uses the best cryptographic tools available. However, for each time, the user may need to consider a SUBNET for the wireguard and a IP for each node, for me, it is every annoyed, as I have too many subnet need to be configured. Thus, I build a little tool: &lt;a href=&#34;https://github.com/TerenceLiu98/wgtools&#34;&gt;wgtools&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;how-to-use&#34;&gt;How to use&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;prerequest:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;clone the code into local directory: &lt;code&gt;git clone  https://github.com/TerenceLiu98/wgtools.git&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;install the requirement: &lt;code&gt;python -m pip install -r requirements.txt&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;install the wireguard before using the tool&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;configuration:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;new a ipv4 pool: &lt;code&gt;python add.py network wg0&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;new (a) peer(s): &lt;code&gt;python add.py node wg0 node1&lt;/code&gt; + &lt;code&gt;python add.py node wg0 node2&lt;/code&gt; + &lt;code&gt;python add.py node wg0 node3&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;check the information: &lt;code&gt;cat wg0.conf&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;modify the endpoint: &lt;code&gt;python modify.py wg0 node1 Endpoint 1.1.1.1&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;generate configuration for each node: &lt;code&gt;python generate.py wg0 node1&lt;/code&gt; + &lt;code&gt;python genenrate.py wg0 node2&lt;/code&gt; + &lt;code&gt;python generate wg0 node3&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;script&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;copy the configuration to the machine&lt;/li&gt;
&lt;li&gt;use &lt;code&gt;wg-quick&lt;/code&gt; to quick start the wireguard&lt;/li&gt;
&lt;li&gt;check the connectivity via `ping&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;why-not-wan&#34;&gt;Why not WAN&lt;/h3&gt;
&lt;p&gt;Yes, using the public IP is convenient but you may counter some security problem as there are multiple ports need to exposed for the communication between nodes (both Kubernetes and Docker Swarm). To avoid this, I can easily use a VPN to avoid the problem, thus, why not.&lt;/p&gt;
&lt;h2 id=&#34;what-wiregurad-can-do&#34;&gt;What wiregurad can do&lt;/h2&gt;
&lt;p&gt;To be continued.&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>ğŸ§‘ğŸ¿â€ğŸ’» Homelab: My Devices</title>
      <link>https://blog.cklau.cc/post/my-homelab-1/</link>
      <pubDate>Wed, 20 Jul 2022 00:11:21 +0800</pubDate>
      <guid>https://blog.cklau.cc/post/my-homelab-1/</guid>
      <description>&lt;p&gt;For a long time, I held many different digital gadgets, however, I did not consider putting them into a cluster, or more precisely, setting up a platform where I can easily manage them. In this summer vacation, I started thinking of a possibility of setting up a distributed homelab.&lt;/p&gt;
&lt;h2 id=&#34;why-distributed&#34;&gt;Why Distributed&lt;/h2&gt;
&lt;p&gt;Since I am wandering around the &lt;a href=&#34;https://en.wikipedia.org/wiki/Guangdong%E2%80%93Hong_Kong%E2%80%93Macao_Greater_Bay_Area&#34;&gt;big bay area&lt;/a&gt;, multiple different devices are scattered.  Thus, I have to build a distributed cluster.&lt;/p&gt;
&lt;p&gt;Here is the list of my bare metal device:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;Device&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;Location&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;Configuration&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;System&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;Network&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;DELL EMC R730&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Zhuhai, China&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;E5-2650V4 + 128GB + 240GB SSD + 600GB HDD + NVIDIA TITAN XP&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Ubuntu 20.04 LTS&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;500Mbps&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;DELL Precision T1700&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Zhuhai, China&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;i7-4790 + 16GB + 256GB SSD + 1T SATA HDD + NVIDIA RTX 2060Ti&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Arch Linux&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;500Mbps&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Homebuilt PC&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Zhongshan, China&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;i5-9400f + 16GB + 256GB SSD + 256GB SSD + 2T SATA HDD + NVIDIA TITAN XP&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Arch Linux&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;500Mbps&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Homebuilt NAS&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Shenzhen, China&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;AMD A8-5550M + 6G DDR3 + 128G SSD + 3T SATA HDD&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Ubuntu 20.04 LTS&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1Gbps&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;ARM Router&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Shenzhen, China&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;rk3568 + 2GB Mem + 8GB EMMC&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;iStoreOS (based on OpenWrt)&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1Gbps&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;ARM Router&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Shenzhen, China&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;rk3399 + 1GB Mem + 1GB + 16GB EMMC&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Ubuntu 20.04 LTS&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1Gbps&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;ARM Router (In future)&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Guangzhou, China&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;rk3399 + 1GB Mem + 1GB + 16GB EMMC&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Ubuntu 20.04 LTS&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;100Mbps&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Not only the bare metal, I also own a bunch of VPS/VPC/VM/&lt;a href=&#34;https://www.tencentcloud.com/products/lighthouse&#34;&gt;Lighthouse&lt;/a&gt;, here is the list&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;Device&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;Location&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;Configuration&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;System&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;Network&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;A Lighthouse server&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Tencent Cloud - Guangzhou&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1C2G&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Ubuntu 20.04 LTS&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;3Mbps&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;A Lighthouse server&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Tencent Cloud - Shuanghai&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;2C4G&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Ubuntu 20.04 LTS&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;3Mbps&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;A Lighthouse server&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Tencent Cloud - Shuanghai&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;4C8G&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Ubuntu 20.04 LTS&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;3Mbps&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;A Lighthouse server&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Tencent Cloud - Shuanghai&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;2C2G&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Ubuntu 20.04 LTS&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;3Mbps&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;A Lighthouse server&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Tencent Cloud - HKSAR&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;2C4G&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Ubuntu 20.04 LTS&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;30Mbps&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;A Lighthouse server&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Tencent Cloud - HKSAR&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;2C4G&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Ubuntu 20.04 LTS&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;30Mbps&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;A Lighthouse server&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Tencent Cloud - Singapore&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;2C2G&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Ubuntu 20.04 LTS&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;30Mbps&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;A VM server&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Oracle Cloud - Japan&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1C1G&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Ubuntu 20.04 LTS&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;500Mbps&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;A VM server&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Oracle Cloud - Japan&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1C1G&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Ubuntu 20.04 LTS&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;500Mbps&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;A VM server&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;CubeCloud - HKSAR&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1C512M&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Ubuntu 20.04 LTS&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1Gbps&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;After the listing, you may know why I need a distributed solution.&lt;/p&gt;
&lt;h2 id=&#34;possible-solution&#34;&gt;Possible solution&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;Docker Swarm&lt;/li&gt;
&lt;li&gt;Kubernetes&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Docker Swarm refers to a container orchestration tool that allows user to manage multiple containers within multiple nodes (a cluster). The document can be found in &lt;a href=&#34;https://docs.docker.com/engine/swarm/&#34;&gt;here&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Kubernetes, a.k. K8s, is an open-source system for automating deployment, scaling and managerment of containerized applications. The introduction can be found in &lt;a href=&#34;https://kubernetes.io/docs/home/&#34;&gt;here&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;In general, Kubernetes is more suitable for those complex applications within the complex development/production environment, and the Docker Swarm is designed for ease of use. Based on the introduction and comparison, I design to use them simultaneously, parts of the device will be used in Docker Swarm (Dhe DS cluster) and others will be used in K8s, those who need persistance will be deployed in DS cluster and the K8s cluster is used for studying.&lt;/p&gt;
&lt;p&gt;After the platform architecture, we need a networking solution for putting up these devices into a LAN. Intuitively, I need a VPN(Virtual Private Network) software as these device can be accessed via the WAN. Based on the VPN software, I may develop my own &lt;a href=&#34;https://en.wikipedia.org/wiki/Software-defined_networking&#34;&gt;SD-WAN&lt;/a&gt;. Here are some SDN (Sofware-Defined Networking) solutions:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://www.zerotier.com/&#34;&gt;Zerotier&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://tailscale.com/&#34;&gt;Tailscale&lt;/a&gt;: based on Wireguard&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/slackhq/nebula&#34;&gt;Nebula&lt;/a&gt;: A scalable overlay networking tool by Slack&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/ntop/n2n&#34;&gt;n2n&lt;/a&gt;: peer-to-peer VPN&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;After the comparison, for my home devices, I will choose Tailscale as its performance in my experiment, and for those two cluster, I will use Wireguard as I don&amp;rsquo;t need to pay any fee for occupation.&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>ç¤¾ç¾¤çš„ç”Ÿè€ç—…æ­»</title>
      <link>https://blog.cklau.cc/post/hcc-survival-die.zh/</link>
      <pubDate>Thu, 05 Aug 2021 05:58:00 +0800</pubDate>
      <guid>https://blog.cklau.cc/post/hcc-survival-die.zh/</guid>
      <description>&lt;blockquote&gt;
&lt;p&gt;ç­†è€…æ³¨ï¼šäººç”Ÿç™¾æ…‹ä¸¦ä¸æ˜¯â€œå‹¸å–»â€å¤§å®¶çœ‹é–‹å¾Œèººå¹³ï¼Œè€Œæ˜¯çœ‹éç™¾æ…‹ï¼Œä¾ç„¶ä¿æŒå‘å…‰çš„å¸Œæœ›ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;ç¤¾ç¾¤çš„å®šç¾©&#34;&gt;ç¤¾ç¾¤çš„å®šç¾©&lt;/h2&gt;
&lt;p&gt;æŒ‰ç…§ç¾ç•¶ä»£äº’è¯ç¶²çš„å®šç¾©ï¼Œå…¬/ç§åŸŸæµé‡çš„é›†åˆé«”ï¼›æ›´åŠ ç›´ç™½çš„èªªï¼Œä¾¿æ˜¯é€šéç¤¾äº¤èªè­˜çš„ä¸€ç¾¤äººï¼Œä»–å€‘æœ‰ç€å…±åŒæ„›å¥½èˆ‡èˆˆè¶£ï¼Œå¾è€Œé›†ä¸­åœ¨äº†ä¸€èµ·ã€‚ç•¶ç„¶ï¼Œç¤¾ç¾¤é€™å€‹è©å·²ç¶“å­˜åœ¨äº†å¾ˆä¹…ï¼Œç”šè‡³é‚„æœ‰ä¸€å€‹ä¸»ç¾©ç¨±ä¹‹çˆ²ã€Œç¤¾ç¾¤ä¸»ç¾©ã€ã€‚&lt;/p&gt;
&lt;p&gt;ç¤¾ç¾¤ä¸»ç¾©èªçˆ²ï¼Œç¤¾ç¾¤é€ å°±äº†äººï¼Œäººçš„è‡ªæˆ‘èªåŒèˆ‡è‡ªæˆ‘è§€å¿µæ˜¯ç”±ä»–æ‰€è™•çš„ç¤¾ç¾¤é€ å°±çš„ã€‚&lt;em&gt;(æµ·æ˜, &amp;amp; æ¸© (2002). å’Œè€Œä¸åŒ: æ¯”è¾ƒå“²å­¦ä¸ä¸­è¥¿ä¼šé€š. åŒ—äº¬å¤§å­¦å‡ºç‰ˆç¤¾)&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;è½èµ·ä¾†ï¼ŒæŒºæœ‰é“ç†çš„ï¼Œä½†ï¼Œå€‹äººèªçˆ²ï¼Œé€™ç¨®ç¤¾ç¾¤ä¸»ç¾©æ˜¯æ›´åŠ å®è§€çš„è§€æ¸¬äººçš„è¡Œçˆ²èˆ‡è¡¨ç¾ï¼Œè€Œä¸æ˜¯æˆ‘å€‘ç¾åœ¨æ‰€è¦‹çš„ç¤¾ç¾¤ã€‚æ­£å¦‚ä¸Šæ–‡æ‰€èªªã€Œä»–å€‘æœ‰ç€å…±åŒæ„›å¥½èˆ‡èˆˆè¶£ã€ï¼Œç¾åœ¨çš„ç¤¾ç¾¤æ›´å¤šçš„æ˜¯åœç¹é€™å…©å€‹å‡ºç™¼çš„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç¤¾ç¾¤çš„ç›®çš„&#34;&gt;ç¤¾ç¾¤çš„ç›®çš„&lt;/h2&gt;
&lt;p&gt;ã€Œäººäººéƒ½æ˜¯ç”¢å“ç¶“ç†ã€ä¸Šæœ‰æåˆ°â€œå¦‚æœæ²’æœ‰æƒ³å¥½åšç¤¾ç¾¤çš„ç›®çš„ï¼Œå°±ä¸è¦å»åšâ€ ã€‚ç­†è€…èªçˆ²ï¼Œå°æ–¼å…¬å¸æˆ–è€…ä»¥ç›ˆåˆ©çˆ²ç›®çš„çš„äººï¼Œç•¶ç„¶å¦‚æ˜¯ï¼Œä½†ï¼Œåœ¨å­¸æ ¡æˆ–ç¤¾æœƒï¼Œå¯èƒ½æœ‰ä¸€éƒ¨åˆ†äººä¸å¤ªé¡˜æ„æ—¥æ—¥è¬›é‡‘ä¸è¬›å¿ƒã€ä¸»ç¾©åœ¨å£è€Œç”Ÿæ„åœ¨æ‰‹ã€‚åŸºæ–¼é€™ç¨®å‡è¨­ï¼Œå•é¡Œåˆè½‰è®Šæˆäº†å¿ƒå’Œé‡‘çš„çˆ­å…ˆï¼Œèª°å°èª°å•±ï¼Œä¸æ¸…æ¥šã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç¤¾ç¾¤çš„ç™¼å±•&#34;&gt;ç¤¾ç¾¤çš„ç™¼å±•&lt;/h2&gt;
&lt;p&gt;è¬›åˆ°ç™¼å±•ï¼Œå°±ä¸å¾—ä¸æâ€œé‹ç‡Ÿâ€ï¼Œç¶“ç‡Ÿä¸€å€‹é¤å»³ã€å£«å¤šä¸æ˜¯æ˜“äº‹ï¼Œç¤¾ç¾¤ä¹Ÿä¸€æ¨£ã€‚å°‡ç¤¾ç¾¤é‹ç‡Ÿæˆå…¬å¸æˆ–è€…å› çˆ²å…¬å¸è€Œé‹ç‡Ÿç¤¾ç¾¤ï¼Œç­†è€…æ²’æœ‰ç¶“é©—ï¼Œæ‰€ä»¥ä¸åœ¨é€™è£éå¤šè¡¨è¿°ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰å¹¸ï¼Œç­†è€…åƒèˆ‡ï¼ˆæ³¨ï¼šåƒèˆ‡æ˜¯å¾ 2016 å¹´è‡³ä»Šï¼‰åˆ°ä¸€å€‹ä»¥å®¶å¸¸è£çŸ­çˆ²ä¸»ï¼Œè¨ˆç®—æ©ŸæŠ€è¡“çˆ²è¼”çš„å¹æ°´ç¤¾ç¾¤ï¼ˆç¤¾ç¾¤å…¨ç¨±ï¼šUIC-HCC, Homebrew Computer Clubï¼‰ï¼Œæˆ–è€…ï¼Œæ‡‰è©²æ²¿ç”¨ä»–å€‘çš„å®šç¾©ï¼Œä¿±æ¨‚éƒ¨ã€‚è¨ˆç®—æ©Ÿç›¸é—œçš„å¾æ¥­äººå£«ï¼Œå¾ˆå–œæ­¡å…©å€‹è©ï¼Œã€Œé–‹æºã€èˆ‡ã€Œé–‹æ”¾ã€ï¼Œé€™ä¹Ÿé–“æ¥å°è‡´äº† HCC â€œè¬›å¿ƒä¸è¬›é‡‘â€ã€‚ä½†ï¼Œå…¶å¯¦ä¹Ÿæœ‰çŸ›ç›¾ä¹‹è™•ï¼Œé–‹æºå°è‡´çš„å•é¡Œæ˜¯å¯èƒ½ç™½å«–ï¼Œé–‹æ”¾å°è‡´çš„å•é¡Œæ˜¯æ€ç¶­éæ–¼ç™¼æ•£ã€‚åœ¨ HCC ä¸­ï¼Œâ€œç«‹é …â€çš„å®šç¾©æ˜¯æ¯ä¸€å€‹åƒèˆ‡è€…éƒ½å¯ä»¥åšè‡ªå·±æƒ³åšçš„äº‹ï¼Œå¯ä»¥è‡ªç”±æ‹›å‹Ÿåˆä½œè€…ï¼Œç”¨æ„›ç™¼é›»ã€‚é€™å€‹ï¼Œå¯èƒ½å°±æ˜¯å°è‡´ç”šå°‘æ–°äººåƒèˆ‡ HCC çš„åŸå› ä¹‹ä¸€ã€‚&lt;/p&gt;
&lt;p&gt;ä½†ï¼Œçˆ²ä»€éº¼æœƒäººå°‘çš„ç†ç”±ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ç­†è€…æ†‘æ„Ÿè¦ºï¼Œæ„Ÿå—åˆ°ç„¡è«–å­¸æ ¡é‚„æ˜¯ç¤¾æœƒï¼Œæœ‰ä¸€ç¨®ã€Œèººå¹³ï¼Œä½†å¸Œæœ›ä»–äººèººå¹³ã€çš„æ°£æ¯ã€‚ä½•çˆ² ã€Œèººå¹³ï¼Œä½†å¸Œæœ›ä»–äººèººå¹³ã€ï¼Œæˆ‘çš„çŒœæ¸¬æ˜¯ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä»–äººèººå¹³å¾Œï¼Œè‡ªå·±å³å¯ä¸Šä½&lt;/li&gt;
&lt;li&gt;å…ˆèººå¸¶å‹•å¾Œèººã€‚ç„¶å¾Œï¼Œå…ˆèººçš„äººä¸€å€‹é¯‰é­šæ‰“æŒºï¼Œ åšåˆ°â€œé¹¹é­šâ€ç¿»ç”Ÿ&lt;/li&gt;
&lt;li&gt;ä¸èººï¼Œçœ‹åˆ¥äººèºº&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ç•¶ç„¶ï¼Œé€™å¹¾ç¨®æ€è·¯éƒ½å¯ä»¥ç†è§£ï¼Œç«¶çˆ­ä¸­å„æ–½å…¶æ³•ï¼Œâ€œç™¾èŠ±é½Šæ”¾â€ã€‚ä½†ï¼Œç­†è€…ä½œçˆ²ä¸€å€‹çœŸæ­£èººå¹³çš„äººï¼Œæ„Ÿå—çš„ç”Ÿå­˜çš„å£“åŠ›ï¼Œè¢«â€œç”Ÿæ„äººâ€é€šéå®£æšâ€œèººå¹³â€æ“ å£“äº†æˆ‘çš„ç”Ÿå­˜ç©ºé–“ã€‚æ•…ï¼Œç”¨é€™ç¨®æ–¹å¼æ„Ÿæ…¨ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ï¼Œç©¶ç«Ÿæ˜¯ï¼Œç¤¾ç¾¤é€ å°±äººç”Ÿè§€ï¼Œé‚„æ˜¯ç›¸åŒäººç”Ÿè§€å½¢æˆç¤¾ç¾¤ï¼Ÿç­†è€…èªçˆ²æ‡‰ç•¶åƒè€ƒé€™å…©å€‹è©ï¼šã€Œé–‹æºã€èˆ‡ã€Œé–‹æ”¾ã€ã€‚äººèšé›†ï¼Œå½¢æˆç¤¾ç¾¤ï¼Œå„˜ç®¡æ˜¯æ„›å¥½èˆˆè¶£ç›¸è¿‘ï¼Œäº¦æœ‰ä¸åŒï¼Œã€Œé–‹æºã€æä¾›äº†â€œä¿®æ”¹â€å’Œâ€œé‡æ–°åˆ†ç™¼â€çš„å¯èƒ½ï¼Œã€Œé–‹æ”¾ã€å‰‡æä¾›äº†è§£é™¤äº†é™åˆ¶ï¼ˆä¸åŒ…æ‹¬å„åœ°ç¤¾æœƒé“å¾·è§„èŒƒï¼Œæ³•å¾‹æ³•è¦ï¼Œä»¥åŠä¸€åˆ‡é•åç¤¾æœƒå€«ç†çš„è¡Œçˆ²ï¼‰ï¼Œçˆ²å„ä½â€œæœ‰å¿—â€ä¹‹å£«ï¼Œæä¾›äº†å¹³è‡ºã€‚ä¾‹å¦‚ï¼Œç­†è€…å°±å¾é›»è…¦ç™½ç™¡ï¼Œè®Šæˆäº†ç¾åœ¨çš„é›»è…¦å…¥é–€é¸æ‰‹ï¼Œä¸¦é€šéè‡ªå·±çš„çŸ¥è­˜æ”¶ç©«äº†ä¸€äº›å°æˆå°±ã€‚ä½†ï¼Œ&lt;strong&gt;ä¸¦ä¸æ˜¯å› çˆ²ï¼Œä¸€ç´™å¯¦ç¿’è­‰æ˜ï¼Œæˆ–è€…ä¸€ä»½è¯éº—çš„å€‹äººç°¡ä»‹ï¼Œè€Œæ˜¯ä¸€å€‹â€œä¸æ¸…æ¥šçˆ²ä»€éº¼è¦åƒåŠ ï¼Œä½†æ˜¯è¦ºå¾—åƒåŠ äº†å¯èƒ½æœ‰äº›è¨±æ„æ€â€çš„å¿ƒã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;é™æœ›æœªä¾†ã€çˆ²æœªä¾†åšå¥½æº–å‚™æ˜¯ååˆ†é‡è¦çš„ï¼Œä½†æ˜¯ï¼Œä»€éº¼æ‰æ˜¯æœªä¾†éœ€è¦çš„ï¼Œé€™å€‹èª°ä¹Ÿä¸èƒ½è‚¯å®šã€‚å€‹äººèªçˆ²ï¼Œç¤¾ç¾¤çš„ç™¼å±•ï¼Œä¹Ÿæ‡‰å¦‚æ­¤ï¼Œç€çœ¼æœªä¾†ï¼Œæ›´åŠ è¦é—œæ³¨ç¾åœ¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç¤¾ç¾¤çš„ç—…èˆ‡æ­»&#34;&gt;ç¤¾ç¾¤çš„ç—…èˆ‡æ­»&lt;/h2&gt;
&lt;p&gt;æ²’åƒèˆ‡éï¼Œä¸ç™¼è¡¨è©•è«–ï¼Œå¯èƒ½ä»¥å¾Œæœƒå¯«ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¾Œè¨˜&#34;&gt;å¾Œè¨˜&lt;/h2&gt;
&lt;p&gt;é›–ç„¶é¡Œç›®å’Œå„æ®µæ¨™é¡Œéƒ½æ˜¯â€œç¤¾ç¾¤â€ï¼Œä½†æ˜¯è¬›åˆ°å¯èƒ½æ›´å¤šçš„å€‹é«”ã€‚å¦ï¼Œè¡Œæ–‡å‡Œäº‚ï¼Œçš†å› è¨±ä¹…æœªå‹•ç­†ï¼Œè§è°…ã€‚è¦‹æ­¤æ–‡æœ‰æ„Ÿï¼šè®¡ç®—æœºç¤¾ç¾¤ï¼Œç¦»æˆ‘æœ‰å¤šè¿œï¼Ÿâ€”â€” UIC HCC ä¸“è®¿&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>2020 å°ç»“</title>
      <link>https://blog.cklau.cc/post/summary-2020.zh/</link>
      <pubDate>Sat, 02 Jan 2021 00:11:21 +0800</pubDate>
      <guid>https://blog.cklau.cc/post/summary-2020.zh/</guid>
      <description>&lt;p&gt;2021/01/02ï¼Œçªç„¶æƒ³å†™ä¸‹ 2020 çš„æ€»ç»“ï¼Œä¹Ÿä¸èƒ½ç®—æ˜¯æ€»ç»“ï¼Œæµæ°´ä¸€ä¸‹ï¼Œè®°å½• 2020 çš„â€œæ‚²æƒ¨â€äººç”Ÿã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç¬¬ä¸€å­£åº¦&#34;&gt;ç¬¬ä¸€å­£åº¦&lt;/h2&gt;
&lt;p&gt;é™¤äº†ç–«æƒ…ï¼Œæ˜¥å¤©è¿˜å‘ç”Ÿäº†å¾ˆå¤šäº‹ï¼Œæ¯”å¦‚åœ¨è¿™ä¸ªç”³è¯·å­£å…¨å†›è¦†æ²¡ï¼Œæ¯”å¦‚å®¶é‡Œäººå»ä¸–ã€‚ æˆ‘æ‰¿è®¤æœ‰èµŒçš„æˆåˆ†ï¼Œä½†æ˜¯ç¡®å®æˆç»©å·®äº†ä¸å°‘ï¼Œæ‰€å¹¸ï¼Œä¸­ä»‹å¦‚åˆåŒåŠäº‹ï¼ŒæˆåŠŸé€€å›ä¸­ä»‹è´¹è¿˜å«–åˆ°äº†ä¸­ä»‹çš„æ–‡ä¹¦ï¼ˆä¸è¯´å¾ˆçƒ‚ï¼Œä½†è´¨é‡ç¡®å®å¾ˆä¸€èˆ¬ï¼‰ã€‚ ç¬¬ä¸€å­£åº¦ï¼Œä¹Ÿæ˜¯å¤§å››çš„æœ€åä¸€ä¸ªå­¦æœŸï¼Œå®Œæˆäº† FYP2ï¼Œ ä¹Ÿæå‡ºäº†ä¸€ä¸ªä¸èƒ½ç®—æ˜¯æ–°æ–¹æ³•çš„ â€œnovel algorithmâ€ï¼Œ è€å¸ˆä¹Ÿè§‰å¾—å¯ä»¥æŠ•ä¸ª conference è¯•è¯•ã€‚ç®—æ˜¯ç»™ CV å¤šå¢äº†ä¸€äº›å¥½çœ‹çš„ä¸œè¥¿å§ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç¬¬äºŒå­£åº¦&#34;&gt;ç¬¬äºŒå­£åº¦&lt;/h2&gt;
&lt;p&gt;æ— æ‰€äº‹äº‹ï¼Œç½‘è¯¾ä¹Ÿæ²¡å¥½å¥½ä¸Šï¼Œè€Œä¸”æˆ‘æœ€åä¸€ä¸ªå­¦æœŸè¿˜æ˜¯ 4 é—¨è¯¾ï¼ˆå¤§ä¸‰ drop äº†ä¸€é—¨ï¼Œå¦å¤–è‡ªå·±å¤šåŠ äº†ä¸€é—¨ï¼‰ï¼Œ ä¸è¿‡è¿˜å¥½ï¼Œæœ€åä¸€ä¸ªå­¦æœŸ GPA ç«Ÿç„¶ä¸Š 3 äº†ï¼Œä¹Ÿæ˜¯å››å¹´ç¬¬ä¸€æ¬¡ä¸Š 3 :) paper ä¹Ÿå†™çš„å·®ä¸å¤šäº†ï¼Œåœ¨ submission çš„æœ€åå‡ å¤©æŠ•äº†å‡ºå»ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç¬¬ä¸‰å­£åº¦&#34;&gt;ç¬¬ä¸‰å­£åº¦&lt;/h2&gt;
&lt;p&gt;æŸ 5G å…¬å¸é‚€è¯·æˆ‘è¿‡å»å®ä¹ ï¼Œä¾¿å»äº†ï¼Œæ¯å¤©éƒ½è¦ä»å¸‚åŒºåä¸€ä¸ªå¤šå°æ—¶çš„åœ°é“å»åˆ°ç§‘å­¦åŸï¼Œäººéƒ½å‚»äº†ã€‚åšç€ä¸ä¸“ä¸šæ— å…³çš„å·¥ä½œï¼ˆç¿»è¯‘æ–‡æ¡£å’ŒæŒ‡å¯¼é¢†å¯¼ï¼‰ï¼Œç»ˆæ—¥ä»¥éº¦å½“åŠ³è–¯é¥¼ä¸ºç”Ÿã€‚æœ€ååœ¨ 8 æœˆä¸­ä»¥ paper è¢« accept è€å¸ˆè¦æˆ‘æ—©ç‚¹å›å­¦æ ¡ä¸ºç”±ç‚’æ‰äº†è€æ¿ã€‚æš‘å‡ç»“æŸï¼Œå›åˆ°å­¦æ ¡å¼€å§‹ Research Assistant ç”Ÿæ´»ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç¬¬å››å­£åº¦&#34;&gt;ç¬¬å››å­£åº¦&lt;/h2&gt;
&lt;p&gt;RA çš„ç”Ÿæ´»è¯´å¿™ä¸å¿™ï¼Œè¯´ä¸å¿™ä¹Ÿå¾ˆå¿™ï¼Œä¸å¿™çš„æ˜¯æ—¶é—´å¯ä»¥è‡ªå·±å®‰æ’ï¼Œå¿™çš„æ˜¯æ¯å¤©éƒ½æœ‰å¹²ä¸å®Œçš„æ´»ï¼Œæ¯•ç«Ÿæœ‰ paper äº§å‡ºæ‰æ˜¯æœ€ç»ˆç›®æ ‡ã€‚ä¹Ÿè¿˜å¥½ï¼ŒMphil æœ‰äº†çœ‰ç›®ï¼ŒåŸºæœ¬ç®—æ˜¯å°˜åŸƒè½å®šäº†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;ç”Ÿæ´»æ€»æ˜¯èµ·èµ·è½è½ï¼ŒåŠªä¸åŠªåŠ›éƒ½ä¸€æ ·ï¼Œ ç–«æƒ…å‰å…¶å®æˆ‘å°±å¾ˆèººå¹³ï¼Œç°åœ¨çš„ç›®æ ‡èƒ½åƒåˆ°æƒ³åƒçš„å°±å¾ˆå¥½ã€‚&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>2019 å°ç»“</title>
      <link>https://blog.cklau.cc/post/summary-2019.zh/</link>
      <pubDate>Sat, 28 Dec 2019 00:11:21 +0800</pubDate>
      <guid>https://blog.cklau.cc/post/summary-2019.zh/</guid>
      <description>&lt;blockquote&gt;
&lt;p&gt;å·±äº¥ä¸ºå¹²æ”¯ä¹‹ä¸€ï¼Œé¡ºåºä¸ºç¬¬36ä¸ªã€‚å‰ä¸€ä½æ˜¯æˆŠæˆŒï¼Œåä¸€ä½æ˜¯åºšå­ã€‚è«–é™°é™½äº”è¡Œï¼Œå¤©å¹²ä¹‹å·±å±¬é™°ä¹‹åœŸï¼Œåœ°æ”¯ä¹‹äº¥å±¬é™°ä¹‹æ°´ï¼Œæ˜¯åœŸå°…æ°´ç›¸å°…ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;é€™ä¸€å¹´æˆ‘å€‘å¤±å»äº†å¾ˆå¤šå¤§å¸«ï¼šéœé‡‘ã€æŸ¥è‰¯éã€æ›¾ä»•å¼·æ•™æˆç­‰ç­‰ï¼›&lt;/p&gt;
&lt;p&gt;é€™ä¸€å¹´æˆ‘å€‘ç¶“æ­·äº†å¾ˆå¤šï¼šã€ŒPKU å¤§å­—å ±ã€ï¼Œã€Œç¾åœ‹åˆ¶è£ ZTE ã€èŠ±å» ç¾ã€ï¼Œã€ŒCN-US è²¿æ˜“ Battle ã€ï¼Œã€Œè‹±å¸è„±æ­ã€ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;å°±å€‹äººä¾†èªªï¼Œå¤±å»çš„äº†ä¸å°‘ï¼Œæ¯”å¦‚æ™‚é–“ï¼›å¾—åˆ°äº†çš„ä¸å¤šï¼Œæ¯”å¦‚æ­²æ•¸ã€‚&lt;/p&gt;
&lt;p&gt;ã€Œé€¢â€œ8â€å¿…ç½ã€ï¼Œã€Œé€¢â€œ9â€å¿…äº‚ã€ï¼›ç„¡è«–æ˜¯å¯’å†¬ä½è°·æŠ‘æˆ–æ˜¯å±æ©Ÿå››èµ·ï¼Œåªè¦åœ˜çµä¸€å¿ƒï¼Œç¸½æ˜¯èƒ½é‚éå»çš„ï¼Œ 1959 èƒ½æ‰“éå»æ–°å¾·é‡Œï¼Œ2019  å°±ä¹Ÿèƒ½æ”¶å¾©â€œå¤±åœ°â€ã€‚ä¸å®œè«‡å¤ªå¤šï¼Œä½ æ‡‚æˆ‘æ‡‚å¤§å®¶æ‡‚ã€‚&lt;/p&gt;
&lt;p&gt;å¯’å†¬éå»å°±æ˜¯æ˜¥å¤©ï¼Œå°±åƒå¹´å»¿ä¹çš„æ˜å¤©å°±æ˜¯å¹´ä¸‰åäº†ï¼Œè·¨éå»ï¼Œå°±æ˜¯æ˜¥å¤©äº†ï¼Œæ˜¥å¤©åˆ°äº†ï¼Œå°±åˆ¥å†ç•æ‡¼å¯’å†·äº†ï¼Œç”Ÿç™¼çš„å­£ç¯€ï¼Œå°±è¦åŠªåŠ›çš„å¾€ä¸Šç”Ÿé•·ã€‚&lt;/p&gt;
&lt;p&gt;å¸Œæœ›ç¸½æ˜¯è¦æœ‰çš„ï¼Œä¾‹å¦‚ï¼šä¸–ç•Œå’Œå¹³ï¼›å¦å¤–ï¼Œå›½è¶³åŠ æ²¹ã€‚&lt;/p&gt;
&lt;p&gt;å»¢è©±ä¸å¤šèªªäº†ï¼Œæˆ‘åœ¨é€™è£¡æå‰ç¥å¤§å®¶ï¼šæ–°å¹´å¿«æ¨‚ï¼Œå·±äº¥å¹´å‰ç¥¥ã€‚&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>âš–ï¸ é¡Œç›®æš«å®šç‚ºèƒ¡è¨€äº‚èªä¹‹ä½•è¬‚å…¬å¹³</title>
      <link>https://blog.cklau.cc/post/not-fair.zh/</link>
      <pubDate>Mon, 20 Aug 2018 00:10:44 +0800</pubDate>
      <guid>https://blog.cklau.cc/post/not-fair.zh/</guid>
      <description>&lt;blockquote&gt;
&lt;p&gt;ç¤¾æœƒæœ¬èº«æ˜¯ä¸å…¬å¹³çš„ï¼Œçˆ­å–çš„å°±åªæ˜¯ç›¸å°å…¬å¹³ï¼Œå¾ä¾†æ²’æœ‰çµ•å°å…¬å¹³ã€‚åŠ‰å°‘å¥‡æ›¾ç¶“è¬›éï¼šåˆ†é…å•é¡Œæ˜¯é•·æœŸæ€§çš„å•é¡Œï¼Œæ˜¯ç¤¾æœƒä¸»ç¾©ç¤¾æœƒçš„åˆ¶åº¦ä¸Šç”¢ç”Ÿçš„æ–°çš„å•é¡Œã€‚â€”â€”ç¤¾æœƒä¸»ç¾©åˆ¶åº¦ä¸‹çš„åˆ†é…å•é¡Œï¼ˆä¸€ä¹äº”ä¸ƒå¹´ä¸‰æœˆäºŒåå››æ—¥ï¼‰&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;é€™ä¹Ÿæ°æ°èªªæ˜äº†é€™å€‹å•é¡Œä¸æ˜¯ç¾åœ¨æ‰æœ‰çš„ï¼Œè€Œæ˜¯é•·æœŸä»¥å¾€çš„ã€‚é›£é“åªæœ‰ç¤¾æœƒä¸»ç¾©æ˜¯é€™æ¨£å—ï¼Ÿä½ å€‘å¿˜è¨˜äº†è³‡æœ¬ä¸»ç¾©çš„è²§å¯Œæ‡¸æ®Šäº†å—ï¼Ÿæ›´æ…˜ï¼å¾é‚£å·¥è³‡é‚£ä¸€åˆ»èµ·ï¼Œæ³¨å®šä½ å’Œåˆ¥äººçš„å·®è·ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰è¨±å¤šå·¥å» ã€å…¬å¸å»ºäº†æ“å ´ã€é‹å‹•å ´ï¼Œèªªçµ¦å“¡å·¥ç¦åˆ©ï¼Œä½†æ˜¯åŸºå±¤ç”Ÿç”¢ç·šçš„å“¡å·¥å»å¾ä¾†æ²’æœ‰æ©Ÿæœƒå»äº«å—ã€‚ç‚ºä»€éº¼ï¼Ÿå› ç‚ºä½ ä¸åŠ ç­ï¼Œå»è¸¢çƒï¼Œå°±æ²’æœ‰åŠ ç­è²»æ‹¿ï¼›ä½ ä¸é¡˜æ„åŠ ç­ï¼Œåˆ¥äººé¡˜æ„ï¼Œä½ å°±è¢«ç‚’é­·é­šï¼Œç®—æ˜¯ç¾ä»£ç‰ˆã€Œç‰©ç«¶å¤©æ“‡ã€äº†ï¼Œå¥—ç”¨è€é—†å€‘æœ€å–œæ­¡ç”¨çš„ä¸€å¥â€œæ„›å¹¹å¹¹ï¼Œä¸å¹¹æ»¾è›‹ã€‚â€&lt;/p&gt;
&lt;p&gt;ç¾å¯¦ä¹Ÿç¸½æœƒçµ¦äºˆä½ ä»¥è€³å…‰ï¼Œè®“ä½ å¾å¤¢è£¡é†’ä¾†ï¼Œå› ç‚ºè¡å‹•èˆ‡æš´åŠ›è§£æ±ºä¸äº†å•é¡Œï¼Œåè€Œæœƒè®“ä½ è‡ªå·±å—å‚·ã€‚&lt;/p&gt;
&lt;p&gt;ä¸–ç•Œæ˜¯é€™å€‹æ¨£å­ï¼Œèµ°å‘ä»»ä½•ä¸€ç¨®æ¥µç«¯éƒ½æœƒåŠ é€Ÿç³»çµ±ç“¦è§£ï¼Œä¾‹å¦‚æ¥µç«¯çš„å…±ç”¢ä¸»ç¾©æˆ–è€…æ¥µç«¯çš„è³‡æœ¬ä¸»ç¾©ã€‚
æˆ‘å€‘éƒ½å¾ˆäº†è§£å…±ç”¢ä¸»ç¾©æ˜¯å¦‚ä½•å¼•ç™¼äººé¡çš„æ€ æƒ°è€Œå°è‡´è‡ªæˆ‘æ¯€æ»…ï¼ˆåƒè¦‹äººæ°‘å…¬ç¤¾å¾Œçš„é£¢è’ï¼‰ï¼Œä½†è²¡ç”¢ç§æœ‰åŒ–çš„å•é¡Œåœ¨æ­·å²ä¸Šä¹Ÿçµ•éç½•è¦‹ã€‚ä»”ç´°æ€è€ƒæ‰€æœ‰ç‹åœ‹èˆ‡æœä»£çš„æœ«æœŸï¼Œéƒ½æ˜¯å› ç‚ºè²¡ç”¢ç§æœ‰åˆ¶åº¦é€ æˆç¤¾æœƒç„¡æ³•æµå‹•ï¼Œå‡ºç”Ÿåœ¨å¥½å®¶åº­çš„äººä¸éœ€è¦åŠªåŠ›å°±å¯ä»¥å¾—åˆ°ä¸€åˆ‡ï¼Œå‡ºç”Ÿåœ¨ç¤¾æœƒåº•å±¤çš„äººæ°¸ç„¡ç¿»èº«ä¹‹è·¯ã€‚
èªªåˆ°åº•ï¼Œæ¥µç«¯çš„å…±ç”¢ä¸»ç¾©èˆ‡æ¥µç«¯çš„è³‡æœ¬ä¸»ç¾©éƒ½æ˜¯ç·Šæ‰£è‘—ã€Œå…¬å¹³ã€é€™å€‹æ¦‚å¿µã€‚å…±ç”¢ä¸»ç¾©å¦å®šäº†äººå¤©ç”Ÿå°±æœ‰èƒ½åŠ›å·®ç•°ï¼Œè®“åŠªåŠ›åˆæœ‰æ‰è¯çš„äººå¾—ä¸åˆ°æ›´å¤šå ±é…¬ï¼Œé€™æ˜¯ä¸€ç¨®ä¸å…¬å¹³ï¼›è³‡æœ¬ä¸»ç¾©çš„æœ«æœŸå‰‡ä½¿åŠªåŠ›åˆæœ‰æ‰è¯çš„äººç„¡æ³•å‡ºé ­ï¼Œé€™ä¹Ÿæ˜¯ä¸€ç¨®ä¸å…¬å¹³ã€‚&lt;/p&gt;
&lt;p&gt;ä½ å€‘é€™æ¨£çš„å°ä»–å€‘è²¼è¿‘ä»–å€‘ï¼Œå» â€œå¹«åŠ©â€ ä»–å€‘ï¼Œè©¦æƒ³ä¸€ä¸‹ï¼Œã€ŒåŸºå±¤ã€ç•¶ä¸­æœƒæœ‰å¹¾å¤šå€‹äººï¼Œæœƒèªç‚ºåˆ¥äººå¸Œæœ›æ”¹å–„ä»–å€‘çš„å·¥ä½œå’Œç”Ÿæ´»æ¢ä»¶ï¼Œå°±æ˜¯ã€Œçœ‹ä¸èµ·ã€ä»–å€‘ï¼Ÿ å¾ˆç°¡å–®çš„è¬›ï¼Œå°±æ˜¯ä¸èªç‚ºã€ŒåŸºå±¤ã€æ˜¯å’Œä»–å€‘æœ‰ä¸€æ¨£çš„ç‰©è³ªå’Œç²¾ç¥éœ€è¦çš„äººï¼Œè€Œæ˜¯ä¸€ç¨®ç‰¹æ®Šçš„ç‰©ç¨®ï¼Œä¸€ç¨®ä¾›å°è³‡é‹å‹•å®¶å€‘ã€Œä¿è‚²ã€å’Œã€Œé‘‘è³ã€çš„å°è±¡ã€‚&lt;/p&gt;
&lt;p&gt;é€™æ¨£çš„ã€ŒRovolutionã€ä¹Ÿå¥½ï¼Œã€ŒMovementã€ä¹Ÿç½·ï¼Œèˆ‡åŸæœ¬çš„ç„¡ç”¢éšç´šé©å‘½å·²ç¶“æ˜¯èƒŒé“è€Œé¦³ï¼Œä¸å†æ˜¯ã€Œæ¶ˆé™¤å·¥äººå€‘åœ¨è³‡æœ¬ä¸»ç¾©ä¸‹çš„ç”Ÿæ´»å›°è‹¦ç­‰å¢ƒé‡ï¼Œæé«˜ç”Ÿæ´»ã€æ–‡åŒ–ã€æŠ€è¡“æ°´å¹³ï¼Œå‰µé€ è‡ªå·±çš„ç¶“æ¿ŸåŸºç¤ã€è€Œæ˜¯ä¸€ç¨®ï¼Œèªç‚ºã€Œä¸æ†‚æ…®å‰é€”ï¼Œä¸è²ªå¿ƒç”Ÿè¨ˆçš„äººã€æ‰æ˜¯ã€ŒçœŸÂ·å·¥äººéšç´šã€ï¼Œä¹Ÿæ­£æ˜¯é€™ä¸€ç¨®ã€ŒåŸºå±¤ã€æ¦‚å¿µï¼ˆèªç‚ºåªæœ‰å°åº·çš„äººæ‰æœ‰èƒ½åŠ›ä½œç‚ºåœ‹å®¶å’Œç¤¾æœƒçš„å…ˆé€²åŠ›é‡ï¼Œè€Œéæ™®é€šçš„ã€ŒåŸºå±¤ç¾¤çœ¾ã€ï¼‰ï¼Œè­‰æ˜äº†ä»–å€‘çŠ¯ä¸‹äº†ä½›æ´›ä¼Šå¾·å¼çš„éŒ¯èª¤ï¼Œè®“ä»–å€‘èˆ‡ç¤¾æœƒä¸»ç¾©ã€å…±ç”¢ä¸»æ„ä¸å†ç›¸é—œï¼Œè€Œè®Šæˆäº†ä¸€ç¨®å·¦ç¿¼æ°‘ç²¹ä¸»ç¾©ã€‚&lt;/p&gt;
&lt;p&gt;è€Œä¸”é€™äº›ï¼Œæ­£æ˜¯åœ¨ä¸Šå±¤éšç´šå’Œã€ŒåŸºå±¤ã€ä¹‹é–“å»æ‰®æ¼”ä¸€ç¨®ã€Œæ”¯æŒæ­£ç¾©ã€çš„ç¥­å¸ã€ã€Œä¼¸å¼µç¤¾æœƒå€«ç†ã€çš„åˆ¤å®˜ã€‚&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>æˆ‘ä»¬çš„ç›®æ ‡ï¼š æ²¡æœ‰è›€ç‰™ - 2017 å°çµ</title>
      <link>https://blog.cklau.cc/post/summary-2017.zh/</link>
      <pubDate>Wed, 27 Dec 2017 00:11:21 +0800</pubDate>
      <guid>https://blog.cklau.cc/post/summary-2017.zh/</guid>
      <description>&lt;blockquote&gt;
&lt;p&gt;ç­†è€…è¨»ï¼šæœ¬æ–‡ç‚ºé–‹å§‹å…¬çœ¾è™Ÿå¾Œçš„ç¬¬ä¸€å€‹å¹´åº¦å°çµ&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;é€™å€‹å…¬çœ¾è™Ÿå·²ç¶“æ´»äº† 161 å¤©äº†ã€‚&lt;/p&gt;
&lt;p&gt;2017å¹´7æœˆ19æ—¥ï¼Œç¬¬ä¸€ç¯‡æ–‡ç« ã€Šæ—¥èˆ‡å¤œã€‹çš„æ¨é€ï¼Œåˆ°ä»Šå¤©çš„é€™ä¸€æ¢ã€Šæˆ‘å€‘çš„ç›®æ¨™ã€‹æ‡‰è©²å·²æœ‰åä¸‰ç¯‡äº†ï¼Œå…¶ä¸­æœ‰é—œæ–¼è‡ªå·±çš„ï¼Œä¹Ÿæœ‰é—œæ–¼ ingress çš„ï¼› å¤§éƒ½æ˜¯è‡ªå·±å°å¤–ç•Œçš„çœ‹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;å¹´æœ«äº†ï¼Œä½œç‚ºä¸€å€‹å®Œå…¨æ²’æœ‰çŸ¥ååº¦çš„å€‹äººå…¬çœ¾è™Ÿï¼Œç…§ä¾‹è©²åšä¸€ä¸‹å¹´ç¸½ç¸½çµã€‚&lt;/p&gt;
&lt;h2 id=&#34;å…¬çœ¾è™Ÿçš„å»ºç«‹&#34;&gt;å…¬çœ¾è™Ÿçš„å»ºç«‹&lt;/h2&gt;
&lt;p&gt;å»ºç«‹é€™å€‹å…¬çœ¾è™Ÿçš„åˆè¡·å¾ˆç°¡å–®ï¼Œå°±æ˜¯ç‚ºäº†å¯ä»¥çå¯«ï¼Œæ»¿è¶³è‡ªå·±çš„å€‹äººæ…¾æœ›ã€‚æˆ‘é€™å€‹äººé›–ç„¶æ–‡ç­†ä¸å¥½ï¼Œå»åˆå–œæ­¡å¯«æ±è¥¿ï¼›è®€å¾—æ›¸å°‘ï¼Œå»åˆå–œæ­¡äº‚æƒ³ï¼›èªªè©±ä¸è¨å–œï¼Œå»é‚„å–œæ­¡é€¼é€¼ã€‚æ—¢ç„¶å¦‚æ­¤ï¼Œé‚£ä¾¿æå€‹å…¬çœ¾è™Ÿå§ï¼Œä¸€ä¾†å¯ä»¥æ»¿è¶³å€‹äººæ…¾æœ›ï¼›äºŒä¾†ï¼Œèªªä¸å®šå°±æœ‰äººå–œæ­¡æˆ‘é€™æ¨£çš„å‘¢ğŸ˜ƒ&lt;/p&gt;
&lt;p&gt;å‰å‰å¾Œå¾Œï¼Œä¸€å¤©æ™‚é–“ï¼Œå¤§æ¦‚å°±æå¥½äº†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¯¦ç¿’&#34;&gt;å¯¦ç¿’&lt;/h2&gt;
&lt;p&gt;æ‰˜äº†çˆ¶è¦ªçš„ç¦ï¼Œæš‘å‡æ‰¾äº†ä¸€å®¶çš„å…¬å¸åšäº†ä¸€æœŸçš„å¯¦ç¿’ï¼šå¹«åŠ©å…¬å¸é‡æ–°åšç¶²ç«™ã€‚çœŸæ­£èªè­˜åˆ°äº† â€œç¤¾æœƒå¤§å­¸â€ èˆ‡å¤§å­¸çš„ä¸åŒï¼šä¸Šç­æœŸé–“éƒ½æ˜¯è€ƒè©¦æ™‚é–“ï¼Œå·®ç•°åœ¨æ–¼ï¼šè€é—†å¾ä¾†ä¸æœƒå‘Šè¨´ä½ ä»–ä»€éº¼æ™‚å€™è€ƒè©¦ï¼Œä¸€ä¸Šä¾†å°±æ˜¯æå•ï¼›å“¡å·¥ä¹‹é–“é›–ç„¶ç›¸æœƒå‹å¥½ï¼Œä½†ä¹Ÿä¸æœƒå†åƒåŒå­¸ä¹‹é–“é‚£æ¨£çš„ç´”æ¨¸ï¼›UIC å­¸åˆ°çš„å°çµ„åˆä½œï¼Œä¹Ÿç¢ºå¯¦å¾ˆæœ‰æ•ˆã€‚æ‰€ä»¥ï¼Œä¸ç”¨æ“”å¿ƒâ€œ ä¸Š UIC åˆ°åº•èƒ½å­¸åˆ°æ±è¥¿ â€ é€™æ¨£çš„å•é¡Œäº†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å€‹äººç¶²ç«™&#34;&gt;å€‹äººç¶²ç«™&lt;/h2&gt;
&lt;p&gt;å¯¦ç¿’çš„æ™‚å€™ï¼Œé …ç›®å°±æ˜¯å¹«å…¬å¸å»ºç«™ï¼Œæ—¢ç„¶å¦‚æ­¤ï¼Œç‚ºä»€éº¼ä¸èƒ½åšä¸€å€‹å€‹äººç¶²ç«™å‘¢ï¼Œå°‡å€‹äººä½œå“æ”¾ä¸Šå»å‘¢ï¼Ÿï¼ˆä»¥å¾Œç°¡æ­·è£¡é‚„å¯ä»¥å¯«å¤šé»æ±è¥¿ï¼‰
ç•¶ç„¶ï¼Œå¤±æ•—äº†å¾ˆå¤šæ¬¡ã€‚ï¼ˆè‡ªå·±èƒŒé‹ï¼Œç¸½æ˜¯åœ¨æ‹–ï¼‰çµ‚æ–¼ï¼Œåœ¨é€™å€‹å­¸æœŸçš„æœŸä¸­è€ƒè©¦å¾Œæå®šäº†ã€‚
å¦‚æœæ²’æœ‰ä»€éº¼æ„å¤–ï¼Œä¸€ç›´æœƒæ²¿ç”¨å¥¹çš„ã€‚æƒ³çœ‹çš„è©±ï¼Œé»æ“Šé–±è®€åŸæ–‡å§ã€‚&lt;/p&gt;
&lt;h2 id=&#34;é‚„æœ‰&#34;&gt;é‚„æœ‰&lt;/h2&gt;
&lt;p&gt;é€™ä¸€å¹´ï¼Œç™¼ç”Ÿäº†å¾ˆå¤šäº‹ï¼Œå¾ ä¸‰æ˜Ÿ S8 åˆ° iPhone X å†åˆ°å‰å¹¾é€±çš„ Smartisan å …æœ pro2 ï¼Œé€™äº›éƒ½è·Ÿæˆ‘ç„¡é—œï¼›å¾æš‘å‡åœ¨æ–°ç”Ÿå®¶é•·ç¾¤è¢«åˆé›£åˆ°é¢å°é¢å°æ–°ç”Ÿ â€œåˆé›£â€ ï¼Œé€™ä¸€å¹´ç¢ºå¯¦æˆé•·äº†å¾ˆå¤šï¼›ç™¼ç”Ÿäº†å¾ˆå¤šäº‹ï¼Œå°±ä¸å›‰å—¦äº†ã€‚&lt;/p&gt;
&lt;p&gt;å¤©å¤©åˆ·ç‰™ï¼Œè›€ç‰™æ‡‰è©²æ˜¯æ²’æœ‰äº†ï¼Œå¸Œæœ›æ˜å¹´é‚„èƒ½é–‹é–‹å¿ƒå¿ƒå§&lt;/p&gt;</description>
    </item>
    
  </channel>
</rss>